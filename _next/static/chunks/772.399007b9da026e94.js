(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[772],{11261:function(t){"use strict";t.exports=function(){function t(t){var e,a,s=[];return t.AMapUI&&s.push((e=t.AMapUI,new Promise(function(t,a){var s=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==r.AMapUI.plugins.indexOf(e.plugins[u])&&s.push(e.plugins[u]);if(i.AMapUI===n.failed)a("前次请求 AMapUI 失败");else if(i.AMapUI===n.notload){i.AMapUI=n.loading,r.AMapUI.version=e.version||r.AMapUI.version,u=r.AMapUI.version;var c=document.body||document.head,l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/ui/"+u+"/main.js",l.onerror=function(t){i.AMapUI=n.failed,a("请求 AMapUI 失败")},l.onload=function(){if(i.AMapUI=n.loaded,s.length)window.AMapUI.loadUI(s,function(){for(var e=0,n=s.length;e<n;e++){var r=s[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();o.AMapUI.length;)o.AMapUI.splice(0,1)[0]()});else for(t();o.AMapUI.length;)o.AMapUI.splice(0,1)[0]()},c.appendChild(l)}else i.AMapUI===n.loaded?e.version&&e.version!==r.AMapUI.version?a("不允许多个版本 AMapUI 混用"):s.length?window.AMapUI.loadUI(s,function(){for(var e=0,n=s.length;e<n;e++){var r=s[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()}):t():e.version&&e.version!==r.AMapUI.version?a("不允许多个版本 AMapUI 混用"):o.AMapUI.push(function(e){e?a(e):s.length?window.AMapUI.loadUI(s,function(){for(var e=0,n=s.length;e<n;e++){var r=s[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()}):t()})}))),t.Loca&&s.push((a=t.Loca,new Promise(function(t,e){if(i.Loca===n.failed)e("前次请求 Loca 失败");else if(i.Loca===n.notload){i.Loca=n.loading,r.Loca.version=a.version||r.Loca.version;var s=r.Loca.version,u=r.AMap.version.startsWith("2"),c=s.startsWith("2");if(u&&!c||!u&&c)e("JSAPI 与 Loca 版本不对应！！");else{u=r.key,c=document.body||document.head;var l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/loca?v="+s+"&key="+u,l.onerror=function(t){i.Loca=n.failed,e("请求 AMapUI 失败")},l.onload=function(){for(i.Loca=n.loaded,t();o.Loca.length;)o.Loca.splice(0,1)[0]()},c.appendChild(l)}}else i.Loca===n.loaded?a.version&&a.version!==r.Loca.version?e("不允许多个版本 Loca 混用"):t():a.version&&a.version!==r.Loca.version?e("不允许多个版本 Loca 混用"):o.Loca.push(function(t){t?e(t):e()})}))),Promise.all(s)}if(!window)throw Error("AMap JSAPI can only be used in Browser.");(e=n||(n={})).notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed";var e,n,r={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},o={AMap:[],AMapUI:[],Loca:[]},a=[],s=function(t){"function"==typeof t&&(i.AMap===n.loaded?t(window.AMap):a.push(t))};return{load:function(e){return new Promise(function(o,u){if(i.AMap==n.failed)u("");else if(i.AMap==n.notload){var c=e.key,l=e.version,f=e.plugins;c?(window.AMap&&"lbs.amap.com"!==location.host&&u("禁止多种API加载方式混用"),r.key=c,r.AMap.version=l||r.AMap.version,r.AMap.plugins=f||r.AMap.plugins,i.AMap=n.loading,l=document.body||document.head,window.___onAPILoaded=function(r){if(delete window.___onAPILoaded,r)i.AMap=n.failed,u(r);else for(i.AMap=n.loaded,t(e).then(function(){o(window.AMap)}).catch(u);a.length;)a.splice(0,1)[0]()},(f=document.createElement("script")).type="text/javascript",f.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+r.AMap.version+"&key="+c+"&plugin="+r.AMap.plugins.join(","),f.onerror=function(t){i.AMap=n.failed,u(t)},l.appendChild(f)):u("请填写key")}else if(i.AMap==n.loaded){if(e.key&&e.key!==r.key)u("多个不一致的 key");else if(e.version&&e.version!==r.AMap.version)u("不允许多个版本 JSAPI 混用");else{if(c=[],e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==r.AMap.plugins.indexOf(e.plugins[l])&&c.push(e.plugins[l]);c.length?window.AMap.plugin(c,function(){t(e).then(function(){o(window.AMap)}).catch(u)}):t(e).then(function(){o(window.AMap)}).catch(u)}}else if(e.key&&e.key!==r.key)u("多个不一致的 key");else if(e.version&&e.version!==r.AMap.version)u("不允许多个版本 JSAPI 混用");else{var h=[];if(e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==r.AMap.plugins.indexOf(e.plugins[l])&&h.push(e.plugins[l]);s(function(){h.length?window.AMap.plugin(h,function(){t(e).then(function(){o(window.AMap)}).catch(u)}):t(e).then(function(){o(window.AMap)}).catch(u)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,r={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},o={AMap:[],AMapUI:[],Loca:[]}}}}()},58800:function(t){"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,o),!0;case 6:return l.fn.call(l.context,e,r,i,o,a),!0}for(c=1,u=Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,r);break;case 4:l[c].fn.call(l[c].context,e,r,i);break;default:if(!u)for(h=1,u=Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s},23969:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(t){try{var e=(e=document.getElementsByTagName("script"))[e.length-1],n=e.getAttribute("data-injectcss"),e=e.getAttribute("data-disable-injectsvg");if(!e){var r,i,o,a,s,u=function(t,e){e.parentNode.insertBefore(t,e)};if(n&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var e,n=document.createElement("div");n.innerHTML=t._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(e=document.body).firstChild?u(n,e.firstChild):e.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=t.document,s=!1,function t(){try{a.documentElement.doScroll("left")}catch(e){return void setTimeout(t,50)}c()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,c())})}function c(){s||(s=!0,o())}}catch(t){}}(window)},61369:function(t,e,n){var r,i,o=n(49079);r=i||(i={}),function(t){var e="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(r);function o(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===e.Reflect?e.Reflect=r:i=o(e.Reflect,i),t(i)}(function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s=({__proto__:[]})instanceof Array,u=!a&&!s,c={create:a?function(){return Z(Object.create(null))}:s?function(){return Z({__proto__:null})}:function(){return Z({})},has:u?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:u?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),f="object"==typeof o&&o.env&&"true"===o.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,o)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function o(t,e){return e}function a(t,e){return[t,e]}}():Map,p=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}():Set,d=new(f||"function"!=typeof WeakMap?function(){var t=c.create(),n=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do e="@@WeakMap@@"+function(){var t="function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(16)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(16)):o(new Uint8Array(16),16):o(Array(16),16);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var e="",n=0;n<16;++n){var r=t[n];(4===n||6===n||8===n)&&(e+="-"),r<16&&(e+="0"),e+=r.toString(16).toLowerCase()}return e}();while(c.has(t,e));return t[e]=!0,e}function i(t,r){if(!e.call(t,n)){if(!r)return;Object.defineProperty(t,n,{value:c.create()})}return t[n]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}}():WeakMap);function v(t,e,n){var r=d.get(t);if(_(r)){if(!n)return;r=new h,d.set(t,r)}var i=r.get(e);if(_(i)){if(!n)return;i=new h,r.set(e,i)}return i}function m(t,e,n){var r=v(e,n,!1);return!_(r)&&!!r.has(t)}function g(t,e,n){var r=v(e,n,!1);if(!_(r))return r.get(t)}function y(t,e,n,r){v(n,r,!0).set(t,e)}function b(t,e){var n=[],r=v(t,e,!1);if(_(r))return n;for(var o=function(t){var e=M(t,i);if(!E(e))throw TypeError();var n=e.call(t);if(!w(n))throw TypeError();return n}(r.keys()),a=0;;){var s=function(t){var e=t.next();return!e.done&&e}(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(t){try{(function(t){var e=t.return;e&&e.call(t)})(o)}finally{throw t}}a++}}function x(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function _(t){return void 0===t}function S(t){return null===t}function w(t){return"object"==typeof t?null!==t:"function"==typeof t}function k(t){var e=function(t,e){switch(x(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=M(t,r);if(void 0!==i){var o=i.call(t,n);if(w(o))throw TypeError();return o}return function(t,e){if("string"===e){var n=t.toString;if(E(n)){var r=n.call(t);if(!w(r))return r}var i=t.valueOf;if(E(i)){var r=i.call(t);if(!w(r))return r}}else{var i=t.valueOf;if(E(i)){var r=i.call(t);if(!w(r))return r}var o=t.toString;if(E(o)){var r=o.call(t);if(!w(r))return r}}throw TypeError()}(t,"default"===n?"number":n)}(t,3);return"symbol"==typeof e?e:""+e}function C(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function E(t){return"function"==typeof t}function A(t){return"function"==typeof t}function M(t,e){var n=t[e];if(null!=n){if(!E(n))throw TypeError();return n}}function L(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l||e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function Z(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,n,r){if(_(n)){if(!C(t)||!A(e))throw TypeError();return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!_(r)&&!S(r)){if(!A(r))throw TypeError();e=r}}return e}(t,e)}if(!C(t)||!w(e)||!w(r)&&!_(r)&&!S(r))throw TypeError();return S(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!_(o)&&!S(o)){if(!w(o))throw TypeError();r=o}}return r}(t,e,n=k(n),r)}),t("metadata",function(t,e){return function(n,r){if(!w(n)||!_(r)&&!function(t){switch(x(t)){case 3:case 4:return!0;default:return!1}}(r))throw TypeError();y(t,e,n,r)}}),t("defineMetadata",function(t,e,n,r){if(!w(n))throw TypeError();return _(r)||(r=k(r)),y(t,e,n,r)}),t("hasMetadata",function(t,e,n){if(!w(e))throw TypeError();return _(n)||(n=k(n)),function t(e,n,r){if(m(e,n,r))return!0;var i=L(n);return!S(i)&&t(e,i,r)}(t,e,n)}),t("hasOwnMetadata",function(t,e,n){if(!w(e))throw TypeError();return _(n)||(n=k(n)),m(t,e,n)}),t("getMetadata",function(t,e,n){if(!w(e))throw TypeError();return _(n)||(n=k(n)),function t(e,n,r){if(m(e,n,r))return g(e,n,r);var i=L(n);if(!S(i))return t(e,i,r)}(t,e,n)}),t("getOwnMetadata",function(t,e,n){if(!w(e))throw TypeError();return _(n)||(n=k(n)),g(t,e,n)}),t("getMetadataKeys",function(t,e){if(!w(t))throw TypeError();return _(e)||(e=k(e)),function t(e,n){var r=b(e,n),i=L(e);if(null===i)return r;var o=t(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new p,s=[],u=0;u<r.length;u++){var c=r[u],l=a.has(c);l||(a.add(c),s.push(c))}for(var f=0;f<o.length;f++){var c=o[f],l=a.has(c);l||(a.add(c),s.push(c))}return s}(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!w(t))throw TypeError();return _(e)||(e=k(e)),b(t,e)}),t("deleteMetadata",function(t,e,n){if(!w(e))throw TypeError();_(n)||(n=k(n));var r=v(e,n,!1);if(_(r)||!r.delete(t))return!1;if(r.size>0)return!0;var i=d.get(e);return i.delete(n),i.size>0||(d.delete(e),!0)})})},99769:function(t,e,n){"use strict";n.r(e),n.d(e,{AJAXError:function(){return r7},AttributeType:function(){return hL},BKDRHash:function(){return aU},BaiduMap:function(){return _m},BaseLayer:function(){return pG},BaseMapService:function(){return _o},BaseMapWrapper:function(){return xx},BaseModel:function(){return pQ},BasePostProcessingPass:function(){return f4},BlendType:function(){return lh},ButtonControl:function(){return pa},CameraUniform:function(){return hE},CanvasLayer:function(){return p4},CanvasUpdateType:function(){return p3},CityBuildingLayer:function(){return vw},Control:function(){return po},CoordinateSystem:function(){return lM},CoordinateUniform:function(){return lT},DOM:function(){return rL},Earth:function(){return wt},EarthLayer:function(){return mz},ExportImage:function(){return pp},FrequencyController:function(){return af},Fullscreen:function(){return px},GaodeMap:function(){return _n},GaodeMapV1:function(){return x7},GaodeMapV2:function(){return _n},GeoLocate:function(){return p_},GeometryLayer:function(){return vM},GoogleMap:function(){return wH},HeatmapLayer:function(){return vI},IDebugLog:function(){return hA},ILayerStage:function(){return lv},ImageLayer:function(){return vN},InteractionEvent:function(){return lI},LRUCache:function(){return a0},LayerPopup:function(){return xb},LayerSwitch:function(){return pw},LineLayer:function(){return vQ},LineTriangulation:function(){return ul},LinearDir:function(){return p0},LoadTileDataStatus:function(){return su},Logo:function(){return pk},Map:function(){return wr},MapLibre:function(){return wg},MapServiceEvent:function(){return hZ},MapTheme:function(){return pA},MapType:function(){return aG},Mapbox:function(){return wf},Marker:function(){return pn},MarkerLayer:function(){return pi},MaskLayer:function(){return mB},MaskOperation:function(){return ld},MouseLocation:function(){return pM},PassType:function(){return fK},PointFillTriangulation:function(){return uf},PointLayer:function(){return mg},PolygonLayer:function(){return mC},PopperControl:function(){return pc},Popup:function(){return xg},PositionType:function(){return la},RasterLayer:function(){return mL},RasterTileType:function(){return hO},Satistics:function(){return rZ},Scale:function(){return pT},ScaleTypes:function(){return hM},Scene:function(){return kY},SceneConifg:function(){return r5},SceneEventList:function(){return hP},SelectControl:function(){return pf},SizeUnitType:function(){return p2},Source:function(){return pe},SourceTile:function(){return sb},StencilType:function(){return lp},StyleScaleType:function(){return hT},Swipe:function(){return xv},TMap:function(){return wR},TYPES:function(){return ci},TencentMap:function(){return wM},TextureBlend:function(){return p1},TextureUsage:function(){return lj},TileDebugLayer:function(){return mZ},TilesetManager:function(){return sC},UpdateTileStrategy:function(){return ss},Viewport:function(){return xD},WindLayer:function(){return mQ},WorkerSourceMap:function(){return ud},Zoom:function(){return xm},aProjectFlat:function(){return ak},amap2Project:function(){return aE},amap2UnProject:function(){return aA},anchorTranslate:function(){return ip},anchorType:function(){return ih},applyAnchorClass:function(){return id},bBoxToBounds:function(){return aP},bindAll:function(){return al},boundsContains:function(){return aZ},calAngle:function(){return aD},calDistance:function(){return aR},calculateCentroid:function(){return aj},calculatePointsCenterAndRadius:function(){return aB},container:function(){return hy},createLayerContainer:function(){return h_},createSceneContainer:function(){return hx},decodePickingColor:function(){return iG},defaultValue:function(){return ux},djb2hash:function(){return aV},encodePickingColor:function(){return iW},executeWorkerTask:function(){return uy},expandUrl:function(){return sA},extent:function(){return ag},flow:function(){return az},formatImage:function(){return il},generateCatRamp:function(){return iX},generateColorRamp:function(){return iY},generateCustomRamp:function(){return i$},generateLinearRamp:function(){return iq},generateQuantizeRamp:function(){return iK},getAngle:function(){return aN},getArrayBuffer:function(){return ie},getBBoxFromPoints:function(){return aF},getCullFace:function(){return i1},getData:function(){return ii},getDefaultDomain:function(){return iJ},getImage:function(){return ic},getJSON:function(){return it},getProtocolAction:function(){return r4},getReferrer:function(){return ai},getTileIndices:function(){return sg},getTileWarpXY:function(){return sy},getURLFromTemplate:function(){return sM},getWMTSURLFromTemplate:function(){return sT},gl:function(){return lq},guid:function(){return aH},isAndroid:function(){return as},isColor:function(){return iV},isImageBitmap:function(){return an},isPC:function(){return au},isURLTemplate:function(){return sE},isWorker:function(){return ar},isiOS:function(){return aa},latitude:function(){return aS},lazyInject:function(){return hm},lazyMultiInject:function(){return hg},lineAtOffset:function(){return aQ},lineAtOffsetAsyc:function(){return aJ},lineStyleType:function(){return pJ},lngLatInExtent:function(){return am},lngLatToMeters:function(){return ab},lnglatDistance:function(){return aM},lodashUtil:function(){return oD},longitude:function(){return a_},makeXMLHttpRequestPromise:function(){return r8},metersToLngLat:function(){return ax},normalize:function(){return aO},osmLonLat2TileXY:function(){return sd},osmTileXY2LonLat:function(){return sv},packCircleVertex:function(){return hC},padBounds:function(){return aL},polygonFillTriangulation:function(){return uh},postData:function(){return ir},project:function(){return aT},removeDuplicateUniforms:function(){return fz},rgb2arr:function(){return iH},sameOrigin:function(){return io},setL7WorkerSource:function(){return ug},tileToBounds:function(){return sm},tranfrormCoord:function(){return ay},unProjectFlat:function(){return aC},validateLngLat:function(){return aw},version:function(){return kq}});var r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M,L,Z,P,O,R,I,D,N,z,j,B,F,U,V,H,G,W,Y,q,X,K,$,Q,J,tt,te,tn,tr,ti,to,ta,ts,tu,tc,tl,tf,th,tp,td,tv,tm,tg,ty,tb,tx,t_,tS,tw,tk,tC,tE,tA,tM,tT,tL,tZ,tP,tO,tR,tI,tD,tN,tz,tj,tB,tF,tU,tV,tH,tG,tW,tY,tq,tX,tK,t$,tQ,tJ,t0,t1,t2,t3,t5,t4,t7,t6,t8,t9,et,ee,en,er,ei,eo,ea,es,eu,ec,el,ef,eh,ep,ed,ev,em,eg,ey,eb,ex,e_,eS,ew,ek,eC,eE,eA,eM,eT,eL,eZ,eP,eO,eR,eI,eD,eN,ez,ej,eB,eF,eU,eV,eH,eG,eW,eY,eq,eX,eK,e$,eQ,eJ,e0,e1,e2,e3,e5,e4,e7,e6,e8,e9,nt,ne,nn,nr,ni,no,na,ns,nu,nc,nl,nf,nh,np,nd,nv,nm,ng,ny,nb,nx,n_,nS,nw,nk,nC,nE,nA,nM,nT,nL,nZ,nP,nO,nR,nI,nD,nN,nz,nj,nB,nF,nU,nV,nH,nG,nW,nY,nq,nX,nK,n$,nQ,nJ,n0,n1,n2,n3,n5,n4,n7,n6,n8,n9,rt,re,rn,rr,ri,ro,ra,rs,ru,rc,rl,rf,rh,rp,rd,rv,rm,rg,ry,rb,rx,r_,rS,rw,rk,rC,rE,rA,rM,rT,rL={};n.r(rL),n.d(rL,{DPR:function(){return o1},addClass:function(){return oV},addStyle:function(){return o2},appendElementType:function(){return at},clearChildren:function(){return o8},create:function(){return oF},css2Style:function(){return o4},empty:function(){return oX},findParentElement:function(){return ae},getClass:function(){return oq},getContainer:function(){return oz},getDiffRect:function(){return o7},getStyleList:function(){return o3},getViewPortScale:function(){return o0},hasClass:function(){return oG},printCanvas:function(){return oJ},remove:function(){return oU},removeClass:function(){return oH},removeStyle:function(){return o5},setChecked:function(){return o6},setClass:function(){return oW},setTransform:function(){return o$},setUnDraggable:function(){return o9},splitWords:function(){return oB},toggleClass:function(){return oY},triggerResize:function(){return oQ},trim:function(){return oj}});var rZ={};n.r(rZ),n.d(rZ,{getColumn:function(){return a6},getSatByColumn:function(){return a8},max:function(){return a1},mean:function(){return a5},min:function(){return a2},mode:function(){return a4},statMap:function(){return a7},sum:function(){return a3}});var rP={};n.r(rP),n.d(rP,{add:function(){return c6},adjoint:function(){return cE},clone:function(){return cb},copy:function(){return cx},create:function(){return cy},determinant:function(){return cA},equals:function(){return ln},exactEquals:function(){return le},frob:function(){return c7},fromQuat:function(){return cq},fromQuat2:function(){return cU},fromRotation:function(){return cN},fromRotationTranslation:function(){return cF},fromRotationTranslationScale:function(){return cW},fromRotationTranslationScaleOrigin:function(){return cY},fromScaling:function(){return cD},fromTranslation:function(){return cI},fromValues:function(){return c_},fromXRotation:function(){return cz},fromYRotation:function(){return cj},fromZRotation:function(){return cB},frustum:function(){return cX},getRotation:function(){return cG},getScaling:function(){return cH},getTranslation:function(){return cV},identity:function(){return cw},invert:function(){return cC},lookAt:function(){return c3},mul:function(){return lr},multiply:function(){return cM},multiplyScalar:function(){return c9},multiplyScalarAndAdd:function(){return lt},ortho:function(){return c1},orthoNO:function(){return c0},orthoZO:function(){return c2},perspective:function(){return c$},perspectiveFromFieldOfView:function(){return cJ},perspectiveNO:function(){return cK},perspectiveZO:function(){return cQ},rotate:function(){return cZ},rotateX:function(){return cP},rotateY:function(){return cO},rotateZ:function(){return cR},scale:function(){return cL},set:function(){return cS},str:function(){return c4},sub:function(){return li},subtract:function(){return c8},targetTo:function(){return c5},translate:function(){return cT},transpose:function(){return ck}});var rO={};n.r(rO),n.d(rO,{add:function(){return dn},angle:function(){return dP},bezier:function(){return dk},ceil:function(){return ds},clone:function(){return p6},copy:function(){return dt},create:function(){return p7},cross:function(){return d_},dist:function(){return dB},distance:function(){return dd},div:function(){return dj},divide:function(){return da},dot:function(){return dx},equals:function(){return dD},exactEquals:function(){return dI},floor:function(){return du},forEach:function(){return dH},fromValues:function(){return p9},hermite:function(){return dw},inverse:function(){return dy},len:function(){return dU},length:function(){return p8},lerp:function(){return dS},max:function(){return dl},min:function(){return dc},mul:function(){return dz},multiply:function(){return di},negate:function(){return dg},normalize:function(){return db},random:function(){return dC},rotateX:function(){return dT},rotateY:function(){return dL},rotateZ:function(){return dZ},round:function(){return df},scale:function(){return dh},scaleAndAdd:function(){return dp},set:function(){return de},sqrDist:function(){return dF},sqrLen:function(){return dV},squaredDistance:function(){return dv},squaredLength:function(){return dm},str:function(){return dR},sub:function(){return dN},subtract:function(){return dr},transformMat3:function(){return dA},transformMat4:function(){return dE},transformQuat:function(){return dM},zero:function(){return dO}});var rR={},rI={},rD=function(t){return rI[t]},rN=function(t,e){rI[t]=e},rz=function(t,e){rR[t]=e},rj={},rB={};function rF(t){return Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'}).join(",")+"}")}function rU(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var r in t)r in e||n.push(e[r]=r)}),n}function rV(t,e){var n=t+"",r=n.length;return r<e?Array(e-r+1).join(0)+n:n}var rH=function(t){var e=RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,c=!1;function l(){if(u)return rB;if(c)return c=!1,rj;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?c=!0:13===r&&(c=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))c=!0;else if(13===r)c=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=l())!==rB;){for(var f=[];r!==rj&&r!==rB;)f.push(r),r=l();e&&null==(f=e(f,s++))||i.push(f)}return i}function i(e,n){return e.map(function(e){return n.map(function(t){return a(e[t])}).join(t)})}function o(e){return e.map(a).join(t)}function a(t){var n,r,i,o,a,s;return null==t?"":t instanceof Date?(r=(n=t).getUTCHours(),i=n.getUTCMinutes(),o=n.getUTCSeconds(),a=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((s=n.getUTCFullYear())<0?"-"+rV(-s,6):s>9999?"+"+rV(s,6):rV(s,4))+"-"+rV(n.getUTCMonth()+1,2)+"-"+rV(n.getUTCDate(),2)+(a?"T"+rV(r,2)+":"+rV(i,2)+":"+rV(o,2)+"."+rV(a,3)+"Z":o?"T"+rV(r,2)+":"+rV(i,2)+":"+rV(o,2)+"Z":i||r?"T"+rV(r,2)+":"+rV(i,2)+"Z":"")):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,function(t,r){var o;if(n)return n(t,r-1);i=t,n=e?(o=rF(t),function(n,r){return e(o(n),r,t)}):rF(t)});return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=rU(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=rU(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),rG=rH.parse;rH.parseRows,rH.format,rH.formatBody,rH.formatRows,rH.formatRow,rH.formatValue;var rW=n(5239),rY=n(17037),rq=n(24274),rX=n(65127),rK=n(47365),r$=n(96171),rQ=n(72784),rJ=n(68605),r0=n(89988),r1=n(29676);function r2(t,e,n){if((0,r1.Z)())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&(0,r0.Z)(i,n.prototype),i}function r3(t){var e="function"==typeof Map?new Map:void 0;return(r3=function(t){if(null===t||!function(t){try{return -1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return r2(t,arguments,(0,rJ.Z)(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),(0,r0.Z)(n,t)})(t)}var r5={REGISTERED_PROTOCOLS:{}},r4=function(t){return r5.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]},r7=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t,e,i,o){var a;return(0,rK.Z)(this,r),(a=n.call(this,"AJAXError: ".concat(e," (").concat(t,"): ").concat(i))).status=t,a.statusText=e,a.url=i,a.body=o,a}return(0,rX.Z)(r)}(r3(Error));function r6(t,e){var n=new XMLHttpRequest,r=Array.isArray(t.url)?t.url[0]:t.url;for(var i in n.open(t.method||"GET",r,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)t.headers.hasOwnProperty(i)&&n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});e(new r7(n.status,n.statusText,r.toString(),o))}},n.cancel=n.abort,n.send(t.body),n}function r8(t){return new Promise(function(e,n){r6(t,function(t,r,i,o,a){t?n({err:t,data:null,xhr:a}):e({err:null,data:r,cacheControl:i,expires:o,xhr:a})})})}function r9(t,e){return r6(t,e)}var it=function(t,e){return(r4(t.url)||r9)((0,rW.Z)((0,rW.Z)({},t),{},{type:"json"}),e)},ie=function(t,e){return(r4(t.url)||r9)((0,rW.Z)((0,rW.Z)({},t),{},{type:"arrayBuffer"}),e)},ir=function(t,e){return r6((0,rW.Z)((0,rW.Z)({},t),{},{method:"POST"}),e)},ii=function(t,e){return r6((0,rW.Z)((0,rW.Z)({},t),{},{method:"GET"}),e)};function io(t){var e=window.document.createElement("a");return e.href=t,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}var ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function is(t,e){var n=new window.Image,r=window.URL||window.webkitURL;n.crossOrigin="anonymous",n.onload=function(){e(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(function(){n.src=ia})},n.onerror=function(){return e(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(i):ia}function iu(t,e){var n=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(n).then(function(t){e(null,t)}).catch(function(t){e(Error("Could not load image because of ".concat(t.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ic=function(t,e,n){var r=function(t,r){if(t)e(t);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?iu(o,e):is(o,e)}};return"json"===t.type?it(t,r):ie(t,r)},il=function(t,e){"function"==typeof createImageBitmap?iu(t,e):is(t,e)},ih=((o={}).CENTER="center",o.TOP="top",o["TOP-LEFT"]="top-left",o["TOP-RIGHT"]="top-right",o.BOTTOM="bottom",o["BOTTOM-LEFT"]="bottom-left",o["BOTTOM-RIGHT"]="bottom-right",o.LEFT="left",o.RIGHT="right",o),ip={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function id(t,e,n){var r=t.classList;for(var i in ip)ip.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(e))}function iv(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function im(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ig(){}var iy="\\s*([+-]?\\d+)\\s*",ib="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ix="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",i_=/^#([0-9a-f]{3,8})$/,iS=RegExp("^rgb\\("+[iy,iy,iy]+"\\)$"),iw=RegExp("^rgb\\("+[ix,ix,ix]+"\\)$"),ik=RegExp("^rgba\\("+[iy,iy,iy,ib]+"\\)$"),iC=RegExp("^rgba\\("+[ix,ix,ix,ib]+"\\)$"),iE=RegExp("^hsl\\("+[ib,ix,ix]+"\\)$"),iA=RegExp("^hsla\\("+[ib,ix,ix,ib]+"\\)$"),iM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function iT(){return this.rgb().formatHex()}function iL(){return this.rgb().formatRgb()}function iZ(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=i_.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?iP(e):3===n?new iI(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?iO(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?iO(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=iS.exec(t))?new iI(e[1],e[2],e[3],1):(e=iw.exec(t))?new iI(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=ik.exec(t))?iO(e[1],e[2],e[3],e[4]):(e=iC.exec(t))?iO(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=iE.exec(t))?ij(e[1],e[2]/100,e[3]/100,1):(e=iA.exec(t))?ij(e[1],e[2]/100,e[3]/100,e[4]):iM.hasOwnProperty(t)?iP(iM[t]):"transparent"===t?new iI(NaN,NaN,NaN,0):null}function iP(t){return new iI(t>>16&255,t>>8&255,255&t,1)}function iO(t,e,n,r){return r<=0&&(t=e=n=NaN),new iI(t,e,n,r)}function iR(t,e,n,r){var i;return 1==arguments.length?((i=t)instanceof ig||(i=iZ(i)),i)?new iI((i=i.rgb()).r,i.g,i.b,i.opacity):new iI:new iI(t,e,n,null==r?1:r)}function iI(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function iD(){return"#"+iz(this.r)+iz(this.g)+iz(this.b)}function iN(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function iz(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ij(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new iF(t,e,n,r)}function iB(t){if(t instanceof iF)return new iF(t.h,t.s,t.l,t.opacity);if(t instanceof ig||(t=iZ(t)),!t)return new iF;if(t instanceof iF)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+(n<r)*6:n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new iF(a,s,u,t.opacity)}function iF(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function iU(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function iV(t){return"string"==typeof t&&!!iZ(t)}function iH(t){var e=iZ(t),n=[0,0,0,0];return null!=e&&(n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.opacity),n}function iG(t){return(t&&t[0])+256*(t&&t[1])+65536*(t&&t[2])-1}function iW(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function iY(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=null,i=n.createLinearGradient(0,0,256,1),o=t.positions[0],a=t.positions[t.positions.length-1],s=0;s<t.colors.length;++s){var u=(t.positions[s]-o)/(a-o);i.addColorStop(u,t.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),e=null,n=null,{data:r,width:256,height:1}}function iq(t,e){var n=window.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1,console.log("colorRamp",n);for(var i=r.createLinearGradient(0,0,256,1),o=e[1]-e[0],a=0;a<t.colors.length;++a){var s=Math.max((t.positions[a]-e[0])/o,0);i.addColorStop(s,t.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,c=iQ(r,u);return n=null,r=null,c}function iX(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;var r=n.createImageData(256,1);return r.data.fill(0),t.positions.forEach(function(e,n){var i=iH(t.colors[n]);r.data[4*e+0]=255*i[0],r.data[4*e+1]=255*i[1],r.data[4*e+2]=255*i[2],r.data[4*e+3]=255*i[3]}),e=null,n=null,r}function iK(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");n.globalAlpha=1,e.width=256,e.height=1;for(var r=256/t.colors.length,i=0;i<t.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=t.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=iQ(n,o);return e=null,n=null,a}function i$(t,e){var n=window.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=e[1]-e[0];t.positions.length-t.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(var o=0;o<t.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=t.colors[o],r.moveTo((t.positions[o]-e[0])/i*255,0),r.lineTo((t.positions[o+1]-e[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=iQ(r,a);return n=null,r=null,s}function iQ(t,e){for(var n=t.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=e[r+0],n.data[r+1]=e[r+1],n.data[r+2]=e[r+2],n.data[r+3]=e[r+3];return n}function iJ(t){return"cat"===t.type?[0,255]:[0,1]}iv(ig,iZ,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:iT,formatHex:iT,formatHsl:function(){return iB(this).formatHsl()},formatRgb:iL,toString:iL}),iv(iI,iR,im(ig,{brighter:function(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new iI(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new iI(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:iD,formatHex:iD,formatRgb:iN,toString:iN})),iv(iF,function(t,e,n,r){return 1==arguments.length?iB(t):new iF(t,e,n,null==r?1:r)},im(ig,{brighter:function(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new iF(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new iF(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new iI(iU(t>=240?t-240:t+120,i,r),iU(t,i,r),iU(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var i0={BACK:1029,FRONT:1028};function i1(t){switch(t){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return i0.BACK;default:return i0.FRONT}}var i2=n(63787),i3=n(80406),i5=n(89508),i4=n.n(i5),i7=n(70156),i6=n.n(i7),i8=n(54525),i9=n.n(i8),ot=n(44750),oe=n.n(ot),on=n(90849),or=n.n(on),oi=n(93574),oo=n.n(oi),oa=n(71292),os=n.n(oa),ou=n(39018),oc=n.n(ou),ol=n(23393),of=n.n(ol),oh=n(96907),op=n.n(oh),od=n(30484),ov=n.n(od),om=n(74613),og=n.n(om),oy=n(57102),ob=n.n(oy),ox=n(92619),o_=n.n(ox),oS=n(68417),ow=n.n(oS),ok=n(59679),oC=n.n(ok),oE=n(9332),oA=n.n(oE),oM=n(80509),oT=n.n(oM),oL=n(70816),oZ=n.n(oL),oP=n(14308),oO=n.n(oP),oR=n(51729),oI=n.n(oR),oD={isNil:os(),merge:og(),throttle:ow(),isString:op(),debounce:i9(),pull:o_(),isTypedArray:ov(),isPlainObject:of(),isNumber:oc(),isBoolean:or(),isEqual:oo(),cloneDeep:i6(),uniq:oC(),clamp:i4(),upperFirst:oA(),get:oe(),mergeWith:ob(),isFunction:oT(),isObject:oZ(),isUndefined:oO(),camelCase:oI()},oN=oD.pull;function oz(t){var e=t;return"string"==typeof t&&(e=window.document.getElementById(t)),e}function oj(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function oB(t){return oj(t).split(/\s+/)}function oF(t,e,n){var r=window.document.createElement(t);return e&&(r.className=e||""),n&&n.appendChild(r),r}function oU(t){var e=t.parentNode;e&&e.removeChild(t)}function oV(t,e){if(void 0!==t.classList)for(var n=oB(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!oG(t,e)){var o=oq(t);oW(t,(o?o+" ":"")+e)}}function oH(t,e){void 0!==t.classList?oB(e).forEach(function(e){t.classList.remove(e)}):oW(t,oj((" "+oq(t)+" ").replace(" "+e+" "," ")))}function oG(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=oq(t);return n.length>0&&RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function oW(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function oY(t,e,n){void 0===n?oG(t,e)?oH(t,e):oV(t,e):n?oV(t,e):oH(t,e)}function oq(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function oX(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}var oK=function(t){var e,n=null===(e=document)||void 0===e||null===(e=e.documentElement)||void 0===e?void 0:e.style;if(!n)return t[0];for(var r in t)if(t[r]&&t[r]in n)return t[r];return t[0]}(["transform","WebkitTransform"]);function o$(t,e){t.style[oK]=e}function oQ(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var t=window.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t)}}function oJ(t){console.log("%c\n",["padding: "+(t.height/2-8)+"px "+t.width/2+"px;","line-height: "+t.height+"px;","background-image: url("+t.toDataURL()+");"].join(""))}function o0(){var t,e=window.document.querySelector('meta[name="viewport"]');if(!e)return 1;var n=(null===(t=e.content)||void 0===t?void 0:t.split(",")).find(function(t){var e=t.split("=");return"initial-scale"===(0,i3.Z)(e,1)[0]});return n?1*n.split("=")[1]:1}var o1=1>o0()?1:window.devicePixelRatio;function o2(t,e){t.setAttribute("style","".concat(t.style.cssText).concat(e))}function o3(t){return t.split(";").map(function(t){return t.trim()}).filter(function(t){return t})}function o5(t,e){var n,r=o3(null!==(n=t.getAttribute("style"))&&void 0!==n?n:""),i=o3(e),o=oN.apply(void 0,[r].concat((0,i2.Z)(i)));t.setAttribute("style",o.join(";"))}function o4(t){return Object.entries(t).map(function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)}).join(";")}function o7(t,e){return{left:t.left-e.left,top:t.top-e.top,right:e.left+e.width-t.left-t.width,bottom:e.top+e.height-t.top-t.height}}function o6(t,e){t.checked=e,e?t.setAttribute("checked","true"):t.removeAttribute("checked")}function o8(t){t.innerHTML=""}function o9(t){t.setAttribute("draggable","false")}function at(t,e){if("string"==typeof e){var n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.append(n.firstChild)}else Array.isArray(e)?t.append.apply(t,(0,i2.Z)(e)):t.append(e)}function ae(t,e){for(var n,r,i=Array.isArray(e)?e:[e],o=t;o instanceof Element&&o!==window.document.body;){if(i.find(function(t){var e;return null===(e=o)||void 0===e?void 0:e.matches(t)}))return o;o=null!==(n=null===(r=o)||void 0===r?void 0:r.parentElement)&&void 0!==n?n:null}}function an(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}function ar(){return"function"==typeof importScripts}var ai=ar()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},ao=null===(tu=navigator)||void 0===tu?void 0:tu.userAgent,aa=!!ao.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),as=ao.indexOf("Android")>-1||ao.indexOf("Adr")>-1;function au(){for(var t=!0,e=0,n=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];e<n.length;e++){var r=n[e];if(ao.indexOf(r)>0){t=!1;break}}return t}var ac=n(50833);function al(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}var af=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;(0,rK.Z)(this,t),(0,ac.Z)(this,"duration",16),(0,ac.Z)(this,"timestamp",new Date().getTime()),this.duration=e}return(0,rX.Z)(t,[{key:"run",value:function(t){var e=new Date().getTime(),n=e-this.timestamp;this.timestamp=e,n>=this.duration&&t()}}]),t}(),ah=n(7996),ap=n(38425);function ad(t){return"number"==typeof t}var av=2*Math.PI*6378137/2;function am(t,e){var n=(0,i3.Z)(e,4),r=n[0],i=n[1],o=n[2],a=n[3];return t.lng>r&&t.lng<=o&&t.lat>i&&t.lat<=a}function ag(t){var e=[1/0,1/0,-1/0,-1/0];return t.forEach(function(t){(function t(e,n){return Array.isArray(n[0])?n.forEach(function(n){t(e,n)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e})(e,t.coordinates)}),e}function ay(t,e){return function t(e,n){return Array.isArray(e[0])?e.map(function(e){return t(e,n)}):n(e)}(t,e)}function ab(t){var e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(t=aw(t,e))[0],i=t[1],o=r*av/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*av/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===t.length?[o,a,t[2]]:[o,a]}function ax(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=t[0],r=t[1],i=n/av*180,o=r/av*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=e&&(i=Number(i.toFixed(e)),o=Number(o.toFixed(e))),3===t.length?[i,o,t[2]]:[i,o]}function a_(t){if(null==t)throw Error("lng is required");return(t>180||t<-180)&&((t%=360)>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0)),t}function aS(t){if(null==t)throw Error("lat is required");return(t>90||t<-90)&&((t%=180)>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0)),t}function aw(t,e){if(!1===e)return t;var n=a_(t[0]),r=aS(t[1]);return r>85&&(r=85),r<-85&&(r=-85),3===t.length?[n,r,t[2]]:[n,r]}function ak(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),n=Math.PI/180,r=t[0]*n,i=e*n;i=Math.log(Math.tan(Math.PI/4+i/2));var o=-.5/Math.PI;return n=.5,[Math.floor(r=268435456*(.5/Math.PI*r+.5)),Math.floor(i=268435456*(o*i+n))]}function aC(t){var e=.5/Math.PI,n=-.5/Math.PI,r=.5,i=(0,i3.Z)(t,2),o=i[0],a=i[1];o=(o/268435456-.5)/e;var s=(a=(Math.atan(Math.pow(Math.E,a=(a/268435456-r)/n))-Math.PI/4)*2)/(r=Math.PI/180);return[o/r,s]}function aE(t,e){var n=Math.PI/180;return e=Math.max(Math.min(85.0511287798,e),-85.0511287798),t*=n,e*=n,[6378137*t,6378137*(e=Math.log(Math.tan(Math.PI/4+e/2)))]}function aA(t,e){var n=Math.PI/180,r=2*(Math.atan(Math.exp(e/6378137))-Math.PI/4)/n;return[t/6378137/n,r]}function aM(t,e,n){var r=Math.pow(Math.sin((0,ap.Ht)(e[1]-t[1])/2),2)+Math.pow(Math.sin((0,ap.Ht)(e[0]-t[0])/2),2)*Math.cos((0,ap.Ht)(t[1]))*Math.cos((0,ap.Ht)(e[1]));return(0,ap.DL)(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),"meters")}function aT(t){var e=Math.PI/180,n=Math.sin(Math.max(Math.min(85.0511287798,t[1]),-85.0511287798)*e);return[6378137*t[0]*e,6378137*Math.log((1+n)/(1-n))/2]}function aL(t,e){var n=Math.abs(t[1][1]-t[0][1])*e,r=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function aZ(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function aP(t){return[[t[0],t[1]],[t[2],t[3]]]}function aO(t){var e=aR(t,[0,0]);return[t[0]/e,t[1]/e]}function aR(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function aI(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function aD(t,e){return 180*Math.acos((t[0]*e[0]+t[1]*e[1])/(aI(t)*aI(e)))/Math.PI}function aN(t,e){return e[0]>0?e[1]>0?90-180*Math.atan(e[1]/e[0])/Math.PI:90+180*Math.atan(-e[1]/e[0])/Math.PI:e[1]<0?180+(90-180*Math.atan(e[1]/e[0])/Math.PI):270+180*Math.atan(-(e[1]/e[0]))/Math.PI}function az(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(t&&!(t.length<2)){for(var n=[0,1],r=0,i=[],o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],u=aR(a,s);r+=u;var c=aN(n,[a[0]-s[0],a[1]-s[1]]);if(o>0){var l=i[o-1].rotation;l-c>360-l+c&&(c+=360)}i.push({start:a,end:s,dis:u,rotation:c,duration:0})}return i.map(function(t){t.duration=t.dis/r*e}),i}}function aj(t){if(ad(t[0]))return t;if(ad(t[0][0]))throw Error("当前数据不支持标注");if(ad(t[0][0][0])){var e=0,n=0,r=0;return t.forEach(function(t){t.forEach(function(t){e+=t[0],n+=t[1],r++})}),[e/r,n/r,0]}throw Error("当前数据不支持标注")}function aB(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0,a=0,s=0,u=0;u<t.length;u+=2){var c=t[u],l=t[u+1];c&&l&&(e=Math.max(c,e),n=Math.max(l,n),r=Math.min(c,r),i=Math.min(l,i),o+=c,a+=l,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-r,2)+Math.pow(n-i,2))/2}}function aF(t){return(0,ah.Z)((0,ap.uf)([(0,ap.Tu)(t)]))}function aU(t){var e=0;t+="x";for(var n=Math.floor(65745979961613.07),r=0;r<t.length;r++)e>n&&(e=Math.floor(e/137)),e=131*e+t.charCodeAt(r);return e}function aV(t){t=t.toString();for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}function aH(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}var aG=((a={})["GAODE1.x"]="GAODE1.x",a["GAODE2.x"]="GAODE2.x",a.MAPBOX="MAPBOX",a.DEFAULT="DEFAUlTMAP",a.SIMPLE="SIMPLE",a.GLOBEL="GLOBEL",a);function aW(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return(a&&(s=Math.round(n*(o-1))/(o-1)),r)?aX(t,e,s,r,i):aX(t,e,s,.314,i)}function aY(t,e){var n=1-e;return(t[0]*n+t[1]*e)*n+(t[1]*n+t[2]*e)*e}function aq(t,e,n){var r=[e[0]-t[0],e[1]-t[1]],i=Math.sqrt(Math.pow(r[0]-0,2)+Math.pow(r[1]-0,2))/2/Math.cos(n),o=Math.atan2(r[1],r[0])+n;return[i*Math.cos(o)+t[0],i*Math.sin(o)+t[1]]}function aX(t,e,n,r,i){if(i===aG["GAODE2.x"]){var o=aE(t[0],t[1]),a=aE(e[0],e[1]),s=aq(o,a,r),u=[o[0],s[0],a[0]],c=[o[1],s[1],a[1]];return[].concat((0,i2.Z)(aA(aY(u,n),aY(c,n))),[0])}var l=aq(t,e,r),f=[t[0],l[0],e[0]],h=[t[1],l[1],e[1]];return[aY(f,n),aY(h,n),0]}function aK(t,e,n,r,i){arguments.length>5&&void 0!==arguments[5]&&arguments[5];var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),function(t,e,n,r){var i,o,a,s=[(0,ap.Ht)(t[0]),(0,ap.Ht)(t[1])],u=[(0,ap.Ht)(e[0]),(0,ap.Ht)(e[1])];if("GAODE2.x"===r){var c,l,f,h,p,d=(l=aR(c=[u[0]-s[0],u[1]-s[1]],[0,0]),f=Math.atan2(c[1],c[0]),[(h=l/2/.951105719935495)*Math.cos(p=f+.314)+s[0],h*Math.sin(p)+s[1]]),v=[s[0],d[0],u[0]],m=[s[1],d[1],u[1]];return[a$(v,n),a$(m,n),0]}var g=2*Math.atan2(Math.sqrt(a=(o=[Math.sin((i=[s[0]-u[0],s[1]-u[1]])[0]/2),Math.sin(i[1]/2)])[1]*o[1]+Math.cos(s[1])*Math.cos(u[1])*o[0]*o[0]),Math.sqrt(1-a));if(.001>Math.abs(g-Math.PI))return[(1-n)*s[0]+n*u[0],(1-n)*s[1]+n*u[1]];var y=Math.sin((1-n)*g)/Math.sin(g),b=Math.sin(n*g)/Math.sin(g),x=[Math.sin(s[0]),Math.sin(s[1])],_=[Math.cos(s[0]),Math.cos(s[1])],S=[Math.sin(u[0]),Math.sin(u[1])],w=[Math.cos(u[0]),Math.cos(u[1])],k=y*_[1]*_[0]+b*w[1]*w[0],C=y*_[1]*x[0]+b*w[1]*S[0],E=y*x[1]+b*S[1];return[(0,ap.vi)(Math.atan2(C,k)),(0,ap.vi)(Math.atan2(E,Math.sqrt(k*k+C*C)))]}(t,e,a,i)}function a$(t,e){var n=1-e;return(t[0]*n+t[1]*e)*n+(t[1]*n+t[2]*e)*e}function aQ(t,e){var n=e.featureId,r=t.data.dataArray;return"number"==typeof n&&(r=r.filter(function(t){return t.id===n})),r.map(function(t){var n=function(t,e){var n,r=e.offset,i=e.shape,o=e.thetaOffset,a=e.mapVersion,s=e.segmentNumber,u=e.autoFit,c=t.coordinates;if("line"===i)return function(t,e){for(var n,r,i=0,o=[],a=0;a<t.length-1;a++){var s=t[a],u=t[a+1],c=Math.sqrt(Math.pow(s[0]-u[0],2)+Math.pow(s[1]-u[1],2)),l=i;i+=c,o.push({p1:s,p2:u,totalDistance:i,distance:c,lastTotalDistance:l})}for(var f=i*e,h=0;h<o.length;h++){var p=o[h];if(p.totalDistance>f){var d,v,m=p.p1,g=(d=p.p2,v=(f-p.lastTotalDistance)/p.distance,[d[0]*v+m[0]*(1-v),d[1]*v+m[1]*(1-v)]);n=g[0],r=g[1];break}}return{lng:n,lat:r,height:0}}(c,r);var l=c[0],f=c[1],h="string"==typeof o?t[o]||0:o;switch(i){case"arc":default:n=aW;break;case"greatcircle":n=aK}var p=n(l,f,r,h,a,void 0===s?30:s,void 0===u||u),d=(0,i3.Z)(p,3);return{lng:d[0],lat:d[1],height:d[2]}}(t,e);return(0,rW.Z)((0,rW.Z)({},t),n)})}function aJ(t,e){return new Promise(function(n){t.inited?n(aQ(t,e)):t.once("update",function(){n(aQ(t,e))})})}var a0=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;(0,rK.Z)(this,t),this.limit=e,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return(0,rX.Z)(t,[{key:"clear",value:function(){var t=this;this.order.forEach(function(e){t.delete(e)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?this.delete(t):Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t)}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex(function(e){return e===t});e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),t}();function a1(t){if(0===t.length)throw Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return 1*e}function a2(t){if(0===t.length)throw Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return 1*e}function a3(t){if(0===t.length)return 0;for(var e=1*t[0],n=1;n<t.length;n++)e+=1*t[n];return e}function a5(t){if(0===t.length)throw Error("mean requires at least one data point");return a3(t)/t.length}function a4(t){if(0===t.length)throw Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var e=t[0],n=NaN,r=0,i=1,o=1;o<t.length+1;o++)t[o]!==e?(i>r&&(r=i,n=e),i=1,e=t[o]):i++;return 1*n}var a7={min:a2,max:a1,mean:a5,sum:a3,mode:a4};function a6(t,e){return t.map(function(t){return t[e]})}function a8(t,e){return a7[t](e)}function a9(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){n(t);return}s.done?e(u):Promise.resolve(u).then(r,i)}function st(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){a9(o,r,i,a,s,"next",t)}function s(t){a9(o,r,i,a,s,"throw",t)}a(void 0)})}}var se=n(34951),sn=n(28311),sr=n.n(sn),si=n(49174),so=n(32614),sa=n.n(so),ss=((s={}).Realtime="realtime",s.Overlap="overlap",s.Replace="replace",s),su=((u={}).Loading="Loading",u.Loaded="Loaded",u.Failure="Failure",u.Cancelled="Cancelled",u);function sc(t){for(;t;){if(t.isLoaded)return t.properties.state|=2,!0;t=t.parent}return!1}function sl(t){t.children.forEach(function(t){t.isLoaded?t.properties.state|=2:sl(t)})}var sf=[-1/0,-1/0,1/0,1/0],sh=(tc={},(0,ac.Z)(tc,ss.Realtime,function(t){t.forEach(function(t){t.isCurrent&&(t.isVisible=t.isLoaded)})}),(0,ac.Z)(tc,ss.Overlap,function(t){t.forEach(function(t){t.properties.state=0}),t.forEach(function(t){t.isCurrent&&!sc(t)&&sl(t)}),t.forEach(function(t){t.isVisible=!!(2&t.properties.state)})}),(0,ac.Z)(tc,ss.Replace,function(t){t.forEach(function(t){t.properties.state=0}),t.forEach(function(t){t.isCurrent&&sc(t)}),t.slice().sort(function(t,e){return t.z-e.z}).forEach(function(t){t.isVisible=!!(2&t.properties.state),t.children.length&&(t.isVisible||1&t.properties.state)?t.children.forEach(function(t){t.properties.state=1}):t.isCurrent&&sl(t)})}),tc),sp=function(){};function sd(t,e,n){return[Math.floor((t+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function sv(t,e,n){var r=t/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var sm=function(t,e,n){var r=sv(t,e,n),i=(0,i3.Z)(r,2),o=i[0],a=i[1],s=sv(t+1,e+1,n),u=(0,i3.Z)(s,2),c=u[0];return[o,u[1],c,a]};function sg(t){var e=t.zoom,n=t.latLonBounds,r=t.maxZoom,i=void 0===r?1/0:r,o=t.minZoom,a=void 0===o?0:o,s=t.zoomOffset,u=t.extent,c=void 0===u?sf:u,l=Math.ceil(e)+(void 0===s?0:s);if(Number.isFinite(a)&&l<a)return[];Number.isFinite(i)&&l>i&&(l=i);for(var f=(0,i3.Z)(n,4),h=f[0],p=f[1],d=f[2],v=f[3],m=[Math.max(h,c[0]),Math.max(p,c[1]),Math.min(d,c[2]),Math.min(v,c[3])],g=[],y=sd(m[0],m[1],l),b=(0,i3.Z)(y,2),x=b[0],_=b[1],S=sd(m[2],m[3],l),w=(0,i3.Z)(S,2),k=w[0],C=w[1],E=x;E<=k;E++)for(var A=C;A<=_;A++)g.push({x:E,y:A,z:l});var M=(k+x)/2,L=(_+C)/2,Z=function(t,e){return Math.abs(t-M)+Math.abs(e-L)};return g.sort(function(t,e){return Z(t.x,t.y)-Z(e.x,e.y)}),g}var sy=function(t,e,n){var r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=Math.pow(2,n),o=t;return r&&(o<0?o+=i:o>i-1&&(o%=i)),{warpX:o,warpY:e}},sb=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(t){(0,rK.Z)(this,i),e=r.call(this),(0,ac.Z)((0,se.Z)(e),"tileSize",256),(0,ac.Z)((0,se.Z)(e),"isVisible",!1),(0,ac.Z)((0,se.Z)(e),"isCurrent",!1),(0,ac.Z)((0,se.Z)(e),"isVisibleChange",!1),(0,ac.Z)((0,se.Z)(e),"loadedLayers",0),(0,ac.Z)((0,se.Z)(e),"isLayerLoaded",!1),(0,ac.Z)((0,se.Z)(e),"isLoad",!1),(0,ac.Z)((0,se.Z)(e),"isChildLoad",!1),(0,ac.Z)((0,se.Z)(e),"parent",null),(0,ac.Z)((0,se.Z)(e),"children",[]),(0,ac.Z)((0,se.Z)(e),"data",null),(0,ac.Z)((0,se.Z)(e),"properties",{}),(0,ac.Z)((0,se.Z)(e),"loadDataId",0);var e,n=t.x,o=t.y,a=t.z,s=t.tileSize,u=t.warp;return e.x=n,e.y=o,e.z=a,e.warp=void 0===u||u||!0,e.tileSize=s,e}return(0,rX.Z)(i,[{key:"isLoading",get:function(){return this.loadStatus===su.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===su.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===su.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===su.Cancelled}},{key:"isDone",get:function(){return[su.Loaded,su.Cancelled,su.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return sm(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,i3.Z)(this.bounds,4),e=t[0],n=t[1],r=t[2],i=t[3];return(0,si.Z)(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:[(r-e)/2,(i-n)/2],meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(n=st(sr().mark(function t(e){var n,r,i,o,a,s,u,c,l,f,h,p,d,v;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getData,r=e.onLoad,i=e.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=su.Loading,a=null,t.prev=7,u=this.x,c=this.y,l=this.z,f=this.bounds,h=this.tileSize,v={x:(d=sy(u,c,l,p=this.warp)).warpX,y:d.warpY,z:l,bounds:f,tileSize:h,signal:this.abortController.signal,warp:p},t.next=14,n(v,this);case 14:a=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),s=t.t0;case 20:if(!(o!==this.loadDataId)){t.next=22;break}return t.abrupt("return");case 22:if(!(this.isCancelled&&!a)){t.next=24;break}return t.abrupt("return");case 24:if(!(s||!a)){t.next=28;break}return this.loadStatus=su.Failure,i(s,this),t.abrupt("return");case 28:this.loadStatus=su.Loaded,this.data=a,r(this);case 31:case"end":return t.stop()}},t,this,[[7,17]])})),function(t){return n.apply(this,arguments)})},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=su.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),i}(so.EventEmitter),sx=function(t,e){var n=aL(aP(t),e);return[Math.max(n[0][0],-900),Math.max(n[0][1],-85.0511287798065),Math.min(n[1][0],900),Math.min(n[1][1],85.0511287798065)]};function s_(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return sS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sS(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function sS(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var sw=oD.throttle,sk=((c={}).TilesLoadStart="tiles-load-start",c.TileLoaded="tile-loaded",c.TileError="tile-error",c.TileUnload="tile-unload",c.TileUpdate="tile-update",c.TilesLoadFinished="tiles-load-finished",c),sC=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e;return(0,rK.Z)(this,r),e=n.call(this),(0,ac.Z)((0,se.Z)(e),"currentTiles",[]),(0,ac.Z)((0,se.Z)(e),"cacheTiles",new Map),(0,ac.Z)((0,se.Z)(e),"throttleUpdate",sw(function(t,n){e.update(t,n)},16)),(0,ac.Z)((0,se.Z)(e),"onTileLoad",function(t){e.emit(sk.TileLoaded,t),e.updateTileVisible(),e.loadFinished()}),(0,ac.Z)((0,se.Z)(e),"onTileError",function(t,n){e.emit(sk.TileError,{error:t,tile:n}),e.updateTileVisible(),e.loadFinished()}),(0,ac.Z)((0,se.Z)(e),"onTileUnload",function(t){e.emit(sk.TileUnload,t),e.loadFinished()}),e.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:sf,getTileData:sp,warp:!0,updateStrategy:ss.Replace},e.updateOptions(t),e}return(0,rX.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort(function(t,e){return t.z-e.z})}},{key:"updateOptions",value:function(t){var e=void 0===t.minZoom?this.options.minZoom:Math.ceil(t.minZoom),n=void 0===t.maxZoom?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,rW.Z)((0,rW.Z)((0,rW.Z)({},this.options),t),{},{minZoom:e,maxZoom:n})}},{key:"update",value:function(t,e){var n=this,r=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===r&&aZ(aP(this.lastViewStates.latLonBoundsBuffer),aP(e)))){var i=sx(e,.2);this.lastViewStates={zoom:r,latLonBounds:e,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter(function(t){return n.options.warp||t.x>=0&&t.x<Math.pow(2,r)});this.emit(sk.TilesLoadStart),this.currentTiles=a.map(function(t){var e,r,i=t.x,a=t.y,s=t.z,u=n.getTile(i,a,s);return u?((null===(e=u)||void 0===e?void 0:e.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}):(u=n.createTile(i,a,s),o=!0),u}),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t,e=s_(this.cacheTiles);try{for(e.s();!(t=e.n()).done;){var n=(0,i3.Z)(t.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i)){this.cacheTiles.delete(r),this.onTileUnload(i);return}this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(t){e.e(t)}finally{e.f()}}},{key:"reloadTileById",value:function(t,e,n){var r=this.cacheTiles.get("".concat(e,",").concat(n,",").concat(t));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,e,n){var r=this.getTileByLngLat(t,e,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(t,e){var n=this;this.getTileIndices(e,t).forEach(function(t){n.reloadTileById(t.z,t.x,t.y)})}},{key:"pruneRequests",value:function(){var t,e=[],n=s_(this.cacheTiles.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;!r.isLoading||r.isCurrent||r.isVisible||e.push(r)}}catch(t){n.e(t)}finally{n.f()}for(;e.length>0;)e.shift().abortLoad()}},{key:"getTileByLngLat",value:function(t,e,n){var r=Math.ceil(n)+this.options.zoomOffset,i=sd(t,e,r);return this.tiles.filter(function(t){return t.key==="".concat(i[0],"_").concat(i[1],"_").concat(r)})[0]}},{key:"getTileExtent",value:function(t,e){return this.getTileIndices(e,t)}},{key:"getTileByZXY",value:function(t,e,n){return this.tiles.filter(function(r){return r.key==="".concat(e,"_").concat(n,"_").concat(t)})[0]}},{key:"clear",value:function(){var t,e=s_(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(t){e.e(t)}finally{e.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t,e=this.options.updateStrategy,n=new Map,r=s_(this.cacheTiles.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(t){r.e(t)}finally{r.f()}var o,a=s_(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(t){a.e(t)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof e?e(u):sh[e](u);var c=!1;Array.from(this.cacheTiles.values()).forEach(function(t){t.isVisible!==n.get(t.key)?(t.isVisibleChange=!0,c=!0):t.isVisibleChange=!1}),c&&this.emit(sk.TileUpdate)}},{key:"getTileIndices",value:function(t,e){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return sg({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:t,latLonBounds:e,extent:i})}},{key:"getTileId",value:function(t,e,n){return"".concat(t,",").concat(e,",").concat(n)}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some(function(t){return!t.isDone});return t&&this.emit(sk.TilesLoadFinished),t}},{key:"getTile",value:function(t,e,n){var r=this.getTileId(t,e,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(t,e,n){var r=this.getTileId(t,e,n),i=new sb({x:t,y:e,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var t=5*this.currentTiles.length;if(this.cacheTiles.size>t){var e,n=s_(this.cacheTiles);try{for(n.s();!(e=n.n()).done;){var r=(0,i3.Z)(e.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=t)break}}catch(t){n.e(t)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t,e=s_(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.parent=null,n.children.length=0}}catch(t){e.e(t)}finally{e.f()}var r,i=s_(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(t){i.e(t)}finally{i.f()}}},{key:"getNearestAncestor",value:function(t,e,n){for(;n>this.options.minZoom;){t=Math.floor(t/2),e=Math.floor(e/2),n-=1;var r=this.getTile(t,e,n);if(r)return r}return null}}]),r}(sa());function sE(t){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function sA(t){var e=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)e.push(t.replace(n[0],String.fromCharCode(r)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)e.push(t.replace(n[0],s.toString()));return e}return e.push(t),e}function sM(t,e){if(!t||!t.length)throw Error("url is not allowed to be empty");var n=e.x,r=e.y,i=e.z,o=sA(t),a=Math.abs(n+r)%o.length;return(r4(o[a])?"".concat(o[a],"/{z}/{x}/{y}"):o[a]).replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,sm(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function sT(t,e){var n=e.x,r=e.y,i=e.z,o=e.layer,a=e.version,s=e.style,u=e.format,c=e.service,l=e.tileMatrixset,f=sA(t),h=Math.abs(n+r)%f.length;return"".concat(f[h],"&SERVICE=").concat(void 0===c?"WMTS":c,"&REQUEST=GetTile&VERSION=").concat(void 0===a?"1.0.0":a,"&LAYER=").concat(o,"&STYLE=").concat(void 0===s?"default":s,"&TILEMATRIXSET=").concat(l,"&FORMAT=").concat(u,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function sL(t,e){if(!t)throw Error(e||"web worker helper assertion failed.")}var sZ={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,document:"undefined"!=typeof document&&document};sZ.self||sZ.window,sZ.window||sZ.self,sZ.self||sZ.window,sZ.document;var sP="undefined"!=typeof window&&void 0!==window.orientation,sO=function(){function t(t,e){var n=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,e){n.resolve=t,n.reject=e})}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){sL(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){sL(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),sR=new Map;function sI(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function sD(t,e,n){void 0===e&&(e=!0);var r=n||new Set;if(t){if(sN(t))r.add(t);else if(sN(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var i in t)sD(t[i],e,r)}return void 0===n?Array.from(r):[]}function sN(t){return!!t&&!!(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}var sz=function(){},sj=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,n=t.source,r=t.url;sL(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=sz,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=sz,this.onError=sz,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||sD(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),Error(e)},t.prototype.createBrowserWorker=function(){var t,e,n,r=this;this.loadableURL=(sL((e={source:this.source,url:this.url}).source&&!e.url||!e.source&&e.url),(n=sR.get(e.source||e.url))||(e.url&&(n=(t=e.url).startsWith("http")?sI("try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"):t,sR.set(e.url,n)),e.source&&(n=sI(e.source),sR.set(e.source,n))),sL(n),n);var i=new Worker(this.loadableURL,{name:this.name});return i.onmessage=function(t){t.data?r.onMessage(t.data):r.onError(Error("No data received"))},i.onerror=function(t){r.onError(r.getErrorFromErrorEvent(t)),r.terminated=!0},i.onmessageerror=function(t){return console.error("worker "+r.name+", message error: "+t)},i},t}(),sB=function(){return(sB=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},sF=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(a,s)}u((r=r.apply(t,e||[])).next())})},sU=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},sV=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach(function(t){return t.destroy()}),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=sB(sB({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,n){return void 0===e&&(e=function(t,e,n){return t.done(n)}),void 0===n&&(n=function(t,e){return t.error(e)}),sF(this,void 0,void 0,function(){var r,i=this;return sU(this,function(o){switch(o.label){case 0:return r=new Promise(function(r){return i.jobQueue.push({name:t,onMessage:e,onError:n,onStart:r}),i}),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}})})},t.prototype.startQueuedJob=function(){return sF(this,void 0,void 0,function(){var t,e,n;return sU(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length||!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),n=new sO(e.name,t),t.onMessage=function(t){return e.onMessage(n,t.type,t.payload)},t.onError=function(t){return e.onError(n,t)},e.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}})})},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){return this.idleQueue.length>0?this.idleQueue.shift()||null:this.count<this.getMaxConcurrency()?(this.count++,new sj({name:this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")",source:this.source,url:this.url})):null},t.prototype.getMaxConcurrency=function(){return sP?this.maxMobileConcurrency:this.maxConcurrency},t}(),sH=function(){return(sH=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},sG=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},sW={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},sY=function(){function t(t){this.workerPools=new Map,this.props=sH({},sW),this.setProps(t),this.workerPools=new Map}return t.isSupported=function(){return sj.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var n=sG(this.workerPools.values()),r=n.next();!r.done;r=n.next())r.value.destroy()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,n;this.props=sH(sH({},this.props),t);try{for(var r=sG(this.workerPools.values()),i=r.next();!i.done;i=r.next())i.value.setProps(this.getWorkerPoolProps())}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,n=t.source,r=t.url,i=this.workerPools.get(e);return i||((i=new sV({name:e,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,i)),i},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},t}(),sq=new Map;function sX(t){var e=t.type,n=t.data;return"message"===e&&n&&"string"==typeof n.source&&"Main thread"===n.source}function sK(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function s$(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function sQ(t){return t.filter?[1]:[0]}function sJ(t,e){return[e]}!function(){function t(){}Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(sX(e)){var n=e.data;t(n.type,n.payload)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=sq.get(t);e||(e=function(e){if(sX(e)){var n=e.data;t(n.type,n.payload)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=sq.get(t);sq.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var n=sD(e);self.postMessage({source:"Worker thread",type:t,payload:e},n)}}}(),function(){function t(){this._values=[],this._settlers=[],this._closed=!1}t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(e,n){t._settlers.push({resolve:e,reject:n})})}}();var s0=n(35060),s1=n.n(s0),s2="undefined"!=typeof Float32Array?Float32Array:Array,s3=Math.random;function s5(){var t=new s2(2);return s2!=Float32Array&&(t[0]=0,t[1]=0),t}function s4(t,e){var n=new s2(2);return n[0]=t,n[1]=e,n}function s7(t,e){return t[0]=e[0],t[1]=e[1],t}function s6(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function s8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function s9(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function ut(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),s5();var ue=s5();s5();var un=s5(),ur=s5(),ui=s5();function uo(t,e,n,r,i){return s6(t,n,r),s9(t,t),[i/ut(e=s4(-t[1],t[0]),s4(-n[1],n[0])),e]}function ua(t,e){var n,r;return n=-e[1],r=e[0],t[0]=n,t[1]=r,t}function us(t,e,n){return s8(t,e,n),s9(t,t),t}function uu(t,e){return t[0]===e[0]&&t[1]===e[1]}var uc=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,rK.Z)(this,t),(0,ac.Z)(this,"lastFlip",-1),(0,ac.Z)(this,"miter",s4(0,0)),(0,ac.Z)(this,"started",!1),(0,ac.Z)(this,"dash",!1),(0,ac.Z)(this,"totalDistance",0),(0,ac.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,rX.Z)(t,[{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],f=t[o];f.push(null!==(s=e[o][2])&&void 0!==s?s:0);var h=e[o],p=o<t.length-1?[].concat((0,i2.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.segment_gaode2(n,i,c,f,p,l,h,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],f=t[o];f.push(null!==(s=e[o][2])&&void 0!==s?s:0);var h=e[o],p=o<t.length-1?[].concat((0,i2.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.simpleSegment(n,i,c,f,p,l,h,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.segment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.simpleSegment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,c=t.indices,l=t.positions,f=t.normals,h="square"===this.cap,p="bevel"===this.join,d=ak([a[0],a[1]]),v=ak([o[0],o[1]]);us(un,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=s5(),ua(this.normal,un)),!this.started){if(this.started=!0,h){var g=s5(),y=s5();s6(g,this.normal,un),s6(y,this.normal,un),f.push(y[0],y[1],0),f.push(g[0],g[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,f,n,this.normal,this.thickness,this.totalDistance-m)}if(c.push(e+0,e+1,e+2),i){uu(r,i)&&s6(i,r,s9(i,s8(i,r,n))),us(ur,i,r);var b=uo(ui,s5(),un,ur,this.thickness),x=(0,i3.Z)(b,2),_=x[0],S=x[1],w=0>ut(ui,this.normal)?-1:1,k=p;!k&&"miter"===this.join&&_>this.miterLimit&&(k=!0),k?(f.push(this.normal[0],this.normal[1],0),f.push(S[0],S[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,i2.Z)(this.lastFlip!==-w?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),ua(ue,ur),s7(this.normal,ue),f.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,f,r,S,_,this.totalDistance),c.push.apply(c,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),w=-1,s7(this.normal,S),u+=2),this.lastFlip=w}else{if(ua(this.normal,un),h){var C=s5(),E=s5();s8(E,un,this.normal),s6(C,un,this.normal),f.push(E[0],E[1],0),f.push(C[0],C[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,f,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c=ak([r[0],r[1]]),l=ak([n[0],n[1]]);us(un,c,l);var f=0;if(this.dash&&(f=this.lineSegmentDistance(c,l),this.totalDistance+=f),this.normal||(this.normal=s5(),ua(this.normal,un)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f)),a.push(e+0,e+1,e+2),i){var h=ak([i[0],i[1]]);uu(c,h)&&s6(h,c,s9(h,s8(h,c,l))),us(ur,h,c);var p=uo(ui,s5(),un,ur,this.thickness),d=(0,i3.Z)(p,2),v=d[0],m=d[1],g=0>ut(ui,this.normal)?-1:1;this.extrusions(s,u,r,m,v,this.totalDistance),a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),g=-1,s7(this.normal,m),o+=2,this.lastFlip=g}else ua(this.normal,un),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c="square"===this.cap,l="bevel"===this.join,f=ak([r[0],r[1]]),h=ak([n[0],n[1]]);us(un,f,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(f,h),this.totalDistance+=p),this.normal||(this.normal=s5(),ua(this.normal,un)),!this.started){if(this.started=!0,c){var d=s5(),v=s5();s6(d,this.normal,un),s6(v,this.normal,un),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p)}if(a.push(e+0,e+1,e+2),i){var m=ak([i[0],i[1]]);uu(f,m)&&s6(m,f,s9(m,s8(m,f,h))),us(ur,m,f);var g=uo(ui,s5(),un,ur,this.thickness),y=(0,i3.Z)(g,2),b=y[0],x=y[1],_=0>ut(ui,this.normal)?-1:1,S=l;!S&&"miter"===this.join&&b>this.miterLimit&&(S=!0),S?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*_,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*_,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,i2.Z)(this.lastFlip!==-_?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),ua(ue,ur),s7(this.normal,ue),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*_,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,b,this.totalDistance),a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),_=-1,s7(this.normal,x),o+=2),this.lastFlip=_}else{if(ua(this.normal,un),c){var w=s5(),k=s5();s8(k,un,this.normal),s6(w,un,this.normal),u.push(k[0],k[1],0),u.push(w[0],w[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function ul(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new uc({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=e;l[0]&&!Array.isArray(l[0][0])&&(l=[e]),l.forEach(function(t){i.extrude(t)})}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function uf(t){var e=aj(t.coordinates);return{vertices:[].concat((0,i2.Z)(e),(0,i2.Z)(e),(0,i2.Z)(e),(0,i2.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function uh(t){var e=t.coordinates,n=s1().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:s1()(r,o,i),vertices:r,size:i}}var up=(l=st(sr().mark(function t(e){var n,r,i,o,a,s,u,c,l;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.iconMap,a={a_Color:sK,a_Position:s$,filter:sQ,a_vertexId:sJ,a_PickingColor:function(t){var e=t.id;return i?iW(e):[0,0,0]},a_DistanceAndIndex:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(t,e,n){return[n[5]]},a_Size:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(t,e,n,r,i){return i},a_Miter:function(t,e,n){return[n[4]]},a_iconMapUV:function(t){var e=o[t.texture]||{x:0,y:0};return[e.x,e.y]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach(function(t,e){var r=ul(t),i=r.indices,o=r.vertices,f=r.normals,h=r.size,p=r.indexes;i.forEach(function(t){c.push(t+u)}),l=h;var d=o.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:o,normals:f,offset:u}),u+=d;for(var v=function(r){var i=(null==f?void 0:f.slice(3*r,3*r+3))||[],s=o.slice(r*h,r*h+h),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach(function(n){if(n&&a[n.name]){var o;(o=n.buffer.data).push.apply(o,(0,i2.Z)(a[n.name](t,e,s,r,i,u)))}})},m=0;m<d;m++)v(m)}),t.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return t.stop()}},t)})),function(t){return l.apply(this,arguments)}),ud={pointFill:(f=st(sr().mark(function t(e){var n,r,i,o,a,s,u,c,l;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.shape2d,a={a_Color:sK,a_Position:s$,filter:sQ,a_vertexId:sJ,a_PickingColor:function(t){var e=t.id;return i?iW(e):[0,0,0]},a_Shape:function(t){var e=t.shape,n=void 0===e?2:e;return[o.indexOf(n)]},a_Extrude:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach(function(t,e){var r=uf(t),i=r.indices,o=r.vertices,f=r.normals,h=r.size,p=r.indexes;i.forEach(function(t){c.push(t+u)}),l=h;var d=o.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:o,normals:f,offset:u}),u+=d;for(var v=function(r){var i=(null==f?void 0:f.slice(3*r,3*r+3))||[],s=o.slice(r*h,r*h+h),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach(function(n){if(n&&a[n.name]){var o;(o=n.buffer.data).push.apply(o,(0,i2.Z)(a[n.name](t,e,s,r,i,u)))}})},m=0;m<d;m++)v(m)}),t.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return t.stop()}},t)})),function(t){return f.apply(this,arguments)}),line:up,polygonFill:(h=st(sr().mark(function t(e){var n,r,i,o,a,s,u,c;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o={a_Color:sK,a_Position:s$,filter:sQ,a_vertexId:sJ,a_PickingColor:function(t){var e=t.id;return i?iW(e):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],c=3,r.forEach(function(t,e){var r=uh(t),i=r.indices,l=r.vertices,f=r.normals,h=r.size,p=r.indexes;i.forEach(function(t){u.push(t+s)}),c=h;var d=l.length/h;a.sizePerElement=c,a.elements.push({featureIdx:e,vertices:l,normals:f,offset:s}),s+=d;for(var v=function(r){var i=(null==f?void 0:f.slice(3*r,3*r+3))||[],a=l.slice(r*h,r*h+h),s=0;p&&void 0!==p[r]&&(s=p[r]),n.forEach(function(n){if(n&&o[n.name]){var u;(u=n.buffer.data).push.apply(u,(0,i2.Z)(o[n.name](t,e,a,r,i,s)))}})},m=0;m<d;m++)v(m)}),t.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return t.stop()}},t)})),function(t){return h.apply(this,arguments)})};(0,rW.Z)({},ud);var uv=new Map,um="l7-worker";function ug(t){uv.set(um,t)}function uy(t,e){return ub.apply(this,arguments)}function ub(){return(ub=st(sr().mark(function t(e,n){var r,i,o,a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(){var t=uv.get(um);if(!t)throw Error("get worker failed by workerName: ".concat(um,"."));return t}(),i=sY.getWorkerFarm({maxConcurrency:3,reuseWorkers:!0}).getWorkerPool({name:um,source:r}),t.next=5,i.startJob(um,function(t,e,n){return t.done(n)});case 5:return(o=t.sent).postMessage("process",{input:{workerType:e,data:n}}),t.next=9,o.result;case 9:return a=t.sent,t.abrupt("return",a.result);case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function ux(t,e){return null==t?e:t}var u_=n(3338),uS=n.n(u_);function uw(t){return!!Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function uk(t){var e=Object.isFrozen(t)?oD.cloneDeep(t):t;return uS()(e,!0),e}function uC(t,e){var n=e.x,r=e.y,i=e.x1,o=e.y1,a=e.coordinates,s=e.geometry,u=[];if(!Array.isArray(t))return{dataArray:[]};if(s)return t.filter(function(t){return t[s]&&t[s].type&&t[s].coordinates&&t[s].coordinates.length>0}).forEach(function(t,e){var n=uk(t[s]);(0,rq.nG)(n,function(n){var r=(0,rY.r7)(n),i=(0,rW.Z)((0,rW.Z)({},t),{},{_id:e,coordinates:r});u.push(i)})}),{dataArray:u};for(var c=0;c<t.length;c++){var l=t[c],f=[];if(a){var h="Polygon";Array.isArray(a[0])||(h="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(h="LineString"),f=uk({type:h,coordinates:l[a]}).coordinates}else n&&r&&i&&o?f=[[parseFloat(l[n]),parseFloat(l[r])],[parseFloat(l[i]),parseFloat(l[o])]]:n&&r&&(f=[parseFloat(l[n]),parseFloat(l[r])]);var p=(0,rW.Z)((0,rW.Z)({},l),{},{_id:c,coordinates:f});u.push(p)}return{dataArray:u}}function uE(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)uA(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)uA(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)uA(t,e[r][i])}(i),i}function uA(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function uM(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)uT(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)uT(i[c],s);else if("LineString"===o)uL(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<i.length;c++)s=[],uL(i[c],s,a,!1),t.push(uE(u,"LineString",s,e.properties));return}uZ(i,s,a,!1)}else if("Polygon"===o)uZ(i,s,a,!0);else if("MultiPolygon"===o)for(c=0;c<i.length;c++){var l=[];uZ(i[c],l,a,!0),s.push(l)}else if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)uM(t,{id:u,geometry:e.geometry.geometries[c],properties:e.properties},n,r);return}else throw Error("Input data is not a valid GeoJSON object.");t.push(uE(u,o,s,e.properties))}}function uT(t,e){e.push(t[0]/360+.5),e.push(uP(t[1])),e.push(0)}function uL(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=t[s][0]/360+.5,c=uP(t[s][1]);e.push(u),e.push(c),e.push(0),s>0&&(r?a+=(i*c-u*o)/2:a+=Math.sqrt(Math.pow(u-i,2)+Math.pow(c-o,2))),i=u,o=c}var l=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,c=e[n],l=e[n+1],f=e[r],h=e[r+1],p=n+3;p<r;p+=3){var d=function(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}(e[p],e[p+1],c,l,f,h);if(d>a)o=p,a=d;else if(d===a){var v=Math.abs(p-s);v<u&&(o=p,u=v)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,l,n),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function uZ(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];uL(t[i],o,n,r),e.push(o)}}function uP(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function uO(t,e,n,r,i,o,a,s){if(n/=e,r/=e,o>=n&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],c=0;c<t.length;c++){var l=t[c],f=l.geometry,h=l.type,p=0===i?l.minX:l.minY,d=0===i?l.maxX:l.maxY;if(p>=n&&d<r){u.push(l);continue}if(!(d<n)&&!(p>=r)){var v=[];if("Point"===h||"MultiPoint"===h)!function(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}(f,v,n,r,i);else if("LineString"===h)uR(f,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===h)uD(f,v,n,r,i,!1);else if("Polygon"===h)uD(f,v,n,r,i,!0);else if("MultiPolygon"===h)for(var m=0;m<f.length;m++){var g=[];uD(f[m],g,n,r,i,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===h){for(m=0;m<v.length;m++)u.push(uE(l.id,h,v[m],l.tags));continue}("LineString"===h||"MultiLineString"===h)&&(1===v.length?(h="LineString",v=v[0]):h="MultiLineString"),("Point"===h||"MultiPoint"===h)&&(h=3===v.length?"Point":"MultiPoint"),u.push(uE(l.id,h,v,l.tags))}}}return u.length?u:null}function uR(t,e,n,r,i,o,a){for(var s,u,c=uI(t),l=0===i?uz:uj,f=t.start,h=0;h<t.length-3;h+=3){var p=t[h],d=t[h+1],v=t[h+2],m=t[h+3],g=t[h+4],y=0===i?p:d,b=0===i?m:g,x=!1;a&&(s=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-g,2))),y<n?b>n&&(u=l(c,p,d,m,g,n),a&&(c.start=f+s*u)):y>r?b<r&&(u=l(c,p,d,m,g,r),a&&(c.start=f+s*u)):uN(c,p,d,v),b<n&&y>=n&&(u=l(c,p,d,m,g,n),x=!0),b>r&&y<=r&&(u=l(c,p,d,m,g,r),x=!0),!o&&x&&(a&&(c.end=f+s*u),e.push(c),c=uI(t)),a&&(f+=s)}var _=t.length-3;p=t[_],d=t[_+1],v=t[_+2],(y=0===i?p:d)>=n&&y<=r&&uN(c,p,d,v),_=c.length-3,o&&_>=3&&(c[_]!==c[0]||c[_+1]!==c[1])&&uN(c,c[0],c[1],c[2]),c.length&&e.push(c)}function uI(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function uD(t,e,n,r,i,o){for(var a=0;a<t.length;a++)uR(t[a],e,n,r,i,o,!1)}function uN(t,e,n,r){t.push(e),t.push(n),t.push(r)}function uz(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function uj(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function uB(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=uF(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(uF(o.geometry[s],e))}else if("MultiPolygon"===a)for(s=0,i=[];s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(uF(o.geometry[s][c],e));i.push(u)}n.push(uE(o.id,a,i,o.tags))}return n}function uF(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function uU(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(r=0;r<c.length;r+=2)u.geometry.push(uV(c[r],c[r+1],e,o,a,s));else for(r=0;r<c.length;r++){var f=[];for(i=0;i<c[r].length;i+=2)f.push(uV(c[r][i],c[r][i+1],e,o,a,s));u.geometry.push(f)}}return t.transformed=!0,t}function uV(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function uH(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r)){n.numPoints+=e.length/3;return}for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}function uG(t,e){var n,r,i,o,a,s,u=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(u&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw Error("promoteId and generateId cannot be used together.");var c=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)uM(n,t.features[r],e,r);else"Feature"===t.type?uM(n,t,e):uM(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],u&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=c,i=(r=e).buffer/r.extent,o=n,a=uO(n,1,-1-i,i,0,-1,2,r),s=uO(n,1,1-i,2+i,0,-1,2,r),(a||s)&&(o=uO(n,1,-i,1+i,0,-1,2,r)||[],a&&(o=uB(a,1).concat(o)),s&&(o=o.concat(uB(s,-1)))),(c=o).length&&this.splitTile(c,0,0,0),u&&(c.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function uW(t,e,n){return((1<<t)*n+e)*32+t}uG.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},uG.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,c=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var l=1<<e,f=uW(e,n,r),h=this.tiles[f];if(!h&&(c>1&&console.time("creation"),h=this.tiles[f]=function(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,function(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)uH(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)uH(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(s=0;s<c.length;s++)uH(a,c[s],t,n,!0,0===s)}if(a.length){var l=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var f in l={},e.tags)l[f]=e.tags[f];l.mapbox_clip_start=i.start/i.size,l.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==e.id&&(h.id=e.id),t.features.push(h)}}(a,t[s],o,i);var u=t[s].minX,c=t[s].minY,l=t[s].maxX,f=t[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),f>a.maxY&&(a.maxY=f)}return a}(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(h.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||h.numPoints<=u.indexMaxPoints)continue;if(h.source=null,0!==t.length){c>1&&console.time("clipping");var v,m,g,y,b,x,_=.5*u.buffer/u.extent,S=.5-_,w=.5+_,k=1+_;v=m=g=y=null,b=uO(t,l,n-_,n+w,0,h.minX,h.maxX,u),x=uO(t,l,n+S,n+k,0,h.minX,h.maxX,u),t=null,b&&(v=uO(b,l,r-_,r+w,1,h.minY,h.maxY,u),m=uO(b,l,r+S,r+k,1,h.minY,h.maxY,u),b=null),x&&(g=uO(x,l,r-_,r+w,1,h.minY,h.maxY,u),y=uO(x,l,r+S,r+k,1,h.minY,h.maxY,u),x=null),c>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*n,2*r),s.push(m||[],e+1,2*n,2*r+1),s.push(g||[],e+1,2*n+1,2*r),s.push(y||[],e+1,2*n+1,2*r+1)}}},uG.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=uW(t,e=(e%a+a)%a,n);if(this.tiles[s])return uU(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,c=t,l=e,f=n;!u&&c>0;)c--,l=Math.floor(l/2),f=Math.floor(f/2),u=this.tiles[uW(c,l,f)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,l,f),o>1&&console.time("drilling down"),this.splitTile(u.source,c,l,f,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?uU(this.tiles[s],i):null):null};var uY=function(){function t(e,n,r,i){(0,rK.Z)(this,t),(0,ac.Z)(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=e}return(0,rX.Z)(t,[{key:"getTileData",value:function(t){return t&&this.vectorTile.layers[t]?this.vectorLayerCache[t]?this.vectorLayerCache[t]:this.vectorTile.layers[t].features:[]}},{key:"getFeatureById",value:function(){throw Error("Method not implemented.")}}]),t}(),uq={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},uX=["Unknown","Point","LineString","Polygon"],uK=(p=st(sr().mark(function t(e,n,r,i){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){var o=n.getTile(e.z,e.x,e.y);t(new uY({layers:{defaultLayer:{features:o?o.features.map(function(t){return function(t,e,n,r,i){var o,a,s=i.geometry,u=i.type,c=i.tags,l=i.id,f=t*Math.pow(2,r),h=t*e,p=t*n,d=uX[u];function v(t){for(var e=0;e<t.length;e++){var n=t[e];if(n[3])break;var r=180-(n[1]+p)*360/f,i=(n[0]+h)*360/f-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;t[e]=[i,o,0,1]}}switch(u){case 1:var m=[];for(o=0;o<s.length;o++)m[o]=s[o][0];v(s=m);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(o=0,s=function(t){var e,n,r=t.length;if(r<=1)return[t];for(var i=[],o=0;o<r;o++){var a=function(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(e&&i.push(e),e=[t[o]]):e.push(t[o]))}return e&&i.push(e),i}(s);o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:c,id:l,tileOrigin:[0,0],coord:""}}(i,r.x,r.y,r.z,t)}):[]}}},e.x,e.y,e.z))}));case 1:case"end":return t.stop()}},t)})),function(t,e,n,r){return p.apply(this,arguments)}),u$=(d=st(sr().mark(function t(e,n,r,i){var o,a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=sM(e,o={x:n.x,y:n.y,z:n.z}),t.abrupt("return",new Promise(function(t){i?i(o,function(e,r){e||!r?t(new uY({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z)):t(new uY({layers:{defaultLayer:{features:r.features}}},n.x,n.y,n.z))}):ii((0,rW.Z)((0,rW.Z)({},r),{},{url:a}),function(e,r){e||!r?t(new uY({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z)):t(new uY({layers:{defaultLayer:{features:JSON.parse(r)}}},n.x,n.y,n.z))})}));case 3:case"end":return t.stop()}},t)})),function(t,e,n,r){return d.apply(this,arguments)}),uQ=n(29935),uJ=n(20079),u0=n.n(uJ),u1=function(){function t(e,n,r,i){(0,rK.Z)(this,t),(0,ac.Z)(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=new uQ.VectorTile(new(u0())(e))}return(0,rX.Z)(t,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var e=this.vectorTile.layers[t];if(Array.isArray(e.features))return this.vectorLayerCache[t]=e.features,e.features;for(var n=[],r=0;r<e.length;r++){var i=e.feature(r).toGeoJSON(this.x,this.y,this.z);n.push((0,rW.Z)((0,rW.Z)({},i),{},{properties:(0,rW.Z)({id:i.id},i.properties)}))}return this.vectorLayerCache[t]=n,n}},{key:"getFeatureById",value:function(){throw Error("Method not implemented.")}}]),t}(),u2={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},u3=(v=st(sr().mark(function t(e,n,r,i,o){var a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=sM(e,n),t.abrupt("return",new Promise(function(t){if(o)o({x:r.x,y:r.y,z:r.z},function(e,n){e||!n?t(void 0):t(new u1(n,r.x,r.y,r.z))});else{var e=ie((0,rW.Z)((0,rW.Z)({},i),{},{url:a}),function(e,n){e||!n?t(void 0):t(new u1(n,r.x,r.y,r.z))});r.xhrCancel=function(){return e.cancel()}}}));case 2:case"end":return t.stop()}},t)})),function(t,e,n,r,i){return v.apply(this,arguments)}),u5=n(6976);function u4(t,e){for(var n=e[0],r=n.width,i=n.height,o=e.map(function(t){return t.rasterData}),a=r*i,s=[],u=JSON.stringify(t),c=0;c<a;c++){var l=JSON.parse(u),f=function t(e,n,r){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return n[e[1]][r]}catch(t){return console.warn("Raster Data err!"),0}e.map(function(i,o){if(Array.isArray(i)&&i.length>0){if("band"===i[0])try{e[o]=n[i[1]][r]}catch(t){console.warn("Raster Data err!"),e[o]=0}else t(i,n,r)}})}(l,o,c);if("number"==typeof f)s.push(f);else{var h=function t(e){var n,r,i,o,a=(r=(n=(0,i3.Z)(e,3))[0],i=n[1],o=n[2],void 0===r?(console.warn("Express err!"),["+",0,0]):[r.replace(/\s+/g,""),void 0===i?-1:i,void 0===o?-1:o]),s=a[0],u=a[1],c=a[2];return Array.isArray(u)&&(u=t(e[1])),Array.isArray(c)&&(c=t(e[2])),function(t,e,n){switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"%":return e%n;case"^":return Math.pow(e,n);case"abs":return Math.abs(e);case"floor":return Math.floor(e);case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"sin":return Math.sin(e);case"cos":return Math.cos(e);case"atan":return -1===n?Math.atan(e):Math.atan2(e,n);case"min":return Math.min(e,n);case"max":return Math.max(e,n);case"log10":return Math.log(e);case"log2":return Math.log2(e);default:return console.warn("Calculate symbol err! Return default 0"),0}}(s,u,c)}(l);s.push(h)}}return s}var u7={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(t,e){for(var n=t[0].rasterData,r=t[1].rasterData,i=t[2].rasterData,o=[],a=(null==e?void 0:e.countCut)||[2,98],s=(0,i3.Z)(a,2),u=s[0],c=s[1],l=(null==e?void 0:e.RMinMax)||u6(n,u,c),f=(null==e?void 0:e.GMinMax)||u6(r,u,c),h=(null==e?void 0:e.BMinMax)||u6(i,u,c),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-l[0])),o.push(Math.max(0,r[p]-f[0])),o.push(Math.max(0,i[p]-h[0]));return{rasterData:o,rMinMax:l,gMinMax:f,bMinMax:h}}}};function u6(t,e,n){var r=t.slice().sort(function(t,e){return t-e}),i=r.length;return[r[Math.ceil(i*e/100)],r[Math.ceil(i*n/100)]]}function u8(t,e,n){return u9.apply(this,arguments)}function u9(){return(u9=st(sr().mark(function t(e,n,r){var i,o,a,s,u,c;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return t.next=4,Promise.all(e.map(function(t){var e=t.data,r=t.bands;return n(e,void 0===r?[0]:r)}));case 4:i=t.sent,o=[],i.forEach(function(t){Array.isArray(t)?o.push.apply(o,(0,i2.Z)(t)):o.push(t)}),s=(a=o[0]).width,u=a.height,t.t0=(0,u5.Z)(r),t.next="function"===t.t0?11:"object"===t.t0?13:15;break;case 11:return c=r(o),t.abrupt("break",16);case 13:return c=Array.isArray(r)?{rasterData:u4(r,o)}:function(t,e){var n,r=u7[t.type];return"function"===r.type?r.method(e,null==t?void 0:t.options):"operation"===r.type?"rgb"===t.type?(void 0===(n=r.expression).r&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),void 0===n.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),void 0===n.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!"),[u4(n.r||["band",0],e),u4(n.g||["band",0],e),u4(n.b||["band",0],e)]):{rasterData:u4(r.expression,e)}:void 0}(r,o),t.abrupt("break",16);case 15:c={rasterData:o[0].rasterData};case 16:return t.abrupt("return",(0,rW.Z)((0,rW.Z)({},c),{},{width:s,height:u}));case 17:case"end":return t.stop()}},t)}))).apply(this,arguments)}function ct(t,e,n,r){return ce.apply(this,arguments)}function ce(){return(ce=st(sr().mark(function t(e,n,r,i){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u8(e,n,r);case 2:i(null,{data:t.sent});case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}n(32986);var cn=n(15581),cr=n(55729),ci={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},co=n(46721),ca=n.n(co);function cs(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return cu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cu(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function cu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function cc(t,e,n){var r,i=cs(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;t[a.id]=(0,rW.Z)((0,rW.Z)({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(t){i.e(t)}finally{i.f()}}function cl(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function cf(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ch(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ch(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ch(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var cp=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}();function cd(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="black",t.textBaseline="middle"}function cv(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}var cm=(0,cn.b2)()(tl=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"fontAtlas",void 0),(0,ac.Z)((0,se.Z)(t),"iconFontMap",void 0),(0,ac.Z)((0,se.Z)(t),"iconFontGlyphs",{}),(0,ac.Z)((0,se.Z)(t),"fontOptions",void 0),(0,ac.Z)((0,se.Z)(t),"key",void 0),(0,ac.Z)((0,se.Z)(t),"cache",new a0(3)),t}return(0,rX.Z)(r,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var e=this.cache.get(t);return e&&e.data}},{key:"getMappingByKey",value:function(t){var e=this.cache.get(t);return e&&e.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:cp,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach(function(t){e.iconFontGlyphs[t.name]=t.unicode})}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,rW.Z)((0,rW.Z)({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==e.length){var r=this.generateFontAtlas(this.key,e,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(t,e){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(t,"';\n            src: url('").concat(e,"') format('woff2'),\n            url('").concat(e,"') format('woff'),\n            url('").concat(e,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){n.emit("fontloaded",{fontFamily:t})})}catch(t){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(t)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,c=r.radius,l=r.cutoff,f=r.iconfont,h=n&&n.data;h||((h=window.document.createElement("canvas")).width=1024);var p=h.getContext("2d",{willReadFrequently:!0});cd(p,i,a,o);var d=(_=(x=(0,rW.Z)({getFontWidth:function(t){return p.measureText(t).width},fontHeight:1*a,buffer:s,characterSet:e,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})).characterSet,S=x.getFontWidth,w=x.fontHeight,k=x.buffer,C=x.maxCanvasWidth,A=void 0===(E=x.mapping)?{}:E,M=x.xOffset,Z=void 0===(L=x.yOffset)?0:L,P=0,O=void 0===M?0:M,Array.from(_).forEach(function(t,e){if(!A[t]){var n=S(t,e);O+30>C&&(O=0,P++),A[t]={x:O,y:Z+30*P,width:30,height:30,advance:n},O+=30}}),{mapping:A,xOffset:O,yOffset:Z+P*(R=w+2*k),canvasHeight:cl(Z+(P+1)*R)}),v=d.mapping,m=d.canvasHeight,g=d.xOffset,y=d.yOffset,b=p.getImageData(0,0,h.width,h.height);if(h.height=m,p.putImageData(b,0,0),cd(p,i,a,o),u){var x,_,S,w,k,C,E,A,M,L,Z,P,O,R,I,D=new(ca())(a,s,c,l,i,o),N=p.getImageData(0,0,D.size,D.size),z=cf(e);try{for(z.s();!(I=z.n()).done;){var j=I.value;if(f){var B=String.fromCharCode(parseInt(j.replace("&#x","").replace(";",""),16)),F=D.draw(B);cv(F,N)}else cv(D.draw(j),N);p.putImageData(N,v[j].x,v[j].y)}}catch(t){z.e(t)}finally{z.f()}}else{var U,V=cf(e);try{for(V.s();!(U=V.n()).done;){var H=U.value;p.fillText(H,v[H].x,v[H].y+1*a)}}catch(t){V.e(t)}finally{V.f()}}return{xOffset:g,yOffset:y,mapping:v,data:h,width:h.width,height:h.height}}},{key:"getKey",value:function(){var t=this.fontOptions,e=t.fontFamily,n=t.fontWeight;return"".concat(e,"_").concat(n)}},{key:"getNewChars",value:function(t,e){var n=this.cache.get(t);if(!n)return e;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(e).forEach(function(t){o.has(t)||r.push(t)}),r}}]),r}(so.EventEmitter))||tl,cg=(0,cn.b2)()(tf=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"canvasHeight",128),(0,ac.Z)((0,se.Z)(t),"texture",void 0),(0,ac.Z)((0,se.Z)(t),"canvas",void 0),(0,ac.Z)((0,se.Z)(t),"iconData",void 0),(0,ac.Z)((0,se.Z)(t),"iconMap",void 0),(0,ac.Z)((0,se.Z)(t),"ctx",void 0),(0,ac.Z)((0,se.Z)(t),"loadingImageCount",0),t}return(0,rX.Z)(i,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(n=st(sr().mark(function t(e,n){var r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(e)?console.warn("Image Id already exists"):this.iconData.push({id:e,size:64}),this.updateIconMap(),t.next=6,this.loadImage(n);case 6:r=t.sent,(i=this.iconData.find(function(t){return t.id===e}))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return t.stop()}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"addImageMini",value:function(t,e,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImageMini(e,i).then(function(e){o=e;var n=r.iconData.find(function(e){return e.id===t});n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(e){return e.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(e,n){if(t instanceof HTMLImageElement){e(t);return}var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(e){var n=t.iconMap[e],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,c=void 0===u?64:u,l=Math.max(s,c)/64,f=c/l,h=s/l;o&&t.ctx.drawImage(o,r+(64-h)/2,i+(64-f)/2,h,f)})}},{key:"updateIconMap",value:function(){var t=function(t,e,n){var r,i=0,o=0,a=0,s=[],u={},c=cs(t);try{for(c.s();!(r=c.n()).done;){var l=r.value;if(!u[l.id]){var f=l.size;i+f+e>1024&&(cc(u,s,o),i=0,o=a+o+e,a=0,s=[]),s.push({icon:l,xOffset:i}),i=i+f+e,a=Math.max(a,f)}}}catch(t){c.e(t)}finally{c.f()}return s.length>0&&cc(u,s,o),{mapping:u,canvasHeight:cl(a+o+e)}}(this.iconData,3,0),e=t.mapping,n=t.canvasHeight;this.iconMap=e,this.canvasHeight=n}},{key:"loadImageMini",value:function(t,e){return new Promise(function(n,r){var i=e.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(Error("Could not load image at "+t))},i.src=t})}}]),i}(so.EventEmitter))||tf;function cy(){var t=new s2(16);return s2!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function cb(t){var e=new s2(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function cx(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c_(t,e,n,r,i,o,a,s,u,c,l,f,h,p,d,v){var m=new s2(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=c,m[10]=l,m[11]=f,m[12]=h,m[13]=p,m[14]=d,m[15]=v,m}function cS(t,e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=l,t[10]=f,t[11]=h,t[12]=p,t[13]=d,t[14]=v,t[15]=m,t}function cw(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ck(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function cC(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,b=n*u-i*a,x=n*c-o*a,_=r*u-i*s,S=r*c-o*s,w=i*c-o*u,k=l*v-f*d,C=l*m-h*d,E=l*g-p*d,A=f*m-h*v,M=f*g-p*v,L=h*g-p*m,Z=y*L-b*M+x*A+_*E-S*C+w*k;return Z?(Z=1/Z,t[0]=(s*L-u*M+c*A)*Z,t[1]=(i*M-r*L-o*A)*Z,t[2]=(v*w-m*S+g*_)*Z,t[3]=(h*S-f*w-p*_)*Z,t[4]=(u*E-a*L-c*C)*Z,t[5]=(n*L-i*E+o*C)*Z,t[6]=(m*x-d*w-g*b)*Z,t[7]=(l*w-h*x+p*b)*Z,t[8]=(a*M-s*E+c*k)*Z,t[9]=(r*E-n*M-o*k)*Z,t[10]=(d*S-v*x+g*y)*Z,t[11]=(f*x-l*S-p*y)*Z,t[12]=(s*C-a*A-u*k)*Z,t[13]=(n*A-r*C+i*k)*Z,t[14]=(v*b-d*_-m*y)*Z,t[15]=(l*_-f*b+h*y)*Z,t):null}function cE(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15];return t[0]=s*(h*g-p*m)-f*(u*g-c*m)+v*(u*p-c*h),t[1]=-(r*(h*g-p*m)-f*(i*g-o*m)+v*(i*p-o*h)),t[2]=r*(u*g-c*m)-s*(i*g-o*m)+v*(i*c-o*u),t[3]=-(r*(u*p-c*h)-s*(i*p-o*h)+f*(i*c-o*u)),t[4]=-(a*(h*g-p*m)-l*(u*g-c*m)+d*(u*p-c*h)),t[5]=n*(h*g-p*m)-l*(i*g-o*m)+d*(i*p-o*h),t[6]=-(n*(u*g-c*m)-a*(i*g-o*m)+d*(i*c-o*u)),t[7]=n*(u*p-c*h)-a*(i*p-o*h)+l*(i*c-o*u),t[8]=a*(f*g-p*v)-l*(s*g-c*v)+d*(s*p-c*f),t[9]=-(n*(f*g-p*v)-l*(r*g-o*v)+d*(r*p-o*f)),t[10]=n*(s*g-c*v)-a*(r*g-o*v)+d*(r*c-o*s),t[11]=-(n*(s*p-c*f)-a*(r*p-o*f)+l*(r*c-o*s)),t[12]=-(a*(f*m-h*v)-l*(s*m-u*v)+d*(s*h-u*f)),t[13]=n*(f*m-h*v)-l*(r*m-i*v)+d*(r*h-i*f),t[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+d*(r*u-i*s)),t[15]=n*(s*h-u*f)-a*(r*h-i*f)+l*(r*u-i*s),t}function cA(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],p=t[12],d=t[13],v=t[14],m=t[15];return(e*a-n*o)*(f*m-h*v)-(e*s-r*o)*(l*m-h*d)+(e*u-i*o)*(l*v-f*d)+(n*s-r*a)*(c*m-h*p)-(n*u-i*a)*(c*v-f*p)+(r*u-i*s)*(c*d-l*p)}function cM(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=n[0],x=n[1],_=n[2],S=n[3];return t[0]=b*r+x*s+_*f+S*v,t[1]=b*i+x*u+_*h+S*m,t[2]=b*o+x*c+_*p+S*g,t[3]=b*a+x*l+_*d+S*y,b=n[4],x=n[5],_=n[6],S=n[7],t[4]=b*r+x*s+_*f+S*v,t[5]=b*i+x*u+_*h+S*m,t[6]=b*o+x*c+_*p+S*g,t[7]=b*a+x*l+_*d+S*y,b=n[8],x=n[9],_=n[10],S=n[11],t[8]=b*r+x*s+_*f+S*v,t[9]=b*i+x*u+_*h+S*m,t[10]=b*o+x*c+_*p+S*g,t[11]=b*a+x*l+_*d+S*y,b=n[12],x=n[13],_=n[14],S=n[15],t[12]=b*r+x*s+_*f+S*v,t[13]=b*i+x*u+_*h+S*m,t[14]=b*o+x*c+_*p+S*g,t[15]=b*a+x*l+_*d+S*y,t}function cT(t,e,n){var r,i,o,a,s,u,c,l,f,h,p,d,v=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],p=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=f,t[9]=h,t[10]=p,t[11]=d,t[12]=r*v+s*m+f*g+e[12],t[13]=i*v+u*m+h*g+e[13],t[14]=o*v+c*m+p*g+e[14],t[15]=a*v+l*m+d*g+e[15]),t}function cL(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function cZ(t,e,n,r){var i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M=r[0],L=r[1],Z=r[2],P=Math.hypot(M,L,Z);return P<1e-6?null:(M*=P=1/P,L*=P,Z*=P,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],c=e[2],l=e[3],f=e[4],h=e[5],p=e[6],d=e[7],v=e[8],m=e[9],g=e[10],y=e[11],b=M*M*a+o,x=L*M*a+Z*i,_=Z*M*a-L*i,S=M*L*a-Z*i,w=L*L*a+o,k=Z*L*a+M*i,C=M*Z*a+L*i,E=L*Z*a-M*i,A=Z*Z*a+o,t[0]=s*b+f*x+v*_,t[1]=u*b+h*x+m*_,t[2]=c*b+p*x+g*_,t[3]=l*b+d*x+y*_,t[4]=s*S+f*w+v*k,t[5]=u*S+h*w+m*k,t[6]=c*S+p*w+g*k,t[7]=l*S+d*w+y*k,t[8]=s*C+f*E+v*A,t[9]=u*C+h*E+m*A,t[10]=c*C+p*E+g*A,t[11]=l*C+d*E+y*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function cP(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+l*r,t[6]=s*i+f*r,t[7]=u*i+h*r,t[8]=c*i-o*r,t[9]=l*i-a*r,t[10]=f*i-s*r,t[11]=h*i-u*r,t}function cO(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-l*r,t[2]=s*i-f*r,t[3]=u*i-h*r,t[8]=o*r+c*i,t[9]=a*r+l*i,t[10]=s*r+f*i,t[11]=u*r+h*i,t}function cR(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+l*r,t[2]=s*i+f*r,t[3]=u*i+h*r,t[4]=c*i-o*r,t[5]=l*i-a*r,t[6]=f*i-s*r,t[7]=h*i-u*r,t}function cI(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function cD(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cN(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<1e-6?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function cz(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cj(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cB(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cF(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,c=o+o,l=r*s,f=r*u,h=r*c,p=i*u,d=i*c,v=o*c,m=a*s,g=a*u,y=a*c;return t[0]=1-(p+v),t[1]=f+y,t[2]=h-g,t[3]=0,t[4]=f-y,t[5]=1-(l+v),t[6]=d+m,t[7]=0,t[8]=h+g,t[9]=d-m,t[10]=1-(l+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function cU(t,e){var n=new s2(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=r*r+i*i+o*o+a*a;return f>0?(n[0]=(s*a+l*r+u*o-c*i)*2/f,n[1]=(u*a+l*i+c*r-s*o)*2/f,n[2]=(c*a+l*o+s*i-u*r)*2/f):(n[0]=(s*a+l*r+u*o-c*i)*2,n[1]=(u*a+l*i+c*r-s*o)*2,n[2]=(c*a+l*o+s*i-u*r)*2),cF(t,e,n),t}function cV(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function cH(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,l),t}function cG(t,e){var n=new s2(3);cH(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,c=e[4]*r,l=e[5]*i,f=e[6]*o,h=e[8]*r,p=e[9]*i,d=e[10]*o,v=a+l+d,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(f-p)/m,t[1]=(h-u)/m,t[2]=(s-c)/m):a>l&&a>d?(m=2*Math.sqrt(1+a-l-d),t[3]=(f-p)/m,t[0]=.25*m,t[1]=(s+c)/m,t[2]=(h+u)/m):l>d?(m=2*Math.sqrt(1+l-a-d),t[3]=(h-u)/m,t[0]=(s+c)/m,t[1]=.25*m,t[2]=(f+p)/m):(m=2*Math.sqrt(1+d-a-l),t[3]=(s-c)/m,t[0]=(h+u)/m,t[1]=(f+p)/m,t[2]=.25*m),t}function cW(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,l=a+a,f=i*u,h=i*c,p=i*l,d=o*c,v=o*l,m=a*l,g=s*u,y=s*c,b=s*l,x=r[0],_=r[1],S=r[2];return t[0]=(1-(d+m))*x,t[1]=(h+b)*x,t[2]=(p-y)*x,t[3]=0,t[4]=(h-b)*_,t[5]=(1-(f+m))*_,t[6]=(v+g)*_,t[7]=0,t[8]=(p+y)*S,t[9]=(v-g)*S,t[10]=(1-(f+d))*S,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function cY(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],c=o+o,l=a+a,f=s+s,h=o*c,p=o*l,d=o*f,v=a*l,m=a*f,g=s*f,y=u*c,b=u*l,x=u*f,_=r[0],S=r[1],w=r[2],k=i[0],C=i[1],E=i[2],A=(1-(v+g))*_,M=(p+x)*_,L=(d-b)*_,Z=(p-x)*S,P=(1-(h+g))*S,O=(m+y)*S,R=(d+b)*w,I=(m-y)*w,D=(1-(h+v))*w;return t[0]=A,t[1]=M,t[2]=L,t[3]=0,t[4]=Z,t[5]=P,t[6]=O,t[7]=0,t[8]=R,t[9]=I,t[10]=D,t[11]=0,t[12]=n[0]+k-(A*k+Z*C+R*E),t[13]=n[1]+C-(M*k+P*C+I*E),t[14]=n[2]+E-(L*k+O*C+D*E),t[15]=1,t}function cq(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,f=r*s,h=i*a,p=i*s,d=i*u,v=o*a,m=o*s,g=o*u;return t[0]=1-f-d,t[1]=l+g,t[2]=h-m,t[3]=0,t[4]=l-g,t[5]=1-c-d,t[6]=p+v,t[7]=0,t[8]=h+m,t[9]=p-v,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cX(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function cK(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var c$=cK;function cQ(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function cJ(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((a-s)*u*.5),t[9]=(i-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function c0(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t}var c1=c0;function c2(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*c,t[15]=1,t}function c3(t,e,n,r){var i,o,a,s,u,c,l,f,h,p,d=e[0],v=e[1],m=e[2],g=r[0],y=r[1],b=r[2],x=n[0],_=n[1],S=n[2];return 1e-6>Math.abs(d-x)&&1e-6>Math.abs(v-_)&&1e-6>Math.abs(m-S)?cw(t):(p=1/Math.hypot(l=d-x,f=v-_,h=m-S),l*=p,f*=p,h*=p,(p=Math.hypot(i=y*h-b*f,o=b*l-g*h,a=g*f-y*l))?(i*=p=1/p,o*=p,a*=p):(i=0,o=0,a=0),(p=Math.hypot(s=f*a-h*o,u=h*i-l*a,c=l*o-f*i))?(s*=p=1/p,u*=p,c*=p):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=l,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=h,t[11]=0,t[12]=-(i*d+o*v+a*m),t[13]=-(s*d+u*v+c*m),t[14]=-(l*d+f*v+h*m),t[15]=1,t)}function c5(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],c=r[2],l=i-n[0],f=o-n[1],h=a-n[2],p=l*l+f*f+h*h;p>0&&(l*=p=1/Math.sqrt(p),f*=p,h*=p);var d=u*h-c*f,v=c*l-s*h,m=s*f-u*l;return(p=d*d+v*v+m*m)>0&&(d*=p=1/Math.sqrt(p),v*=p,m*=p),t[0]=d,t[1]=v,t[2]=m,t[3]=0,t[4]=f*m-h*v,t[5]=h*d-l*m,t[6]=l*v-f*d,t[7]=0,t[8]=l,t[9]=f,t[10]=h,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function c4(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function c7(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function c6(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function c8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function c9(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function lt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function le(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function ln(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=e[0],b=e[1],x=e[2],_=e[3],S=e[4],w=e[5],k=e[6],C=e[7],E=e[8],A=e[9],M=e[10],L=e[11],Z=e[12],P=e[13],O=e[14],R=e[15];return Math.abs(n-y)<=1e-6*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-b)<=1e-6*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-x)<=1e-6*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-_)<=1e-6*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-S)<=1e-6*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-w)<=1e-6*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-k)<=1e-6*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(c-C)<=1e-6*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(l-E)<=1e-6*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-A)<=1e-6*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(h-M)<=1e-6*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-L)<=1e-6*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(d-Z)<=1e-6*Math.max(1,Math.abs(d),Math.abs(Z))&&Math.abs(v-P)<=1e-6*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(m-O)<=1e-6*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-R)<=1e-6*Math.max(1,Math.abs(g),Math.abs(R))}var lr=cM,li=c8,lo=(0,cn.b2)()(th=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"viewport",void 0),(0,ac.Z)(this,"overridedViewProjectionMatrix",void 0),(0,ac.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,ac.Z)(this,"jitteredProjectionMatrix",void 0),(0,ac.Z)(this,"viewMatrixInverse",void 0),(0,ac.Z)(this,"cameraPosition",void 0)}return(0,rX.Z)(t,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=cy(),cC(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),e=(0,i3.Z)(t,2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var n=cI(cy(),[t,e,0]);this.jitteredProjectionMatrix=cM(cy(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=cM(cy(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||th,la=((m={}).TOPRIGHT="topright",m.TOPLEFT="topleft",m.BOTTOMRIGHT="bottomright",m.BOTTOMLEFT="bottomleft",m.TOPCENTER="topcenter",m.BOTTOMCENTER="bottomcenter",m.LEFTCENTER="leftcenter",m.RIGHTCENTER="rightcenter",m.LEFTTOP="lefttop",m.RIGHTTOP="righttop",m.LEFTBOTTOM="leftbottom",m.RIGHTBOTTOM="rightbottom",m);function ls(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var lu={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},lc=(0,cn.b2)()(tp=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"container",void 0),(0,ac.Z)(this,"controlCorners",void 0),(0,ac.Z)(this,"controlContainer",void 0),(0,ac.Z)(this,"scene",void 0),(0,ac.Z)(this,"mapsService",void 0),(0,ac.Z)(this,"controls",[]),(0,ac.Z)(this,"unAddControls",[])}return(0,rX.Z)(t,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(ci.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){e.get(ci.IMapService).map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(e){return e.controlOption.name===t})}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(e){e.addTo(t.scene),t.controls.push(e)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ls(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ls(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.controls);try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e=this.controlContainer=oF("div","l7-control-container",this.container);Object.values(la).forEach(function(n){var r;(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=n.map(function(t){return"l7-"+t}).join(" ");t[n.filter(function(t){return!["row","column"].includes(t)}).join("")]=oF("div",r,e)})((r=n.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat((0,i2.Z)(r),[lu[n]])))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&oU(this.controlCorners[t]);this.controlContainer&&oU(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,e=window.MutationObserver;if(e)for(var n=0,r=Object.keys(this.controlCorners);n<r.length;n++)(function(){var i=r[n].match(/^(top|bottom)(left|right)$/);if(i){var o=(0,i3.Z)(i,3),a=o[1],s=o[2],u=t.controlCorners["".concat(a).concat(s)];new e(function(t){var e=(0,i3.Z)(t,1)[0].target;u&&(u.style[a]=e.clientHeight+"px")}).observe(t.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}})()}}]),t}())||tp,ll=(0,cn.b2)()(td=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"container",void 0),(0,ac.Z)(this,"scene",void 0),(0,ac.Z)(this,"mapsService",void 0),(0,ac.Z)(this,"markers",[]),(0,ac.Z)(this,"markerLayers",[]),(0,ac.Z)(this,"unAddMarkers",[]),(0,ac.Z)(this,"unAddMarkerLayers",[])}return(0,rX.Z)(t,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(e){e.addTo(t.scene),t.markers.push(e)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(e){t.markerLayers.push(e),e.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(ci.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),t}())||td,lf=(0,cn.b2)()(tv=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"scene",void 0),(0,ac.Z)(this,"mapsService",void 0),(0,ac.Z)(this,"popups",[]),(0,ac.Z)(this,"unAddPopups",[])}return(0,rX.Z)(t,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){null!=t&&t.isOpen()&&t.remove();var e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);var n=this.unAddPopups.indexOf(t);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var e=this;t&&t.getOptions().autoClose&&[].concat((0,i2.Z)(this.popups),(0,i2.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&e.removePopup(t)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){e.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(e){t.addPopup(e),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(ci.IMapService)}}]),t}())||tv,lh=((g={}).normal="normal",g.additive="additive",g.subtractive="subtractive",g.min="min",g.max="max",g.none="none",g),lp=((y={}).MULTIPLE="MULTIPLE",y.SINGLE="SINGLE",y),ld=((b={}).AND="and",b.OR="or",b),lv=((x={}).INIT="init",x.UPDATE="update",x),lm={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},lg=oD.merge,ly={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},lb={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:ld.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},lx=(0,cn.b2)()(tm=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"sceneConfigCache",{}),(0,ac.Z)(this,"layerConfigCache",{}),(0,ac.Z)(this,"layerAttributeConfigCache",{})}return(0,rX.Z)(t,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return lm[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=(0,rW.Z)((0,rW.Z)({},ly),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,n){this.layerConfigCache[e]=(0,rW.Z)({},lg({},this.sceneConfigCache[t],lb,n))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,e){this.layerAttributeConfigCache[t]=(0,rW.Z)((0,rW.Z)({},this.layerAttributeConfigCache[t]),e)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||tm;function l_(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function lS(t,e,n,r,i){var o={};return Object.keys(r).forEach(function(t){o[t]=r[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(t,e,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}function lw(){var t=new s2(4);return s2!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function lk(t,e,n,r){var i=new s2(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function lC(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}lw();var lE=Math.PI/180;function lA(t){var e=t.latitude,n=void 0===e?0:e,r=t.zoom,i=t.scale,o=t.highPrecision,a=t.flipY,s=void 0!==a&&a,u={},c=512*(i=void 0!==i?i:Math.pow(2,void 0===r?0:r)),l=Math.cos(n*lE),f=c/360,h=f/l,p=c/4003e4/l;if(u.pixelsPerMeter=[p,-p,p],u.metersPerPixel=[1/p,-1/p,1/p],u.pixelsPerDegree=[f,-h,p],u.degreesPerPixel=[1/f,-1/h,1/p],void 0!==o&&o){var d=lE*Math.tan(n*lE)/l,v=f*d/2,m=c/4003e4*d,g=m/h*p;u.pixelsPerDegree2=[0,-v,m],u.pixelsPerMeter2=[g,0,g],s&&(u.pixelsPerDegree2[1]=-u.pixelsPerDegree2[1],u.pixelsPerMeter2[1]=-u.pixelsPerMeter2[1])}return s&&(u.pixelsPerMeter[1]=-u.pixelsPerMeter[1],u.metersPerPixel[1]=-u.metersPerPixel[1],u.pixelsPerDegree[1]=-u.pixelsPerDegree[1],u.degreesPerPixel[1]=-u.degreesPerPixel[1]),u}var lM=((_={})[_.LNGLAT=1]="LNGLAT",_[_.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",_[_.VECTOR_TILE=3]="VECTOR_TILE",_[_.IDENTITY=4]="IDENTITY",_[_.P20=5]="P20",_[_.P20_OFFSET=6]="P20_OFFSET",_[_.METER_OFFSET=7]="METER_OFFSET",_[_.P20_2=8]="P20_2",_),lT={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},lL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],lZ=(tg=(0,cn.b2)(),ty=(0,cn.f3)(ci.ICameraService),tg((tx=lS((tb=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"needRefresh",!0),l_(this,"cameraService",tx,this),(0,ac.Z)(this,"coordinateSystem",void 0),(0,ac.Z)(this,"viewportCenter",void 0),(0,ac.Z)(this,"viewportCenterProjection",void 0),(0,ac.Z)(this,"pixelsPerDegree",void 0),(0,ac.Z)(this,"pixelsPerDegree2",void 0),(0,ac.Z)(this,"pixelsPerMeter",void 0)}return(0,rX.Z)(t,[{key:"refresh",value:function(t){var e=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=t||this.cameraService.getCenter(),i=lA({latitude:r[1],zoom:e}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===lM.LNGLAT||this.coordinateSystem===lM.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===lM.LNGLAT_OFFSET?this.calculateLnglatOffset(r,e):this.coordinateSystem===lM.P20_OFFSET&&this.calculateLnglatOffset(r,e,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,n,r){var i=lA({latitude:t[1],zoom:e,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),c=this.cameraService.getProjectionMatrix(),l=cM([],c,u),f=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=lC([],[f[0],f[1],0,1],l),l=cM([],c,u=this.cameraService.getViewMatrixUncentered()||u),l=cM([],l,lL),this.cameraService.setViewProjectionMatrix(l),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}()).prototype,"cameraService",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb))||tb),lP=(0,cn.b2)()(t_=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"renderMap",new Map),(0,ac.Z)((0,se.Z)(t),"enable",!1),(0,ac.Z)((0,se.Z)(t),"renderEnable",!1),(0,ac.Z)((0,se.Z)(t),"cacheLogs",{}),t}return(0,rX.Z)(r,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,e){var n=this;if(this.enable){var r=t.split("."),i=null;r.forEach(function(t,o){null!==i?(i[t]||(i[t]={}),o!==r.length-1&&(i=i[t])):(n.cacheLogs[t]||(n.cacheLogs[t]={}),o!==r.length-1&&(i=n.cacheLogs[t])),o===r.length-1&&(i[t]=(0,rW.Z)((0,rW.Z)({time:Date.now()},i[t]),e))})}}},{key:"getLog",value:function(t){var e=this;switch((0,u5.Z)(t)){case"string":return this.cacheLogs[t];case"object":return t.map(function(t){return e.cacheLogs[t]}).filter(function(t){return void 0!==t});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?aH():""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(this.renderEnable&&this.enable){var e=this.renderMap.get(t)||{};this.renderMap.set(t,(0,rW.Z)((0,rW.Z)({},e),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(this.renderEnable&&this.enable){var e=this.renderMap.get(t);if(e){var n=e.renderStart,r=Date.now();this.emit("renderEnd",(0,rW.Z)((0,rW.Z)({},e),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(so.EventEmitter))||t_,lO=n(45796),lR=n.n(lO),lI=((S={}).Hover="hover",S.Click="click",S.Select="select",S.Active="active",S.Drag="drag",S),lD={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},lN=(tS=(0,cn.b2)(),tw=(0,cn.f3)(ci.IMapService),tS((tC=lS((tk=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"indragging",!1),l_((0,se.Z)(t),"mapService",tC,(0,se.Z)(t)),(0,ac.Z)((0,se.Z)(t),"hammertime",void 0),(0,ac.Z)((0,se.Z)(t),"lastClickTime",0),(0,ac.Z)((0,se.Z)(t),"lastClickXY",[-1,-1]),(0,ac.Z)((0,se.Z)(t),"clickTimer",void 0),(0,ac.Z)((0,se.Z)(t),"$containter",void 0),(0,ac.Z)((0,se.Z)(t),"onDrag",function(e){var n=t.interactionEvent(e);n.type=lD[n.type],"dragging"===n.type?t.indragging=!0:t.indragging=!1,t.emit(lI.Drag,n)}),(0,ac.Z)((0,se.Z)(t),"onHammer",function(e){e.srcEvent.stopPropagation();var n=t.interactionEvent(e);t.emit(lI.Hover,n)}),(0,ac.Z)((0,se.Z)(t),"onTouch",function(e){var n=e.touches[0];t.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchstart"})}),(0,ac.Z)((0,se.Z)(t),"onTouchEnd",function(e){if(e.changedTouches.length>0){var n=e.changedTouches[0];t.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchend"})}}),(0,ac.Z)((0,se.Z)(t),"onTouchMove",function(e){var n=e.changedTouches[0];t.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchmove"})}),(0,ac.Z)((0,se.Z)(t),"onHover",function(e){var n=e.clientX,r=e.clientY,i=n,o=r,a=e.type,s=t.mapService.getMapContainer();if(s){var u=s.getBoundingClientRect(),c=u.top;i=i-u.left-s.clientLeft,o=o-c-s.clientTop}var l=t.mapService.containerToLngLat([i,o]);if("click"===a||"touch"===a){t.isDoubleTap(i,o,l);return}"click"!==a&&"dblclick"!==a&&t.emit(lI.Hover,{x:i,y:o,lngLat:l,type:a,target:e})}),t}return(0,rX.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(lI.Hover)}},{key:"triggerHover",value:function(t){var e=t.x,n=t.y;this.emit(lI.Hover,{x:e,y:n})}},{key:"triggerSelect",value:function(t){this.emit(lI.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(lI.Active,{featureId:t})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t){var e=new(lR()).Manager(t);e.add(new(lR()).Tap({event:"dblclick",taps:2})),e.add(new(lR()).Tap({event:"click"})),e.add(new(lR()).Pan({threshold:0,pointers:0})),e.add(new(lR()).Press({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}},{key:"removeEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(t){var e,n,r=t.type;"touch"===t.pointerType?(n=Math.floor(t.pointers[0].clientY),e=Math.floor(t.pointers[0].clientX)):(n=Math.floor(t.srcEvent.y),e=Math.floor(t.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;e-=o.left,n-=a}var s=this.mapService.containerToLngLat([e,n]);return{x:e,y:n,lngLat:s,type:r,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,e,n){var r=this,i=new Date().getTime(),o="click";i-this.lastClickTime<400&&10>Math.abs(this.lastClickXY[0]-t)&&10>Math.abs(this.lastClickXY[1]-e)?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(lI.Hover,{x:t,y:e,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,e],this.clickTimer=setTimeout(function(){o="click",r.emit(lI.Hover,{x:t,y:e,lngLat:n,type:o})},400))}}]),r}(sa())).prototype,"mapService",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tk))||tk),lz=0,lj=((w={})[w.SAMPLED=0]="SAMPLED",w[w.RENDER_TARGET=1]="RENDER_TARGET",w);function lB(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var lF=(tE=(0,cn.b2)(),tA=(0,cn.f3)(ci.IMapService),tM=(0,cn.f3)(ci.IRendererService),tT=(0,cn.f3)(ci.IGlobalConfigService),tL=(0,cn.f3)(ci.IInteractionService),tZ=(0,cn.f3)(ci.ILayerService),tE((tO=lS((tP=function(){var t,e,n,r;function i(){var t,e=this;(0,rK.Z)(this,i),(0,ac.Z)(this,"pickedColors",void 0),(0,ac.Z)(this,"pickedTileLayers",[]),l_(this,"mapService",tO,this),l_(this,"rendererService",tR,this),l_(this,"configService",tI,this),l_(this,"interactionService",tD,this),l_(this,"layerService",tN,this),(0,ac.Z)(this,"pickingFBO",void 0),(0,ac.Z)(this,"width",0),(0,ac.Z)(this,"height",0),(0,ac.Z)(this,"alreadyInPicking",!1),(0,ac.Z)(this,"pickBufferScale",1),(0,ac.Z)(this,"pickFromPickingFBO",(t=st(sr().mark(function t(n,r){var i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.x,o=r.y,a=r.lngLat,s=r.type,u=r.target,c=!1,f=(l=e.rendererService).readPixelsAsync,p=(h=(0,l.getViewportSize)()).width,d=h.height,m=(v=n.getLayerConfig()).enableHighlight,g=v.enableSelect,y=i*o1,b=o*o1,!(y>p-1*o1||y<0||b>d-1*o1||b<0)){t.next=9;break}return t.abrupt("return",!1);case 9:return t.next=11,f({x:Math.floor(y/e.pickBufferScale),y:Math.floor((d-(o+1)*o1)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});case 11:return(x=t.sent,e.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2])?(_=iG(x),S=n.layerPickService.getFeatureById(_),_!==n.getCurrentPickId()&&"mousemove"===s&&(s="mouseenter"),w={x:i,y:o,type:s,lngLat:a,featureId:_,feature:S,target:u},S&&(c=!0,n.setCurrentPickId(_),e.triggerHoverOnLayer(n,w))):(k={x:i,y:o,lngLat:a,type:null!==n.getCurrentPickId()&&"mousemove"===s?"mouseout":"un"+s,featureId:null,target:u,feature:null},e.triggerHoverOnLayer(n,(0,rW.Z)((0,rW.Z)({},k),{},{type:"unpick"})),e.triggerHoverOnLayer(n,k),n.setCurrentPickId(null)),m&&n.layerPickService.highlightPickedFeature(x),g&&"click"===s&&(null==x?void 0:x.toString())!==[0,0,0,0].toString()&&(C=iG(x),null===n.getCurrentSelectedId()||C!==n.getCurrentSelectedId()?(n.layerPickService.selectFeature(x),n.setCurrentSelectedId(C)):(n.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null))),t.abrupt("return",c);case 17:case"end":return t.stop()}},t)})),function(e,n){return t.apply(this,arguments)}))}return(0,rX.Z)(i,[{key:"init",value:function(t){var e=this.rendererService,n=e.createTexture2D,r=e.createFramebuffer,i=(0,e.getViewportSize)(),o=i.width,a=i.height;this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1;var s=n({width:o=Math.round(o/this.pickBufferScale),height:a=Math.round(a/this.pickBufferScale),usage:lj.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=r({color:s,depth:!0,width:o,height:a}),this.interactionService.on(lI.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(t=st(sr().mark(function t(e,n,r){var i,o,a,s=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=(i=this.rendererService).useFramebufferAsync,a=i.clear,this.resizePickingFBO(),e.hooks.beforePickingEncode.call(),t.next=5,o(this.pickingFBO,st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.renderModels({ispick:!0});case 2:case"end":return t.stop()}},t)})));case 5:return e.hooks.afterPickingEncode.call(),t.next=8,this.pickBox(e,n);case 8:r(t.sent);case 10:case"end":return t.stop()}},t,this)})),function(e,n,r){return t.apply(this,arguments)})},{key:"pickBox",value:(e=st(sr().mark(function t(e,n){var r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.map(function(t){return Math.floor((t<0?0:t)*o1/S.pickBufferScale)}),o=(i=(0,i3.Z)(r,4))[0],a=i[1],s=i[2],u=i[3],l=(c=this.rendererService).readPixelsAsync,h=(f=(0,c.getViewportSize)()).width,p=f.height,!(o>(h-1)*o1/this.pickBufferScale||s<0||a>(p-1)*o1/this.pickBufferScale||u<0)){t.next=5;break}return t.abrupt("return",[]);case 5:return d=Math.min(h/this.pickBufferScale,s)-o,v=Math.min(p/this.pickBufferScale,u)-a,t.next=9,l({x:o,y:Math.floor(p/this.pickBufferScale-(u+1)),width:d,height:v,data:new Uint8Array(d*v*4),framebuffer:this.pickingFBO});case 9:for(b=0,m=t.sent,g=[],y={};b<m.length/4;b+=1)-1===(x=iG(m.slice(4*b,4*b+4)))||y[x]||(_=e.layerPickService.getFeatureById(x),g.push((0,rW.Z)((0,rW.Z)({},_),{},{pickedFeatureIdx:x})),y[x]=!0);return t.abrupt("return",g);case 14:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"handleCursor",value:function(t,e){var n=t.getLayerConfig(),r=n.cursor;if(n.cursorEnabled){var i="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),o=null==i?void 0:i.style.getPropertyValue("cursor");"unmousemove"===e&&""!==o?null==i||i.style.setProperty("cursor",""):"mousemove"===e&&(null==i||i.style.setProperty("cursor",void 0===r?"":r))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!this.layerService.needPick(e.type)||!this.isPickingAllLayer())){t.next=2;break}return t.abrupt("return");case 2:return this.alreadyInPicking=!0,t.next=5,this.pickingLayers(e);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&!this.layerService.alreadyInRendering&&!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()}},{key:"resizePickingFBO",value:function(){var t=(0,this.rendererService.getViewportSize)(),e=t.width,n=t.height;(this.width!==e||this.height!==n)&&(this.pickingFBO.resize({width:Math.round(e/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=e,this.height=n)}},{key:"pickingLayers",value:(r=st(sr().mark(function t(e){var n,r,i,o,a,s,u=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=(n=this.rendererService).clear,i=n.useFramebufferAsync,this.resizePickingFBO(),o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return lB(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lB(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.layerService.getRenderList().filter(function(t){return t.needPick(e.type)}).reverse()),t.prev=4,s=sr().mark(function t(){var n,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.value,t.next=3,i(u.pickingFBO,st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),n.layerPickService.pickRender(e);case 2:case"end":return t.stop()}},t)})));case 3:return t.next=5,u.pickFromPickingFBO(n,e);case 5:if(o=t.sent,u.layerService.pickedLayerId=o?+n.id:-1,!(o&&!n.getLayerConfig().enablePropagation)){t.next=9;break}return t.abrupt("return",1);case 9:case"end":return t.stop()}},t)}),o.s();case 7:if((a=o.n()).done){t.next=13;break}return t.delegateYield(s(),"t0",9);case 9:if(!t.t0){t.next=11;break}return t.abrupt("break",13);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t1=t.catch(4),o.e(t.t1);case 18:return t.prev=18,o.f(),t.finish(18);case 21:case"end":return t.stop()}},t,this,[[4,15,18,21]])})),function(t){return r.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(t,e){(function(t){var e=!0;if((null==t||null===(r=t.target)||void 0===r?void 0:r.target)instanceof HTMLElement)for(var n=null==t||null===(i=t.target)||void 0===i?void 0:i.target;n;){var r,i,o,a=Array.from(n.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){e=!1;break}n=null===(o=n)||void 0===o?void 0:o.parentElement}return e})(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}}]),i}()).prototype,"mapService",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tR=lS(tP.prototype,"rendererService",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=lS(tP.prototype,"configService",[tT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tD=lS(tP.prototype,"interactionService",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tN=lS(tP.prototype,"layerService",[tZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tP))||tP),lU=function(){function t(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];(0,rK.Z)(this,t),(0,ac.Z)(this,"autoStart",void 0),(0,ac.Z)(this,"startTime",0),(0,ac.Z)(this,"oldTime",0),(0,ac.Z)(this,"running",!1),(0,ac.Z)(this,"elapsedTime",0),this.autoStart=e}return(0,rX.Z)(t,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),t}();function lV(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return lH(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lH(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function lH(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var lG=oD.throttle,lW=(tz=(0,cn.b2)(),tj=(0,cn.f3)(ci.IRendererService),tB=(0,cn.f3)(ci.IMapService),tF=(0,cn.f3)(ci.IDebugService),tz((tV=lS((tU=function(t){(0,r$.Z)(c,t);var e,n,r,i,o,a,s,u=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(c);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function c(){var t;(0,rK.Z)(this,c);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=u.call.apply(u,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"pickedLayerId",-1),(0,ac.Z)((0,se.Z)(t),"clock",new lU),(0,ac.Z)((0,se.Z)(t),"alreadyInRendering",!1),(0,ac.Z)((0,se.Z)(t),"layers",[]),(0,ac.Z)((0,se.Z)(t),"layerList",[]),(0,ac.Z)((0,se.Z)(t),"layerRenderID",void 0),(0,ac.Z)((0,se.Z)(t),"sceneInited",!1),(0,ac.Z)((0,se.Z)(t),"animateInstanceCount",0),(0,ac.Z)((0,se.Z)(t),"shaderPicking",!0),(0,ac.Z)((0,se.Z)(t),"enableRender",!0),l_((0,se.Z)(t),"renderService",tV,(0,se.Z)(t)),l_((0,se.Z)(t),"mapService",tH,(0,se.Z)(t)),l_((0,se.Z)(t),"debugService",tG,(0,se.Z)(t)),(0,ac.Z)((0,se.Z)(t),"reRender",lG(function(){t.renderLayers()},32)),(0,ac.Z)((0,se.Z)(t),"throttleRenderLayers",lG(function(){t.renderLayers()},16)),t}return(0,rX.Z)(c,[{key:"needPick",value:function(t){return this.updateLayerRenderList(),this.layerList.some(function(e){return e.needPick(t)})}},{key:"add",value:function(t){var e=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){e.renderLayers()})}},{key:"addMask",value:function(t){var e=this;this.sceneInited&&t.init().then(function(){e.renderLayers()})}},{key:"initLayers",value:(n=st(sr().mark(function t(){var e=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var t=st(sr().mark(function t(n){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.startInit){t.next=4;break}return t.next=3,n.init();case 3:e.updateLayerRenderList();case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(e){return e.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(e){return e.name===t})}},{key:"remove",value:(r=st(sr().mark(function t(e,n){var r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n?(r=n.layerChildren.indexOf(e))>-1&&n.layerChildren.splice(r,1):(i=this.layers.indexOf(e))>-1&&this.layers.splice(i,1),e.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"removeAllLayers",value:(i=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.destroy(),this.reRender();case 2:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:(o=st(sr().mark(function t(){var e,n,r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){t.next=2;break}return t.abrupt("return");case 2:this.updateLayerRenderList(),e=this.debugService.generateRenderUid(),this.debugService.renderStart(e),this.alreadyInRendering=!0,this.clear(),n=lV(this.layerList);try{for(n.s();!(r=n.n()).done;)r.value.prerender()}catch(t){n.e(t)}finally{n.f()}this.renderService.beginFrame(),i=lV(this.layerList),t.prev=11,i.s();case 13:if((o=i.n()).done){t.next=25;break}if(s=(a=o.value).getLayerConfig().enableMask,a.masks.filter(function(t){return t.inited}).length>0&&s&&this.renderMask(a.masks),!a.getLayerConfig().enableMultiPassRenderer){t.next=22;break}return t.next=20,a.renderMultiPass();case 20:t.next=23;break;case 22:a.render();case 23:t.next=13;break;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(11),i.e(t.t0);case 30:return t.prev=30,i.f(),t.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(e),this.alreadyInRendering=!1;case 36:case"end":return t.stop()}},t,this,[[11,27,30,33]])})),function(){return o.apply(this,arguments)})},{key:"renderMask",value:function(t){var e=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=t.length>1?lp.MULTIPLE:lp.SINGLE,i=lV(t);try{for(i.s();!(n=i.n()).done;)n.value.render({isStencil:!0,stencilType:r,stencilIndex:e++})}catch(t){i.e(t)}finally{i.f()}}},{key:"beforeRenderData",value:(a=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.hooks.beforeRenderData.promise();case 2:t.sent&&this.renderLayers();case 4:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(t){var e=0,n=t.getLayerConfig().enableMask,r=void 0===n||n,i=t.tileMask?1:0,o=t.masks.filter(function(t){return t.inited}),a=(i+=r?o.length:1)>1?lp.MULTIPLE:lp.SINGLE;if((t.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var s,u=lV(o);try{for(u.s();!(s=u.n()).done;)s.value.render({isStencil:!0,stencilType:a,stencilIndex:e++})}catch(t){u.e(t)}finally{u.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:e++,stencilOperation:ld.OR})}},{key:"renderTileLayer",value:(s=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.renderTileLayerMask(e),!e.getLayerConfig().enableMultiPassRenderer){t.next=6;break}return t.next=4,e.renderMultiPass();case 4:t.next=8;break;case 6:return t.next=8,e.render();case 8:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(t){return t.inited}).filter(function(t){return t.isVisible()}).sort(function(t,e){return t.zIndex-e.zIndex}).forEach(function(e){t.layerList.push(e)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=iH(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),c}(so.EventEmitter)).prototype,"renderService",[tj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tH=lS(tU.prototype,"mapService",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tG=lS(tU.prototype,"debugService",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU))||tU),lY=n(6787),lq=((k={})[k.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",k[k.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",k[k.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",k[k.POINTS=0]="POINTS",k[k.LINES=1]="LINES",k[k.LINE_LOOP=2]="LINE_LOOP",k[k.LINE_STRIP=3]="LINE_STRIP",k[k.TRIANGLES=4]="TRIANGLES",k[k.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",k[k.TRIANGLE_FAN=6]="TRIANGLE_FAN",k[k.ZERO=0]="ZERO",k[k.ONE=1]="ONE",k[k.SRC_COLOR=768]="SRC_COLOR",k[k.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",k[k.SRC_ALPHA=770]="SRC_ALPHA",k[k.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",k[k.DST_ALPHA=772]="DST_ALPHA",k[k.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",k[k.DST_COLOR=774]="DST_COLOR",k[k.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",k[k.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",k[k.FUNC_ADD=32774]="FUNC_ADD",k[k.BLEND_EQUATION=32777]="BLEND_EQUATION",k[k.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",k[k.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",k[k.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",k[k.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",k[k.MAX_EXT=32776]="MAX_EXT",k[k.MIN_EXT=32775]="MIN_EXT",k[k.BLEND_DST_RGB=32968]="BLEND_DST_RGB",k[k.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",k[k.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",k[k.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",k[k.CONSTANT_COLOR=32769]="CONSTANT_COLOR",k[k.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",k[k.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",k[k.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",k[k.BLEND_COLOR=32773]="BLEND_COLOR",k[k.ARRAY_BUFFER=34962]="ARRAY_BUFFER",k[k.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",k[k.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",k[k.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",k[k.STREAM_DRAW=35040]="STREAM_DRAW",k[k.STATIC_DRAW=35044]="STATIC_DRAW",k[k.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",k[k.BUFFER_SIZE=34660]="BUFFER_SIZE",k[k.BUFFER_USAGE=34661]="BUFFER_USAGE",k[k.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",k[k.FRONT=1028]="FRONT",k[k.BACK=1029]="BACK",k[k.FRONT_AND_BACK=1032]="FRONT_AND_BACK",k[k.CULL_FACE=2884]="CULL_FACE",k[k.BLEND=3042]="BLEND",k[k.DITHER=3024]="DITHER",k[k.STENCIL_TEST=2960]="STENCIL_TEST",k[k.DEPTH_TEST=2929]="DEPTH_TEST",k[k.SCISSOR_TEST=3089]="SCISSOR_TEST",k[k.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",k[k.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",k[k.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",k[k.NO_ERROR=0]="NO_ERROR",k[k.INVALID_ENUM=1280]="INVALID_ENUM",k[k.INVALID_VALUE=1281]="INVALID_VALUE",k[k.INVALID_OPERATION=1282]="INVALID_OPERATION",k[k.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",k[k.CW=2304]="CW",k[k.CCW=2305]="CCW",k[k.LINE_WIDTH=2849]="LINE_WIDTH",k[k.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",k[k.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",k[k.CULL_FACE_MODE=2885]="CULL_FACE_MODE",k[k.FRONT_FACE=2886]="FRONT_FACE",k[k.DEPTH_RANGE=2928]="DEPTH_RANGE",k[k.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",k[k.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",k[k.DEPTH_FUNC=2932]="DEPTH_FUNC",k[k.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",k[k.STENCIL_FUNC=2962]="STENCIL_FUNC",k[k.STENCIL_FAIL=2964]="STENCIL_FAIL",k[k.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",k[k.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",k[k.STENCIL_REF=2967]="STENCIL_REF",k[k.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",k[k.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",k[k.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",k[k.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",k[k.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",k[k.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",k[k.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",k[k.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",k[k.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",k[k.VIEWPORT=2978]="VIEWPORT",k[k.SCISSOR_BOX=3088]="SCISSOR_BOX",k[k.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",k[k.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",k[k.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",k[k.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",k[k.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",k[k.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",k[k.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",k[k.RED_BITS=3410]="RED_BITS",k[k.GREEN_BITS=3411]="GREEN_BITS",k[k.BLUE_BITS=3412]="BLUE_BITS",k[k.ALPHA_BITS=3413]="ALPHA_BITS",k[k.DEPTH_BITS=3414]="DEPTH_BITS",k[k.STENCIL_BITS=3415]="STENCIL_BITS",k[k.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",k[k.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",k[k.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",k[k.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",k[k.SAMPLES=32937]="SAMPLES",k[k.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",k[k.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",k[k.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",k[k.DONT_CARE=4352]="DONT_CARE",k[k.FASTEST=4353]="FASTEST",k[k.NICEST=4354]="NICEST",k[k.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",k[k.BYTE=5120]="BYTE",k[k.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",k[k.SHORT=5122]="SHORT",k[k.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",k[k.INT=5124]="INT",k[k.UNSIGNED_INT=5125]="UNSIGNED_INT",k[k.FLOAT=5126]="FLOAT",k[k.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",k[k.ALPHA=6406]="ALPHA",k[k.RGB=6407]="RGB",k[k.RGBA=6408]="RGBA",k[k.LUMINANCE=6409]="LUMINANCE",k[k.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",k[k.RED=6403]="RED",k[k.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",k[k.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",k[k.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",k[k.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",k[k.VERTEX_SHADER=35633]="VERTEX_SHADER",k[k.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",k[k.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",k[k.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",k[k.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",k[k.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",k[k.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",k[k.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",k[k.SHADER_TYPE=35663]="SHADER_TYPE",k[k.DELETE_STATUS=35712]="DELETE_STATUS",k[k.LINK_STATUS=35714]="LINK_STATUS",k[k.VALIDATE_STATUS=35715]="VALIDATE_STATUS",k[k.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",k[k.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",k[k.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",k[k.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",k[k.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",k[k.NEVER=512]="NEVER",k[k.LESS=513]="LESS",k[k.EQUAL=514]="EQUAL",k[k.LEQUAL=515]="LEQUAL",k[k.GREATER=516]="GREATER",k[k.NOTEQUAL=517]="NOTEQUAL",k[k.GEQUAL=518]="GEQUAL",k[k.ALWAYS=519]="ALWAYS",k[k.KEEP=7680]="KEEP",k[k.REPLACE=7681]="REPLACE",k[k.INCR=7682]="INCR",k[k.DECR=7683]="DECR",k[k.INVERT=5386]="INVERT",k[k.INCR_WRAP=34055]="INCR_WRAP",k[k.DECR_WRAP=34056]="DECR_WRAP",k[k.VENDOR=7936]="VENDOR",k[k.RENDERER=7937]="RENDERER",k[k.VERSION=7938]="VERSION",k[k.NEAREST=9728]="NEAREST",k[k.LINEAR=9729]="LINEAR",k[k.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",k[k.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",k[k.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",k[k.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",k[k.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",k[k.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",k[k.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",k[k.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",k[k.TEXTURE_2D=3553]="TEXTURE_2D",k[k.TEXTURE=5890]="TEXTURE",k[k.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",k[k.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",k[k.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",k[k.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",k[k.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",k[k.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",k[k.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",k[k.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",k[k.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",k[k.TEXTURE0=33984]="TEXTURE0",k[k.TEXTURE1=33985]="TEXTURE1",k[k.TEXTURE2=33986]="TEXTURE2",k[k.TEXTURE3=33987]="TEXTURE3",k[k.TEXTURE4=33988]="TEXTURE4",k[k.TEXTURE5=33989]="TEXTURE5",k[k.TEXTURE6=33990]="TEXTURE6",k[k.TEXTURE7=33991]="TEXTURE7",k[k.TEXTURE8=33992]="TEXTURE8",k[k.TEXTURE9=33993]="TEXTURE9",k[k.TEXTURE10=33994]="TEXTURE10",k[k.TEXTURE11=33995]="TEXTURE11",k[k.TEXTURE12=33996]="TEXTURE12",k[k.TEXTURE13=33997]="TEXTURE13",k[k.TEXTURE14=33998]="TEXTURE14",k[k.TEXTURE15=33999]="TEXTURE15",k[k.TEXTURE16=34e3]="TEXTURE16",k[k.TEXTURE17=34001]="TEXTURE17",k[k.TEXTURE18=34002]="TEXTURE18",k[k.TEXTURE19=34003]="TEXTURE19",k[k.TEXTURE20=34004]="TEXTURE20",k[k.TEXTURE21=34005]="TEXTURE21",k[k.TEXTURE22=34006]="TEXTURE22",k[k.TEXTURE23=34007]="TEXTURE23",k[k.TEXTURE24=34008]="TEXTURE24",k[k.TEXTURE25=34009]="TEXTURE25",k[k.TEXTURE26=34010]="TEXTURE26",k[k.TEXTURE27=34011]="TEXTURE27",k[k.TEXTURE28=34012]="TEXTURE28",k[k.TEXTURE29=34013]="TEXTURE29",k[k.TEXTURE30=34014]="TEXTURE30",k[k.TEXTURE31=34015]="TEXTURE31",k[k.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",k[k.REPEAT=10497]="REPEAT",k[k.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",k[k.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",k[k.FLOAT_VEC2=35664]="FLOAT_VEC2",k[k.FLOAT_VEC3=35665]="FLOAT_VEC3",k[k.FLOAT_VEC4=35666]="FLOAT_VEC4",k[k.INT_VEC2=35667]="INT_VEC2",k[k.INT_VEC3=35668]="INT_VEC3",k[k.INT_VEC4=35669]="INT_VEC4",k[k.BOOL=35670]="BOOL",k[k.BOOL_VEC2=35671]="BOOL_VEC2",k[k.BOOL_VEC3=35672]="BOOL_VEC3",k[k.BOOL_VEC4=35673]="BOOL_VEC4",k[k.FLOAT_MAT2=35674]="FLOAT_MAT2",k[k.FLOAT_MAT3=35675]="FLOAT_MAT3",k[k.FLOAT_MAT4=35676]="FLOAT_MAT4",k[k.SAMPLER_2D=35678]="SAMPLER_2D",k[k.SAMPLER_CUBE=35680]="SAMPLER_CUBE",k[k.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",k[k.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",k[k.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",k[k.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",k[k.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",k[k.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",k[k.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",k[k.COMPILE_STATUS=35713]="COMPILE_STATUS",k[k.LOW_FLOAT=36336]="LOW_FLOAT",k[k.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",k[k.HIGH_FLOAT=36338]="HIGH_FLOAT",k[k.LOW_INT=36339]="LOW_INT",k[k.MEDIUM_INT=36340]="MEDIUM_INT",k[k.HIGH_INT=36341]="HIGH_INT",k[k.FRAMEBUFFER=36160]="FRAMEBUFFER",k[k.RENDERBUFFER=36161]="RENDERBUFFER",k[k.RGBA4=32854]="RGBA4",k[k.RGB5_A1=32855]="RGB5_A1",k[k.RGB565=36194]="RGB565",k[k.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",k[k.STENCIL_INDEX=6401]="STENCIL_INDEX",k[k.STENCIL_INDEX8=36168]="STENCIL_INDEX8",k[k.DEPTH_STENCIL=34041]="DEPTH_STENCIL",k[k.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",k[k.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",k[k.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",k[k.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",k[k.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",k[k.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",k[k.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",k[k.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",k[k.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",k[k.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",k[k.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",k[k.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",k[k.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",k[k.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",k[k.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",k[k.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",k[k.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",k[k.NONE=0]="NONE",k[k.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",k[k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",k[k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",k[k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",k[k.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",k[k.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",k[k.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",k[k.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",k[k.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",k[k.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",k[k.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",k[k.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",k[k.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",k[k.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",k),lX=oD.isNil,lK=function(){function t(e){var n=this;(0,rK.Z)(this,t),(0,ac.Z)(this,"name",void 0),(0,ac.Z)(this,"type",void 0),(0,ac.Z)(this,"scale",void 0),(0,ac.Z)(this,"descriptor",void 0),(0,ac.Z)(this,"featureBufferLayout",[]),(0,ac.Z)(this,"needRescale",!1),(0,ac.Z)(this,"needRemapping",!1),(0,ac.Z)(this,"needRegenerateVertices",!1),(0,ac.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,ac.Z)(this,"vertexAttribute",void 0),(0,ac.Z)(this,"defaultCallback",function(t){if(0===t.length){var e;return(null===(e=n.scale)||void 0===e?void 0:e.defaultValues)||[]}return t.map(function(t,e){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[e].func)(t)})}),this.setProps(e)}return(0,rX.Z)(t,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,(0,i2.Z)(t));if(!lX(r))return[r]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),l$=["buffer","update","name"],lQ=["buffer","update","name"],lJ=(tW={},(0,ac.Z)(tW,lq.FLOAT,4),(0,ac.Z)(tW,lq.UNSIGNED_BYTE,1),(0,ac.Z)(tW,lq.UNSIGNED_SHORT,2),tW),l0=(tY=(0,cn.b2)(),tq=(0,cn.f3)(ci.IRendererService),tY((tK=lS((tX=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"attributesAndIndices",void 0),l_(this,"rendererService",tK,this),(0,ac.Z)(this,"attributes",[]),(0,ac.Z)(this,"triangulation",void 0),(0,ac.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,rX.Z)(t,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new lK(t),this.attributes.push(e)),e}},{key:"unRegisterStyleAttribute",value:function(t){var e=this.attributes.findIndex(function(e){return e.name===t});e>-1&&this.attributes.splice(e,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(e){var n,r=e.name,i=null===(n=e.scale)||void 0===n?void 0:n.field;(t[r]||i&&t[i])&&(e.needRescale=!0,e.needRemapping=!0,e.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,e,n){var r=this.getLayerStyleAttribute(t);r||(r=this.registerStyleAttribute((0,rW.Z)((0,rW.Z)({},e),{},{name:t})));var i=e.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(e){return e.name===t})}},{key:"getLayerAttributeScale",value:function(t){var e,n=this.getLayerStyleAttribute(t),r=null==n||null===(e=n.scale)||void 0===e?void 0:e.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find(function(e){return e.name===t});if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,c=a.size,l=lJ[u.type||lq.FLOAT];if(s){var f=this.featureLayout,h=f.elements,p=f.sizePerElement,d=h.slice(n,r);if(!d.length)return;var v=d[0].offset,m=d.map(function(t,n){for(var r=t.featureIdx,i=t.vertices,o=t.normals,a=i.length/p,u=[],c=0;c<a;c++){var l=o?o.slice(3*c,3*c+3):[];u.push.apply(u,(0,i2.Z)(s(e[r],r,i.slice(c*p,c*p+p),n,l)))}return u}).flat();o.vertexAttribute.updateBuffer({data:m,offset:v*(void 0===c?0:c)*l}),null==i||i.emit("legend:".concat(t),{type:t,attr:o})}}}},{key:"createAttributesAndIndices",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var i=this.attributes.map(function(t){return t.resetDescriptor(),t.descriptor}),o=0,a=0,s=[],u=3;t.forEach(function(t,e){var c=r.triangulation(t,n),l=c.indices,f=c.vertices,h=c.normals,p=c.size,d=c.indexes,v=c.count;"number"==typeof v&&(a+=v),l.forEach(function(t){s.push(t+o)}),u=p;var m=f.length/p;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:e,vertices:f,normals:h,offset:o}),o+=m;for(var g=function(n){var r=(null==h?void 0:h.slice(3*n,3*n+3))||[],o=f.slice(n*p,n*p+p),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach(function(i,s){if(i&&i.update){var u;(u=i.buffer.data).push.apply(u,(0,i2.Z)(i.update(t,e,o,n,r,a)))}})},y=0;y<m;y++)g(y)});var c=this.rendererService,l=c.createAttribute,f=c.createBuffer,h=c.createElements,p={};i.forEach(function(t,e){if(t){var n=t.buffer,i=(t.update,t.name,(0,lY.Z)(t,l$)),o=l((0,rW.Z)({buffer:f(n)},i));p[t.name||""]=o,r.attributes[e].vertexAttribute=o}});var d=h({data:s,type:lq.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:p,elements:d,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(t,e){var n=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var r=this.attributes.map(function(t){return t.resetDescriptor(),t.descriptor}),i=0,o=[],a=3;t.forEach(function(t,e){var s=n.triangulation(t),u=s.indices,c=s.vertices,l=s.normals,f=s.size,h=s.indexes;u.forEach(function(t){o.push(t+i)}),a=f;var p=c.length/f;n.featureLayout.sizePerElement=a,n.featureLayout.elements.push({featureIdx:e,vertices:c,normals:l,offset:i}),i+=p;for(var d=function(n){var i=(null==l?void 0:l.slice(3*n,3*n+3))||[],o=c.slice(n*f,n*f+f),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach(function(r,s){if(r&&r.update){var u;(u=r.buffer.data).push.apply(u,(0,i2.Z)(r.update(t,e,o,n,i,a)))}})},v=0;v<p;v++)d(v)});var s=this.rendererService,u=s.createAttribute,c=s.createBuffer,l={};return r.forEach(function(t,e){if(t){var r=t.buffer,i=(t.update,t.name,(0,lY.Z)(t,lQ)),o=u((0,rW.Z)({buffer:c(r)},i));l[t.name||""]=o,n.attributes[e].vertexAttribute=o}}),{attributes:l}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(t){t.vertexAttribute&&t.vertexAttribute.destroy()}),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}}]),t}()).prototype,"rendererService",[tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tX))||tX),l1=n(49079);function l2(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(a,s)}u((r=r.apply(t,e||[])).next())})}function l3(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function l5(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function l4(t,e,n){if(n||2==arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function l7(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var l6={exports:{}},l8={exports:{}},l9={exports:{}};Object.defineProperty(C=l9.exports,"__esModule",{value:!0}),C.default=function(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},l9.exports=C.default;var ft={},fe={exports:{}},fn={exports:{}};Object.defineProperty(E=fn.exports,"__esModule",{value:!0}),E.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return t.call(this,e,r)}},fn.exports=E.default;var fr={};Object.defineProperty(fr,"__esModule",{value:!0}),fr.fallback=fs,fr.wrap=fu;var fi=fr.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,fo=fr.hasSetImmediate="function"==typeof setImmediate&&setImmediate,fa=fr.hasNextTick="object"==typeof l1&&"function"==typeof l1.nextTick;function fs(t){setTimeout(t,0)}function fu(t){return function(e){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return t(function(){return e.apply(void 0,n)})}}t$=fi?queueMicrotask:fo?setImmediate:fa?l1.nextTick:fs,fr.default=fu(t$),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,ft.isAsync)(t)?function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return o(t.apply(this,e),r)}:(0,n.default)(function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}if(r&&"function"==typeof r.then)return o(r,n);n(null,r)})};var n=i(fn.exports),r=i(fr);function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return t.then(function(t){a(e,null,t)},function(t){a(e,t&&t.message?t:Error(t))})}function a(t,e,n){try{t(e,n)}catch(t){(0,r.default)(function(t){throw t},t)}}t.exports=e.default}(fe,fe.exports),Object.defineProperty(ft,"__esModule",{value:!0}),ft.isAsyncIterable=ft.isAsyncGenerator=ft.isAsync=void 0;var fc=(r=fe.exports)&&r.__esModule?r:{default:r};function fl(t){return"AsyncFunction"===t[Symbol.toStringTag]}ft.default=function(t){if("function"!=typeof t)throw Error("expected a function");return fl(t)?(0,fc.default)(t):t},ft.isAsync=fl,ft.isAsyncGenerator=function(t){return"AsyncGenerator"===t[Symbol.toStringTag]},ft.isAsyncIterable=function(t){return"function"==typeof t[Symbol.asyncIterator]};var ff={exports:{}};Object.defineProperty(A=ff.exports,"__esModule",{value:!0}),A.default=function(t,e){if(void 0===e&&(e=t.length),!e)throw Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[e-1]?t.apply(this,r):new Promise(function(i,o){r[e-1]=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(n,r)})}},ff.exports=A.default,function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(l9.exports),r=o(ft),i=o(ff.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)(function(t,e,i){var o=(0,n.default)(e)?[]:{};t(e,function(t,e,n){(0,r.default)(t)(function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[e]=r,n(t)})},function(t){return i(t,o)})},3),t.exports=e.default}(l8,l8.exports);var fh={exports:{}},fp={exports:{}},fd={exports:{}},fv={exports:{}};Object.defineProperty(M=fv.exports,"__esModule",{value:!0}),M.default=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null!==t){var r=t;t=null,r.apply(this,e)}}return Object.assign(e,t),e},fv.exports=M.default;var fm={exports:{}},fg={exports:{}};Object.defineProperty(L=fg.exports,"__esModule",{value:!0}),L.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},fg.exports=L.default,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,n.default)(t))return e=-1,i=t.length,function(){return++e<i?{value:t[e],key:e}:null};var e,i,o,a,s,u,c=(0,r.default)(t);return c?(o=-1,function(){var t=c.next();return t.done?null:(o++,{value:t.value,key:o})}):(a=t?Object.keys(t):[],s=-1,u=a.length,function e(){var n=a[++s];return"__proto__"===n?e():s<u?{value:t[n],key:n}:null})};var n=i(l9.exports),r=i(fg.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(fm,fm.exports);var fy={exports:{}};Object.defineProperty(Z=fy.exports,"__esModule",{value:!0}),Z.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null===t)throw Error("Callback was already called.");var r=t;t=null,r.apply(this,e)}},fy.exports=Z.default;var fb={exports:{}},fx={exports:{}};Object.defineProperty(P=fx.exports,"__esModule",{value:!0}),P.default={},fx.exports=P.default,Object.defineProperty(O=fb.exports,"__esModule",{value:!0}),O.default=function(t,e,n,r){var i=!1,o=!1,a=!1,s=0,u=0;function c(){s>=e||a||i||(a=!0,t.next().then(function(t){var e=t.value,f=t.done;if(!o&&!i){if(a=!1,f){i=!0,s<=0&&r(null);return}s++,n(e,u,l),u++,c()}}).catch(f))}function l(t,e){if(s-=1,!o){if(t)return f(t);if(!1===t){i=!0,o=!0;return}if(e===R.default||i&&s<=0)return i=!0,r(null);c()}}function f(t){o||(a=!1,i=!0,r(t))}c()},R=(i=fx.exports)&&i.__esModule?i:{default:i},fb.exports=O.default,function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=s(fv.exports),r=s(fm.exports),i=s(fy.exports),o=s(fb.exports),a=s(fx.exports);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,s,u){if(u=(0,n.default)(u),t<=0)throw RangeError("concurrency limit cannot be less than 1");if(!e)return u(null);if((0,ft.isAsyncGenerator)(e))return(0,o.default)(e,t,s,u);if((0,ft.isAsyncIterable)(e))return(0,o.default)(e[Symbol.asyncIterator](),t,s,u);var c=(0,r.default)(e),l=!1,f=!1,h=0,p=!1;function d(t,e){if(!f){if(h-=1,t)l=!0,u(t);else if(!1===t)l=!0,f=!0;else{if(e===a.default||l&&h<=0)return l=!0,u(null);p||v()}}}function v(){for(p=!0;h<t&&!l;){var e=c();if(null===e){l=!0,h<=0&&u(null);return}h+=1,s(e.value,e.key,(0,i.default)(d))}p=!1}v()}},t.exports=e.default}(fd,fd.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(fd.exports),r=o(ft),i=o(ff.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)(function(t,e,i,o){return(0,n.default)(e)(t,(0,r.default)(i),o)},4),t.exports=e.default}(fp,fp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=i(fp.exports),r=i(ff.exports);function i(t){return t&&t.__esModule?t:{default:t}}e.default=(0,r.default)(function(t,e,r){return(0,n.default)(t,1,e,r)},3),t.exports=e.default}(fh,fh.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,n.default)(r.default,t,e)};var n=i(l8.exports),r=i(fh.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(l6,l6.exports);var f_=l7(l6.exports),fS=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,f_(this.tasks)},t.prototype.tap=function(t,e){var n=this;this.tasks.push(function(r){e.apply(void 0,l4([],l5(n.args),!1)),r(null,t)})},t}(),fw={exports:{}},fk={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=c(l9.exports),r=c(fx.exports),i=c(fp.exports),o=c(fv.exports),a=c(fy.exports),s=c(ft),u=c(ff.exports);function c(t){return t&&t.__esModule?t:{default:t}}e.default=(0,u.default)(function(t,e,u){return((0,n.default)(t)?function(t,e,n){n=(0,o.default)(n);var i=0,s=0,u=t.length,c=!1;function l(t,e){!1===t&&(c=!0),!0!==c&&(t?n(t):(++s===u||e===r.default)&&n(null))}for(0===u&&n(null);i<u;i++)e(t[i],i,(0,a.default)(l))}:function(t,e,n){return(0,i.default)(t,1/0,e,n)})(t,(0,s.default)(e),u)},3),t.exports=e.default}(fk,fk.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,r.default)(n.default,t,e)};var n=i(fk.exports),r=i(l8.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(fw,fw.exports);var fC=l7(fw.exports);!function(){function t(){this.tasks=[]}t.prototype.promise=function(){return fC(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push(function(r){return l2(n,void 0,void 0,function(){return l3(this,function(n){switch(n.label){case 0:return[4,e()];case 1:return n.sent(),r(null,t),[2]}})})})}}();var fE={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=a(fv.exports),r=a(fy.exports),i=a(ft),o=a(ff.exports);function a(t){return t&&t.__esModule?t:{default:t}}e.default=(0,o.default)(function(t,e){if(e=(0,n.default)(e),!Array.isArray(t))return e(Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var o=0;function a(e){(0,i.default)(t[o++]).apply(void 0,e.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n){if(n||o===t.length)return e.apply(void 0,[n].concat(r));a(r)}}a([])}),t.exports=e.default}(fE,fE.exports);var fA=l7(fE.exports);!function(){function t(){this.tasks=[]}t.prototype.call=function(){return fA(this.tasks)},t.prototype.tap=function(t,e){0===this.tasks.length?this.tasks.push(function(t){var n=e();t(!!n&&null,n)}):this.tasks.push(function(n,r){r(!!e.apply(void 0,l4([],l5(n),!1))&&null,t)})}}();var fM=function(){function t(){this.tasks=[]}return t.prototype.call=function(){return f_(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push(function(n){n(e(),t)})},t}(),fT=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,f_(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push(function(r){return l2(n,void 0,void 0,function(){return l3(this,function(n){switch(n.label){case 0:return[4,e.apply(void 0,l4([],l5(this.args),!1))];case 1:return n.sent(),r(null,t),[2]}})})})},t}(),fL=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,f_(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push(function(r){return l2(n,void 0,void 0,function(){return l3(this,function(n){switch(n.label){case 0:return[4,e.apply(void 0,l4([],l5(this.args),!1))];case 1:return r(n.sent(),t),[2]}})})})},t}(),fZ=function(){function t(){this.tasks=[]}return t.prototype.promise=function(){return fA(this.tasks)},t.prototype.tapPromise=function(t,e){0===this.tasks.length?this.tasks.push(function(t){e().then(function(e){t(null,e)})}):this.tasks.push(function(t,n){e(t).then(function(t){n(null,t)})})},t}(),fP=n(23369),fO=n.n(fP),fR=(tQ=(0,cn.b2)(),tJ=(0,cn.f3)(ci.SceneID),t0=(0,cn.f3)(ci.IIconService),t1=(0,cn.f3)(ci.IFontService),t2=(0,cn.f3)(ci.IControlService),t3=(0,cn.f3)(ci.IGlobalConfigService),t5=(0,cn.f3)(ci.IMapService),t4=(0,cn.f3)(ci.ICoordinateSystemService),t7=(0,cn.f3)(ci.IRendererService),t6=(0,cn.f3)(ci.ILayerService),t8=(0,cn.f3)(ci.IDebugService),t9=(0,cn.f3)(ci.ICameraService),et=(0,cn.f3)(ci.IInteractionService),ee=(0,cn.f3)(ci.IPickingService),en=(0,cn.f3)(ci.IShaderModuleService),er=(0,cn.f3)(ci.IMarkerService),ei=(0,cn.f3)(ci.IPopupService),tQ((ea=lS((eo=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;return(0,rK.Z)(this,o),t=i.call(this),(0,ac.Z)((0,se.Z)(t),"destroyed",!1),(0,ac.Z)((0,se.Z)(t),"loaded",!1),l_((0,se.Z)(t),"id",ea,(0,se.Z)(t)),l_((0,se.Z)(t),"iconService",es,(0,se.Z)(t)),l_((0,se.Z)(t),"fontService",eu,(0,se.Z)(t)),l_((0,se.Z)(t),"controlService",ec,(0,se.Z)(t)),l_((0,se.Z)(t),"configService",el,(0,se.Z)(t)),l_((0,se.Z)(t),"map",ef,(0,se.Z)(t)),l_((0,se.Z)(t),"coordinateSystemService",eh,(0,se.Z)(t)),l_((0,se.Z)(t),"rendererService",ep,(0,se.Z)(t)),l_((0,se.Z)(t),"layerService",ed,(0,se.Z)(t)),l_((0,se.Z)(t),"debugService",ev,(0,se.Z)(t)),l_((0,se.Z)(t),"cameraService",em,(0,se.Z)(t)),l_((0,se.Z)(t),"interactionService",eg,(0,se.Z)(t)),l_((0,se.Z)(t),"pickingService",ey,(0,se.Z)(t)),l_((0,se.Z)(t),"shaderModuleService",eb,(0,se.Z)(t)),l_((0,se.Z)(t),"markerService",ex,(0,se.Z)(t)),l_((0,se.Z)(t),"popupService",e_,(0,se.Z)(t)),(0,ac.Z)((0,se.Z)(t),"inited",!1),(0,ac.Z)((0,se.Z)(t),"rendering",!1),(0,ac.Z)((0,se.Z)(t),"$container",void 0),(0,ac.Z)((0,se.Z)(t),"canvas",void 0),(0,ac.Z)((0,se.Z)(t),"markerContainer",void 0),(0,ac.Z)((0,se.Z)(t),"resizeDetector",void 0),(0,ac.Z)((0,se.Z)(t),"hooks",void 0),(0,ac.Z)((0,se.Z)(t),"handleWindowResized",function(){t.emit("resize"),t.$container&&(t.initContainer(),t.coordinateSystemService.needRefresh=!0,t.render())}),(0,ac.Z)((0,se.Z)(t),"handleMapCameraChanged",function(e){t.cameraService.update(e),t.render()}),t.hooks={init:new fT},t}return(0,rX.Z)(o,[{key:"init",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return e.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.debugService.log("map.mapInitStart",{type:e.map.version}),t.next=3,new Promise(function(t){e.map.onCameraChanged(function(n){e.cameraService.init(),e.cameraService.update(n),t()}),e.map.init()});case 3:e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(lI.Drag,e.addSceneEvent.bind(e));case 10:case"end":return t.stop()}},t)}))),this.hooks.init.tapPromise("initRenderer",st(sr().mark(function n(){var r,i,o;return sr().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if((i=(null===(r=e.map)||void 0===r?void 0:r.getOverlayContainer())||void 0)?e.$container=i:e.$container=function(t){var e=t;if("string"==typeof t&&(e=document.getElementById(t)),e){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(lz++),n.classList.add("l7-scene"),e.appendChild(n),n}return null}(e.configService.getSceneConfig(e.id).id||""),!e.$container){n.next=14;break}return e.canvas=oF("canvas","",e.$container),e.setCanvas(),n.next=7,e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl);case 7:e.registerContextLost(),e.initContainer(),e.resizeDetector=fO()({strategy:"scroll"}),e.resizeDetector.listenTo(e.$container,e.handleWindowResized),window.matchMedia&&(null===(o=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===o||o.addListener(e.handleWindowResized.bind("screen"))),n.next=15;break;case 14:console.error("容器 id 不存在");case 15:e.pickingService.init(e.id);case 16:case"end":return n.stop()}},n)}))),this.render()}},{key:"registerContextLost",value:function(){var t=this,e=this.rendererService.getCanvas();e&&e.addEventListener("webglcontextlost",function(){return t.emit("webglcontextlost")})}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.rendering||this.destroyed)){t.next=2;break}return t.abrupt("return");case 2:if(this.rendering=!0,this.inited){t.next=16;break}return t.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),t.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,t.next=20;break;case 16:return t.next=18,this.layerService.initLayers();case 18:return t.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(t,e){this.fontService.addFontFace(t,e)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(r=st(sr().mark(function t(e){var n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],t.next=3,this.render();case 3:return i="jpg"===e?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),t.abrupt("return",i);case 5:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;null!==t&&(this.markerContainer=oF("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t,e=this;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var t;null===(t=e.$container)||void 0===t||t.removeChild(e.canvas),e.canvas=null,e.rendererService.destroy()}),null===(t=this.$container)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,e,n=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,r=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,i=this.canvas;i&&(i.width=n*o1,i.height=r*o1),this.rendererService.viewport({x:0,y:0,width:o1*n,height:o1*r})}},{key:"setCanvas",value:function(){var t,e,n=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,r=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,i=this.canvas;i.width=n*o1,i.height=r*o1,i.style.width="100%",i.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),o}(so.EventEmitter)).prototype,"id",[tJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),es=lS(eo.prototype,"iconService",[t0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu=lS(eo.prototype,"fontService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=lS(eo.prototype,"controlService",[t2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el=lS(eo.prototype,"configService",[t3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ef=lS(eo.prototype,"map",[t5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eh=lS(eo.prototype,"coordinateSystemService",[t4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=lS(eo.prototype,"rendererService",[t7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed=lS(eo.prototype,"layerService",[t6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev=lS(eo.prototype,"debugService",[t8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=lS(eo.prototype,"cameraService",[t9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eg=lS(eo.prototype,"interactionService",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ey=lS(eo.prototype,"pickingService",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=lS(eo.prototype,"shaderModuleService",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ex=lS(eo.prototype,"markerService",[er],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=lS(eo.prototype,"popupService",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo))||eo),fI=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function fD(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return{content:t=t.replace(fI,function(t,r,i){var o=i.split(":"),a=o[0].trim(),s="";switch(o.length>1&&(s=o[1].trim()),r){case"bool":s="true"===s;break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s=s?s.replace("[","").replace("]","").split(",").reduce(function(t,e){return t.push(Number(e.trim())),t},[]):Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(r)).fill(0)}return n[a]=s,"".concat(e?"uniform ":"").concat(r," ").concat(a,";\n")}),uniforms:n}}function fN(t){var e=fD(t,!0),n=e.content,r=e.uniforms;return{content:n=n.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(t,e,n){var i=fD(n=n.trim().replace(/^.*$/gm,function(t){return"uniform ".concat(t)})),o=i.content;return Object.assign(r,i.uniforms),"".concat(e,"{\n").concat(o,"\n};")}),uniforms:r}}function fz(t){var e={};return t.replace(fI,function(t,n,r){var i=r.trim();return e[i]?"":(e[i]=!0,"uniform ".concat(n," ").concat(i,";\n"))})}var fj=oD.uniq,fB="#define PI 3.14159265359",fF="layout(std140) uniform SceneUniforms {\n  mat4 u_ViewMatrix;\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewProjectionMatrix;\n  mat4 u_ModelMatrix;\n  vec4 u_ViewportCenterProjection;\n  vec3 u_PixelsPerDegree;\n  float u_Zoom;\n  vec3 u_PixelsPerDegree2;\n  float u_ZoomScale;\n  vec3 u_PixelsPerMeter;\n  float u_CoordinateSystem;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_ViewportCenter;\n  vec2 u_ViewportSize;\n  float u_FocalDistance;\n};\n\nlayout(std140) uniform LayerUniforms {\n  mat4 u_Mvp;\n  vec2 u_sceneCenterMercator;\n};\n",fU="layout(std140) uniform PickingUniforms {\n  vec4 u_HighlightColor;\n  vec4 u_SelectColor;\n  vec3 u_PickingColor;\n  float u_PickingStage;\n  vec3 u_CurrentSelectedId;\n  float u_PickingThreshold;\n  float u_PickingBuffer;\n  float u_shaderPick;\n  float u_EnableSelect;\n  float u_activeMix;\n};",fV='#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define EARTH_CIRCUMFERENCE 40.03e6\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n#pragma include "scene_uniforms"\n\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return lnglat;\n  }\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n \n\n  //    return vec4(\n  //     position.xy,\n  //     project_scale(position.z),\n  //     position.w);\n  // }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\n\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n\n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\n// Project meter into the unit of pixel which used in the camera world space\nfloat project_float_meter(float meter) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Since the zoom level uniform is updated by mapservice and it\'s alread been subtracted by 1\n    // Not sure if we are supposed to do that again\n   return meter;\n  } else  {\n    return project_float_pixel(meter);\n  }\n\n  // TODO: change the following code to make adaptations for amap\n  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}\n\n// 支持 GaodeV2、Mapbox\nvec4 project_common_position_to_clipspace_v2(vec4 position) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    return u_Mvp * position;\n  } else {\n    return project_common_position_to_clipspace(position);\n  }\n}\n',fH=/precision\s+(high|low|medium)p\s+float/,fG="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",fW=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,fY=/void\s+main\s*\([^)]*\)\s*\{\n?/,fq=(0,cn.b2)()(eS=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"moduleCache",{}),(0,ac.Z)(this,"rawContentCache",{})}return(0,rX.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:fB,fs:fB}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("scene_uniforms",{vs:fF,fs:fF}),this.registerModule("picking_uniforms",{vs:fU,fs:fU}),this.registerModule("projection",{vs:fV,fs:fV}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:'layout(location = 3) in vec3 a_PickingColor;\nout vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return distance(vertexColor,u_PickingColor.rgb) < 0.01;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n',fs:'\nin vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n'}),this.registerModule("rotation_2d",{vs:"vec2 rotate_matrix(vec2 v, float a) {\n    float b = a / 180.0 * 3.1415926535897932384626433832795;\n    float s = sin(b);\n    float c = cos(b);\n    mat2 m = mat2(c, s, -s, c);\n    return m * v;\n}",fs:""})}},{key:"registerModule",value:function(t,e){e.vs=e.vs.replace(/\r\n/g,"\n"),e.fs=e.fs.replace(/\r\n/g,"\n");var n=e.vs,r=e.fs,i=e.uniforms,o=e.inject,a=fN(n),s=a.content,u=a.uniforms,c=fN(r),l=c.content,f=c.uniforms;this.rawContentCache[t]={fs:l,inject:o,uniforms:(0,rW.Z)((0,rW.Z)((0,rW.Z)({},u),f),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this,n=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs,i=this.rawContentCache[t].inject,o={};null!=i&&i["vs:#decl"]&&(n=(null==i?void 0:i["vs:#decl"])+n,o=fN(null==i?void 0:i["vs:#decl"]).uniforms),null!=i&&i["vs:#main-start"]&&(n=n.replace(fY,function(t){return t+(null==i?void 0:i["vs:#main-start"])})),null!=i&&i["fs:#decl"]&&(r=(null==i?void 0:i["fs:#decl"])+r);var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,c=this.processModule(r,[],"fs"),l=c.content,f=c.includeList,h="",p=fj(u.concat(f).concat(t)).reduce(function(t,n){return(0,rW.Z)((0,rW.Z)({},t),e.rawContentCache[n].uniforms)},(0,rW.Z)({},o));fH.test(l)||(h+=fG),h+=l;var d="";return fH.test(s)||(d+=fG),d+=s,this.moduleCache[t]={fs:h.trim(),uniforms:p,vs:d.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this;return{content:t.replace(fW,function(t,i){var o=i.split(" ")[0].replace(/"/g,"");if(e.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return e.push(o),r.processModule(a,e,n).content}),includeList:e}}},{key:"injectDefines",value:function(t){return Object.keys(t).reduce(function(e,n){return e+"#define ".concat(n.toUpperCase()," ").concat(t[n],";\n")},"\n")}}]),t}())||eS;function fX(){return(fX="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=(0,rJ.Z)(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}var fK=((I={}).Normal="normal",I.PostProcessing="post-processing",I),f$=(0,cn.b2)()(ew=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"shaderModuleService",void 0),(0,ac.Z)(this,"rendererService",void 0),(0,ac.Z)(this,"cameraService",void 0),(0,ac.Z)(this,"mapService",void 0),(0,ac.Z)(this,"interactionService",void 0),(0,ac.Z)(this,"layerService",void 0),(0,ac.Z)(this,"config",void 0)}return(0,rX.Z)(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return fK.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(ci.IRendererService),this.cameraService=t.getContainer().get(ci.ICameraService),this.mapService=t.getContainer().get(ci.IMapService),this.interactionService=t.getContainer().get(ci.IInteractionService),this.layerService=t.getContainer().get(ci.ILayerService),this.shaderModuleService=t.getContainer().get(ci.IShaderModuleService)}},{key:"render",value:function(t){}}]),t}())||ew,fQ=(0,cn.b2)()(ek=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,e){fX((0,rJ.Z)(r.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(f$))||ek;function fJ(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var f0=(eC=(0,cn.b2)(),eE=(0,cn.f3)(ci.IPostProcessor),eC((eM=lS((eA=function(){var t;function e(){(0,rK.Z)(this,e),(0,ac.Z)(this,"passes",[]),l_(this,"postProcessor",eM,this),(0,ac.Z)(this,"layer",void 0),(0,ac.Z)(this,"renderFlag",void 0),(0,ac.Z)(this,"width",0),(0,ac.Z)(this,"height",0)}return(0,rX.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(t=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return fJ(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fJ(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.passes),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value,t.next=7,r.render(this.layer);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:return t.next=19,this.postProcessor.render(this.layer);case 19:case"end":return t.stop()}},t,this,[[1,11,14,17]])})),function(){return t.apply(this,arguments)})},{key:"resize",value:function(t,e){(this.width!==t||this.height!==e)&&(this.postProcessor.resize(t,e),this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===fK.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,n){t.init(this.layer,e),this.passes.splice(n,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}()).prototype,"postProcessor",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eA))||eA),f1=(0,cn.b2)()(eT=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"pickingFBO",void 0),(0,ac.Z)((0,se.Z)(t),"layer",void 0),(0,ac.Z)((0,se.Z)(t),"width",0),(0,ac.Z)((0,se.Z)(t),"height",0),(0,ac.Z)((0,se.Z)(t),"alreadyInRendering",!1),(0,ac.Z)((0,se.Z)(t),"pickFromPickingFBO",function(e){var n,r=e.x,i=e.y,o=e.lngLat,a=e.type;if(t.layer.isVisible()&&t.layer.needPick(a)){var s=t.rendererService,u=s.getViewportSize,c=s.readPixelsAsync,l=s.useFramebuffer,f=u(),h=f.width,p=f.height,d=t.layer.getLayerConfig(),v=d.enableHighlight,m=d.enableSelect,g=r*o1,y=i*o1;g>h||g<0||y>p||y<0||l(t.pickingFBO,st(sr().mark(function e(){var s,u,l,f,h;return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({x:Math.round(g),y:Math.round(p-(i+1)*o1),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO});case 2:0!==(n=e.sent)[0]||0!==n[1]||0!==n[2]?(u=iG(n),l=t.layer.getSource().getFeatureById(u),f={x:r,y:i,type:a,lngLat:o,featureId:u,feature:l},l&&(t.layer.setCurrentPickId(u),t.triggerHoverOnLayer(f))):(h={x:r,y:i,lngLat:o,type:null===t.layer.getCurrentPickId()?"un"+a:"mouseout",featureId:null,feature:null},t.triggerHoverOnLayer((0,rW.Z)((0,rW.Z)({},h),{},{type:"unpick"})),t.triggerHoverOnLayer(h),t.layer.setCurrentPickId(null)),v&&t.highlightPickedFeature(n),m&&"click"===a&&(null===(s=n)||void 0===s?void 0:s.toString())!==[0,0,0,0].toString()&&t.selectFeature(n);case 6:case"end":return e.stop()}},e)})))}}),t}return(0,rX.Z)(r,[{key:"getType",value:function(){return fK.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,e){fX((0,rJ.Z)(r.prototype),"init",this).call(this,t,e),this.layer=t;var n=this.rendererService,i=n.createTexture2D,o=n.createFramebuffer,a=(0,n.getViewportSize)(),s=i({width:a.width,height:a.height,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=o({color:s}),this.interactionService.on(lI.Hover,this.pickFromPickingFBO),this.interactionService.on(lI.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(lI.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var e=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,(this.width!==s||this.height!==u)&&(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,function(){o({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=e.layer.multiPassRenderer.getRenderFlag();e.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),e.layer.multiPassRenderer.setRenderFlag(n),e.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var e=(0,i3.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var e=(0,i3.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var e=iW(t.featureId);this.selectFeature(new Uint8Array(e))}},{key:"highlightFeatureHandle",value:function(t){var e=iW(t.featureId);this.highlightPickedFeature(new Uint8Array(e))}}]),r}(f$))||eT,f2=oD.camelCase,f3=oD.isNil,f5=oD.upperFirst,f4=(eL=(0,cn.b2)(),eZ=(0,cn.f3)(ci.IShaderModuleService),eL((eO=lS((eP=function(){function t(){(0,rK.Z)(this,t),l_(this,"shaderModuleService",eO,this),(0,ac.Z)(this,"rendererService",void 0),(0,ac.Z)(this,"config",void 0),(0,ac.Z)(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),(0,ac.Z)(this,"enabled",!0),(0,ac.Z)(this,"renderToScreen",!1),(0,ac.Z)(this,"model",void 0),(0,ac.Z)(this,"name",void 0),(0,ac.Z)(this,"optionsToUpdate",{})}return(0,rX.Z)(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return fK.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(ci.IRendererService),this.shaderModuleService=t.getContainer().get(ci.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,c=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:lq.FLOAT}),size:2})},uniforms:(0,rW.Z)((0,rW.Z)({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(t,e){var n=this,r=t.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),c=u.width,l=u.height;o(this.renderToScreen?null:r.getWriteFBO(),function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var t=(0,rW.Z)({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,l]},n.convertOptionsToUniforms(n.optionsToUpdate));e&&(t.u_BloomFinal=1,t.u_Texture2=e),n.model.draw({uniforms:t})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,rW.Z)((0,rW.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach(function(n){f3(t[n])||(e["u_".concat(f5(f2(n)))]=t[n])}),e}}]),t}()).prototype,"shaderModuleService",[eZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eP))||eP),f7=oD.isNil,f6=(0,cn.b2)()(eR=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,rW.Z)((0,rW.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return f7(t.bloomRadius)||(e.u_radius=t.bloomRadius),f7(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),f7(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}]),r}(f4))||eR,f8=oD.isNil,f9=(0,cn.b2)()(eI=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,rW.Z)((0,rW.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return f8(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}]),r}(f4))||eI,ht=oD.isNil,he=(0,cn.b2)()(eD=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,rW.Z)((0,rW.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return ht(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}]),r}(f4))||eD,hn=(0,cn.b2)()(eN=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var t=this.shaderModuleService.getModule("colorhalftone-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,rW.Z)((0,rW.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),r}(f4))||eN,hr=(0,cn.b2)()(ez=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),r}(f4))||ez,hi=(0,cn.b2)()(ej=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,rW.Z)((0,rW.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),r}(f4))||ej,ho=(0,cn.b2)()(eB=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("ink-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,rW.Z)((0,rW.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),r}(f4))||eB,ha=(0,cn.b2)()(eF=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),r}(f4))||eF,hs=(0,cn.b2)()(eU=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(f4))||eU,hu=(eV=(0,cn.b2)(),eH=(0,cn.f3)(ci.IRendererService),eG=(0,cn.zY)(),eV((eY=lS((eW=function(){var t,e;function n(){(0,rK.Z)(this,n),l_(this,"rendererService",eY,this),(0,ac.Z)(this,"passes",[]),(0,ac.Z)(this,"readFBO",void 0),(0,ac.Z)(this,"writeFBO",void 0)}return(0,rX.Z)(n,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,e=t.getViewportSize,n=t.createTexture2D,r=e();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,e=this.rendererService.useFramebuffer;return new Promise(function(n){e(t.readFBO,st(sr().mark(function e(){return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n(t.getCurrentFBOTex());case 1:case"end":return e.stop()}},e)})))})}},{key:"renderBloomPass",value:(t=st(sr().mark(function t(e,n){var r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getReadFBOTex();case 2:r=t.sent,i=0;case 4:if(!(i<4)){t.next=11;break}return t.next=7,n.render(e,r);case 7:this.swap(),i++,t.next=4;break;case 11:case"end":return t.stop()}},t,this)})),function(e,n){return t.apply(this,arguments)})},{key:"render",value:(e=st(sr().mark(function t(e){var n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.passes.length)){t.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){t.next=9;break}return t.next=7,this.renderBloomPass(e,r);case 7:t.next=12;break;case 9:return t.next=11,r.render(e);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,t.next=1;break;case 15:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,n){t.init(e,n),this.passes.push(t)}},{key:"insert",value:function(t,e,n,r){t.init(n,r),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(e){return e.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,e=t.createFramebuffer,n=t.createTexture2D;this.readFBO=e({color:n({width:1,height:1,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE})}),this.writeFBO=e({color:n({width:1,height:1,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),n}()).prototype,"rendererService",[eH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lS(eW.prototype,"init",[eG],Object.getOwnPropertyDescriptor(eW.prototype,"init"),eW.prototype),eW))||eW),hc=(0,cn.b2)()(eq=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getType",value:function(){return fK.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,e){fX((0,rJ.Z)(r.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(t){var e=this.rendererService,n=e.useFramebuffer,r=e.clear,i=t.multiPassRenderer.getPostProcessor().getReadFBO();n(i,function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(e){e.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(f$))||eq,hl="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function hf(t,e){for(var n=0,r=1/e,i=t;i>0;)n+=i%e*r,i=Math.floor(i/e),r/=e;return n}var hh=1,hp=(eX=(0,cn.b2)(),eK=(0,cn.f3)(ci.IShaderModuleService),eX((eQ=lS((e$=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),l_((0,se.Z)(t),"shaderModuleService",eQ,(0,se.Z)(t)),(0,ac.Z)((0,se.Z)(t),"haltonSequence",[]),(0,ac.Z)((0,se.Z)(t),"accumulatingId",0),(0,ac.Z)((0,se.Z)(t),"frame",0),(0,ac.Z)((0,se.Z)(t),"timer",void 0),(0,ac.Z)((0,se.Z)(t),"sampleRenderTarget",void 0),(0,ac.Z)((0,se.Z)(t),"prevRenderTarget",void 0),(0,ac.Z)((0,se.Z)(t),"outputRenderTarget",void 0),(0,ac.Z)((0,se.Z)(t),"copyRenderTarget",void 0),(0,ac.Z)((0,se.Z)(t),"blendModel",void 0),(0,ac.Z)((0,se.Z)(t),"outputModel",void 0),(0,ac.Z)((0,se.Z)(t),"copyModel",void 0),t}return(0,rX.Z)(r,[{key:"getType",value:function(){return fK.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,e){fX((0,rJ.Z)(r.prototype),"init",this).call(this,t,e);var n=this.rendererService,i=n.createFramebuffer,o=n.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([hf(a,2),hf(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",hl,{blend:{enable:!0,func:{srcRGB:lq.ONE,dstRGB:lq.ONE_MINUS_SRC_ALPHA,srcAlpha:lq.ONE,dstAlpha:lq.ONE_MINUS_SRC_ALPHA},equation:{rgb:lq.FUNC_ADD,alpha:lq.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",hl)}},{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var c=t.multiPassRenderer.getPostProcessor().getReadFBO();o(c,function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var l=function n(r){e.accumulatingId&&r===e.accumulatingId&&(e.isFinished()||(e.doRender(t),window.requestAnimationFrame(function(){n(r)})))};this.accumulatingId=hh++,this.timer=window.setTimeout(function(){l(e.accumulatingId)},50)}},{key:"doRender",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,c=t.getLayerConfig().jitterScale,l=void 0===c?1:c,f=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*f[0]-1)/s*l,(2*f[1]-1)/u*l),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),o(this.sampleRenderTarget,function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var h=t.getLayerConfig();o(this.outputRenderTarget,function(){e.blendModel.draw({uniforms:{u_opacity:h.opacity||1,u_MixRatio:0===e.frame?1:.9,u_Diffuse1:e.sampleRenderTarget,u_Diffuse2:0===e.frame?t.multiPassRenderer.getPostProcessor().getReadFBO():e.prevRenderTarget}})}),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,function(){e.outputModel.draw({uniforms:{u_Texture:e.outputRenderTarget}})}),o(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){e.copyModel.draw({uniforms:{u_Texture:e.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,e,n){this.shaderModuleService.registerModule(t,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:e});var r=this.shaderModuleService.getModule(t),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,c=s.createBuffer;return(0,s.createModel)((0,rW.Z)({vs:i,fs:o,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:lq.FLOAT}),size:2})},uniforms:(0,rW.Z)({},a),depth:{enable:!1},count:3},n))}}]),r}(f$)).prototype,"shaderModuleService",[eK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e$))||e$),hd=new cn.W2;hd.bind(ci.IGlobalConfigService).to(lx).inSingletonScope(),(0,cn.GW)((0,cn.b2)(),so.EventEmitter),hd.bind(ci.IEventEmitter).to(so.EventEmitter);var hv=(0,cr.Z)(hd,!1),hm=function(t){var e=hv.lazyInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},hg=function(t){var e=hv.lazyMultiInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},hy=hd,hb=0;function hx(){var t=new cn.W2;return t.parent=hd,t.bind(ci.SceneID).toConstantValue("".concat(hb++)),t.bind(ci.IShaderModuleService).to(fq).inSingletonScope(),t.bind(ci.ILayerService).to(lW).inSingletonScope(),t.bind(ci.IDebugService).to(lP).inSingletonScope(),t.bind(ci.ISceneService).to(fR).inSingletonScope(),t.bind(ci.ICameraService).to(lo).inSingletonScope(),t.bind(ci.ICoordinateSystemService).to(lZ).inSingletonScope(),t.bind(ci.IInteractionService).to(lN).inSingletonScope(),t.bind(ci.IPickingService).to(lF).inSingletonScope(),t.bind(ci.IControlService).to(lc).inSingletonScope(),t.bind(ci.IMarkerService).to(ll).inSingletonScope(),t.bind(ci.IIconService).to(cg).inSingletonScope(),t.bind(ci.IFontService).to(cm).inSingletonScope(),t.bind(ci.IPopupService).to(lf).inSingletonScope(),t.bind(ci.INormalPass).to(fQ).whenTargetNamed("clear"),t.bind(ci.INormalPass).to(f1).whenTargetNamed("pixelPicking"),t.bind(ci.INormalPass).to(hc).whenTargetNamed("render"),t.bind(ci.INormalPass).to(hp).whenTargetNamed("taa"),t.bind(ci.IFactoryNormalPass).toFactory(function(t){return function(e){return t.container.getNamed(ci.INormalPass,e)}}),t.bind(ci.IPostProcessingPass).to(hr).whenTargetNamed("copy"),t.bind(ci.IPostProcessingPass).to(f6).whenTargetNamed("bloom"),t.bind(ci.IPostProcessingPass).to(f9).whenTargetNamed("blurH"),t.bind(ci.IPostProcessingPass).to(he).whenTargetNamed("blurV"),t.bind(ci.IPostProcessingPass).to(ha).whenTargetNamed("noise"),t.bind(ci.IPostProcessingPass).to(hs).whenTargetNamed("sepia"),t.bind(ci.IPostProcessingPass).to(hn).whenTargetNamed("colorHalftone"),t.bind(ci.IPostProcessingPass).to(hi).whenTargetNamed("hexagonalPixelate"),t.bind(ci.IPostProcessingPass).to(ho).whenTargetNamed("ink"),t.bind(ci.IFactoryPostProcessingPass).toFactory(function(t){return function(e){var n=t.container.getNamed(ci.IPostProcessingPass,e);return n.setName(e),n}}),t}function h_(t){var e=new cn.W2;return e.parent=t,e.bind(ci.IStyleAttributeService).to(l0).inSingletonScope(),e.bind(ci.IMultiPassRenderer).to(f0).inSingletonScope(),e.bind(ci.IPostProcessor).to(hu).inSingletonScope(),e}var hS=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],hw=oD.clamp;function hk(t,e){return 256*(t=hw(Math.floor(t),0,255))+(e=hw(Math.floor(e),0,255))}function hC(t){var e=t.color,n=t.radius,r=t.tileX,i=t.tileY,o=t.shape,a=t.opacity,s=t.stroke,u=t.strokeWidth,c=t.strokeOpacity,l=[],f=[],h=[],p=[hk(e[0],e[1]),hk(e[2],e[3])],d=[hk(s[0],s[1]),hk(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(t){var e=(0,i3.Z)(t,2),s=e[0],v=e[1];l.push([].concat(p,[(s+1)*8388608+(v+1)*2097152+131072*hS.indexOf(o)+n,(r+512)*524288+(i+512)*64])),f.push([].concat(d,[u,c])),h.push([a,0,0,0])}),{packedBuffer:l,packedBuffer2:f,packedBuffer3:h}}var hE={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},hA={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},hM=((D={}).LINEAR="linear",D.SEQUENTIAL="sequential",D.POWER="power",D.LOG="log",D.IDENTITY="identity",D.TIME="time",D.QUANTILE="quantile",D.QUANTIZE="quantize",D.THRESHOLD="threshold",D.CAT="cat",D.DIVERGING="diverging",D.CUSTOM="threshold",D),hT=((N={}).CONSTANT="constant",N.VARIABLE="variable",N),hL=((z={})[z.Attribute=0]="Attribute",z[z.InstancedAttribute=1]="InstancedAttribute",z[z.Uniform=2]="Uniform",z),hZ=["mapload","mapchange","mapAfterFrameChange"],hP=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],hO=((j={}).IMAGE="image",j.CUSTOMIMAGE="customImage",j.ARRAYBUFFER="arraybuffer",j.RGB="rgb",j.TERRAINRGB="terrainRGB",j.CUSTOMRGB="customRGB",j.CUSTOMARRAYBUFFER="customArrayBuffer",j.CUSTOMTERRAINRGB="customTerrainRGB",j),hR=(B=st(sr().mark(function t(e,n,r,i){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,o){n({x:e.x,y:e.y,z:e.z},function(e,n){if(e||0===n.length){o(e);return}n&&ct([{data:n,bands:[0]}],r,i,function(e,n){e?o(e):n&&t(n)})})}));case 1:case"end":return t.stop()}},t)})),function(t,e,n,r){return B.apply(this,arguments)}),hI=(F=st(sr().mark(function t(e,n){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,r){n({x:e.x,y:e.y,z:e.z},function(e,n){if(e||!n){r(e);return}n instanceof ArrayBuffer?il(n,function(e,n){e&&r(e),t(n)}):n instanceof HTMLImageElement?t(n):r(e)})}));case 1:case"end":return t.stop()}},t)})),function(t,e){return F.apply(this,arguments)});function hD(t,e){t.xhrCancel=function(){e.map(function(t){t.abort()})}}var hN=(U=st(sr().mark(function t(e,n,r,i,o){var a,s,u,c,l;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:var f;if(!((a="string"==typeof(f=n.url)?[{url:f,bands:[0]}]:"string"==typeof f[0]?f.map(function(t){return{url:t,bands:[0]}}):f).length>1)){t.next=15;break}return t.next=4,function(t,e){return hz.apply(this,arguments)}(a,n);case 4:if(u=(s=t.sent).rasterFiles,c=s.xhrList,l=s.errList,hD(e,c),!(l.length>0)){t.next=12;break}return r(l,null),t.abrupt("return");case 12:ct(u,i,o,r),t.next=17;break;case 15:hD(e,[ie(n,function(t,e){t?r(t):e&&ct([{data:e,bands:a[0].bands}],i,o,r)})]);case 17:case"end":return t.stop()}},t)})),function(t,e,n,r,i){return U.apply(this,arguments)});function hz(){return(hz=st(sr().mark(function t(e,n){var r,i,o,a,s,u,c,l,f,h,p;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<e.length)){t.next=20;break}return s=e[a],u=(0,rW.Z)((0,rW.Z)({},n),{},{url:s.url}),c=s.bands,t.next=10,r8((0,rW.Z)((0,rW.Z)({},u),{},{type:"arrayBuffer"}));case 10:f=(l=t.sent).err,h=l.data,p=l.xhr,f&&o.push(f),i.push(p),r.push({data:h,bands:c});case 17:a++,t.next=4;break;case 20:return t.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return t.stop()}},t)}))).apply(this,arguments)}var hj=(V=st(sr().mark(function t(e,n,r,i,o){var a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={url:function(t,e){return Array.isArray(t)?"string"==typeof t[0]?t.map(function(t){return sM(t,e)}):t.map(function(t){return{url:sM(t.url,e),bands:t.bands||[0]}}):sM(t,e)}(e,n)},t.abrupt("return",new Promise(function(t,e){hN(r,a,function(n,r){n?e(n):r&&t(r)},i,o)}));case 2:case"end":return t.stop()}},t)})),function(t,e,n,r,i){return V.apply(this,arguments)}),hB=(H=st(sr().mark(function t(e,n,r,i){var o,a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=Array.isArray(e)?e[0]:e,o=i.wmtsOptions?((null==i?void 0:i.getURLFromTemplate)||sT)(a,(0,rW.Z)((0,rW.Z)({},n),i.wmtsOptions)):((null==i?void 0:i.getURLFromTemplate)||sM)(a,n),t.abrupt("return",new Promise(function(t,e){var n,a=ic({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},function(n,r){n?e(n):r&&t(r)},i.transformResponse);r.xhrCancel=function(){return a.cancel()}}));case 3:case"end":return t.stop()}},t)})),function(t,e,n,r){return H.apply(this,arguments)}),hF=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},hU={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};hO.ARRAYBUFFER,hO.RGB;var hV=["extent","min","max","width","height","format","operation"],hH={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},hG=(G=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){var n=(0,i3.Z)(e.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];t({layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})}));case 1:case"end":return t.stop()}},t)})),function(t){return G.apply(this,arguments)}),hW=["extent","width","height"],hY=["extent","width","height"],hq=n(24299),hX=n.n(hq);function hK(t,e){var n=e.radius,r=e.maxZoom,i=e.minZoom,o=e.zoom;if(t.pointIndex){var a=t.pointIndex.getClusters(t.extent,Math.floor(void 0===o?2:o));return t.dataArray=a.map(function(t,e){return(0,rW.Z)({coordinates:t.geometry.coordinates,_id:e+1},t.properties)}),t}var s=new(hX())({radius:void 0===n?40:n,minZoom:void 0===i?0:i,maxZoom:void 0===r?18:r}),u={features:[]};return u.features=t.dataArray.map(function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:(0,rW.Z)({},t)}}),s.load(u.features),s}function h$(t){if(0===t.length)return 0;for(var e,n=t[0],r=0,i=1;i<t.length;i++)e=n+1*t[i],Math.abs(n)>=Math.abs(t[i])?r+=n-e+t[i]:r+=t[i]-e+n,n=e;return n+1*r}var hQ={min:function(t){if(0===t.length)throw Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return e},max:function(t){if(0===t.length)throw Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return e},mean:function(t){if(0===t.length)throw Error("mean requires at least one data point");return h$(t)/t.length},sum:h$},hJ=oD.cloneDeep,h0=oD.isFunction,h1=oD.isString,h2=oD.mergeWith;function h3(t,e){if(Array.isArray(e))return e}var h5=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(t,e){var n;return(0,rK.Z)(this,o),n=i.call(this),(0,ac.Z)((0,se.Z)(n),"type","source"),(0,ac.Z)((0,se.Z)(n),"isTile",!1),(0,ac.Z)((0,se.Z)(n),"inited",!1),(0,ac.Z)((0,se.Z)(n),"hooks",{init:new fS}),(0,ac.Z)((0,se.Z)(n),"parser",{type:"geojson"}),(0,ac.Z)((0,se.Z)(n),"transforms",[]),(0,ac.Z)((0,se.Z)(n),"cluster",!1),(0,ac.Z)((0,se.Z)(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,ac.Z)((0,se.Z)(n),"invalidExtent",!1),(0,ac.Z)((0,se.Z)(n),"dataArrayChanged",!1),(0,ac.Z)((0,se.Z)(n),"cfg",{autoRender:!0}),n.originData=t,n.initCfg(e),n.init().then(function(){n.inited=!0,n.emit("update",{type:"inited"})}),n}return(0,rX.Z)(o,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var e=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,a.forEach(function(t){t.id||(t.properties.point_count=1)}),(o||h0(i))&&(a=a.map(function(t){var n=t.id;if(n){var r=e.clusterIndex.getLeaves(n,1/0).map(function(t){return t.properties});if(h1(i)&&o){var a,s=r.map(function(t){return 1*t[o]});a=hQ[i](s)}h0(i)&&(a=i(r)),t.properties.stat=a}else t.properties.point_count=1;return t})),this.data=rD("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var e=this.parser,n=e.type,r=void 0===n?"geojson":n,i=e.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find(function(e){return e._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null";var o=hJ(t<this.originData.features.length?this.originData.features[t]:"null");if(null!=o&&o.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var a=this.data.dataArray.find(function(e){return e._id===t});o.properties=a}return o}},{key:"updateFeaturePropertiesById",value:function(t,e){this.data.dataArray=this.data.dataArray.map(function(n){return n._id===t?(0,rW.Z)((0,rW.Z)({},n),e):n}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,e){var n=this.data.dataArray.find(function(n){return n[t]===e});return null==n?void 0:n._id}},{key:"setData",value:function(t,e){var n=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(e),this.init().then(function(){n.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var t;null===(t=this.tileset)||void 0===t||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,e,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(t,e,n)}},{key:"reloadTileByLnglat",value:function(t,e,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(t,e,n)}},{key:"getTileExtent",value:function(t,e){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(t,e)}},{key:"getTileByZXY",value:function(t,e,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(t,e,n)}},{key:"reloadTileByExtent",value:function(t,e){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(t,e)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(t=this.tileset)||void 0===t||t.destroy()}},{key:"processData",value:(n=st(sr().mark(function t(){var e=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){try{e.excuteParser(),e.initCluster(),e.executeTrans(),t({})}catch(t){n(t)}}));case 1:case"end":return t.stop()}},t)})),function(){return n.apply(this,arguments)})},{key:"initCfg",value:function(t){this.cfg=h2(this.cfg,t,h3);var e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,rW.Z)((0,rW.Z)({},this.clusterOptions),e.clusterOptions)))}},{key:"init",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.inited=!1,t.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"excuteParser",value:function(){var t=this.parser,e=rD(t.type||"geojson");this.data=e(this.originData,t),this.tileset=this.initTileset(),t.cancelExtent||(this.extent=ag(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;return t?(this.isTile=!0,this.tileset)?(this.tileset.updateOptions(t),this.tileset):new sC((0,rW.Z)({},t)):void 0}},{key:"executeTrans",value:function(){var t=this;this.transforms.forEach(function(e){var n=rR[e.type](t.data,e);Object.assign(t.data,n)})}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=hK(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=aL(aP(this.extent),t)),e[0].concat(e[1])}}]),o}(so.EventEmitter);function h4(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return h7(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h7(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function h7(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var h6=Math.PI/3,h8=[0,h6,2*h6,3*h6,4*h6,5*h6];function h9(t){return t[0]}function pt(t){return t[1]}rN("rasterTile",function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Array.isArray(t)&&0===t.length||!Array.isArray(t)&&"string"!=typeof t)throw Error("tile server url is error");var n=(null==e?void 0:e.dataType)||hO.IMAGE;n===hO.RGB&&(n=hO.ARRAYBUFFER);var r=(0,rW.Z)((0,rW.Z)((0,rW.Z)({},hU),e),{},{getTileData:function(r,i){switch(n){case hO.IMAGE:return hB(t,r,i,e);case hO.CUSTOMIMAGE:case hO.CUSTOMTERRAINRGB:return hI(i,null==e?void 0:e.getCustomData);case hO.ARRAYBUFFER:return hj(t,r,i,(null==e?void 0:e.format)||hF,null==e?void 0:e.operation);case hO.CUSTOMARRAYBUFFER:case hO.CUSTOMRGB:return hR(i,null==e?void 0:e.getCustomData,(null==e?void 0:e.format)||hF,null==e?void 0:e.operation);default:return hB(t,r,i,e)}}});return{data:t,dataArray:[],tilesetOptions:r,isTile:!0}}),rN("mvt",function(t,e){var n=Array.isArray(t)?t[0]:t,r=(0,rW.Z)((0,rW.Z)((0,rW.Z)({},u2),e),{},{getTileData:function(t,r){return u3(n,t,r,null==e?void 0:e.requestParameters,null==e?void 0:e.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}}),rN("geojsonvt",function(t,e){var n,r=(n={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0},void 0===e||void 0===e.geojsonvtOptions?n:(0,rW.Z)((0,rW.Z)({},n),e.geojsonvtOptions)),i=r.extent||4096,o=new uG(t,r);return{data:t,dataArray:[],tilesetOptions:(0,rW.Z)((0,rW.Z)((0,rW.Z)({},uq),e),{},{getTileData:function(t,e){return uK(e,o,t,i)}}),isTile:!0}}),rN("testTile",function(t,e){return{data:t,dataArray:[],tilesetOptions:(0,rW.Z)((0,rW.Z)((0,rW.Z)({},hH),e),{},{getTileData:function(t){return hG(t)}}),isTile:!0}}),rN("geojson",function(t,e){var n=[],r={};return t.features?(t.features=t.features.filter(function(t){var e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0}),0===(t=uk(t)).features.length)?{dataArray:[],featureKeys:r}:((0,rq.nG)(t,function(t,r){var i,o=void 0===(i=null==e?void 0:e.featureId)?null:"number"==typeof(1*t.properties[i])?1*t.properties[i]:t.properties&&t.properties[i]?function(t){for(var e=t.toString(),n=5381,r=e.length;r;)n=33*n^e.charCodeAt(--r);return n>>>0}(t.properties[i]+"")%1000019:null;null===o&&(o=r);var a=o,s=(0,rY.r7)(t),u=(0,rW.Z)((0,rW.Z)({},t.properties),{},{coordinates:s,_id:a});n.push(u)}),{dataArray:n,featureKeys:r}):(t.features=[],{dataArray:[]})}),rN("jsonTile",function(t,e){return{dataArray:[],tilesetOptions:(0,rW.Z)((0,rW.Z)({},e),{},{getTileData:function(n,r){return u$(t,r,null==e?void 0:e.requestParameters,e.getCustomData)}}),isTile:!0}}),rN("image",function t(e,n){var r=n.extent,i=void 0===r?[121.168,30.2828,121.384,30.4219]:r,o=n.requestParameters,a=void 0===o?{}:o,s=new Promise(function(n){e instanceof HTMLImageElement||an(e)?n([e]):function(e,n,r){var i=[];if("string"==typeof e)ic((0,rW.Z)((0,rW.Z)({},n),{},{url:e}),function(t,e){e&&(i.push(e),r(i))});else{var o=e.length,a=0;e.forEach(function(t){ic((0,rW.Z)((0,rW.Z)({},n),{},{url:t}),function(t,e){a++,e&&i.push(e),a===o&&r(i)})})}return t}(e,a,function(t){n(t)})});return{originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]}}),rN("csv",function(t,e){return uC(rG(t),e)}),rN("json",uC),rN("raster",function(t,e){var n,r,i,o=e.extent,a=e.width,s=e.height,u=e.min,c=e.max,l=e.format,f=e.operation;return void 0===l||uw(t)?(n=Array.from(t),r=a,i=s):n=u8(Array.isArray(t)?t:[t],l,f),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:c,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}}),rN("rasterRgb",function(t,e){var n,r=e.extent,i=e.min,o=e.max,a=e.width,s=e.height,u=e.format,c=e.operation,l=(0,lY.Z)(e,hV);return n=void 0===u||uw(t)?Array.from(t):u8(Array.isArray(t)?t:[t],u,c),{_id:1,dataArray:[(0,rW.Z)((0,rW.Z)({_id:1,data:n,width:a,height:s},l),{},{min:i,max:o,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]}}),rN("rgb",function(t,e){var n=e.extent,r=e.width,i=e.height,o=(0,lY.Z)(e,hW);t.length<3&&console.warn("RGB解析需要三个波段的数据");for(var a=o.bands||[0,1,2],s=(0,i3.Z)(a,3),u=s[0],c=s[1],l=s[2],f=[t[u],t[c],t[l]],h=[],p=(null==o?void 0:o.countCut)||[2,98],d=(0,i3.Z)(p,2),v=d[0],m=d[1],g=(null==o?void 0:o.RMinMax)||u6(f[0],v,m),y=(null==o?void 0:o.GMinMax)||u6(f[1],v,m),b=(null==o?void 0:o.BMinMax)||u6(f[2],v,m),x=0;x<f[0].length;x++)h.push(Math.max(0,f[0][x]-g[0])),h.push(Math.max(0,f[1][x]-y[0])),h.push(Math.max(0,f[2][x]-b[0]));return{_id:1,dataArray:[(0,rW.Z)((0,rW.Z)({_id:1,data:h,width:r,height:i,rMinMax:g,gMinMax:y,bMinMax:b},o),{},{coordinates:[[n[0],n[1]],[n[2],n[3]]]})]}}),rN("ndi",function(t,e){var n=e.extent,r=e.width,i=e.height,o=(0,lY.Z)(e,hY);t.length<2&&console.warn("RGB解析需要2个波段的数据");for(var a=o.bands||[0,1],s=(0,i3.Z)(a,2),u=s[0],c=s[1],l=[t[u],t[c]],f=[],h=0;h<l[0].length;h++)f.push((l[1][h]-l[0][h])/(l[1][h]+l[0][h]));return{_id:1,dataArray:[(0,rW.Z)((0,rW.Z)({_id:1,data:f,width:r,height:i},o),{},{coordinates:[[n[0],n[1]],[n[2],n[3]]]})]}}),rz("cluster",hK),rz("filter",function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t}),rz("join",function(t,e){var n=e.sourceField,r=e.targetField,i=e.data,o={};return i.forEach(function(t){o[t[n]]=t}),t.dataArray=t.dataArray.map(function(t){var e=t[r];return(0,rW.Z)((0,rW.Z)({},t),o[e])}),t}),rz("map",function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.map(n)),t}),rz("grid",function(t,e){var n,r,i=t.dataArray,o=e.size,a=void 0===o?10:o,s=a/(2*Math.PI*6378e3)*268435456/2,u=function(t,e){var n,r,i=1/0,o=-1/0,a=h4(t);try{for(a.s();!(r=a.n()).done;)n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}catch(t){a.e(t)}finally{a.f()}var s={yOffset:e/6378e3*(180/Math.PI),xOffset:e/6378e3*(180/Math.PI)/Math.cos((i+o)/2*Math.PI/180)};if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var u,c={},l=h4(t);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=f.coordinates[1],p=f.coordinates[0];if(Number.isFinite(h)&&Number.isFinite(p)){var d=Math.floor((h+90)/s.yOffset),v=Math.floor((p+180)/s.xOffset),m="".concat(d,"-").concat(v);c[m]=c[m]||{count:0,points:[]},c[m].count+=1,c[m].points.push(f)}}}catch(t){l.e(t)}finally{l.f()}return{gridHash:c,gridOffset:s}}(i,a);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:(n=u.gridHash,r=u.gridOffset,Object.keys(n).reduce(function(t,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),c={};if(e.field&&e.method){var l=a6(n[i].points,e.field);c[e.method]=a7[e.method](l)}return Object.assign(c,{_id:o,coordinates:ak([-180+r.xOffset*(u+.5),-90+r.yOffset*(s+.5)]),rawData:n[i].points,count:n[i].count}),t.push(c),t},[]))}}),rz("hexagon",function(t,e){var n=t.dataArray,r=e.size,i=e.method,o=void 0===i?"sum":i,a=(void 0===r?10:r)/(2*Math.PI*6378e3)*268435456/2,s=n.map(function(t){var e=ak(t.coordinates),n=(0,i3.Z)(e,2),r=n[0],i=n[1];return(0,rW.Z)((0,rW.Z)({},t),{},{coordinates:[r,i]})});return{dataArray:(function(){var t,e,n,r=0,i=0,o=1,a=1,s=h9,u=pt;function c(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!(isNaN(l=+s.call(null,c=t[r],r,t))||isNaN(f=+u.call(null,c,r,t)))){var c,l,f,h=Math.round(f/=n),p=Math.round(l=l/e-(1&h)/2),d=f-h;if(3*Math.abs(d)>1){var v=l-p,m=p+(l<p?-1:1)/2,g=h+(f<h?-1:1),y=l-m,b=f-g;v*v+d*d>y*y+b*b&&(p=m+(1&h?1:-1)/2,h=g)}var x=p+"-"+h,_=i[x];_?_.push(c):(o.push(_=i[x]=[c]),_.x=(p+(1&h)/2)*e,_.y=h*n)}return o}function l(t){var e=0,n=0;return h8.map(function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]})}return c.hexagon=function(e){return"m"+l(null==e?t:+e).join("l")+"z"},c.centers=function(){for(var s=[],u=Math.round(i/n),c=Math.round(r/e),l=u*n;l<a+t;l+=n,++u)for(var f=c*e+(1&u)*e/2;f<o+e/2;f+=e)s.push([f,l]);return s},c.mesh=function(){var e=l(t).slice(0,4).join("l");return c.centers().map(function(t){return"M"+t+"m"+e}).join("")},c.x=function(t){return arguments.length?(s=t,c):s},c.y=function(t){return arguments.length?(u=t,c):u},c.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(h6),n=1.5*t,c):t},c.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],c):[o-r,a-i]},c.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],c):[[r,i],[o,a]]},c.radius(1)})().radius(a).x(function(t){return t.coordinates[0]}).y(function(t){return t.coordinates[1]})(s).map(function(t,n){var r;if(e.field&&o){var i=a6(t,e.field);t[o]=a7[o](i)}return r={},(0,ac.Z)(r,e.method,t[o]),(0,ac.Z)(r,"count",t.length),(0,ac.Z)(r,"rawData",t),(0,ac.Z)(r,"coordinates",[t.x,t.y]),(0,ac.Z)(r,"_id",n),r}),radius:a,xOffset:a,yOffset:a,type:"hexagon"}});var pe=h5,pn=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e;return(0,rK.Z)(this,r),e=n.call(this),(0,ac.Z)((0,se.Z)(e),"added",!1),(0,ac.Z)((0,se.Z)(e),"preLngLat",{lng:0,lat:0}),(0,ac.Z)((0,se.Z)(e),"onMarkerDragStart",function(t){var n=e.mapsService.getContainer();if(n){e.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});var r=n.getClientRects()[0],i=r.left,o=r.top,a=t.x,s=t.y;e.preLngLat=e.mapsService.containerToLngLat([a-i,s-o]),e.mapsService.on("mousemove",e.onMarkerDragMove),document.addEventListener("mouseup",e.onMarkerDragEnd),e.emit("dragstart",e.lngLat)}}),(0,ac.Z)((0,se.Z)(e),"onMarkerDragMove",function(t){var n=e.preLngLat,r=n.lng,i=n.lat,o=t.lnglat,a=o.lng,s=o.lat,u={lng:e.lngLat.lng+a-r,lat:e.lngLat.lat+s-i};e.setLnglat(u),e.preLngLat=t.lnglat,e.emit("dragging",u)}),(0,ac.Z)((0,se.Z)(e),"onMarkerDragEnd",function(t){e.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),e.mapsService.off("mousemove",e.onMarkerDragMove),document.removeEventListener("mouseup",e.onMarkerDragEnd),e.emit("dragend",e.lngLat)}),(0,ac.Z)((0,se.Z)(e),"eventHandle",function(t){e.polyfillEvent(t),e.emit(t.type,{target:t,data:e.markerOption.extData,lngLat:e.lngLat})}),e.markerOption=(0,rW.Z)((0,rW.Z)({},e.getDefault()),t),al(["update","onMove","onMapClick","updatePositionWhenZoom"],(0,se.Z)(e)),e.init(),e}return(0,rX.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ih.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(ci.IMapService),this.sceneSerive=t.get(ci.ISceneService);var e=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&oU(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var e=this;if(!this.added)return this.once("added",function(){e.setElement(t)}),this;var n=this.markerOption.element;return n&&oU(n),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var e=this.popup;return e&&(e.isOpen()||e.addTo(this.scene)),this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var e=this.popup;return e&&e.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;return t&&(t.isOpen()?t.remove():t.addTo(this.scene)),this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){this.markerOption.draggable=t,this.updateDraggable()}},{key:"getDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.anchor;this.updatePosition(),o$(e,"".concat(ip[n]))}}},{key:"updatePositionWhenZoom",value:function(t){if(this.mapsService){var e=this.markerOption,n=e.element,r=e.offsets,i=this.lngLat,o=i.lng,a=i.lat;if(n){n.style.display="block",n.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,c=s.containerWidth,l=s.bounds;if(!l)return;var f=t.map,h=t.center,p=t.zoom,d=f.DE(this.lngLat,p,h);if(d.x=Math.round(d.x+r[0]),d.y=Math.round(d.y-r[1]),Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(d.x>c){var v=this.mapsService.lngLatToContainer([o-360,a]);d.x=v.x}if(d.x<0){var m=this.mapsService.lngLatToContainer([o+360,a]);d.x=m.x}}(d.x>c||d.x<0||d.y>u||d.y<0)&&(n.style.display="none"),n.style.left=d.x+"px",n.style.top=d.y+"px",n.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}}},{key:"onMapClick",value:function(t){var e=this.markerOption.element;this.popup&&e&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(null==t?void 0:t.scrollHeight)||0,containerWidth:(null==t?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updateDraggable",value:function(){var t=this.markerOption.element;null==t||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(null==t||t.addEventListener("mousedown",this.onMarkerDragStart))}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(e){e.style.display="block",e.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,c=s.containerWidth,l=s.bounds;if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>c){var f=this.mapsService.lngLatToContainer([i-360,o]);a.x=f.x}if(a.x<0){var h=this.mapsService.lngLatToContainer([i+360,o]);a.x=h.x}}(a.x>c||a.x<0||a.y>u||a.y<0)&&(e.style.display="none"),e.style.left=a.x+n[0]+"px",e.style.top=a.y-n[1]+"px",console.log(e.style.left)}}}},{key:"init",value:function(){var t=this,e=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!e){this.defaultMarker=!0,e=oF("div"),this.markerOption.element=e;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),e.appendChild(o)}oV(e,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(n){var r,i,o=(null===(r=t.markerOption)||void 0===r?void 0:r.style)&&(null===(i=t.markerOption)||void 0===i?void 0:i.style[n]);e&&(e.style[n]=o)}),id(e,i,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){this.mapsService&&"GAODE2.x"===this.mapsService.version&&!au()&&("touchstart"===t.type&&(this.touchStartTime=Date.now()),"touchend"===t.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw Error("Method not implemented.")}}]),r}(so.EventEmitter),pr=oD.merge,pi=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e,i;return(0,rK.Z)(this,r),i=n.call(this),(0,ac.Z)((0,se.Z)(i),"markers",[]),(0,ac.Z)((0,se.Z)(i),"points",[]),(0,ac.Z)((0,se.Z)(i),"clusterMarkers",[]),i.markerLayerOption=pr(i.getDefault(),t),al(["update"],(0,se.Z)(i)),i.zoom=(null===(e=i.markerLayerOption.clusterOption)||void 0===e?void 0:e.zoom)||-99,i}return(0,rX.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(ci.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(null==t?void 0:t.scrollWidth)||0,containerHeight:(null==t?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var e=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),e&&(this.addPoint(t,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=aL(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&(this.markers.splice(e,1),this.markerLayerOption.cluster&&(this.removePoint(e),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(e){e.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,e){var n=t.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:(0,rW.Z)((0,rW.Z)({},t.getExtData()),{},{marker_id:e})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(t){var e=this.points.findIndex(function(e){return e.properties.marker_id===t});e>-1&&this.points.splice(e,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,e=t.radius,n=t.minZoom,r=t.maxZoom;this.clusterIndex=new(hX())({radius:e,minZoom:void 0===n?0:n,maxZoom:r}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,e){var n=this,r=t[0].concat(t[1]),i=this.clusterIndex.getClusters(r,e);this.clusterMarkers.forEach(function(t){t.remove()}),this.clusterMarkers=[],i.forEach(function(t){var e=n.markerLayerOption.clusterOption,r=e.field,i=e.method;if(null!==(o=t.properties)&&void 0!==o&&o.cluster_id){var o,a,s=n.getLeaves(null===(a=t.properties)||void 0===a?void 0:a.cluster_id);if(t.properties.clusterData=s,r&&i){var u=a8(i,a6(null==s?void 0:s.map(function(t){return(0,ac.Z)({},r,t.properties[r])}),r)),c="point_"+i;t.properties[c]=u.toFixed(2)}}var l=n.clusterMarker(t);n.clusterMarkers.push(l),l.addTo(n.scene)})}},{key:"getLeaves",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,e,n):null}},{key:"clusterMarker",value:function(t){var e=this.markerLayerOption.clusterOption.element;return new pn({element:(void 0===e?this.generateElement.bind(this):e)(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]})}},{key:"normalMarker",value:function(t){var e=t.properties.marker_id;return this.markers[e]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var t=this.mapsService.getZoom(),e=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!aZ(this.bbox,e))&&(this.bbox=aL(e,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var e=oF("div","l7-marker-cluster"),n=oF("div","",e),r=oF("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;t.properties.point_count=t.properties.point_count||1;var s=o&&a?t.properties["point_"+a]||t.properties[o]:t.properties.point_count;return r.textContent=s,e}}]),r}(so.EventEmitter);n(23969);var po=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e;return(0,rK.Z)(this,r),e=n.call(this),r.controlCount++,e.controlOption=(0,rW.Z)((0,rW.Z)({},e.getDefault(t)),t||{}),e}return(0,rX.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var e=this.getDefault(t);Object.entries(t).forEach(function(n){var r=(0,i3.Z)(n,2),i=r[0];void 0===r[1]&&(t[i]=e[i])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,rW.Z)((0,rW.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(ci.IMapService),this.renderService=t.get(ci.IRendererService),this.layerService=t.get(ci.ILayerService),this.controlService=t.get(ci.IControlService),this.configService=t.get(ci.IGlobalConfigService),this.scene=t.get(ci.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),oV(this.container,"l7-control");var e=this.controlOption,n=e.className,r=e.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;oU(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return oF("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){oH(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){oV(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:la.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var e=this.mapsService.getContainer();null!==e&&e.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:la.TOPLEFT,e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var e=this.container,n=this.controlOption.className;n&&oH(e,n),t&&oV(e,t)}},{key:"setStyle",value:function(t){var e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{var n=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?n.insertBefore(e,n.firstChild):n.appendChild(e)}}},{key:"checkUpdateOption",value:function(t,e){return e.some(function(e){return e in t})}}]),r}(sa());(0,ac.Z)(po,"controlCount",0);var pa=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"isDisable",!1),t}return(0,rX.Z)(r,[{key:"setIsDisable",value:function(t){var e,n;this.isDisable=t,t?null===(e=this.button)||void 0===e||e.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return oF("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,e=t.title,n=t.btnText,r=t.btnIcon;return this.setBtnTitle(e),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var e=t.title,n=t.btnText,i=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(e),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(n),fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var e;null===(e=this.button)||void 0===e||e.setAttribute("title",null!=t?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&oU(this.buttonIcon),t){var e,n,r,i=null===(e=this.button)||void 0===e?void 0:e.firstChild;i?null===(n=this.button)||void 0===n||n.insertBefore(t,i):null===(r=this.button)||void 0===r||r.appendChild(t),this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(this.button){if(oH(this.button,"l7-button-control--row"),oH(this.button,"l7-button-control--column"),t){var e,n=this.buttonText;n||(n=oF("div","l7-button-control__text"),null===(e=this.button)||void 0===e||e.appendChild(n),this.buttonText=n),n.innerText=t,oV(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(oU(this.buttonText),this.buttonText=void 0)}}}]),r}(po),ps=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t,e){var i;return(0,rK.Z)(this,r),i=n.call(this),(0,ac.Z)((0,se.Z)(i),"isShow",!1),(0,ac.Z)((0,se.Z)(i),"timeout",null),(0,ac.Z)((0,se.Z)(i),"show",function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),oH(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&r.conflictPopperList.forEach(function(t){t!==(0,se.Z)(i)&&t.isShow&&t.hide()}),i.emit("show"),window.addEventListener("pointerdown",i.onPopperUnClick)),(0,se.Z)(i)}),(0,ac.Z)((0,se.Z)(i),"hide",function(){return i.isShow&&(oV(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),window.removeEventListener("pointerdown",i.onPopperUnClick)),(0,se.Z)(i)}),(0,ac.Z)((0,se.Z)(i),"setHideTimeout",function(){i.timeout||(i.timeout=window.setTimeout(function(){i.isShow&&(i.hide(),i.timeout=null)},300))}),(0,ac.Z)((0,se.Z)(i),"clearHideTimeout",function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)}),(0,ac.Z)((0,se.Z)(i),"onBtnClick",function(){i.isShow?i.hide():i.show()}),(0,ac.Z)((0,se.Z)(i),"onPopperUnClick",function(t){ae(t.target,[".l7-button-control",".l7-popper-content"])||i.hide()}),(0,ac.Z)((0,se.Z)(i),"onBtnMouseLeave",function(){i.setHideTimeout()}),(0,ac.Z)((0,se.Z)(i),"onBtnMouseMove",function(){i.clearHideTimeout(),i.isShow||i.show()}),i.button=t,i.option=e,i.init(),e.unique&&r.conflictPopperList.push((0,se.Z)(i)),i}return(0,rX.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){"string"==typeof t?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(o8(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),"click"===t?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),oU(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},e=this.option,n=e.container,r=e.offset,i=e.placement,o=(0,i3.Z)(void 0===r?[0,0]:r,2),a=o[0],s=o[1],u=this.button.getBoundingClientRect(),c=o7(u,n.getBoundingClientRect()),l=c.left,f=c.right,h=c.top,p=c.bottom,d=!1,v=!1;/^(left|right)/.test(i)?(i.includes("left")?t.right="".concat(u.width+f,"px"):i.includes("right")&&(t.left="".concat(u.width+l,"px")),i.includes("start")?t.top="".concat(h,"px"):i.includes("end")?t.bottom="".concat(p,"px"):(t.top="".concat(h+u.height/2,"px"),v=!0,t.transform="translate(".concat(a,"px, calc(").concat(s,"px - 50%))"))):/^(top|bottom)/.test(i)&&(i.includes("top")?t.bottom="".concat(u.height+p,"px"):i.includes("bottom")&&(t.top="".concat(u.height+h,"px")),i.includes("start")?t.left="".concat(l,"px"):i.includes("end")?t.right="".concat(f,"px"):(t.left="".concat(l+u.width/2,"px"),d=!0,t.transform="translate(calc(".concat(a,"px - 50%), ").concat(s,"px)"))),t.transform="translate(calc(".concat(a,"px - ").concat(d?"50%":"0%","), calc(").concat(s,"px - ").concat(v?"50%":"0%",")");var m=i.split("-");m.length&&oV(this.popperDOM,m.map(function(t){return"l7-popper-".concat(t)}).join(" ")),o2(this.popperDOM,o4(t))}},{key:"createPopper",value:function(){var t=this.option,e=t.container,n=t.className,r=t.content,i=oF("div","l7-popper l7-popper-hide ".concat(void 0===n?"":n)),o=oF("div","l7-popper-content"),a=oF("div","l7-popper-arrow");return i.appendChild(o),i.appendChild(a),e.appendChild(i),this.popperDOM=i,this.contentDOM=o,r&&this.setContent(r),i}}]),r}(so.EventEmitter);(0,ac.Z)(ps,"conflictPopperList",[]);var pu={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},pc=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),fX((0,rJ.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var e,n=fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t),i=null!==(e=null==t?void 0:t.position)&&void 0!==e?e:n.position;return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:i instanceof Element?"bottom":pu[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=fX((0,rJ.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,e=this.controlOption,n=e.popperClassName,r=e.popperPlacement,i=e.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new ps(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if(fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var e=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(e)}}}]),r}(pa),pl=((W=pl||{}).ActiveOptionClassName="l7-select-control-item-active",W.OptionValueAttrKey="data-option-value",W.OptionIndexAttrKey="data-option-index",W),pf=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"selectValue",[]),(0,ac.Z)((0,se.Z)(t),"createNormalOption",function(e){var n=t.selectValue.includes(e.value),r=oF("div","l7-select-control-item ".concat(n?pl.ActiveOptionClassName:""));t.getIsMultiple()?r.appendChild(t.createCheckbox(n)):r.appendChild(t.createRadio(n)),e.icon&&r.appendChild(e.icon);var i=oF("span");return i.innerText=e.text,r.appendChild(i),r}),(0,ac.Z)((0,se.Z)(t),"onItemClick",function(e){if(t.getIsMultiple()){var n=t.selectValue.findIndex(function(t){return t===e.value});n>-1?t.selectValue.splice(n,1):t.selectValue=[].concat((0,i2.Z)(t.selectValue),[e.value])}else t.selectValue=[e.value];t.setSelectValue(t.selectValue)}),t}return(0,rX.Z)(r,[{key:"setOptions",value:function(t){fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t);var e=t.options;e&&this.popper.setContent(this.getPopperContent(e))}},{key:"onAdd",value:function(){var t=fX((0,rJ.Z)(r.prototype),"onAdd",this).call(this),e=this.controlOption.defaultValue;return e&&(this.selectValue=this.transSelectValue(e)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=this.transSelectValue(t);this.optionDOMList.forEach(function(t){var e=t.getAttribute(pl.OptionValueAttrKey),r=t.querySelector("input[type=checkbox]"),i=t.querySelector("input[type=radio]"),o=n.includes(e),a=function(e,n){oY(t,pl.ActiveOptionClassName,n),e&&o6(e,n)};a(r,o),a(i,o)}),this.selectValue=n,e&&this.emit("selectChange",this.getIsMultiple()?n:n[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var e=this,n=this.isImageOptions(),r=oF("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&oV(r,"l7-select-control--multiple");var i=t.map(function(t,r){var i=n?e.createImageOption(t):e.createNormalOption(t);return i.setAttribute(pl.OptionValueAttrKey,t.value),i.setAttribute(pl.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",e.onItemClick.bind(e,t)),i});return r.append.apply(r,(0,i2.Z)(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(t){var e=this.selectValue.includes(t.value),n=oF("div","l7-select-control-item ".concat(e?pl.ActiveOptionClassName:"")),r=oF("img");r.setAttribute("src",t.img),o9(r),n.appendChild(r);var i=oF("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(e));var o=oF("span");return o.innerText=t.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(t){var e=oF("input");return e.setAttribute("type","checkbox"),t&&o6(e,!0),e}},{key:"createRadio",value:function(t){var e=oF("input");return e.setAttribute("type","radio"),t&&o6(e,!0),e}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(pc),ph=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("l7-iconfont"),e.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),e.appendChild(n),e},pp=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"onClick",st(sr().mark(function e(){var n;return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.controlOption.onExport,e.t0=null==n,e.t0){e.next=8;break}return e.t1=n,e.next=6,t.getImage();case 6:e.t2=e.sent,(0,e.t1)(e.t2);case 8:case"end":return e.stop()}},e)}))),(0,ac.Z)((0,se.Z)(t),"mergeImage",st(sr().mark(function e(){var n,r,i,o,a,s,u,c,l,f,h,p,d,v=arguments;return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.controlOption.imageType,s=void 0===(a=(o=null!==(n=null===(r=t.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{}).width)?0:a,c=void 0===(u=o.height)?0:u,(l=document.createElement("canvas")).width=s,l.height=c,f=l.getContext("2d"),p=Array(h=v.length),d=0;d<h;d++)p[d]=v[d];return e.next=9,Promise.all(p.map(function(t){return new Promise(function(e){var n=new Image;n.onload=function(){e(n)},n.src=t})}));case 9:return e.sent.forEach(function(t){null==f||f.drawImage(t,0,0,s,c)}),e.abrupt("return",l.toDataURL("image/".concat(i)));case 12:case"end":return e.stop()}},e)}))),t}return(0,rX.Z)(i,[{key:"onAdd",value:function(){var t=fX((0,rJ.Z)(i.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(i.prototype),"getDefault",this).call(this,t)),{},{title:"导出图片",btnIcon:ph("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:(n=st(sr().mark(function t(){var e,n;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.mapsService.exportMap("png");case 2:return e=t.sent,t.next=5,this.scene.exportPng("png");case 5:return n=t.sent,t.abrupt("return",this.mergeImage.apply(this,(0,i2.Z)([e,n].filter(function(t){return t}))));case 7:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})}]),i}(pa);function pd(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var pv=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],pm=function(){if("undefined"==typeof document)return!1;for(var t=pv[0],e={},n=0;n<pv.length;n++){var r=pv[n];if((null==r?void 0:r[1])in document){var i,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return pd(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pd(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r.entries());try{for(o.s();!(i=o.n()).done;){var a=(0,i3.Z)(i.value,2),s=a[0],u=a[1];e[t[s]]=u}}catch(t){o.e(t)}finally{o.f()}return e}}return!1}(),pg={change:pm.fullscreenchange,error:pm.fullscreenerror},py={request:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,e=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,r){var i=function t(){py.off("change",t),n()};py.on("change",i);var o=t[pm.requestFullscreen](e);o instanceof Promise&&o.then(i).catch(r)})},exit:function(){return new Promise(function(t,e){if(!py.isFullscreen){t();return}var n=function e(){py.off("change",e),t()};py.on("change",n);var r=document[pm.exitFullscreen]();r instanceof Promise&&r.then(n).catch(e)})},toggle:function(t,e){return py.isFullscreen?py.exit():py.request(t,e)},onchange:function(t){py.on("change",t)},onerror:function(t){py.on("error",t)},on:function(t,e){var n=pg[t];n&&document.addEventListener(n,e,!1)},off:function(t,e){var n=pg[t];n&&document.removeEventListener(n,e,!1)},raw:pm};Object.defineProperties(py,{isFullscreen:{get:function(){return!!document[pm.fullscreenElement]}},element:{enumerable:!0,get:function(){var t;return null!==(t=document[pm.fullscreenElement])&&void 0!==t?t:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[pm.fullscreenEnabled]}}}),pm||(py={isEnabled:!1});var pb=py,px=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e;return(0,rK.Z)(this,r),e=n.call(this,t),(0,ac.Z)((0,se.Z)(e),"isFullscreen",!1),(0,ac.Z)((0,se.Z)(e),"toggleFullscreen",st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!pb.isEnabled){t.next=3;break}return t.next=3,pb.toggle(e.mapContainer);case 3:case"end":return t.stop()}},t)}))),(0,ac.Z)((0,se.Z)(e),"onClick",function(){e.toggleFullscreen()}),(0,ac.Z)((0,se.Z)(e),"onFullscreenChange",function(){e.isFullscreen=!!document.fullscreenElement;var t=e.controlOption,n=t.btnText,r=t.btnIcon,i=t.title,o=t.exitBtnText,a=t.exitBtnIcon,s=t.exitTitle;e.isFullscreen?(e.setBtnTitle(s),e.setBtnText(o),e.setBtnIcon(a)):(e.setBtnTitle(i),e.setBtnText(n),e.setBtnIcon(r)),e.emit("fullscreenChange",e.isFullscreen)}),pb.isEnabled||console.warn("当前浏览器环境不支持对地图全屏化"),e}return(0,rX.Z)(r,[{key:"setOptions",value:function(t){var e=t.exitBtnText,n=t.exitBtnIcon,i=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(n),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(e),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(i)),fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=fX((0,rJ.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=oz(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){fX((0,rJ.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"全屏",btnIcon:ph("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:ph("l7-icon-exit-fullscreen")})}}]),r}(pa),p_=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e;return(0,rK.Z)(this,r),e=n.call(this,t),(0,ac.Z)((0,se.Z)(e),"getGeoLocation",function(){return new Promise(function(t,e){window.navigator.geolocation.getCurrentPosition(function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;isNaN(o)||isNaN(a)?e():t([o,a])},function(t){e(t)})})}),(0,ac.Z)((0,se.Z)(e),"onClick",st(sr().mark(function t(){var n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.navigator.geolocation){t.next=2;break}return t.abrupt("return");case 2:return n=e.controlOption.transform,t.next=5,e.getGeoLocation();case 5:if(r=t.sent,i=e.mapsService.getZoom(),t.t0=e.mapsService,t.t1=i>15?i:15,!n){t.next=15;break}return t.next=12,n(r);case 12:t.t2=t.sent,t.next=16;break;case 15:t.t2=r;case 16:t.t3=t.t2,t.t0.setZoomAndCenter.call(t.t0,t.t1,t.t3);case 18:case"end":return t.stop()}},t)}))),window.navigator.geolocation||console.warn("当前浏览器环境不支持获取地理定位"),e}return(0,rX.Z)(r,[{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"定位",btnIcon:ph("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=fX((0,rJ.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(pa);function pS(t){return Object.keys(null!=t?t:{}).every(function(t){return["layer","name","img"].includes(t)})}var pw=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"onLayerChange",function(){var e;null!==(e=t.controlOption.layers)&&void 0!==e&&e.length||(t.selectValue=t.getLayerVisible(),t.setOptions({options:t.getLayerOptions()}))}),(0,ac.Z)((0,se.Z)(t),"onLayerVisibleChane",function(){t.setSelectValue(t.getLayerVisible())}),(0,ac.Z)((0,se.Z)(t),"onSelectChange",function(){t.layers.forEach(function(e){var n=t.selectValue.includes(e.name),r=e.isVisible();n&&!r&&e.show(),!n&&r&&e.hide()})}),t}return(0,rX.Z)(r,[{key:"layers",get:function(){var t=this.layerService,e=this.controlOption.layers;if(Array.isArray(e)&&e.length){var n=[];return e.forEach(function(e){if(e instanceof Object&&(pS(e)?n.push(e.layer):n.push(e)),"string"==typeof e){var r=t.getLayer(e)||t.getLayerByName(e);r&&n.push(r)}}),n}return t.getLayers()||[]}},{key:"getDefault",value:function(t){var e;return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"图层控制",btnIcon:ph("l7-icon-layer"),options:[],multiple:null===(e=null==t?void 0:t.multiple)||void 0===e||e})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){var t=this,e=this.controlOption.layers,n=null==e?void 0:e.every(function(t){return t.img});return e?null==e?void 0:e.map(function(e){if(pS(e))return{text:e.name||e.layer.name,value:e.layer.name,img:n?e.img:void 0};if("string"==typeof e){var r=t.layerService.getLayer(e)||t.layerService.getLayerByName(e);return{text:null==r?void 0:r.name,value:null==r?void 0:r.name}}return{text:e.name,value:e.name}}):this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var e=this.checkUpdateOption(t,["layers","multiple"]);fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t),e&&(!1===this.controlOption.multiple&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"handleSingleSelection",value:function(){this.layers.forEach(function(t,e){0===e?t.show():t.hide()})}},{key:"onAdd",value:function(){var t;return!1===this.controlOption.multiple&&this.handleSingleSelection(),null!==(t=this.controlOption.options)&&void 0!==t&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),fX((0,rJ.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),r}(pf),pk=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getDefault",value:function(){return{position:la.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=oF("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(o8(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var e=this.controlOption,n=e.href,r=e.img,i=oF("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),o9(i),n){var o=oF("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),t.appendChild(o)}else t.appendChild(i)}}]),r}(po),pC={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"月光银",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"幻影黑",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"草色青",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"雅士灰",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"涂鸦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"马卡龙",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"极夜蓝",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"酱籽",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},pE={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"亮",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"暗",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"卫星",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"户外",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}},pA=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"onMapThemeChange",function(){t.mapsService.setMapStyle(t.selectValue[0])}),t}return(0,rX.Z)(r,[{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"地图样式",btnIcon:ph("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t="mapbox"===this.mapsService.getType()?pE:pC;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(t){var e=(0,i3.Z)(t,2),n=e[0];return"string"==typeof e[1]&&"blank"!==n}).map(function(e){var n,r=(0,i3.Z)(e,2),i=r[0],o=r[1],a=null!==(n=t[i])&&void 0!==n?n:{},s=a.text;return{text:null!=s?s:i,value:o,img:a.img,key:i}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,e=this;if(null!==(t=this.controlOption.options)&&void 0!==t&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var n,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(n=null===(i=this.controlOption.options.find(function(t){return t.key===o}))||void 0===i?void 0:i.value)&&void 0!==n?n:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",function(){var t=e.mapsService.getMapStyle();e.controlOption.defaultValue=t,e.setSelectValue(t,!1)})}return this.on("selectChange",this.onMapThemeChange),fX((0,rJ.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(pf),pM=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"location",[0,0]),(0,ac.Z)((0,se.Z)(t),"onMouseMove",function(e){var n=t.location,r=e.lngLat||e.lnglat,i=t.controlOption.transform;r&&(n=[r.lng,r.lat]),t.location=n,i&&(n=i(n)),t.insertLocation2HTML(n),t.emit("locationChange",n)}),t}return(0,rX.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:la.BOTTOMLEFT,transform:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=oF("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(po),pT=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"update",function(){var e=t.mapsService,n=t.controlOption.maxWidth,r=e.getSize()[1]/2,i=e.containerToLngLat([0,r]),o=e.containerToLngLat([n,r]),a=aM([i.lng,i.lat],[o.lng,o.lat]);t.updateScales(a)}),t}return(0,rX.Z)(r,[{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:la.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t=oF("div","l7-control-scale");this.resetScaleLines(t);var e=this.controlOption.updateWhenIdle;return this.mapsService.on(e?"moveend":"mapmove",this.update),this.mapsService.on(e?"zoomend":"zoomchange",this.update),t}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var e=this.controlOption,n=e.metric,r=e.imperial;n&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){o8(t);var e=this.controlOption,n=e.metric,r=e.imperial,i=e.maxWidth;e.lockWidth&&o2(t,"width: ".concat(i,"px")),n&&(this.mScale=oF("div","l7-control-scale-line",t)),r&&(this.iScale=oF("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,e,n){var r=this.controlOption.maxWidth;t.style.width=Math.round(r*n)+"px",t.innerHTML=e}},{key:"getRoundNum",value:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(t){var e=this.getRoundNum(t);this.updateScale(this.mScale,e<1e3?e+" m":e/1e3+" km",e/t)}},{key:"updateImperial",value:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this.getRoundNum(e),this.updateScale(this.iScale,n+" mi",n/e)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),r}(po),pL=(eJ={},(0,ac.Z)(eJ,lh.additive,{enable:!0,func:{srcRGB:lq.ONE,dstRGB:lq.ONE,srcAlpha:1,dstAlpha:1}}),(0,ac.Z)(eJ,lh.none,{enable:!1}),(0,ac.Z)(eJ,lh.normal,{enable:!0,func:{srcRGB:lq.SRC_ALPHA,dstRGB:lq.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,ac.Z)(eJ,lh.subtractive,{enable:!0,func:{srcRGB:lq.ONE,dstRGB:lq.ONE,srcAlpha:lq.ZERO,dstAlpha:lq.ONE_MINUS_SRC_COLOR},equation:{rgb:lq.FUNC_SUBTRACT,alpha:lq.FUNC_SUBTRACT}}),(0,ac.Z)(eJ,lh.max,{enable:!0,func:{srcRGB:lq.ONE,dstRGB:lq.ONE},equation:{rgb:lq.MAX_EXT}}),(0,ac.Z)(eJ,lh.min,{enable:!0,func:{srcRGB:lq.ONE,dstRGB:lq.ONE},equation:{rgb:lq.MIN_EXT}}),eJ);function pZ(t){return t.map(function(t){return"string"==typeof t&&(t=[t,{}]),t})}function pP(t,e,n,r){var i=t.multiPassRenderer;return t.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),pZ(e).forEach(function(t){var e=(0,i3.Z)(t,2),r=e[0],o=e[1];i.add(n(r),o)}),i.add(n("copy")),i}var pO=function(){var t;function e(t){(0,rK.Z)(this,e),this.layer=t}return(0,rX.Z)(e,[{key:"pickRender",value:function(t){var e=this.layer.getContainer().get(ci.ILayerService),n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(t);n.hooks.beforePickingEncode.call(),e.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:(t=st(sr().mark(function t(e,n){var r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.layer.getContainer().get(ci.IPickingService),"RasterLayer"!==e.type){t.next=4;break}return t.abrupt("return",this.pickRasterLayer(e,n));case 4:return this.pickRender(n),t.abrupt("return",r.pickFromPickingFBO(e,n));case 6:case"end":return t.stop()}},t,this)})),function(e,n){return t.apply(this,arguments)})},{key:"pickRasterLayer",value:function(t,e,n){var r=this.layer.getContainer(),i=r.get(ci.IPickingService),o=r.get(ci.IMapService),a=this.layer.getSource().extent,s=am(e.lngLat,a),u={x:e.x,y:e.y,type:e.type,lngLat:e.lngLat,target:e,rasterValue:null},c=n||t;if(!s)return u.type="mousemove"===e.type?"mouseout":"un"+e.type,i.triggerHoverOnLayer(c,(0,rW.Z)((0,rW.Z)({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(c,u),!1;var l=this.readRasterValue(t,a,o,e.x,e.y);return u.rasterValue=l,i.triggerHoverOnLayer(c,u),!0}},{key:"readRasterValue",value:function(t,e,n,r,i){var o=t.getSource().data.dataArray[0],a=(0,i3.Z)(e,4),s=a[0],u=a[1],c=a[2],l=a[3],f=n.lngLatToContainer([void 0===s?0:s,void 0===u?0:u]),h=n.lngLatToContainer([void 0===c?10:c,void 0===l?-10:l]),p=h.x-f.x,d=f.y-h.y,v=[(r-f.x)/p,(i-h.y)/d],m=o.width||1,g=o.height||1,y=Math.floor(v[0]*m),b=Math.max(0,Math.floor(v[1]*g)-1)*m+y;return o.data[b]}},{key:"selectFeature",value:function(t){var e=this.layer,n=(0,i3.Z)(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(t){var e=(0,i3.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),pR=function(){function t(e){(0,rK.Z)(this,t),this.layer=e;var n=this.layer.getContainer();this.rendererService=n.get(ci.IRendererService)}return(0,rX.Z)(t,[{key:"getColorTexture",value:function(t,e){var n=this.getTextureKey(t,e);return this.key===n||(this.createColorTexture(t,e),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(t,e){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(t,e),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1,unorm:!0});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(t,e,n){this.key=this.getTextureKey(e,n),this.colorTexture=t}},{key:"destroy",value:function(){var t;null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"getColorRampBar",value:function(t,e){switch(t.type){case"cat":return iX(t);case"quantize":return iK(t);case"custom":return i$(t,e);case"linear":return iq(t,e);default:return iY(t)}}},{key:"getTextureKey",value:function(t,e){var n;return"".concat(t.colors.join("_"),"_").concat(null==t||null===(n=t.positions)||void 0===n?void 0:n.join("_"),"_").concat(t.type,"_").concat(null==e?void 0:e.join("_"))}}]),t}(),pI=["passes"],pD=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption","pickingEnabled"];function pN(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var pz=oD.isEqual,pj=oD.isFunction,pB=oD.isNumber,pF=oD.isObject,pU=oD.isPlainObject,pV=oD.isUndefined,pH=0,pG=(e0=hm(ci.IGlobalConfigService),e2=lS((e1=function(t){(0,r$.Z)(l,t);var e,n,r,i,o,a,s,u,c=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(l);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,rK.Z)(this,l),t=c.call(this),(0,ac.Z)((0,se.Z)(t),"id","".concat(pH++)),(0,ac.Z)((0,se.Z)(t),"name","".concat(pH)),(0,ac.Z)((0,se.Z)(t),"visible",!0),(0,ac.Z)((0,se.Z)(t),"zIndex",0),(0,ac.Z)((0,se.Z)(t),"inited",!1),(0,ac.Z)((0,se.Z)(t),"layerModelNeedUpdate",!1),(0,ac.Z)((0,se.Z)(t),"pickedFeatureID",null),(0,ac.Z)((0,se.Z)(t),"selectedFeatureID",null),(0,ac.Z)((0,se.Z)(t),"styleNeedUpdate",!1),(0,ac.Z)((0,se.Z)(t),"forceRender",!1),(0,ac.Z)((0,se.Z)(t),"clusterZoom",0),(0,ac.Z)((0,se.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,ac.Z)((0,se.Z)(t),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,ac.Z)((0,se.Z)(t),"hooks",{init:new fL,afterInit:new fM,beforeRender:new fM,beforeRenderData:new fZ,afterRender:new fS,beforePickingEncode:new fS,afterPickingEncode:new fS,beforeHighlight:new fS(["pickedColor"]),afterHighlight:new fS,beforeSelect:new fS(["pickedColor"]),afterSelect:new fS,beforeDestroy:new fS,afterDestroy:new fS}),(0,ac.Z)((0,se.Z)(t),"models",[]),(0,ac.Z)((0,se.Z)(t),"startInit",!1),(0,ac.Z)((0,se.Z)(t),"layerChildren",[]),(0,ac.Z)((0,se.Z)(t),"masks",[]),l_((0,se.Z)(t),"configService",e2,(0,se.Z)(t)),(0,ac.Z)((0,se.Z)(t),"animateOptions",{enable:!1}),(0,ac.Z)((0,se.Z)(t),"currentPickId",null),(0,ac.Z)((0,se.Z)(t),"encodeStyleAttribute",{}),(0,ac.Z)((0,se.Z)(t),"enableShaderEncodeStyles",[]),(0,ac.Z)((0,se.Z)(t),"enableDataEncodeStyles",[]),(0,ac.Z)((0,se.Z)(t),"pendingStyleAttributes",[]),(0,ac.Z)((0,se.Z)(t),"scaleOptions",{}),(0,ac.Z)((0,se.Z)(t),"animateStatus",!1),(0,ac.Z)((0,se.Z)(t),"isDestroyed",!1),(0,ac.Z)((0,se.Z)(t),"uniformBuffers",[]),(0,ac.Z)((0,se.Z)(t),"encodeDataLength",0),(0,ac.Z)((0,se.Z)(t),"sourceEvent",function(){t.dataState.dataSourceNeedUpdate=!0;var e=t.getLayerConfig();e&&e.autoFit&&t.fitBounds(e.fitBoundsOptions),t.layerSource.getSourceCfg().autoRender&&setTimeout(function(){t.reRender()},10)}),t.name=e.name||t.id,t.zIndex=e.zIndex||0,t.rawConfig=e,t}return(0,rX.Z)(l,[{key:"addMask",value:function(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var e=this;if(Object.keys(t).map(function(n){n in e.rawConfig&&(e.rawConfig[n]=t[n])}),this.startInit){var n=this.container.get(ci.SceneID);this.configService.setLayerConfig(n,this.id,(0,rW.Z)((0,rW.Z)((0,rW.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=(0,rW.Z)((0,rW.Z)({},this.needUpdateConfig),t)}},{key:"setContainer",value:function(t,e){this.container=t,this.sceneContainer=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.container.get(ci.SceneID),this.startInit=!0,this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(ci.IIconService),this.fontService=this.container.get(ci.IFontService),this.rendererService=this.container.get(ci.IRendererService),this.layerService=this.container.get(ci.ILayerService),this.debugService=this.container.get(ci.IDebugService),this.interactionService=this.container.get(ci.IInteractionService),this.pickingService=this.container.get(ci.IPickingService),this.mapService=this.container.get(ci.IMapService),r=(n=this.getLayerConfig()).enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(ci.ICameraService),this.coordinateService=this.container.get(ci.ICoordinateSystemService),this.shaderModuleService=this.container.get(ci.IShaderModuleService),this.postProcessingPassFactory=this.container.get(ci.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(ci.IFactoryNormalPass),this.styleAttributeService=this.container.get(ci.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(ci.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(t){var e=t.attributeName,n=t.attributeField,r=t.attributeValues,i=t.updateOptions;s.styleAttributeService.updateStyleAttribute(e,{scale:(0,rW.Z)({field:n},s.splitValuesAndCallbackInAttribute(r,n?void 0:s.getLayerConfig()[e]))},i)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(ci.ILayerPlugin),o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return pN(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pN(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(t){o.e(t)}finally{o.f()}return this.layerPickService=new pO(this),this.textureService=new pR(this),this.log(hA.LayerInitStart),t.next=31,this.hooks.init.promise();case 31:this.log(hA.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"log",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(t),i={id:this.id,type:this.type};null===(e=this.debugService)||void 0===e||e.log(r,i)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(e){e.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var t=this.getLayerConfig().animateOption;null!=t&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,e,n){return this.updateStyleAttribute("color",t,e,n),this}},{key:"texture",value:function(t,e,n){return this.updateStyleAttribute("texture",t,e,n),this}},{key:"rotate",value:function(t,e,n){return this.updateStyleAttribute("rotate",t,e,n),this}},{key:"size",value:function(t,e,n){return this.updateStyleAttribute("size",t,e,n),this}},{key:"filter",value:function(t,e,n){var r=this.updateStyleAttribute("filter",t,e,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(t,e,n){this.shapeOption={field:t,values:e};var r=this.updateStyleAttribute("shape",t,e,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(t,e,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:n}),this}},{key:"animate",value:function(t){var e={};return pF(t)?(e.enable=!0,e=(0,rW.Z)((0,rW.Z)({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}},{key:"source",value:function(t,e){return(null==t?void 0:t.type)==="source"?this.setSource(t):(this.sourceOption={data:t,options:e},this.clusterZoom=0),this}},{key:"setData",value:function(t,e){var n=this;return this.inited?(this.log(hA.SourceInitStart,lv.UPDATE),this.layerSource.setData(t,e),this.log(hA.SourceInitEnd,lv.UPDATE)):this.on("inited",function(){n.log(hA.SourceInitStart,lv.UPDATE),n.getSource()?n.layerSource.setData(t,e):n.source(new pe(t,e)),n.layerSource.once("update",function(){n.log(hA.SourceInitEnd,lv.UPDATE)})}),this}},{key:"style",value:function(t){var e=this,n=t.passes,r=(0,lY.Z)(t,pI);return n&&pZ(n).forEach(function(t){var n=e.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);n&&n.updateOptions(t[1])}),r.borderColor&&(r.stroke=r.borderColor),r.borderWidth&&(r.strokeWidth=r.borderWidth),Object.keys(r).forEach(function(t){var e=r[t];!Array.isArray(e)||2!==e.length||pB(e[0])||pB(e[1])||(r[t]={field:e[0],value:e[1]})}),this.encodeStyle(r),this.updateLayerConfig(r),this}},{key:"encodeStyle",value:function(t){var e=this;Object.keys(t).forEach(function(n){[].concat((0,i2.Z)(e.enableShaderEncodeStyles),(0,i2.Z)(e.enableDataEncodeStyles)).includes(n)&&pU(t[n])&&(t[n].field||t[n].value)&&!pz(e.encodeStyleAttribute[n],t[n])?(e.encodeStyleAttribute[n]=t[n],e.updateStyleAttribute(n,t[n].field,t[n].value),e.inited&&(e.dataState.dataMappingNeedUpdate=!0)):e.encodeStyleAttribute[n]&&(delete e.encodeStyleAttribute[n],e.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(t,e){var n=(0,rW.Z)({},this.scaleOptions);if(pF(t)?this.scaleOptions=(0,rW.Z)((0,rW.Z)({},this.scaleOptions),t):this.scaleOptions[t]=e,this.styleAttributeService&&!pz(n,this.scaleOptions)){var r=pF(t)?t:(0,ac.Z)({},t,e);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?this.tileLayer.render():(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(t)),this}},{key:"renderMultiPass",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){t.next=2;break}return t.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){t.next=7;break}return t.next=5,this.multiPassRenderer.render();case 5:t.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"active",value:function(t){var e={};return e.enableHighlight=!!pF(t)||t,pF(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}},{key:"setActive",value:function(t,e){var n=this;if(pF(t)){var r=t.x,i=t.y;this.updateLayerConfig({highlightColor:pF(e)?e.color:this.getLayerConfig().highlightColor,activeMix:pF(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:void 0===r?0:r,y:void 0===i?0:i})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:pF(e)?e.color:this.getLayerConfig().highlightColor,activeMix:pF(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(iW(t)).then(function(){setTimeout(function(){n.reRender()},1)})}},{key:"select",value:function(t){var e={};return e.enableSelect=!!pF(t)||t,pF(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}},{key:"setSelect",value:function(t,e){var n=this;if(pF(t)){var r=t.x,i=t.y;this.updateLayerConfig({selectColor:pF(e)?e.color:this.getLayerConfig().selectColor,selectMix:pF(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:void 0===r?0:r,y:void 0===i?0:i})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:pF(e)?e.color:this.getLayerConfig().selectColor,selectMix:pF(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(iW(t)).then(function(){setTimeout(function(){n.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),e=this.getLayerConfig(),n=e.visible,r=e.minZoom,i=e.maxZoom;return!!n&&t>=(void 0===r?-1/0:r)&&t<(void 0===i?1/0:i)}},{key:"setMultiPass",value:function(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){var n=this.getLayerConfig().passes;this.multiPassRenderer=pP(this,void 0===n?[]:n,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var r=this.rendererService.getViewportSize(),i=r.width,o=r.height;this.multiPassRenderer.resize(i,o)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(t){return this.getLayerConfig()[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var e=this.getSource().extent;return e.some(function(t){return Math.abs(t)===1/0})||this.mapService.fitBounds([[e[0],e[1]],[e[2],e[3]]],t),this}},{key:"destroy",value:function(){var t,e,n,r,i,o=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.isDestroyed||(null===(t=this.layerModel)||void 0===t||t.uniformBuffers.forEach(function(t){t.destroy()}),this.layerChildren.map(function(t){return t.destroy(!1)}),this.layerChildren=[],this.getLayerConfig().maskfence&&(this.masks.map(function(t){return t.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(e=this.multiPassRenderer)||void 0===e||e.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(n=this.layerModel)||void 0===n||n.clearModels(o),null===(r=this.tileLayer)||void 0===r||r.destroy(),this.models=[],null===(i=this.debugService)||void 0===i||i.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(t){return t.destroy()}),null===(t=this.layerModel)||void 0===t||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var e=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(t){var n=t.type;if(void 0===e.coordCenter){var r,i=e.layerSource.center;e.coordCenter=i,null!==(r=e.mapService)&&void 0!==r&&r.setCoordCenter&&e.mapService.setCoordCenter(i)}if("update"===n){if(e.tileLayer){e.tileLayer.reload();return}e.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var e,n,r,i=this.styleAttributeService.getLayerStyleAttribute(t);return{type:null===(n=((null==i||null===(e=i.scale)||void 0===e?void 0:e.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.invertExtent?e.range().map(function(n){return(0,ac.Z)({value:e.invertExtent(n)},t,n)}):e.ticks?e.ticks().map(function(n){return(0,ac.Z)({value:n},t,e(n))}):null!=e&&e.domain?e.domain().filter(function(t){return!pV(t)}).map(function(n){return(0,ac.Z)({value:n},t,e(n))}):[]:[]}},{key:"pick",value:function(t){var e=t.x,n=t.y;this.interactionService.triggerHover({x:e,y:n})}},{key:"boxSelect",value:function(t,e){this.pickingService.boxPickLayer(this,t,e)}},{key:"buildLayerModel",value:(i=st(sr().mark(function t(e){var n,r,i,o,a,s,u,c,l,f,h,p,d,v,m=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.moduleName,r=e.vertexShader,i=e.fragmentShader,o=e.inject,a=e.triangulation,s=e.styleOption,c=void 0===(u=e.pickingEnabled)||u,l=(0,lY.Z)(e,pD),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),h=(f=this.shaderModuleService.getModule(n)).vs,p=f.fs,d=f.uniforms,v=this.rendererService.createModel,t.abrupt("return",new Promise(function(t){var e=m.styleAttributeService.createAttributesAndIndices(m.encodedData,a,s),n=e.attributes,r=e.elements,i=e.count,o=[].concat((0,i2.Z)(m.layerModel.uniformBuffers),(0,i2.Z)(m.rendererService.uniformBuffers),[m.getLayerUniformBuffer()]);c&&o.push(m.getPickingUniformBuffer());var u=(0,rW.Z)({attributes:n,uniforms:d,fs:p,vs:h,elements:r,blend:pL[lh.normal],uniformBuffers:o,textures:m.layerModel.textures},l);i&&(u.count=i),t(v(u))}));case 5:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"createAttributes",value:function(t){var e=t.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,e).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var e=this.getLayerConfig(),n=e.enableHighlight,r=e.enableSelect,i=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return("click"===t||"dblclick"===t)&&(void 0===r||r)&&(i=!0),"mousemove"===t&&(void 0===n||n||-1!==this.eventNames().indexOf("mouseenter")||-1!==this.eventNames().indexOf("unmousemove")||-1!==this.eventNames().indexOf("mouseout"))&&(i=!0),this.isVisible()&&i}},{key:"buildModels",value:(o=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw Error("Method not implemented.");case 1:case"end":return t.stop()}},t)})),function(){return o.apply(this,arguments)})},{key:"rebuildModels",value:(a=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.buildModels();case 2:case"end":return t.stop()}},t,this)})),function(){return a.apply(this,arguments)})},{key:"renderMulPass",value:(s=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:case"end":return t.stop()}},t)})),function(t){return s.apply(this,arguments)})},{key:"renderModels",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?this.clearModels():(this.hooks.beforeRender.call(),this.models.forEach(function(n){n.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(e),textures:t.layerModel.textures},(null==e?void 0:e.ispick)||!1)}),this.hooks.afterRender.call()),this}},{key:"updateStyleAttribute",value:function(t,e,n,r){return!pz((this.configService.getAttributeConfig(this.id)||{})[t],{field:e,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(t)&&this.configService.setAttributeConfig(this.id,(0,ac.Z)({},t,{field:e,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,rW.Z)({field:e},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[e]))},r):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(u=st(sr().mark(function t(){var e,n;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.models.forEach(function(t){return t.destroy()}),this.models=[],this.uniformBuffers.forEach(function(t){t.destroy()}),this.uniformBuffers=[],e=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(e),n=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(n),t.next=10,this.layerModel.initModels();case 10:this.models=t.sent;case 11:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t){return{values:pj(t)?void 0:t,callback:pj(t)?t:void 0}}}]),l}(so.EventEmitter)).prototype,"configService",[e0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e1);function pW(t){return t.maskOperation===ld.OR?{enable:!0,mask:255,func:{cmp:lq.ALWAYS,ref:1,mask:255},opFront:{fail:lq.KEEP,zfail:lq.REPLACE,zpass:lq.REPLACE}}:{enable:!0,mask:255,func:{cmp:t.stencilType===lp.SINGLE?lq.ALWAYS:0===t.stencilIndex?lq.ALWAYS:lq.LESS,ref:t.stencilType===lp.SINGLE?1:0===t.stencilIndex?2:1,mask:255},opFront:{fail:lq.KEEP,zfail:lq.REPLACE,zpass:lq.REPLACE}}}var pY=((Y={})[Y.POSITION=0]="POSITION",Y[Y.COLOR=1]="COLOR",Y[Y.VERTEX_ID=2]="VERTEX_ID",Y[Y.PICKING_COLOR=3]="PICKING_COLOR",Y[Y.STROKE=4]="STROKE",Y[Y.OPACITY=5]="OPACITY",Y[Y.OFFSETS=6]="OFFSETS",Y[Y.ROTATION=7]="ROTATION",Y[Y.EXTRUSION_BASE=8]="EXTRUSION_BASE",Y[Y.SIZE=9]="SIZE",Y[Y.SHAPE=10]="SHAPE",Y[Y.EXTRUDE=11]="EXTRUDE",Y[Y.MAX=12]="MAX",Y[Y.NORMAL=13]="NORMAL",Y[Y.UV=14]="UV",Y[Y.LINEAR=15]="LINEAR",Y),pq={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},pX={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function pK(t){return Math.max(4*Math.ceil(t/4),4)}var p$={opacity:pY.OPACITY,stroke:pY.STROKE,offsets:pY.OFFSETS,rotation:pY.ROTATION,extrusionBase:pY.EXTRUSION_BASE,thetaOffset:15},pQ=(e3=hm(ci.IGlobalConfigService),e4=lS((e5=function(){var t,e,n;function r(t){(0,rK.Z)(this,r),(0,ac.Z)(this,"uniformBuffers",[]),(0,ac.Z)(this,"textures",[]),(0,ac.Z)(this,"preStyleAttribute",{}),(0,ac.Z)(this,"encodeStyleAttribute",{}),l_(this,"configService",e4,this),this.layer=t,this.rendererService=t.getContainer().get(ci.IRendererService),this.pickingService=t.getContainer().get(ci.IPickingService),this.shaderModuleService=t.getContainer().get(ci.IShaderModuleService),this.styleAttributeService=t.getContainer().get(ci.IStyleAttributeService),this.mapService=t.getContainer().get(ci.IMapService),this.iconService=t.getContainer().get(ci.IIconService),this.fontService=t.getContainer().get(ci.IFontService),this.cameraService=t.getContainer().get(ci.ICameraService),this.layerService=t.getContainer().get(ci.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var e=this.rendererService.createTexture2D;this.createTexture2D=e}return(0,rX.Z)(r,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend;return pL[lh[void 0===t?"normal":t]]}},{key:"getStencil",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=e.maskInside,i=e.enableMask,o=e.maskOperation,a=void 0===o?ld.AND:o;return"MaskLayer"===this.layer.type?pW({isStencil:!0,stencilType:lp.SINGLE}):t.isStencil?pW((0,rW.Z)((0,rW.Z)({},t),{},{maskOperation:a})):{enable:void 0!==n&&n||i&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,mask:255,func:{cmp:lq.EQUAL,ref:void 0===r||r?1:0,mask:1}}}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var n=(0,rW.Z)((0,rW.Z)({},e.uniformsOption),t.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&1===this.textures.length&&(n.u_texture=this.textures[0]),n}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(t=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!1);case 1:case"end":return t.stop()}},t)})),function(){return t.apply(this,arguments)})},{key:"buildModels",value:(e=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw Error("Method not implemented.");case 1:case"end":return t.stop()}},t)})),function(){return e.apply(this,arguments)})},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw Error("Method not implemented.");case 1:case"end":return t.stop()}},t)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"getAttribute",value:function(){throw Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(t){throw Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,e="",n=[];this.layer.enableShaderEncodeStyles.forEach(function(r){t[r]?e+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n"):n.push("  ".concat(pX[r]," u_").concat(r,";"));var i=p$[r];i||"THETA_OFFSET"!==r||(i=15),e+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n          layout(location = ").concat(p$[r],") in ").concat(pX[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n        #endif\n\n        ")});var r=n.length?"\nlayout(std140) uniform AttributeUniforms {\n".concat(n.join("\n"),"\n};\n    "):"";e+=r;var i="";return this.layer.enableShaderEncodeStyles.forEach(function(t){i+="\n\n    #ifdef USE_ATTRIBUTE_".concat(t.toUpperCase(),"\n      ").concat(pX[t]," ").concat(t,"  = a_").concat(t.charAt(0).toUpperCase()+t.slice(1),";\n    #else\n      ").concat(pX[t]," ").concat(t," = u_").concat(t,";\n    #endif\n\n    ")}),{"vs:#decl":e,"fs:#decl":r,"vs:#main-start":i}}},{key:"getStyleAttribute",value:function(){var t=this,e={};return this.layer.enableShaderEncodeStyles.forEach(function(n){if(!t.layer.encodeStyleAttribute[n]){var r=t.layer.getLayerConfig()[n],i=void 0===r?pq[n]:r;"stroke"===n&&(i=iH(i)),e["u_"+n]=i}}),e}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(e){var n=function(t){switch(t){case"rotation":return{name:"Rotation",type:hL.Attribute,descriptor:{name:"a_Rotation",shaderLocation:pY.ROTATION,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.rotation,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}};case"stroke":return{name:"stroke",type:hL.Attribute,descriptor:{name:"a_Stroke",shaderLocation:pY.STROKE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t){var e=t.stroke;return void 0===e?[1,1,1,1]:e}}};case"opacity":return{name:"opacity",type:hL.Attribute,descriptor:{name:"a_Opacity",shaderLocation:pY.OPACITY,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.opacity;return[void 0===e?1:e]}}};case"extrusionBase":return{name:"extrusionBase",type:hL.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:pY.EXTRUSION_BASE,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.extrusionBase;return[void 0===e?0:e]}}};case"offsets":return{name:"offsets",type:hL.Attribute,descriptor:{name:"a_Offsets",shaderLocation:pY.OFFSETS,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t){return t.offsets}}};case"thetaOffset":return{name:"thetaOffset",type:hL.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.thetaOffset;return[void 0===e?1:e]}}};default:return}}(e);n&&(t.styleAttributeService.registerStyleAttribute(n),n.descriptor&&(n.descriptor.shaderLocation=p$[e]))})}},{key:"updateEncodeAttribute",value:function(t,e){this.encodeStyleAttribute[t]=e}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),e=this.getCommonUniformsInfo();0!==t.uniformsLength&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(pK(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),0!==e.uniformsLength&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(pK(e.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(t){var e=0,n=[];return Object.values(t).forEach(function(t){Array.isArray(t)?(n.push.apply(n,(0,i2.Z)(t)),e+=t.length):"number"==typeof t?(n.push(t),e+=1):"boolean"==typeof t&&(n.push(Number(t)),e+=1)}),{uniformsOption:t,uniformsLength:e,uniformsArray:n}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t,e,n=this.getUniformsBufferInfo(this.getStyleAttribute()).uniformsArray,r=this.getCommonUniformsInfo().uniformsArray;null===(t=this.attributeUnifoms)||void 0===t||t.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),null===(e=this.commonUnifoms)||void 0===e||e.subData({offset:0,data:new Uint8Array(new Float32Array(r).buffer)})}}]),r}()).prototype,"configService",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e5),pJ=((q={})[q.solid=0]="solid",q[q.dash=1]="dash",q),p0=((X={}).VERTICAL="vertical",X.HORIZONTAL="horizontal",X),p1=((K={}).NORMAL="normal",K.REPLACE="replace",K),p2=(($={})[$.pixel=0]="pixel",$[$.meter=1]="meter",$),p3=((Q={}).ALWAYS="always",Q.DRAGEND="dragend",Q),p5={canvas:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"updateMode",p3.ALWAYS),(0,ac.Z)((0,se.Z)(t),"renderUpdate",function(){var e=t.layer.getLayerConfig(),n=e.zIndex,r=void 0===n?10:n,i=e.update,o=void 0===i?p3.ALWAYS:i,a=e.animateOption;+t.canvas.style.zIndex===r&&(t.canvas.style.zIndex=r+""),t.updateMode!==o&&(t.updateMode=o,t.unBindListener(),t.bindListener()),t.updateMode===p3.ALWAYS&&(void 0===a?{enable:!1,duration:20}:a).enable&&t.renderCanvas()}),(0,ac.Z)((0,se.Z)(t),"unBindListener",function(){t.mapService.off("mapchange",t.renderCanvas),t.mapService.off("zoomstart",t.clearCanvas),t.mapService.off("zoomend",t.renderCanvas),t.mapService.off("movestart",t.clearCanvas),t.mapService.off("moveend",t.renderCanvas)}),(0,ac.Z)((0,se.Z)(t),"bindListener",function(){t.updateMode===p3.ALWAYS?t.mapService.on("mapchange",t.renderCanvas):(t.mapService.on("zoomstart",t.clearCanvas),t.mapService.on("zoomend",t.renderCanvas),t.mapService.on("movestart",t.clearCanvas),t.mapService.on("moveend",t.renderCanvas))}),(0,ac.Z)((0,se.Z)(t),"clearCanvas",function(){if(t.ctx){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;t.ctx.clearRect(0,0,n,r)}}),(0,ac.Z)((0,se.Z)(t),"renderCanvas",function(){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;if(t.prevSize[0]!==n||t.prevSize[1]!==r){t.prevSize=[n,r];var i=t.mapService.getSize(),o=(0,i3.Z)(i,2),a=o[0],s=o[1];t.canvas.width=n,t.canvas.height=r,t.canvas.style.width=a+"px",t.canvas.style.height=s+"px"}var u=t.layer.getLayerConfig().drawingOnCanvas;t.ctx&&u({canvas:t.canvas,ctx:t.ctx,mapService:t.mapService,size:[n,r]})}),t}return(0,rX.Z)(o,[{key:"clearModels",value:function(){if(this.canvas){var t;null===(t=this.mapService.getContainer())||void 0===t||t.removeChild(this.canvas),this.canvas=null}this.unBindListener()}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0===(e=this.layer.getLayerConfig().update)?p3.ALWAYS:e,this.updateMode=n,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),t.abrupt("return",[]);case 7:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"initCanvas",value:function(){var t,e=this.layer.getLayerConfig().zIndex,n=this.mapService.getSize(),r=(0,i3.Z)(n,2),i=r[0],o=r[1],a=this.rendererService.getViewportSize(),s=a.width,u=a.height;this.prevSize=[s,u];var c=document.createElement("canvas");this.canvas=c,c.width=s,c.height=u,c.style.pointerEvents="none",c.style.width=i+"px",c.style.height=o+"px",c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.zIndex=e+"",null===(t=this.mapService.getContainer())||void 0===t||t.appendChild(c);var l=c.getContext("2d");this.ctx=l}},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){}}]),o}(pQ)},p4=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","CanvasLayer"),(0,ac.Z)((0,se.Z)(t),"forceRender",!0),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new p5[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var t,e=this;return this!==null&&void 0!==this&&null!==(t=this.layerModel)&&void 0!==t&&t.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(t){t.draw({uniforms:e.layerModel.getUninforms()},!1)}),this}},{key:"getDefaultConfig",value:function(){return({canvas:{}})[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),i}(pG);function p7(){var t=new s2(3);return s2!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function p6(t){var e=new s2(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function p8(t){return Math.hypot(t[0],t[1],t[2])}function p9(t,e,n){var r=new s2(3);return r[0]=t,r[1]=e,r[2]=n,r}function dt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function de(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function dn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function dr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function di(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function da(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function ds(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function du(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function dc(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function dl(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function df(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function dh(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function dp(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function dd(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function dv(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function dm(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function dg(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function dy(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function db(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function dx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function d_(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function dS(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function dw(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+i[0]*l,t[1]=e[1]*s+n[1]*u+r[1]*c+i[1]*l,t[2]=e[2]*s+n[2]*u+r[2]*c+i[2]*l,t}function dk(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,f=3*u*a,h=u*o;return t[0]=e[0]*c+n[0]*l+r[0]*f+i[0]*h,t[1]=e[1]*c+n[1]*l+r[1]*f+i[1]*h,t[2]=e[2]*c+n[2]*l+r[2]*f+i[2]*h,t}function dC(t,e){e=e||1;var n=2*s3()*Math.PI,r=2*s3()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function dE(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function dA(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function dM(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=i*c-o*u,f=o*s-r*c,h=r*u-i*s,p=i*h-o*f,d=o*l-r*h,v=r*f-i*l,m=2*a;return l*=m,f*=m,h*=m,p*=2,d*=2,v*=2,t[0]=s+l+p,t[1]=u+f+d,t[2]=c+h+v,t}function dT(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function dL(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function dZ(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function dP(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s);return Math.acos(Math.min(Math.max(u&&dx(t,e)/u,-1),1))}function dO(t){return t[0]=0,t[1]=0,t[2]=0,t}function dR(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function dI(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function dD(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}var dN=dr,dz=di,dj=da,dB=dd,dF=dv,dU=p8,dV=dm,dH=(J=p7(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)J[0]=t[a],J[1]=t[a+1],J[2]=t[a+2],i(J,J,o),t[a]=J[0],t[a+1]=J[1],t[a+2]=J[2];return t});function dG(t){return t/180*Math.acos(-1)}function dW(t){var e=dG(t[0])+Math.PI/2,n=dG(t[1]),r=100+.4*Math.random(),i=r*Math.cos(n)*Math.cos(e);return[r*Math.cos(n)*Math.sin(e),r*Math.sin(n),i]}function dY(t,e){var n=cy(),r=cy(),i=p9(0,1,0),o=p9(0,0,0);t=void 0!==t?t:1;for(var a=2+(void 0!==(e=e||{}).segments?e.segments:32),s=2*a,u=[],c=[],l=[],f=[],h=[],p=[],d=0;d<=a;d++){for(var v=d/a,m=v*Math.PI,g=0;g<=s;g++){var y=g/s,b=y*Math.PI*2;cw(r),cR(r,r,-m),cw(n),cO(n,n,b),dE(o,i,r),dE(o,o,n),dh(o,o,-t),l.push(o.slice()),f.push.apply(f,(0,i2.Z)(o.slice())),db(o,o),h.push.apply(h,(0,i2.Z)(o.slice())),p.push([y,1-v]),f.push(y,1-v)}if(d>0)for(var x=l.length,_=x-2*(s+1);_+s+2<x;_++)u.push([_,_+1,_+s+1]),c.push(_,_+1,_+s+1),u.push([_+s+1,_+1,_+s+2]),c.push(_+s+1,_+1,_+s+2)}return{cells:u,positions:l,uvs:p,positionsArr:f,indicesArr:c,normalArr:h}}var dq=s5();s5();var dX=s5(),dK=s5(),d$=s5();function dQ(t,e,n,r,i){return s6(t,n,r),s9(t,t),[i/ut(e=s4(-t[1],t[0]),s4(-n[1],n[0])),e]}function dJ(t,e){var n,r;return n=-e[1],r=e[0],t[0]=n,t[1]=r,t}function d0(t,e,n){return s8(t,e,n),s9(t,t),t}function d1(t,e){return t[0]===e[0]&&t[1]===e[1]}var d2=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,rK.Z)(this,t),(0,ac.Z)(this,"lastFlip",-1),(0,ac.Z)(this,"miter",s4(0,0)),(0,ac.Z)(this,"started",!1),(0,ac.Z)(this,"dash",!1),(0,ac.Z)(this,"totalDistance",0),(0,ac.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,rX.Z)(t,[{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.simpleSegment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],f=t[o];f.push(null!==(s=e[o][2])&&void 0!==s?s:0);var h=e[o],p=o<t.length-1?[].concat((0,i2.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.simpleSegment(n,i,c,f,p,l,h,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],f=t[o];f.push(null!==(s=e[o][2])&&void 0!==s?s:0);var h=e[o],p=o<t.length-1?[].concat((0,i2.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.segment_gaode2(n,i,c,f,p,l,h,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.segment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c=ak([r[0],r[1]]),l=ak([n[0],n[1]]);d0(dX,c,l);var f=0;if(this.dash&&(f=this.lineSegmentDistance(c,l),this.totalDistance+=f),this.normal||(this.normal=s5(),dJ(this.normal,dX)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f)),a.push(e+0,e+1,e+2),i){var h=ak([i[0],i[1]]);d1(c,h)&&s6(h,c,s9(h,s8(h,c,l))),d0(dK,h,c);var p=dQ(d$,s5(),dX,dK,this.thickness),d=(0,i3.Z)(p,2),v=d[0],m=d[1],g=0>ut(d$,this.normal)?-1:1;this.extrusions(s,u,r,m,v,this.totalDistance),a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),g=-1,s7(this.normal,m),o+=2,this.lastFlip=g}else dJ(this.normal,dX),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,c=t.indices,l=t.positions,f=t.normals,h="square"===this.cap,p="bevel"===this.join,d=ak([a[0],a[1]]),v=ak([o[0],o[1]]);d0(dX,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=s5(),dJ(this.normal,dX)),!this.started){if(this.started=!0,h){var g=s5(),y=s5();s6(g,this.normal,dX),s6(y,this.normal,dX),f.push(y[0],y[1],0),f.push(g[0],g[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,f,n,this.normal,this.thickness,this.totalDistance-m)}if(c.push(e+0,e+1,e+2),i){d1(r,i)&&s6(i,r,s9(i,s8(i,r,n))),d0(dK,i,r);var b=dQ(d$,s5(),dX,dK,this.thickness),x=(0,i3.Z)(b,2),_=x[0],S=x[1],w=0>ut(d$,this.normal)?-1:1,k=p;!k&&"miter"===this.join&&_>this.miterLimit&&(k=!0),k?(f.push(this.normal[0],this.normal[1],0),f.push(S[0],S[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,i2.Z)(this.lastFlip!==-w?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),dJ(dq,dK),s7(this.normal,dq),f.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,f,r,S,_,this.totalDistance),c.push.apply(c,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),w=-1,s7(this.normal,S),u+=2),this.lastFlip=w}else{if(dJ(this.normal,dX),h){var C=s5(),E=s5();s8(E,dX,this.normal),s6(C,dX,this.normal),f.push(E[0],E[1],0),f.push(C[0],C[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,f,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c="square"===this.cap,l="bevel"===this.join,f=ak([r[0],r[1]]),h=ak([n[0],n[1]]);d0(dX,f,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(f,h),this.totalDistance+=p),this.normal||(this.normal=s5(),dJ(this.normal,dX)),!this.started){if(this.started=!0,c){var d=s5(),v=s5();s6(d,this.normal,dX),s6(v,this.normal,dX),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p)}if(a.push(e+0,e+1,e+2),i){var m=ak([i[0],i[1]]);d1(f,m)&&s6(m,f,s9(m,s8(m,f,h))),d0(dK,m,f);var g=dQ(d$,s5(),dX,dK,this.thickness),y=(0,i3.Z)(g,2),b=y[0],x=y[1],_=0>ut(d$,this.normal)?-1:1,S=l;!S&&"miter"===this.join&&b>this.miterLimit&&(S=!0),S?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*_,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*_,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,i2.Z)(this.lastFlip!==-_?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),dJ(dq,dK),s7(this.normal,dq),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*_,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,b,this.totalDistance),a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),_=-1,s7(this.normal,x),o+=2),this.lastFlip=_}else{if(dJ(this.normal,dX),c){var w=s5(),k=s5();s8(k,dX,this.normal),s6(w,dX,this.normal),u.push(k[0],k[1],0),u.push(w[0],w[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,i2.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function d3(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var i=t[0].length,o=s1().flatten(t),a=o.vertices,s=o.dimensions,u=[],c=[],l=[],f=0;f<a.length/s;f++)u.push(a[f*s],a[f*s+1],1,-1,-1),l.push(0,0,1);var h=s1()(o.vertices,o.holes,o.dimensions);c.push.apply(c,(0,i2.Z)(h));for(var p=0;p<i;p++)!function(){var t=o.vertices.slice(p*s,(p+1)*s),n=o.vertices.slice((p+1)*s,(p+2)*s);0===n.length&&(n=o.vertices.slice(0,s));var r=u.length/5;u.push(t[0],t[1],1,0,0,n[0],n[1],1,.1,0,t[0],t[1],0,0,.8,n[0],n[1],0,.1,.8);var i=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=p7(),o=p7(),a=p7();r&&(t=ab(t),e=ab(e),n=ab(n));var s=p9.apply(rO,(0,i2.Z)(t)),u=p9.apply(rO,(0,i2.Z)(e));dN(i,p9.apply(rO,(0,i2.Z)(n)),u),dN(o,s,u),d_(a,i,o);var c=p7();return db(c,a),c}([n[0],n[1],1],[t[0],t[1],0],[t[0],t[1],1],e);l.push.apply(l,(0,i2.Z)(i).concat((0,i2.Z)(i),(0,i2.Z)(i),(0,i2.Z)(i))),c.push.apply(c,(0,i2.Z)([1,2,0,3,2,1].map(function(t){return t+r})))}();return{positions:u,index:c,normals:l}}var d5=((tt={}).CYLINDER="cylinder",tt.SQUARECOLUMN="squareColumn",tt.TRIANGLECOLUMN="triangleColumn",tt.HEXAGONCOLUMN="hexagonColumn",tt.PENTAGONCOLUMN="pentagonColumn",tt),d4=((te={}).CIRCLE="circle",te.SQUARE="square",te.TRIANGLE="triangle",te.HEXAGON="hexagon",te.PENTAGON="pentagon",te);function d7(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/t,r=[],i=0;i<t;i++)r.push(n*i+e*Math.PI/12);return r.map(function(t){return[Math.sin(t+Math.PI/4),Math.cos(t+Math.PI/4),0]})}function d6(){return d7(30)}function d8(){return d7(4)}function d9(){return d7(3)}function vt(){return d7(6,1)}function ve(){return d7(5)}var vn=(e7={},(0,ac.Z)(e7,d4.CIRCLE,d6),(0,ac.Z)(e7,d4.HEXAGON,vt),(0,ac.Z)(e7,d4.TRIANGLE,d9),(0,ac.Z)(e7,d4.SQUARE,d8),(0,ac.Z)(e7,d4.PENTAGON,ve),(0,ac.Z)(e7,d5.CYLINDER,d6),(0,ac.Z)(e7,d5.HEXAGONCOLUMN,vt),(0,ac.Z)(e7,d5.TRIANGLECOLUMN,d9),(0,ac.Z)(e7,d5.SQUARECOLUMN,d8),(0,ac.Z)(e7,d5.PENTAGONCOLUMN,ve),e7),vr={};function vi(t){var e=aj(t.coordinates);return{vertices:[].concat((0,i2.Z)(e),(0,i2.Z)(e),(0,i2.Z)(e),(0,i2.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function vo(t){var e=dW(aj(t.coordinates));return{vertices:[].concat((0,i2.Z)(e),(0,i2.Z)(e),(0,i2.Z)(e),(0,i2.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function va(t){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(vr&&vr[t])return vr[t];var n=d3([vn[t]?vn[t]():vn.cylinder()],e);return vr[t]=n,n}(t.shape,!1);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function vs(t){var e=aj(t.coordinates);return{vertices:(0,i2.Z)(e),indices:[0],size:e.length}}function vu(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new d2({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=e;l[0]&&!Array.isArray(l[0][0])&&(l=[e]),l.forEach(function(t){i.extrude(t)})}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function vc(t){var e=t.coordinates,n=t.originCoordinates,r=[];if(!Array.isArray(e[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=function(t,e){var n=t,r=e||t;Array.isArray(n)&&Array.isArray(n[0])&&Array.isArray(n[0][0])&&(n=e.flat(),r=e.flat());var i=0;if(n.length<2)return{results:n,totalDistance:0};var o=[],a=vf(n[0],i);o.push(a);for(var s=1;s<n.length-1;s++){i+=vl(ak(r[s-1]),ak(r[s]));var u=vf(n[s],i);o.push(u),o.push(u)}return i+=vl(ak(r[r.length-2]),ak(r[r.length-1])),o.push(vf(n[n.length-1],i)),{results:o,totalDistance:i}}(e,n),o=i.results,a=i.totalDistance;return o.map(function(t){r.push(t[0],t[1],t[2],t[3],0,a)}),{vertices:r,indices:[],normals:[],size:6,count:o.length}}function vl(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function vf(t,e){return t.length<3&&t.push(0),void 0!==e&&t.push(e),t}function vh(t){var e=t.coordinates,n=s1().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:s1()(r,o,i),vertices:r,size:i}}function vp(t){var e=t.coordinates,n=s1().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:s1()(r,o,i),vertices:function(t){for(var e=[],n=aB(t),r=n.center,i=n.radius,o=0;o<t.length;o+=2){var a=t[o],s=t[o+1];e.push.apply(e,[a,s,0].concat((0,i2.Z)(r),[i]))}return e}(r),size:i+4}}function vd(t){var e=d3(t.coordinates,!0);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function vv(t){var e,n,r,i,o,a=(o=vn[e=t.shape]?vn[e]():vn.circle(),-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[o],r=s1().flatten(n),i=s1()(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(t){var e=t[0][0],n=t[0][t[0].length-1];e[0]===n[0]&&e[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,i=s1().flatten(t),o=i.vertices,a=i.dimensions,s=[],u=[],c=0;c<o.length/a;c++)2===a?s.push(o[2*c],o[2*c+1],1):s.push(o[3*c],o[3*c+1],1);var l=s1()(i.vertices,i.holes,i.dimensions);u.push.apply(u,(0,i2.Z)(l));for(var f=0;f<r;f++)!function(){var t=i.vertices.slice(f*a,(f+1)*a),e=i.vertices.slice((f+1)*a,(f+2)*a);0===e.length&&(e=i.vertices.slice(0,a));var n=s.length/3;s.push(t[0],t[1],1,e[0],e[1],1,t[0],t[1],0,e[0],e[1],0),u.push.apply(u,(0,i2.Z)([0,2,1,2,3,1].map(function(t){return t+n})))}();return{positions:s,index:u}}([o]));return{vertices:a.positions,indices:a.index,size:3}}function vm(t){var e=t.coordinates;return{vertices:[].concat((0,i2.Z)(e[0]),[0,0,1,e[1][0],e[0][1],0,1,1],(0,i2.Z)(e[1]),[0,1,0],(0,i2.Z)(e[0]),[0,0,1],(0,i2.Z)(e[1]),[0,1,0,e[0][0],e[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function vg(t,e){for(var n=e.segmentNumber,r=void 0===n?30:n,i=t.coordinates,o=[],a=[],s=function(t){o.push(t,1,t,i[0][0],i[0][1],i[1][0],i[1][1],t,-1,t,i[0][0],i[0][1],i[1][0],i[1][1]),t!==r-1&&a.push.apply(a,(0,i2.Z)([0,1,2,1,3,2].map(function(e){return 2*t+e})))},u=0;u<r;u++)s(u);return{vertices:o,indices:a,size:7}}function vy(t){var e=t.coordinates;2===e.length&&e.push(0);var n=vb(-1,1),r=vb(1,1),i=vb(-1,-1),o=vb(1,-1);return{vertices:[].concat((0,i2.Z)(e),(0,i2.Z)(n),(0,i2.Z)(e),(0,i2.Z)(i),(0,i2.Z)(e),(0,i2.Z)(o),(0,i2.Z)(e),(0,i2.Z)(r)),indices:[0,1,2,3,0,2],size:5}}function vb(t,e){return[(t+1)/2,(e+1)/2]}function vx(){var t=dY(100,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}function v_(){var t=dY(140,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}var vS=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.baseColor,r=t.brightColor,i=t.windowColor,o=t.time,a=t.sweep,s=void 0===a?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:a,u={u_baseColor:iH(void 0===n?"rgb(16,16,16)":n),u_brightColor:iH(void 0===r?"rgb(255,176,38)":r),u_windowColor:iH(void 0===i?"rgb(30,60,89)":i),u_circleSweepColor:[].concat((0,i2.Z)(iH(s.sweepColor).slice(0,3)),[1]),u_cityCenter:s.sweepCenter||this.cityCenter,u_circleSweep:s.enable?1:0,u_cityMinSize:this.cityMinSize*s.sweepRadius,u_circleSweepSpeed:s.sweepSpeed,u_opacity:void 0===e?1:e,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||(void 0===o?0:o)};return this.getUniformsBufferInfo(u)}},{key:"calCityGeo",value:function(){var t=(0,i3.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+e)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([e,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-e,u=i-n;this.cityCenter=[(r+e)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),t.abrupt("return",this.buildModels());case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\n\nout vec2 v_texCoord;\nout vec4 v_Color;\nout float v_worldDis;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_circleSweepColor;\n  vec2 u_cityCenter;\n  float u_circleSweep;\n  float u_cityMinSize;\n  float u_circleSweepSpeed;\n  float u_opacity: 1.0;\n  float u_near : 0;\n  float u_far : 1;\n  float u_time;\n};\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nlayout(std140) uniform commonUniforms {\n  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_circleSweepColor;\n  vec2 u_cityCenter;\n  float u_circleSweep;\n  float u_cityMinSize;\n  float u_circleSweepSpeed;\n  float u_opacity: 1.0;\n  float u_near : 0;\n  float u_far : 1;\n  float u_time;\n};\nin vec4 v_Color;\nin vec2 v_texCoord;\nin float v_worldDis;\nout vec4 outputColor;\n\n#pragma include "picking"\n#pragma include "scene_uniforms"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  outputColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       outputColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        outputColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    outputColor.rgb += r * r * u_circleSweepColor.rgb;\n  }\n   \n  outputColor.a *= u_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:vd,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:lq.BACK}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(pQ),vw=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","CityBuildingLayer"),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layerModel=new vS(this),t.next=3,this.initLayerModels();case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),i}(pG),vk=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"radian",0),(0,ac.Z)((0,se.Z)(t),"planeGeometryTriangulation",function(){var e=t.layer.getLayerConfig().center,n=void 0===e?[120,30]:e;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat((0,i2.Z)(n),[1,1],(0,i2.Z)(n),[0,1],(0,i2.Z)(n),[0,0],(0,i2.Z)(n),[1,0])}}),t}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.width,r=t.height,i=t.raisingHeight,o=1;("GAODE2.x"===this.mapService.version||"GAODE1.x"===this.mapService.version)&&(o=-1),this.radian=o*Math.PI*(this.mapService.getRotation()%360)/180;var a={u_size:[void 0===n?1:n,void 0===r?1:r],u_raisingHeight:Number(void 0===i?0:i),u_rotation:this.radian,u_opacity:e||1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig().drawCanvas,n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),e&&this.updateTexture(e),this.initUniformsBuffer(),t.next=7,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n vec2 u_size;\n float u_raisingHeight;\n float u_rotation;\n float u_opacity;\n};\n\nout vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_uv = a_Uv;\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // 计算经纬度点位坐标\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // 计算绕 z 轴旋转后的偏移\n   vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0),u_rotation));\n   // 绕 z 轴旋转\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z 轴不参与旋转\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n   gl_Position = project_common_position_to_clipspace_v2(vec4(x , y, z , 1.0));\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n vec2 u_size;\n float u_raisingHeight;\n float u_rotation;\n float u_opacity;\n};\n\nuniform sampler2D u_texture;\n\nin vec2 v_uv;\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\n  outputColor.a *= u_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:this.planeGeometryTriangulation,inject:this.getInject(),primitive:lq.TRIANGLES,depth:{enable:!0}});case 7:return r=t.sent,t.abrupt("return",[r]);case 9:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"updateTexture",value:function(t){var e=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=n.canvasHeight,o=document.createElement("canvas");o.width=void 0===r?1:r,o.height=void 0===i?1:i,o.getContext("2d")&&(t(o),this.texture=e({data:o,width:o.width,height:o.height,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hL.Attribute,descriptor:{name:"a_Extrude",shaderLocation:pY.EXTRUDE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[2],n[3]]}}})}}]),o}(pQ),vC=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"terrainImageLoaded",!1),(0,ac.Z)((0,se.Z)(t),"planeGeometryTriangulation",function(){var e=t.layer.getLayerConfig(),n=e.width,r=e.height,i=e.widthSegments,o=e.heightSegments,a=e.center,s=e.terrainTexture,u=t.initPlane.apply(t,[void 0===n?1:n,void 0===r?1:r,void 0===i?1:i,void 0===o?1:o].concat((0,i2.Z)(void 0===a?[120,30]:a))),c=u.indices,l=u.positions;return s&&t.loadTerrainTexture(l,c),{vertices:l,indices:c,size:5}}),t}return(0,rX.Z)(o,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=t/2,s=e/2,u=Math.floor(n),c=Math.floor(r),l=u+1,f=c+1,h=t/u,p=e/c,d=[],v=[],m=0;m<f;m++)for(var g=m*p-s,y=0;y<l;y++){var b=y*h-a;if("GAODE2.x"===this.mapService.version){var x=this.mapService.lngLatToCoord([b+i,-g+o]),_=(0,i3.Z)(x,2),S=_[0],w=_[1];v.push(S,w,0)}else v.push(b+i,-g+o,0);v.push(y/u),v.push(1-m/c)}for(var k=0;k<c;k++)for(var C=0;C<u;C++){var E=C+l*k,A=C+l*(k+1),M=C+1+l*(k+1),L=C+1+l*k;d.push(E,A,L),d.push(A,M,L)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.terrainClipHeight,o=e.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r));var a={u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:o?void 0===i?0:i:-1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"clearModels",value:function(){var t;this.terrainImage=null,null===(t=this.texture)||void 0===t||t.destroy(),this.textures=[]}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig().mapTexture,this.mapTexture=e,n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),this.updateTexture(e),this.initUniformsBuffer(),t.next=8,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec3 a_Color;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_terrainClipHeight;\n};\n\nout vec3 v_Color;\nout vec2 v_uv;\nout float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy, a_Position.z, 1.0));\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_terrainClipHeight;\n};\n\nin vec3 v_Color;\nin vec2 v_uv;\nin float v_clip;\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\n    outputColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    outputColor = vec4(v_Color, u_opacity);\n  }\n  outputColor.a *= v_clip;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:this.planeGeometryTriangulation,inject:this.getInject(),primitive:lq.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:lq.BACK}});case 8:return r=t.sent,t.abrupt("return",[r]);case 10:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"createModelData",value:function(t){if(t){var e=this.layer.getLayerConfig(),n=e.widthSegments,r=e.heightSegments,i=e.width,o=e.height,a=t.widthSegments,s=t.heightSegments,u=t.width,c=t.height;this.layer.style({widthSegments:void 0!==a?a:n,heightSegments:void 0!==s?s:r,width:void 0!==u?u:i,height:void 0!==c?c:o})}var l=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(l,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE}),e.layerService.reRender()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.width,i=t.height;return e.width=r,e.height=i,n.drawImage(t,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(t,e,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,c=Math.floor(r),l=Math.floor(i),f=c+1,h=l+1,p=a/c,d=s/l,v=0;v<h;v++)for(var m=Math.floor(v*d)*a,g=0;g<f;g++){var y=(m+Math.floor(g*p))*4,b=u[y],x=u[y+1],_=u[y+2];t[(v*f+g)*5+2]=o(b,x,_)}var S=this.layer.getEncodedData(),w=this.styleAttributeService.createAttributesAndIndices(S,function(){return{vertices:t,indices:e,size:5}});this.layer.updateModelData(w),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(t,e){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,c=r.rgb2height,l=void 0===c?function(t,e,n){return t+e+n}:c;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(t,e,this.terrainImage,o,s,l):this.terrainImage.onload=function(){n.translateVertex(t,e,n.terrainImage,o,s,l)};else{var f=new Image;this.terrainImage=f,f.crossOrigin="anonymous",f.onload=function(){n.terrainImageLoaded=!0,setTimeout(function(){return n.layer.emit("terrainImageLoaded",null)}),n.translateVertex(t,e,f,o,s,l)},f.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(pQ),vE=((tn=vE||{}).UP="up",tn.DOWN="down",tn),vA={plane:vC,sprite:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"planeGeometryUpdateTriangulation",function(){for(var e=t.layer.getLayerConfig().spriteBottom,n=t.spriteUpdate,r=void 0===e?-1e5:e,i=t.spriteTop,o=0;o<t.positions.length;o+=5)t.spriteAnimate===vE.UP?(t.positions[o+2]+=n,t.positions[o+2]>i&&(t.positions[o+2]=r)):(t.positions[o+2]-=n,t.positions[o+2]<r&&(t.positions[o+2]=i));return{vertices:t.positions,indices:t.indices,size:5}}),(0,ac.Z)((0,se.Z)(t),"updatePosition",function(){t.planeGeometryUpdateTriangulation();var e,n=null===(e=t.styleAttributeService.getLayerStyleAttribute("position"))||void 0===e?void 0:e.vertexAttribute;if(n){for(var r=[],i=0;i<t.positions.length;i+=5)r.push(t.positions[i],t.positions[i+1],t.positions[i+2]);n.updateBuffer({data:r,offset:0})}t.layerService.throttleRenderLayers(),t.timer=requestAnimationFrame(t.updatePosition)}),(0,ac.Z)((0,se.Z)(t),"planeGeometryTriangulation",function(){var e=t.layer.getLayerConfig(),n=e.center,r=e.spriteCount,i=e.spriteRadius,o=t.initSprite.apply(t,[void 0===i?10:i,void 0===r?100:r].concat((0,i2.Z)(void 0===n?[120,30]:n))),a=o.indices,s=o.positions;return t.positions=s,t.indices=a,{vertices:s,indices:a,size:5}}),t}return(0,rX.Z)(o,[{key:"initSprite",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===vE.UP?-this.spriteTop:this.spriteTop,u=0;u<e;u++){var c=Math.random()*s;o.push.apply(o,(0,i2.Z)(function(e){var i=t*Math.random(),o=t*Math.random(),s=-t/2+i,u=-t/2+o;if("GAODE2.x"!==a.version)return[s+n,-u+r,e,0,0];var c=a.lngLatToCoord([s+n,-u+r]),l=(0,i3.Z)(c,2);return[l[0],l[1],e,0,0]}(c)))}for(var l=0;l<e;l++)i.push(l);return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.spriteScale;this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.textures=[],this.updateTexture(r));var o={u_opacity:n||1,u_mapFlag:r?1:0,u_Scale:void 0===i?1:i,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}},{key:"clearModels",value:function(){var t;cancelAnimationFrame(this.timer),null===(t=this.texture)||void 0===t||t.destroy(),this.textures=[]}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.layer.getLayerConfig()).mapTexture,i=void 0===(r=e.spriteTop)?5e6:r,a=void 0===(o=e.spriteUpdate)?1e4:o,u=void 0===(s=e.spriteAnimate)?vE.DOWN:s,this.initUniformsBuffer(),this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=a,"up"===u?this.spriteAnimate=vE.UP:this.spriteAnimate=vE.DOWN,c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout(function(){f.updatePosition()},100),t.next=12,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec3 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_Scale;\n};\n\nout vec3 v_Color;\nout float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color.xyz;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy, a_Position.z, 1.0));\ngl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_Scale;\n};\nuniform sampler2D u_texture;\n\nin vec3 v_Color;\nin float v_d;\nout vec4 outputColor;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    outputColor = texture(SAMPLER_2D(u_texture), gl_PointCoord);\n    outputColor.a *= u_opacity;\n  } else {\n    outputColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,inject:this.getInject(),primitive:lq.POINTS,depth:{enable:!1},blend:this.getBlend()});case 12:return l=t.sent,t.abrupt("return",[l]);case 14:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE}),e.layerService.reRender()},r.src=t}else this.texture=n({width:1,height:1})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(pQ),billboard:vk},vM=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","GeometryLayer"),(0,ac.Z)((0,se.Z)(t),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new vA[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return({plane:{},sprite:{},billboard:{}})[this.getModelType()]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),i}(pG),vT=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.coverage,r=t.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:e||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'layout(location = 0) in vec3 a_Position;\r\nlayout(location = 1) in vec4 a_Color;\r\nlayout(location = 10) in vec3 a_Pos;\r\n\r\nlayout(std140) uniform commonUniforms {\r\n    vec2 u_radius;\r\n    float u_opacity;\r\n    float u_coverage;\r\n    float u_angle;\r\n};\r\n\r\n\r\nout vec4 v_color;\r\n\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n  v_color.a *= u_opacity;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:vv,primitive:lq.TRIANGLES,depth:{enable:!1}});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:hL.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),o}(pQ),vL=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.coverage,r=t.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:e||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in vec3 a_Pos;\nlayout(location = 13) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:va,primitive:lq.TRIANGLES,depth:{enable:!0}});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{shaderLocation:pY.SIZE,name:"a_Size",buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:hL.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),o}(pQ);n(61369);var vZ=oD.isEqual,vP=(0,cn.b2)()(e6=function(t){(0,r$.Z)(a,t);var e,n,r,i,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(a);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function a(){var t;(0,rK.Z)(this,a);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"colorModelUniformBuffer",[]),(0,ac.Z)((0,se.Z)(t),"heat3DModelUniformBuffer",[]),t}return(0,rX.Z)(a,[{key:"prerender",value:function(){var t=this,e=this.rendererService,n=e.clear;(0,e.useFramebuffer)(this.heatmapFramerBuffer,function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})}},{key:"render",value:function(t){var e=this.layer.getLayerConfig().rampColors;vZ(this.preRampColors,e)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawHeatMap(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw Error("Method not implemented.")}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=(n=this.rendererService).createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,s=(null==(a=this.styleAttributeService.getLayerStyleAttribute("shape"))||null===(e=a.scale)||void 0===e?void 0:e.field)||"heatmap",this.shapeType=s,t.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=t.sent,this.colorModel="heatmap"===s?this.buildHeatmap():this.build3dHeatMap(),c=(u=i()).width,l=u.height,this.heatmapTexture=o({width:Math.floor(c/4),height:Math.floor(l/4),wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE,min:lq.LINEAR,mag:lq.LINEAR,usage:lj.RENDER_TARGET}),this.heatmapFramerBuffer=r({color:this.heatmapTexture,depth:!0,width:Math.floor(c/4),height:Math.floor(l/4)}),this.updateColorTexture(),t.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:hL.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size;return[void 0===e?1:e]}}})}},{key:"buildHeatMapIntensity",value:(i=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=vy,t.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in vec2 a_Dir;\n\n\nlayout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nout vec2 v_extrude;\nout float v_weight;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main(){\n    vec3 picking_color_placeholder = u_PickingColor;\n\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nin vec2 v_extrude;\nin float v_weight;\nout vec4 outputColor;\n#define GAUSS_COEF  0.3989422804014327\n\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    outputColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:vy,depth:{enable:!1},cull:{enable:!0,face:i1(this.mapService.version)}});case 4:return e=t.sent,t.abrupt("return",e);case 6:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nvoid main() {\n  v_texCoord = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_texCoord.y = 1.0 - v_texCoord.y;\n  #endif\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n',fs:'uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n\nfloat getBlurIndusty() {\n    float vW = 2.0/ u_ViewportSize.x;\n    float vH = 2.0/ u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));\n    outputColor = color;\n    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n'}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var t=this.shaderModuleService.getModule("heatmapColor"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer;return(0,i.createModel)({vs:e,fs:n,uniformBuffers:[].concat((0,i2.Z)(this.colorModelUniformBuffer),(0,i2.Z)(this.rendererService.uniformBuffers)),attributes:{a_Position:o({shaderLocation:pY.POSITION,buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:lq.FLOAT}),size:3}),a_Uv:o({shaderLocation:pY.UV,buffer:s({data:[0,1,1,1,0,0,1,0],type:lq.FLOAT}),size:2})},uniforms:(0,rW.Z)({},r),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:lq.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,e=this.layer.getLayerConfig(),n=e.intensity,r=void 0===n?10:n,i=e.radius,o=void 0===i?5:i;this.uniformBuffers[0].subData({offset:0,data:[o,r]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(t=this.intensityModel)||void 0===t||t.draw({uniforms:{u_radius:o,u_intensity:r},blend:{enable:!0,func:{srcRGB:lq.ONE,srcAlpha:1,dstRGB:lq.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(t){var e,n=this.layer.getLayerConfig().opacity,r=void 0===n?1:n,i={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},o=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[r]}),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:i,textures:o,blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var e,n=this.layer.getLayerConfig().opacity,r=void 0===n?1:n,i=cy();cC(i,this.cameraService.getViewProjectionMatrixUncentered());var o={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,i2.Z)(i)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat((0,i2.Z)(o.u_ViewProjectionMatrixUncentered),(0,i2.Z)(o.u_InverseViewProjectionMatrix),[r])});var a=[this.heatmapTexture,this.colorTexture];null===(e=this.colorModel)||void 0===e||e.draw({uniforms:o,textures:a,blend:{enable:!0,func:{srcRGB:lq.SRC_ALPHA,srcAlpha:1,dstRGB:lq.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=(0,this.rendererService.getViewportSize)(),e=function(t,e){for(var n=[],r=[],i=[],o=t+1,a=e+1,s=t/2,u=e/2,c=0;c<a;c++)for(var l=c-u,f=0;f<o;f++){var h=f-s;r.push(h/s,-l/u,0),i.push(f/t),i.push(1-c/e)}for(var p=0;p<e;p++)for(var d=0;d<t;d++){var v=d+o*p,m=d+o*(p+1),g=d+1+o*(p+1),y=d+1+o*p;n.push(v,m,y),n.push(m,g,y)}return{vertices:r,indices:n,uvs:i}}(t.width/4,t.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nout vec2 v_texCoord;\nout float v_intensity;\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n	vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n	inverseP2 = inverseP2 / inverseP2.w;\n\n	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"layout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\nin float v_intensity;\nout vec4 outputColor;\n\nvoid main(){\n   \n    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));\n    outputColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(36).fill(0),isUBO:!0})];var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,i=n.fs,o=n.uniforms,a=this.rendererService,s=a.createAttribute,u=a.createElements,c=a.createBuffer;return(0,a.createModel)({vs:r,fs:i,attributes:{a_Position:s({shaderLocation:pY.POSITION,buffer:c({data:e.vertices,type:lq.FLOAT}),size:3}),a_Uv:s({shaderLocation:pY.UV,buffer:c({data:e.uvs,type:lq.FLOAT}),size:2})},primitive:lq.TRIANGLES,uniformBuffers:[].concat((0,i2.Z)(this.heat3DModelUniformBuffer),(0,i2.Z)(this.rendererService.uniformBuffers)),uniforms:(0,rW.Z)({},o),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:lq.SRC_ALPHA,srcAlpha:1,dstRGB:lq.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:e.indices,type:lq.UNSIGNED_INT,count:e.indices.length})})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var e=this.layer.getLayerConfig().rampColors,n=iY(e);this.colorTexture=t({data:n.data,usage:lj.SAMPLED,width:n.width,height:n.height,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE,min:lq.NEAREST,mag:lq.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=e}}]),a}(pQ))||e6,vO={heatmap:vP,heatmap3d:vP,grid:vT,grid3d:vL,hexagon:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.coverage,r=t.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:e||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 10) in vec3 a_Pos;\n\nlayout(std140) uniform commonUniforms {\n    vec2 u_radius;\n    float u_opacity;\n    float u_coverage;\n    float u_angle;\n};\n\nout vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a *= u_opacity;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:vv,depth:{enable:!1},primitive:lq.TRIANGLES});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:hL.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),o}(pQ)};function vR(t,e){return{type:t.type,field:"value",items:t.positions.map(function(n,r){var i;return i={},(0,ac.Z)(i,e,r>=t.colors.length?null:t.colors[r]),(0,ac.Z)(i,"value",n),i})}}var vI=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","HeatMapLayer"),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new vO[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"prerender",value:function(){"heatmap"===this.getModelType()&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"heatmap"===this.getModelType()?this.layerModel&&this.layerModel.render(e):this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach(function(n){return n.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(e)})}),this.hooks.afterRender.call()),this}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?(null==n?void 0:n.indexOf(i))===-1?"hexagon":"grid3d":"grid"===r?(null==n?void 0:n.indexOf(i))===-1?"grid":"grid3d":"heatmap"}},{key:"getLegend",value:function(t){return"heatmap"!==this.getModelType()?fX((0,rJ.Z)(i.prototype),"getLegend",this).call(this,t):"color"!==t?{type:void 0,field:void 0,items:[]}:vR(this.getLayerConfig().rampColors,t)}}]),i}(pG),vD={image:function(t){(0,r$.Z)(a,t);var e,n,r,i,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(a);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function a(){return(0,rK.Z)(this,a),o.apply(this,arguments)}return(0,rX.Z)(a,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.brightness,r=t.contrast,i=t.saturation,o=t.gamma,a={u_opacity:ux(e,1),u_brightness:ux(n,1),u_contrast:ux(r,1),u_saturation:ux(i,1),u_gamma:ux(o,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadTexture();case 2:return t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"loadTexture",value:(r=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.rendererService.createTexture2D,this.texture=e({height:1,width:1}),n=this.layer.getSource(),t.next=5,n.data.images;case 5:r=t.sent,this.texture=e({data:r[0],width:r[0].width,height:r[0].height,mag:lq.LINEAR,min:lq.LINEAR});case 7:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(i=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nout vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n \n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\nvec3 setContrast(vec3 rgb, float contrast) {\n  vec3 color = mix(vec3(0.5), rgb, contrast);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvec3 setSaturation(vec3 rgb, float adjustment) {\n  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);\n  vec3 intensity = vec3(dot(rgb, grayVector));\n  vec3 color = mix(intensity, rgb, adjustment);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvoid main() {\n  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n  //brightness\n  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);\n  //contrast\n  color.rgb = setContrast(color.rgb, u_contrast);\n  // saturation\n  color.rgb = setSaturation(color.rgb, u_saturation);\n  // gamma\n  color.rgb = pow(color.rgb, vec3(u_gamma));\n  outputColor = color;\n  outputColor.a *= u_opacity;\n  if(outputColor.a < 0.01)\n    discard;\n}\n",triangulation:vm,primitive:lq.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),a}(pQ)},vN=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","ImageLayer"),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new vD[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return({image:{}})[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),i}(pG),vz={solid:0,dash:1};oD.isNumber;var vj=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(t.texture){t.texture.update({data:t.iconService.getCanvas()}),t.layer.render();return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.NEAREST,min:lq.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128}),t.textures=[t.texture]}),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=t.lineType,o=void 0===i?"solid":i,a=t.dashArray,s=t.forward,u=t.lineTexture,c=t.iconStep,l=t.segmentNumber,f=this.layer.getLayerConfig().animateOption,h=void 0===a?[10,5]:a;"dash"!==o&&(h=[0,0]),2===h.length&&h.push(0,0);var p=0,d=[0,0,0,0],v=[0,0,0,0];e&&n&&(d=iH(e),v=iH(n),p=1),this.rendererService.getDirty()&&this.texture.bind();var m={u_animate:this.animateOption2Array(f),u_dash_array:h,u_sourceColor:d,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:void 0===l?30:l,u_lineDir:void 0===s||s?1:-1,u_icon_step:void 0===c?100:c,u_line_texture:void 0!==u&&u?1:0,u_textureBlend:"normal"===(void 0===r?"normal":r)?0:1,u_blur:.9,u_line_type:vz[o||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:p};return this.getUniformsBufferInfo(m)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nin vec4 v_color;\nin vec2 v_iconMapUV;\nin vec4 v_lineData;\n//dash\nin vec4 v_dash_array;\nin float v_distance_ratio;\n\nout vec4 outputColor;\n#pragma include "picking"\n\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  outputColor = v_color;\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n    \n  } else {\n     outputColor = filterColor(outputColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_lineData;\n//dash\nout vec4 v_dash_array;\nout float v_distance_ratio;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if(u_linearColor==1.0){\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  }\n  else{\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n\n\n\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  //计算dashArray和distanceRatio 输出到片元\n  vec2 s = source;\n  vec2 t = target;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n  v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),n=void 0===(e=this.layer.getLayerConfig().segmentNumber)?30:e,i=(r=this.getShaders()).frag,o=r.vert,a=r.type,t.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+a,vertexShader:o,fragmentShader:i,inject:this.getInject(),triangulation:vg,depth:{enable:!1},styleOption:{segmentNumber:n}});case 5:return s=t.sent,t.abrupt("return",[s]);case 7:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hL.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(pQ),vB={solid:0,dash:1},vF=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(t.texture){t.texture.update({data:t.iconService.getCanvas()}),t.layer.render();return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.NEAREST,min:lq.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128}),t.textures=[t.texture]}),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=t.lineType,o=t.dashArray,a=void 0===o?[10,5]:o,s=t.lineTexture,u=t.iconStep,c=t.segmentNumber,l=t.globalArcHeight,f=this.layer.getLayerConfig().animateOption;2===a.length&&a.push(0,0);var h=0,p=[0,0,0,0],d=[0,0,0,0];e&&n&&(p=iH(e),d=iH(n),h=1),this.rendererService.getDirty()&&this.texture.bind();var v={u_animate:this.animateOption2Array(f),u_dash_array:a,u_sourceColor:p,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:100,u_global_height:void 0===l?10:l,segmentNumber:void 0===c?30:c,u_line_type:vB[void 0===i?"solid":i]||0,u_icon_step:void 0===u?100:u,u_line_texture:void 0!==s&&s?1:0,u_textureBlend:"normal"===(void 0===r?"normal":r)?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:h};return this.getUniformsBufferInfo(v)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\n// varying vec2 v_normal;\nin vec4 v_dash_array;\nin vec4 v_color;\nin vec4 v_line_data;\nin float v_segmentIndex;\nin vec2 v_iconMapUV;\n\nout vec4 outputColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  outputColor = v_color;\n\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    outputColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          outputColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\nout vec4 v_color;\nout vec4 v_dash_array;\nout float v_segmentIndex;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if(u_linearColor==1.0){\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  }\n  else{\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0===(e=this.layer.getLayerConfig().segmentNumber)?30:e,i=(r=this.getShaders()).frag,o=r.vert,a=r.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+a,vertexShader:o,fragmentShader:i,inject:this.getInject(),triangulation:vg,styleOption:{segmentNumber:n}});case 4:return s=t.sent,t.abrupt("return",[s]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hL.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(pQ),vU={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0};function vV(t,e){var n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M,L,Z="object"===(0,u5.Z)(t)?t.type:t,P="source"===e?1:-1,O="object"===(0,u5.Z)(t)?t:{};switch(Z){case"circle":return r=void 0===(n=O.width)?2:n,o=void 0===(i=O.height)?2:i,a=d6(),s=s1().flatten([a]),u=s1()(s.vertices,s.holes,s.dimensions),c=a.map(function(t){return[t[0]*r*P,t[1]*o]}).flat(),{vertices:[].concat((0,i2.Z)(c),(0,i2.Z)(c)),dimensions:2,indices:u.map(function(t){return t+a.length}),outLineIndices:u,normals:[].concat((0,i2.Z)(a.map(function(t){return[t[1]*o,t[0]*r*P,1]}).flat()),(0,i2.Z)(Array(3*a.length).fill(0)))};case"triangle":return{vertices:[0,0,1*P*(f=void 0===(l=O.width)?2:l),1*(p=void 0===(h=O.height)?3:h),1*P*f,-1*p,0,0,1*P*f,1*p,1*P*f,-1*p],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*P,1,2,1*P,1,-2,1*P,1,0,0,0,0,0,0,0,0,0],dimensions:2};case"diamond":return{vertices:[0,0,1*(v=void 0===(d=O.width)?2:d)*P,.5*(g=void 0===(m=O.height)?3:m),2*v*P,0,1*v*P,-.5*g,0,0,1*v*P,.5*g,2*v*P,0,1*v*P,-.5*g],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-P,1,1,0,1,0,-P,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]};case"rect":return b=void 0===(y=O.width)?2:y,{vertices:[0,(_=void 0===(x=O.height)?2:x)/2,P*b*1,_/2,P*b*1,-_/2,0,-_/2,0,_/2,P*b*1,_/2,P*b*1,-_/2,0,-_/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-P,1,1,0,1,0,-P,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]};case"classic":return{vertices:[0,0,2*P*(w=void 0===(S=O.width)?2:S),1*(C=void 0===(k=O.height)?3:k),1.5*P*w,0,2*P*w,-1*C,0,0,2*P*w,1*C,1.5*P*w,0,2*P*w,-1*C],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-P,1,1,0,1,0,-P,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]};case"halfTriangle":return{vertices:[0,.5*P,1*P*(A=void 0===(E=O.width)?2:E),-((L=void 0===(M=O.height)?1:M)+.5)*P,1*P*A,(L-.5)*P,0,.5*P,1*P*A,-(L+.5)*P,1*P*A,(L-.5)*P],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*P,-2*P,1,-2*P,1.5*P,1,1*P,1.5*P,1,0,0,0,0,0,0,0,0,0],dimensions:2};default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function vH(t,e){var n,r,i,o,a,s,u;return e?(r=t.coordinates.flat(),i=e.target,a=vG(vV(void 0===(o=e.source)?"circle":o,"source"),r,0,0),s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r="object"===(0,u5.Z)(n.source)?n.source.type:n.source,i="object"===(0,u5.Z)(n.target)?n.target.type:n.target,o="object"===(0,u5.Z)(n.source)?n.source:{},a=o.width,s=void 0===a?r?vU[r]:0:a;o.height;var u="object"===(0,u5.Z)(n.target)?n.target:{},c=u.width,l=void 0===c?i?vU[i]:0:c;return u.height,{vertices:[0,.5,1*s].concat((0,i2.Z)(t),[1,.5,-1*l],(0,i2.Z)(t),[1,-.5,-1*l],(0,i2.Z)(t),[0,-.5,1*s],(0,i2.Z)(t),[0,.5,1*s],(0,i2.Z)(t),[1,.5,-1*l],(0,i2.Z)(t),[1,-.5,-1*l],(0,i2.Z)(t),[0,-.5,1*s],(0,i2.Z)(t)),outLineIndices:[0,1,2,0,2,3].map(function(t){return t+e}),indices:[4,5,6,4,6,7].map(function(t){return t+e}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,a.vertices.length/7,e),u=vG(vV(void 0===i?"classic":i,"target"),r,1,a.vertices.length/7+s.vertices.length/7),{vertices:[].concat((0,i2.Z)(a.vertices),(0,i2.Z)(s.vertices),(0,i2.Z)(u.vertices)),indices:[].concat((0,i2.Z)(a.outLineIndices),(0,i2.Z)(s.outLineIndices),(0,i2.Z)(u.outLineIndices),(0,i2.Z)(a.indices),(0,i2.Z)(s.indices),(0,i2.Z)(u.indices)),normals:[].concat((0,i2.Z)(a.normals),(0,i2.Z)(s.normals),(0,i2.Z)(u.normals)),size:7}):(n=t.coordinates.flat(),{vertices:[1,0,0].concat((0,i2.Z)(n),[1,2,-3],(0,i2.Z)(n),[1,1,-3],(0,i2.Z)(n),[0,1,0],(0,i2.Z)(n),[0,0,0],(0,i2.Z)(n),[1,0,0],(0,i2.Z)(n),[1,2,-3],(0,i2.Z)(n),[1,1,-3],(0,i2.Z)(n),[0,1,0],(0,i2.Z)(n),[0,0,0],(0,i2.Z)(n)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7})}function vG(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=[],o=t.vertices,a=t.indices,s=t.dimensions,u=t.outLineIndices,c=0;c<o.length;c+=s)i.push.apply(i,[n,o[c+1],o[c]].concat((0,i2.Z)(e)));return(0,rW.Z)((0,rW.Z)({},t),{},{vertices:i,indices:a.map(function(t){return t+r}),outLineIndices:u.map(function(t){return t+r})})}var vW=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.gapWidth,n=t.strokeWidth,r=t.strokeOpacity;return this.getUniformsBufferInfo({u_gap_width:void 0===e?2:e,u_stroke_width:void 0===n?1:n,u_stroke_opacity:void 0===r?1:r})}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec2 a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 13) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniorm {\n  float u_gap_width: 1.0;\n  float u_stroke_width: 1.0;\n  float u_stroke_opacity: 1.0;\n};\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nout vec4 v_color;\n\nvec2 project_pixel_offset(vec2 offsets) {\n\n   vec2 data = project_pixel(offsets);\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return data;\n  }\n\n  return vec2(data.x, -data.y);;\n}\n\nvec2 line_dir(vec2 target, vec2 source) {\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n     return normalize(target - source);\n  }\n  return normalize(ProjectFlat(target) - ProjectFlat(source));\n}\n\nfloat flag_gap() {\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n     return 1.;\n  }\n  return -1.;\n\n}\n\n\nvoid main() {\n\n// 透明度计算\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  vec2 flowlineDir = line_dir(target,source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || 高德\n   \n  vec2 position = mix(source, target, a_Position.x);\n  \n  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    \n  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)\n  );\n\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || 高德\n\n  float gapCommon = flag_gap() * project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'// #extension GL_OES_standard_derivatives : enable\n\nin vec4 v_color;\nout vec4 outputColor;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',inject:this.getInject(),triangulation:vH,styleOption:this.layer.getLayerConfig().symbol,primitive:lq.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hL.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}})}}]),o}(pQ),vY={solid:0,dash:1},vq=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(t.texture){t.texture.update({data:t.iconService.getCanvas()}),t.layer.render();return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.NEAREST,min:lq.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128}),t.textures=[t.texture]}),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=t.lineType,o=t.dashArray,a=void 0===o?[10,5]:o,s=t.lineTexture,u=t.iconStep,c=t.segmentNumber,l=this.layer.getLayerConfig().animateOption;2===a.length&&a.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var f=0,h=[0,0,0,0],p=[0,0,0,0];e&&n&&(h=iH(e),p=iH(n),f=1);var d=this.layer.getLayerAnimateTime();isNaN(d)&&(d=0);var v={u_animate:this.animateOption2Array(l),u_dash_array:a,u_sourceColor:h,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:void 0===c?30:c,u_line_type:vY[void 0===i?"solid":i]||0,u_icon_step:void 0===u?100:u,u_line_texture:void 0!==s&&s?1:0,u_textureBlend:"normal"===(void 0===r?"normal":r)?0:1,u_time:d,u_linearColor:f};return this.getUniformsBufferInfo(v)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0===(e=this.layer.getLayerConfig().segmentNumber)?30:e,t.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nout vec4 v_dash_array;\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\nout float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n  mix(source, target, segmentRatio),\n  sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }\n  else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\n    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nin vec4 v_line_data;\nin vec2 v_iconMapUV;\nin vec4 v_dash_array;\nin float v_distance_ratio;\nin vec4 v_color;\n\nout vec4 outputColor;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n    outputColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = outputColor.a/v_color.a;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:vg,styleOption:{segmentNumber:n},inject:this.getInject(),depth:{enable:!1}});case 3:return r=t.sent,t.abrupt("return",[r]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hL.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(pQ),vX=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"textureEventFlag",!1),(0,ac.Z)((0,se.Z)(t),"texture",t.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(0===t.textures.length&&(t.textures=[t.texture]),t.texture){t.texture.update({data:t.iconService.getCanvas()}),t.layer.render();return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.NEAREST,min:lq.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})}),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=t.lineType,o=t.dashArray,a=t.lineTexture,s=t.iconStep,u=t.vertexHeightScale,c=t.strokeWidth,l=t.raisingHeight,f=t.heightfixed,h=t.linearDir,p=void 0===h?p0.VERTICAL:h,d=t.blur,v=void 0===o?[10,5,0,0]:o;"dash"!==(void 0===i?"solid":i)&&(v=[0,0,0,0]),2===v.length&&v.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var m=this.layer.getLayerConfig().animateOption,g=0,y=[0,0,0,0],b=[0,0,0,0];e&&n&&(y=iH(e),b=iH(n),g=1);var x={u_animate:this.animateOption2Array(m),u_dash_array:v,u_blur:void 0===d?[1,1,1,0]:d,u_sourceColor:y,u_targetColor:b,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:void 0===s?100:s,u_heightfixed:Number(void 0!==f&&f),u_vertexScale:void 0===u?20:u,u_raisingHeight:Number(void 0===l?0:l),u_strokeWidth:void 0===c?0:c,u_textureBlend:(void 0===r?"normal":r)===p1.NORMAL?0:1,u_line_texture:void 0!==a&&a?1:0,u_linearDir:p===p0.VERTICAL?1:0,u_linearColor:g,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(x)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0!==(e=this.layer.getLayerConfig().depth)&&e,i=(r=this.getShaders()).frag,o=r.vert,a=r.type,this.layer.triangulation=ul,t.next=5,this.layer.buildLayerModel({moduleName:"line"+a,vertexShader:o,fragmentShader:i,triangulation:ul,inject:this.getInject(),depth:{enable:n}});case 5:return s=t.sent,t.abrupt("return",[s]);case 7:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'// #extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\n// dash\nin vec4 v_dash_array;\nin float v_d_distance_ratio;\nin vec2 v_iconMapUV;\nin vec4 v_texture_data;\n\nout vec4 outputColor;\n#pragma include "picking"\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    d_distance_ratio = v_texture_data.a;\n  }\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float strokeWidth = min(0.5, u_strokeWidth);\n  // 绘制 border\n  if(strokeWidth > 0.01) {\n    float borderOuterWidth = strokeWidth / 2.0;\n\n\n    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {\n      if(v > strokeWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);\n      } else if(v <= strokeWidth) {\n        float linear = smoothstep(0.0, 1.0, v/strokeWidth);\n        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'\n#define Animate 0.0\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec2 a_Size;\nlayout(location = 10) in vec3 a_DistanceAndIndexAndMiter;\nlayout(location = 13) in vec4 a_Normal_Total_Distance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\n\nout vec4 v_color;\nout vec4 v_stroke;\n//dash\nout vec4 v_dash_array;\nout float v_d_distance_ratio;\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_texture_data;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;\n  float a_Miter = a_DistanceAndIndexAndMiter.z;\n  vec3 a_Normal = a_Normal_Total_Distance.xyz;\n  float a_Total_Distance = a_Normal_Total_Distance.w;\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n  v_stroke = stroke;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:hL.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:10,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10,n[4]]:[n[3],o,n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:hL.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t,e,n,r,i){return[].concat((0,i2.Z)(i),[n[5]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(pQ);oD.isNumber;var vK=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.lineType,i=t.dashArray,o=t.vertexHeightScale,a=void 0===i?[10,5,0,0]:i;"dash"!==(void 0===r?"solid":r)&&(a=[0,0,0,0]),2===a.length&&a.push(0,0);var s=0,u=[0,0,0,0],c=[0,0,0,0];e&&n&&(u=iH(e),c=iH(n),s=1);var l={u_sourceColor:u,u_targetColor:c,u_dash_array:a,u_vertexScale:void 0===o?20:o,u_linearColor:s};return this.getUniformsBufferInfo(l)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:"\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\nin float v_distanceScale;\nin vec4 v_color;\n//dash\nin vec4 v_dash_array;\n\nout vec4 outputColor;\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  if(u_linearColor==1.0){\n    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n    outputColor.a *= v_color.a; // 全局透明度\n  }\n  else{\n    outputColor = v_color;\n  }\n}\n",vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\n\n#pragma include "projection"\n#pragma include "picking"\n\nout vec4 v_color;\nout float v_distanceScale;\nout vec4 v_dash_array;\n\nvoid main() {\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;\n\n  v_color = a_Color; \n  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;\n  v_color.a = v_color.a * opacity;\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_SizeDistanceAndTotalDistance.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',type:"lineSimpleNormal"}}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),n=(e=this.getShaders()).frag,r=e.vert,i=e.type,t.next=4,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:vc,inject:this.getInject(),primitive:lq.LINES,depth:{enable:!1},pick:!1});case 4:return o=t.sent,t.abrupt("return",[o]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:hL.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:pY.SIZE,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t,e,n){var r=t.size,i=void 0===r?1:r,o=Array.isArray(i)?[i[0],i[1]]:[i,0];return[o[0],o[1],n[3],n[5]]}}})}}]),o}(pQ),v$={arc:vj,arc3d:vF,greatcircle:vq,wall:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(t.texture){t.texture.update({data:t.iconService.getCanvas()}),t.layer.render();return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.NEAREST,min:lq.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128}),t.textures=[t.texture]}),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=t.heightfixed,o=t.lineTexture,a=t.iconStep,s=t.iconStepCount,u=this.layer.getLayerConfig().animateOption;this.rendererService.getDirty()&&this.texture.bind();var c=0,l=[0,0,0,0],f=[0,0,0,0];e&&n&&(l=iH(e),f=iH(n),c=1);var h={u_animate:this.animateOption2Array(u),u_sourceColor:l,u_targetColor:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:void 0===a?100:a,u_heightfixed:Number(void 0!==i&&i),u_linearColor:c,u_line_texture:void 0!==o&&o?1:0,u_textureBlend:"normal"===(void 0===r?"normal":r)?0:1,u_iconStepCount:void 0===s?1:s,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(h)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec2 a_Size;\nlayout(location = 10) in float a_Miter;\nlayout(location = 11) in float a_Total_Distance;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_iconMapUV;\nlayout(location = 15) in float a_Distance;\n\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_color;\nout float v_blur;\nout float v_radio;\nout vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {    \n     originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整\n  }\n\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\nin vec2 v_iconMapUV;\nin float v_blur;\nin float v_radio;\nin vec4 v_color;\nin vec4 v_dataset;\n\nout vec4 outputColor;\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n\n  outputColor.a *= v_color.a; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    outputColor.a = mix(0.0, outputColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  outputColor = filterColor(outputColor);\n}\n',triangulation:vu,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:hL.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:hL.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:hL.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(pQ),line:vX,simple:vK,flowline:vW,earthArc3d:vF},vQ=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","LineLayer"),(0,ac.Z)((0,se.Z)(t),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,ac.Z)((0,se.Z)(t),"arrowInsertCount",0),(0,ac.Z)((0,se.Z)(t),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new v$[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return({line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}})[this.getModelType()]}},{key:"getModelType",value:function(){if(this.layerType)return this.layerType;var t,e=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"line"}},{key:"processData",value:function(t){if("simple"!==this.getModelType())return t;var e=[];return t.map(function(t){if(Array.isArray(t.coordinates)&&Array.isArray(t.coordinates[0])&&Array.isArray(t.coordinates[0][0])){var n=(0,rW.Z)({},t);t.coordinates.map(function(t){e.push((0,rW.Z)((0,rW.Z)({},n),{},{coordinates:t}))})}else e.push(t)}),e}}]),i}(pG);function vJ(t){var e=t.coordinates;return{vertices:(0,i2.Z)(e),indices:[0],size:e.length}}var v0=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.blend,n=t.strokeOpacity,r=t.strokeWidth,i=t.stroke,o={u_stroke_color:iH(void 0===i?"#fff":i),u_additive:"additive"===e?1:0,u_stroke_opacity:void 0===n?1:n,u_stroke_width:void 0===r?0:r};return this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=vJ,this.initUniformsBuffer(),t.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nout vec4 v_color;\nout float v_blur;\nout float v_innerRadius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n  \n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nin vec4 v_color;\nin float v_blur;\nin float v_innerRadius;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      outputColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      outputColor = mix(v_color, stroke, mixR);\n    } else {\n      outputColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    outputColor = v_color;\n  }\n\n  outputColor = filterColor(outputColor);\n  \n  if(u_additive > 0.0) {\n    outputColor *= circleClipOpacity;\n  } else {\n    outputColor.a *= circleClipOpacity;\n  }\n\n}\n',inject:this.getInject(),triangulation:vJ,depth:{enable:!1},primitive:lq.POINTS});case 4:return e=t.sent,t.abrupt("return",[e]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(pQ),v1=oD.isNumber,v2=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"raiseCount",0),(0,ac.Z)((0,se.Z)(t),"raiseRepeat",0),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,i=void 0===r?1:r,o=t.sourceColor,a=t.targetColor,s=t.pickLight,u=t.heightfixed,c=t.opacityLinear,l=void 0===c?{enable:!1,dir:"up"}:c,f=t.lightEnable,h=0,p=[0,0,0,0],d=[0,0,0,0];if(o&&a&&(p=iH(o),d=iH(a),h=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var v=n.speed;this.raiseCount+=void 0===v?.01:v,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var m={u_sourceColor:p,u_targetColor:d,u_linearColor:h,u_pickLight:Number(void 0!==s&&s),u_heightfixed:Number(void 0===u||u),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:v1(i)?i:1,u_opacitylinear:Number(l.enable),u_opacitylinear_dir:"up"===l.dir?1:0,u_lightEnable:Number(void 0===f||f)};return this.getUniformsBufferInfo(m)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0===(e=this.layer.getLayerConfig().animateOption.repeat)?1:e,this.raiseRepeat=n,t.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec3 a_Size;\nlayout(location = 11) in vec3 a_Pos;\nlayout(location = 13) in vec3 a_Normal;\n\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\n\nout vec4 v_color;\nout float v_lightWeight;\nout float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nin vec4 v_color;\n\n#pragma include "picking"\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\nin float v_lightWeight;\nin float v_barLinearZ;\nout vec4 outputColor;\nvoid main() {\n\n   outputColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:va,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:i1(this.mapService.version)},blend:this.getBlend()});case 4:return r=t.sent,t.abrupt("return",[r]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e=t.size;if(!e)return[2,2,2];var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:hL.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e=aj(t.coordinates);return dW([e[0],e[1]])}}})}}]),o}(pQ),v3=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.strokeOpacity,n=t.strokeWidth,r=t.blend,i=t.blur;return this.layer.getLayerConfig(),this.getUniformsBufferInfo({u_additive:"additive"===r?1:0,u_stroke_opacity:void 0===e?1:e,u_stroke_width:void 0===n?0:n,u_blur:void 0===i?0:i})}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=vo,t.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in float a_Shape;\nlayout(location = 11) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);\n\n  setPickingColor(a_PickingColor);\n}',fragmentShader:"in vec4 v_data;\nin vec4 v_color;\nin float v_radius;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor = filterColor(outputColor);\n  }\n}\n",triangulation:vo,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hL.Attribute,descriptor:{name:"a_Extrude",shaderLocation:pY.EXTRUDE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r){var i=(0,i3.Z)(n,3),o=i[0],a=i[1],s=i[2],u=p9(0,0,1),c=p9(o,0,s),l=o>=0?dP(u,c):2*Math.PI-dP(u,c),f=cy();cO(f,f,l),cP(f,f,2*Math.PI-Math.asin(a/100));var h=p9(1,1,0);dE(h,h,f),db(h,h);var p=p9(-1,1,0);dE(p,p,f),db(p,p);var d=p9(-1,-1,0);dE(d,d,f),db(d,d);var v=p9(1,-1,0);dE(v,v,f),db(v,v);var m=[].concat((0,i2.Z)(h),(0,i2.Z)(p),(0,i2.Z)(d),(0,i2.Z)(v)),g=r%4*3;return[m[g],m[g+1],m[g+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:hL.Attribute,descriptor:{name:"a_Shape",shaderLocation:pY.SHAPE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(e){var n=e.shape;return[t.layer.getLayerConfig().shape2d.indexOf(void 0===n?2:n)]}}})}}]),o}(pQ),v5=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"raiseCount",0),(0,ac.Z)((0,se.Z)(t),"raiseRepeat",0),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.sourceColor,i=t.targetColor,o=t.pickLight,a=t.heightfixed,s=t.opacityLinear,u=void 0===s?{enable:!1,dir:"up"}:s,c=t.lightEnable,l=0,f=[0,0,0,0],h=[0,0,0,0];if(r&&i&&(f=iH(r),h=iH(i),l=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var p=n.speed;this.raiseCount+=void 0===p?.01:p,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var d={u_pickLight:Number(void 0!==o&&o),u_heightfixed:Number(void 0!==a&&a),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:l,u_sourceColor:f,u_targetColor:h,u_opacitylinear:Number(u.enable),u_opacitylinear_dir:"up"===u.dir?1:0,u_lightEnable:Number(void 0===c||c)};return this.getUniformsBufferInfo(d)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0===(n=(e=this.layer.getLayerConfig()).depth)||n,o=void 0===(i=e.animateOption.repeat)?1:i,this.raiseRepeat=o,this.initUniformsBuffer(),t.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'#define pi 3.1415926535\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec3 a_Size;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 13) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\nout vec4 v_color;\nout float v_lightWeight;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nin vec4 v_color;\nin float v_lightWeight;\nout vec4 outputColor;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n\n  outputColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:va,inject:this.getInject(),cull:{enable:!0,face:i1(this.mapService.version)},depth:{enable:r}});case 5:return a=t.sent,t.abrupt("return",[a]);case 7:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e=t.size;if(!e)return[2,2,2];var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hL.Attribute,descriptor:{name:"a_Extrude",shaderLocation:pY.EXTRUDE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t){var e=aj(t.coordinates);return[e[0],e[1],0]}}})}}]),o}(pQ),v4=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.strokeOpacity,n=t.strokeWidth,r=t.blend,i=t.blur,o=t.raisingHeight,a=t.heightfixed,s=t.unit,u=this.getAnimateUniforms().u_time;isNaN(u)&&(u=-1);var c={u_blur_height_fixed:[void 0===i?0:i,Number(void 0===o?0:o),Number(void 0!==a&&a)],u_stroke_width:void 0===n?0:n,u_additive:"additive"===r?1:0,u_stroke_opacity:void 0===e?1:e,u_size_unit:p2[void 0===s?"pixel":s],u_time:u,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(c)}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(void 0===t?{enable:!1}:t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),uf)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0===(e=this.layer.getLayerConfig().animateOption)?{enable:!1}:e,i=(r=this.getShaders(n)).frag,o=r.vert,a=r.type,this.layer.triangulation=uf,this.initUniformsBuffer(),t.next=6,this.layer.buildLayerModel({moduleName:a,vertexShader:o,fragmentShader:i,inject:this.getInject(),triangulation:uf,depth:{enable:!1}});case 6:return s=t.sent,t.abrupt("return",[s]);case 8:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"getShaders",value:function(t){return{frag:"\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\nin vec4 v_data;\nin float v_radius;\n\n#pragma include \"scene_uniforms\"\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  if(u_stroke_width < 0.01) {\n    outputColor = v_color;\n  } else {\n    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n  float intensity = 1.0;\n  if(u_time!=-1.0){\n    //wave相关逻辑\n    float d = length(v_data.xy);\n    if(d > 0.5) {\n      discard;\n    }\n    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor *= intensity;//wave\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor.a *= intensity;//wave \n    outputColor = filterColor(outputColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(outputColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in float a_Shape;\nlayout(location = 11) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;   \n};\n\nout vec4 v_color;\nout vec4 v_stroke;\nout vec4 v_data;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // 透明度计算\n   v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  offset = rotate_matrix(offset,rotation);\n  \n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n  \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"pointFill"}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hL.Attribute,descriptor:{name:"a_Extrude",shaderLocation:pY.EXTRUDE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:hL.Attribute,descriptor:{name:"a_Shape",shaderLocation:pY.SHAPE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(e){var n=e.shape;return[t.indexOf(void 0===n?2:n)]}}})}}]),o}(pQ),v7=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"meter2coord",1),(0,ac.Z)((0,se.Z)(t),"isMeter",!1),(0,ac.Z)((0,se.Z)(t),"radian",0),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(t.texture){t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),t.layerService.throttleRenderLayers();return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.LINEAR,min:lq.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0}),t.textures=[t.texture]}),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=t.heightfixed,r=t.unit;this.rendererService.getDirty()&&this.texture.bind();var i={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(void 0!==n&&n),u_raisingHeight:Number(void 0===e?0:e),u_size_unit:p2[void 0===r?"pixel":r]};return this.getUniformsBufferInfo(i)}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),vi)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed: 0.0;\n  float u_raisingHeight: 0.0;\n  float u_size_unit;\n};\n\nout vec2 v_uv;\nout vec2 v_Iconuv;\nout float v_opacity;\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n  v_opacity = opacity;\n  float newSize = a_Size;\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  \n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (extrude.xy * (newSize) + offsets);\n\n  offset = rotate_matrix(offset,rotation);\n\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec2 v_uv;// 本身的 uv 坐标\nin vec2 v_Iconuv;\nin float v_opacity;\nout vec4 outputColor;\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed: 0.0;\n  float u_raisingHeight: 0.0;\n  float u_size_unit;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  outputColor = texture(SAMPLER_2D(u_texture), pos);\n  outputColor.a *= v_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:vi,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:i1(this.mapService.version)}});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hL.Attribute,descriptor:{name:"a_Extrude",shaderLocation:pY.EXTRUDE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(pQ),v6=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"updateTexture",function(){var e=t.rendererService.createTexture2D;if(t.texture){t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){t.layerService.throttleRenderLayers()});return}t.texture=e({data:t.iconService.getCanvas(),mag:lq.LINEAR,min:lq.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})}),t}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){this.rendererService.getDirty()&&this.texture.bind();var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=t.heightfixed,r={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(void 0===e?0:e),u_heightfixed:Number(void 0!==n&&n),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nout vec4 v_color;\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_opacity = opacity;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nuniform sampler2D u_texture;\n\nin vec4 v_color;\nin vec2 v_uv;\nin float v_opacity;\n\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main(){\n  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n  vec4 textureColor;\n\n  // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n  \n  textureColor = texture(SAMPLER_2D(u_texture), pos);\n\n  // Tip: 去除边缘部分 mipmap 导致的混合变暗\n  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n  if(fragmengTocenter >= 0.5) {\n        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n        textureColor.a *= luma;\n  }\n  \n  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n        outputColor= textureColor;\n  }else {\n        outputColor= step(0.01, textureColor.z) * v_color;\n  }\n  outputColor.a *= v_opacity;\n  if (outputColor.a < 0.01) {\n      discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',triangulation:vs,inject:this.getInject(),depth:{enable:!1},primitive:lq.POINTS});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),o}(pQ);function v8(t){var e=t.coordinates;return{vertices:(0,i2.Z)(e),indices:[0],size:e.length}}var v9=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){return this.getUniformsBufferInfo({u_size_scale:.5})}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=v8,this.initUniformsBuffer(),t.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\n\nlayout(std140) uniform u_Common {\n  float u_size_scale;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);\n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;\n}\n',fragmentShader:"in vec4 v_color;\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n}",triangulation:v8,inject:this.getInject(),depth:{enable:!1},primitive:lq.POINTS,pick:!1});case 4:return e=t.sent,t.abrupt("return",[e]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(pQ),mt=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.blend,n=t.speed,r=t.unit,i={u_additive:"additive"===e?1:0,u_size_unit:p2[void 0===r?"pixel":r],u_speed:void 0===n?1:n,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(i)}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),vi)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 11) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniorm {\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\n\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\nout vec2 v_extrude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_extrude = rotateMatrix * a_Extrude.xy;\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1.) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  v_radius = newSize;\n\n  vec2 offset = (a_Extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n  offset = project_pixel(offset);\n  \n  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm{\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\nin vec4 v_data;\nin vec4 v_color;\nin float v_radius;\nin vec2 v_extrude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  outputColor = vec4(v_color.rgb, v_color.a);\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n  } else {\n    outputColor.a *= opacity_t;\n  }\n\n  if(outputColor.a > 0.0) {\n    outputColor = filterColor(outputColor);\n  }\n\n  vec2 extrude =  v_extrude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  outputColor.a *= radar_v;\n}\n',triangulation:vi,inject:this.getInject(),depth:{enable:!1}});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hL.Attribute,descriptor:{name:"a_Extrude",shaderLocation:pY.EXTRUDE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{shaderLocation:pY.SIZE,name:"a_Size",buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(pQ);function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var mn=function(){function t(e,n,r){(0,rK.Z)(this,t),(0,ac.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0}return(0,rX.Z)(t,[{key:"insert",value:function(t,e,n,r,i){this.forEachCell(e,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!1,i)}},{key:"hitTest",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!0,i)}},{key:"insertBoxCell",value:function(t,e,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}return this.forEachCell(t,e,n,r,this.queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a}},{key:"queryCell",value:function(t,e,n,r,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c){var l,f=this.bboxes,h=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(c);try{for(h.s();!(l=h.n()).done;){var p=l.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(t<=f[d+2]&&e<=f[d+3]&&n>=f[d+0]&&r>=f[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:f[d],y1:f[d+1],x2:f[d+2],y2:f[d+3]})}}}}catch(t){h.e(t)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(t,e,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(t),c=this.convertToYCellCoord(e),l=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),h=u;h<=l;h++)for(var p=c;p<=f;p++){var d=this.xCellCount*p+h;if(i.call(this,t,e,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),t}(),mr=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"viewportPadding",100),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new mn(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return(0,rX.Z)(t,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,r=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,n,r,i)||this.grid.hitTest(e,n,r,i)?{box:[]}:{box:[e,n,r,i]}}},{key:"insertCollisionBox",value:function(t,e){this.grid.insert({featureIndex:e},t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,n){var r=lk(e,n,0,1),i=lw();return lC(i,r,c_.apply(rP,(0,i2.Z)(t))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}}]),t}();function mi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return mo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mo(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function mo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ma(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:e,verticalAlign:n}}function ms(t,e,n,r,i){if(i){var o=t[r],a=o.glyph;if(a)for(var s=e[a].advance*o.scale,u=(t[r].x+s)*i,c=n;c<=r;c++)t[c].x-=u}}function mu(t,e,n,r,i,o,a){var s,u=(e-n)*i,c=(-r*a+.5)*o,l=mi(t);try{for(l.s();!(s=l.n()).done;){var f=s.value;f.x+=u,f.y+=c}}catch(t){l.e(t)}finally{l.f()}}function mc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var ml='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\n\nuniform sampler2D u_sdf_map;\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nin vec2 v_uv;\nin float v_gamma_scale;\nin vec4 v_color;\nin vec4 v_stroke_color;\nin float v_fontScale;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  outputColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (outputColor.a < 0.01) {\n    discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',mf='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in vec2 a_textOffsets;\nlayout(location = 14) in vec2 a_tex;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nout vec2 v_uv;\nout float v_gamma_scale;\nout vec4 v_color;\nout vec4 v_stroke_color;\nout float v_fontScale;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',mh=oD.isEqual;function mp(t){var e=t.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[e])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[e].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[e].glyphQuads.forEach(function(t,e){n.push.apply(n,(0,i2.Z)(o).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],(0,i2.Z)(o),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],(0,i2.Z)(o),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],(0,i2.Z)(o),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),r.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)}),{vertices:n,indices:r,size:7}}var md=function(t){(0,r$.Z)(s,t);var e,n,r,i,o,a=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(s);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function s(){var t;(0,rK.Z)(this,s);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"glyphInfoMap",{}),(0,ac.Z)((0,se.Z)(t),"currentZoom",-1),(0,ac.Z)((0,se.Z)(t),"textureHeight",0),(0,ac.Z)((0,se.Z)(t),"textCount",0),(0,ac.Z)((0,se.Z)(t),"preTextStyle",{}),(0,ac.Z)((0,se.Z)(t),"mapping",st(sr().mark(function e(){return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.initGlyph(),t.updateTexture(),e.next=4,t.reBuildModel();case 4:case"end":return e.stop()}},e)}))),t}return(0,rX.Z)(s,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.stroke,n=t.strokeWidth,r=t.halo,i=t.gamma,o=t.raisingHeight,a=this.getFontServiceMapping(),s=this.getFontServiceCanvas();a&&Object.keys(a).length!==this.textCount&&s&&(this.updateTexture(),this.textCount=Object.keys(a).length),this.preTextStyle=this.getTextStyle();var u={u_stroke_color:iH(void 0===e?"#fff":e),u_sdf_map_size:[(null==s?void 0:s.width)||1,(null==s?void 0:s.height)||1],u_raisingHeight:Number(void 0===o?0:o),u_stroke_width:void 0===n?0:n,u_gamma_scale:void 0===i?2:i,u_halo_blur:void 0===r?.5:r};return this.getUniformsBufferInfo(u)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 6:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0!==(e=this.layer.getLayerConfig().textAllowOverlap)&&e,this.initGlyph(),this.updateTexture(),n||this.filterGlyphs(),t.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:mf,fragmentShader:ml,inject:this.getInject(),triangulation:mp.bind(this),depth:{enable:!1}});case 6:return r=t.sent,t.abrupt("return",[r]);case 8:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(i=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=void 0!==(n=(e=this.getTextStyle()).textAllowOverlap)&&n,o=void 0===(i=e.textAnchor)?"center":i,a=e.textOffset,s=e.padding,u=e.fontFamily,c=e.fontWeight,!(!mh(s,this.preTextStyle.padding)||!mh(a,this.preTextStyle.textOffset)||!mh(o,this.preTextStyle.textAnchor)||!mh(u,this.preTextStyle.fontFamily)||!mh(c,this.preTextStyle.fontWeight))){t.next=5;break}return t.next=4,this.mapping();case 4:case 13:return t.abrupt("return",!0);case 5:if(!r){t.next=7;break}return t.abrupt("return",!1);case 7:if(l=this.mapService.getZoom(),f=this.mapService.getBounds(),h=aZ(this.extent,f),!(Math.abs(this.currentZoom-l)>.5||!h||r!==this.preTextStyle.textAllowOverlap)){t.next=14;break}return t.next=13,this.reBuildModel();case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:hL.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:hL.Attribute,descriptor:{name:"a_tex",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?12:e;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){return aL(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),e=t.fontWeight,n=t.fontFamily,r=this.rawEncodeData,i=[];r.forEach(function(t){var e,n=t.shape,r=void 0===n?"":n,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return mc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mc(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r=r.toString());try{for(o.s();!(e=o.n()).done;){var a=e.value;-1===i.indexOf(a)&&i.push(a)}}catch(t){o.e(t)}finally{o.f()}}),this.fontService.setFontOptions({characterSet:i,fontWeight:e,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),e=t.fontWeight,n=t.fontFamily,r=this.rawEncodeData,i=[];r.forEach(function(t){var e=t.shape,n=void 0===e?"":e;n="".concat(n),-1===i.indexOf(n)&&i.push(n)}),this.fontService.setFontOptions({characterSet:i,fontWeight:e,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=t.fontFamily,r=t.textAllowOverlap,i=t.padding,o=t.textAnchor,a=t.textOffset,s=t.opacity,u=t.strokeOpacity,c=t.strokeWidth,l=t.stroke;return{fontWeight:void 0===e?"400":e,fontFamily:void 0===n?"sans-serif":n,textAllowOverlap:void 0!==r&&r,padding:void 0===i?[0,0]:i,textAnchor:void 0===o?"center":o,textOffset:void 0===a?[0,0]:a,opacity:void 0===s?1:s,strokeOpacity:void 0===u?1:u,strokeWidth:void 0===c?0:c,stroke:void 0===l?"#000":l}}},{key:"generateGlyphLayout",value:function(t){var e=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,c=this.rawEncodeData;this.glyphInfo=c.map(function(r){var i=r.shape,a=r.id,c=r.size,l=r.textOffset?r.textOffset:u||[0,0],f=r.textAnchor?r.textAnchor:s||"center",h=function(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=t.split("\n"),c=[],l={positionedGlyphs:c,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:t};return s?function(t,e,n,r,i,o,a){var s=0,u=-8,c=0,l=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=l.length;n.forEach(function(t){var n=e[t];n&&(l.push({glyph:t,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),l.length!==h&&(c=Math.max(s-a,c),ms(l,e,h,l.length-1,f)),s=0,u-=r+5});var p=ma(i),d=p.horizontalAlign,v=p.verticalAlign;mu(l,f,d,v,c,r,n.length);var m=u- -8;t.top+=-v*m,t.bottom=t.top-m,t.left+=-d*c,t.right=t.left+c}(l,e,u,n,r,i,o):function(t,e,n,r,i,o,a){var s=0,u=-8,c=0,l=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=l.length;n.forEach(function(t){t.split("").forEach(function(t){var n=e[t];n&&(l.push({glyph:t,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)}),l.length!==h&&(c=Math.max(s-a,c),ms(l,e,h,l.length-1,f)),s=0,u-=r+5});var p=ma(i),d=p.horizontalAlign,v=p.verticalAlign;mu(l,f,d,v,c,r,n.length);var m=u- -8;t.top+=-v*m,t.bottom=t.top-m,t.left+=-d*c,t.right=t.left+c}(l,e,u,n,r,i,o),!!c.length&&l}((void 0===i?"":i).toString(),n,void 0===c?1:c,f,"left",o,l,t),p=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=t.positionedGlyphs,o=[],a=mi(void 0===i?[]:i);try{for(a.s();!(e=a.n()).done;){var s=e.value,u=s.metrics,c=u.advance*s.scale/2,l=r?[s.x+c,s.y]:[0,0],f=r?[0,0]:[s.x+c+n[0],s.y+n[1]],h=-4*s.scale-c+f[0],p=-4*s.scale+f[1],d=h+u.width*s.scale,v=p+u.height*s.scale,m={x:h,y:p},g={x:d,y:p},y={x:h,y:v},b={x:d,y:v};o.push({tl:m,tr:g,bl:y,br:b,tex:u,glyphOffset:l})}}catch(t){a.e(t)}finally{a.f()}return o}(h,l,!1);return r.shaping=h,r.glyphQuads=p,r.centroid=aj(r.coordinates),r.originCentroid="GAODE2.x"===r.version?aj(r.originCoordinates):r.originCentroid=r.centroid,e.glyphInfoMap[a]={shaping:h,glyphQuads:p,centroid:aj(r.coordinates)},r})}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=t.fontFamily;return this.fontService.getMappingByKey("".concat(void 0===n?"sans-serif":n,"_").concat(void 0===e?"400":e))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=t.fontFamily;return this.fontService.getCanvasByKey("".concat(void 0===n?"sans-serif":n,"_").concat(void 0===e?"400":e))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[0,0]:n,i=e.textAllowOverlap;if(void 0===i||!i){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=new mr(o.width,o.height);this.glyphInfo.filter(function(e){var n=e.shaping,i=e.id,o="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size/16,u=t.mapService.lngLatToContainer(o),c=a.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:u.x,anchorPointY:u.y}).box;return!!c&&!!c.length&&(a.insertCollisionBox(c,void 0===i?0:i),!0)}).forEach(function(e){t.glyphInfoMap[e.id]=e})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig().iconfont,e=void 0!==t&&t;e?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(e)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.getFontServiceCanvas();this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:lq.LINEAR,min:lq.LINEAR,width:e.width,height:e.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:(o=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.filterGlyphs(),t.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:mf,fragmentShader:ml,triangulation:mp.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:e=t.sent,this.layer.models=[e];case 5:case"end":return t.stop()}},t,this)})),function(){return o.apply(this,arguments)})}]),s}(pQ),mv={fillImage:v7,fill:v4,radar:mt,image:v6,normal:v9,simplePoint:v0,extrude:v5,text:md,earthFill:v3,earthExtrude:v2};function mm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var mg=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","PointLayer"),(0,ac.Z)((0,se.Z)(t),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,ac.Z)((0,se.Z)(t),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,ac.Z)((0,se.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),t}return(0,rX.Z)(o,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new mv[e](this),t.next=5,this.initLayerModels();case 5:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.buildModels();case 2:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,e=t.field,n=t.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(e&&(null==r?void 0:r.indexOf(e))!==-1)return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return mm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mm(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(t){a.e(t)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return({fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}})[this.getModelType()]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=e.billboard,o=this.iconService.getIconMap(),a=t.find(function(t){return t.hasOwnProperty("shape")});if(!a)return this.getModelTypeWillEmptyData();var s=a.shape;return"dot"===s?"normal":"simple"===s?"simplePoint":"radar"===s?"radar":"fillImage"===this.layerType||!1===(void 0===i||i)?"fillImage":(null==n?void 0:n.indexOf(s))!==-1?"GLOBEL"===this.mapService.version?"earthFill":"fill":(null==r?void 0:r.indexOf(s))!==-1?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":o.hasOwnProperty(s)?"image":"text"}}]),o}(pG);function mb(){return(mb=st(sr().mark(function t(e){var n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.createImageBitmap){t.next=14;break}return t.next=3,fetch(e);case 3:return n=t.sent,t.t0=createImageBitmap,t.next=7,n.blob();case 7:return t.t1=t.sent,t.next=10,(0,t.t0)(t.t1);case 10:return r=t.sent,t.abrupt("return",r);case 14:return i=new window.Image,t.abrupt("return",new Promise(function(t){i.onload=function(){return t(i)},i.src=e,i.crossOrigin="Anonymous"}));case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}var mx=function(t){(0,r$.Z)(a,t);var e,n,r,i,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(a);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function a(){return(0,rK.Z)(this,a),o.apply(this,arguments)}return(0,rX.Z)(a,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.mapTexture,n=t.heightfixed,r=t.raisingHeight,i=t.topsurface,o=t.sidesurface,a=t.sourceColor,s=t.targetColor,u=0,c=[1,1,1,1],l=[1,1,1,1];a&&s&&(c=iH(a),l=iH(s),u=1);var f={u_sourceColor:c,u_targetColor:l,u_linearColor:u,u_topsurface:Number(void 0===i||i),u_sidesurface:Number(void 0===o||o),u_heightfixed:Number(void 0!==n&&n),u_raisingHeight:Number(void 0===r?0:r)};return e&&this.texture&&(f.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(f)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadTexture();case 2:return t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.getShaders()).frag,r=e.vert,i=e.type,this.initUniformsBuffer(),t.next=4,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,depth:{enable:!0},inject:this.getInject(),triangulation:vd});case 4:return o=t.sent,t.abrupt("return",[o]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.pickLight;return t.mapTexture?{frag:'uniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));\n  // Tip: 部分机型 GPU 计算精度兼容\n  if (isSide < 0.999) {// 是否是边缘\n    // side face\n    if (u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if (u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      outputColor = v_Color;\n    }\n  } else {\n     // top face\n    if (u_topsurface < 1.0) {\n      discard;\n    }\n  }\n  \n  outputColor.a *= opacity;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec3 a_uvs;\n\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n   \n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:e?{frag:'\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      // side notuse linear\n       outputColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    outputColor = v_Color;\n  }\n\n  outputColor = filterColorAlpha(outputColor, lightWeight);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec3 a_uvs;\n\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'layout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    outputColor = v_Color;\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \nfloat isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=t,n=this.layer.coordCenter||this.layer.getSource().center,r=e[2]-e[0],i=e[3]-e[1];if("GAODE2.x"===this.mapService.version){var o=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],n),a=(0,i3.Z)(o,2),s=a[0],u=a[1],c=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],n),l=(0,i3.Z)(c,2),f=l[0],h=l[1];r=f-s,i=h-u,e=[s,u,f,h]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:hL.Attribute,descriptor:{name:"a_uvs",shaderLocation:pY.UV,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,n,o){var a=o[0],s=o[1];return[(a-e[0])/r,(s-e[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(i=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.layer.getLayerConfig().mapTexture,n=this.rendererService.createTexture2D,this.texture=n({height:1,width:1}),!e){t.next=8;break}return t.next=6,function(t){return mb.apply(this,arguments)}(e);case 6:r=t.sent,this.texture=n({data:r,width:r.width,height:r.height,wrapS:lq.CLAMP_TO_EDGE,wrapT:lq.CLAMP_TO_EDGE,min:lq.LINEAR,mag:lq.LINEAR});case 8:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})}]),a}(pQ),m_=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){return this.getUniformsBufferInfo({})}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.getShaders()).frag,r=e.vert,i=e.type,this.initUniformsBuffer(),t.next=4,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:vd,depth:{enable:!0}});case 4:return o=t.sent,t.abrupt("return",[o]);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n  outputColor = v_Color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);\n\n  vec4 project_pos = project_position(pos);\n   float lightWeight = calc_lighting(project_pos);\n  v_Color = a_Color;\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(pQ),mS=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=t.opacityLinear,r=void 0===n?{enable:!1,dir:"in"}:n,i={u_raisingHeight:Number(void 0===e?0:e),u_opacitylinear:Number(r.enable),u_dir:"in"===r.dir?1:0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.getModelParams()).frag,r=e.vert,i=e.triangulation,o=e.type,this.initUniformsBuffer(),this.layer.triangulation=i,t.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:lq.TRIANGLES,depth:{enable:!1}});case 5:return a=t.sent,t.abrupt("return",[a]);case 7:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:hL.Attribute,descriptor:{name:"a_linear",shaderLocation:pY.LINEAR,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig().opacityLinear;return(void 0===t?{enable:!1}:t).enable?{frag:'\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nin vec4 v_color;\nin vec3 v_linear;\nin vec2 v_pos;\nout vec4 outputColor;\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  if (u_opacitylinear > 0.0) {\n    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 15) in vec3 a_linear;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nout vec4 v_color;\nout vec3 v_linear;\nout vec2 v_pos;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  if (u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:vp}:{frag:'in vec4 v_color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n};\n\n\nout vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:uh}}}]),o}(pQ);oD.isNumber;var mw=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.watercolor,n=t.watercolor2,r={u_watercolor:iH(void 0===e?"#6D99A8":e),u_watercolor2:iH(void 0===n?"#0F121C":n),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(r)}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_uv;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\n\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_opacity = opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\nin vec2 v_uv;\nin float v_opacity;\nout vec4 outputColor;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n  outputColor = vec4(col, v_opacity);  \n}\n",inject:this.getInject(),triangulation:vh,primitive:lq.TRIANGLES,depth:{enable:!1}});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var t,e,n;null===(t=this.texture1)||void 0===t||t.destroy(),null===(e=this.texture2)||void 0===e||e.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,i3.Z)(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:hL.Attribute,descriptor:{name:"a_uv",shaderLocation:pY.UV,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,i,o){var u="GAODE2.x"===t.version?t.originCoordinates[0][o]:i,c=(0,i3.Z)(u,2);return[(c[0]-n)/a,(c[1]-r)/s]}}})}},{key:"loadTexture",value:function(){var t,e,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(t){return i({data:t,width:t.width,height:t.height,wrapS:lq.MIRRORED_REPEAT,wrapT:lq.MIRRORED_REPEAT,min:lq.LINEAR,mag:lq.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),t=function(t){r.texture1=a(t[0]),r.texture2=a(t[1]),r.texture3=a(t[2]),r.layerService.reRender()},e=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++e&&t(n)}})}}]),o}(pQ);oD.isNumber;var mk={fill:mS,line:vX,extrude:mx,text:md,point_fill:v4,point_image:v6,point_normal:v9,point_extrude:v5,water:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig().speed,e={u_speed:void 0===t?.5:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(e)}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 14) in vec2 a_uv;\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\nout vec4 v_Color;\nout vec2 v_uv;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\n\nout vec4 outputColor;\n\n\nin vec4 v_Color;\nin vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n\n  outputColor = v_Color;\n  float spc = calSpc();\n  outputColor += spc * 0.4;\n}\n",triangulation:vh,inject:this.getInject(),primitive:lq.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,i3.Z)(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:hL.Attribute,descriptor:{name:"a_uv",shaderLocation:pY.UV,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,i,o){var u="GAODE2.x"===t.version?t.originCoordinates[0][o]:i,c=(0,i3.Z)(u,2);return[(c[0]-n)/a,(c[1]-r)/s]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:1,width:1});var r=new Image;r.crossOrigin="",e?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=e):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:lq.MIRRORED_REPEAT,wrapT:lq.MIRRORED_REPEAT,min:lq.LINEAR,mag:lq.LINEAR}),t.layerService.reRender()}}}]),o}(pQ),ocean:mw,extrusion:m_},mC=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","PolygonLayer"),(0,ac.Z)((0,se.Z)(t),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new mk[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"!==n&&n?"extrude"===n?"extrude":"extrusion"===n?"extrusion":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find(function(t){return t.hasOwnProperty("shape")});if(!o)return"fill";var a=o.shape;return"dot"===a?"point_normal":(null==n?void 0:n.indexOf(a))!==-1?"point_fill":(null==r?void 0:r.indexOf(a))!==-1?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}}]),i}(pG),mE=function(t){(0,r$.Z)(a,t);var e,n,r,i,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(a);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function a(){return(0,rK.Z)(this,a),o.apply(this,arguments)}return(0,rX.Z)(a,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.clampLow,r=void 0===n||n,i=t.clampHigh,o=void 0===i||i,a=t.noDataValue,s=t.domain,u=t.rampColors,c=s||iJ(u);this.colorTexture=this.layer.textureService.getColorTexture(u,c);var l={u_domain:c,u_opacity:(void 0===e?1:e)||1,u_noDataValue:void 0===a?-9999999:a,u_clampLow:r?1:0,u_clampHigh:(void 0!==o?o:r)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(l)}},{key:"getRasterData",value:(n=st(sr().mark(function t(e){var n,r,i,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return t.abrupt("return",{data:e.data,width:e.width,height:e.height});case 4:return t.next=6,e.data;case 6:return r=(n=t.sent).rasterData,i=n.width,o=n.height,t.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return t.stop()}},t)})),function(t){return n.apply(this,arguments)})},{key:"initModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(i=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),e=this.layer.getSource(),r=(n=this.rendererService).createTexture2D,i=n.queryVerdorInfo,o=e.data.dataArray[0],t.next=6,this.getRasterData(o);case 6:return s=(a=t.sent).data,u=a.width,c=a.height,this.texture=r({data:new Float32Array(s),width:u,height:c,format:"WebGL1"===i()?lq.LUMINANCE:lq.RED,type:lq.FLOAT,alignment:1}),t.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nuniform sampler2D u_rasterTexture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\n\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\nout vec4 outputColor;\n\nvoid main() {\n  // Can use any component here since u_rasterTexture is under luminance format.\n  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value)) {\n    discard;\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n    discard;\n  } else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));\n    \n    outputColor = color;\n    outputColor.a = outputColor.a * u_opacity ;\n    if (outputColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:vm,primitive:lq.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return l=t.sent,t.abrupt("return",[l]);case 15:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{shaderLocation:pY.UV,name:"a_Uv",buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),a}(pQ),mA=["data"],mM=["rasterData"],mT={raster:mE,rasterRgb:function(t){(0,r$.Z)(a,t);var e,n,r,i,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(a);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function a(){var t;(0,rK.Z)(this,a);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"dataOption",{}),t}return(0,rX.Z)(a,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.noDataValue,r=this.dataOption,i=r.rMinMax,o=r.gMinMax,a=r.bMinMax,s={u_rminmax:void 0===i?[0,255]:i,u_gminmax:void 0===o?[0,255]:o,u_bminmax:void 0===a?[0,255]:a,u_opacity:(void 0===e?1:e)||1,u_noDataValue:void 0===n?0:n,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(s)}},{key:"getRasterData",value:(n=st(sr().mark(function t(e){var n,r,i,o,a;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return n=e.data,r=(0,lY.Z)(e,mA),this.dataOption=r,t.abrupt("return",(0,rW.Z)({data:n},r));case 4:return t.next=6,e.data;case 6:if(o=(i=t.sent).rasterData,a=(0,lY.Z)(i,mM),this.dataOption=a,!Array.isArray(o)){t.next=14;break}return t.abrupt("return",(0,rW.Z)({data:o},a));case 14:return t.abrupt("return",(0,rW.Z)({data:Array.from(o)},a));case 15:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"initModels",value:(r=st(sr().mark(function t(){var e,n,r,i,o,a,s,u;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),e=this.layer.getSource(),n=this.rendererService.createTexture2D,r=e.data.dataArray[0],t.next=6,this.getRasterData(r);case 6:return o=(i=t.sent).data,a=i.width,s=i.height,this.texture=n({data:new Float32Array(o),width:a,height:s,format:lq.RGB,type:lq.FLOAT}),t.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n vec2 u_rminmax;\n vec2 u_gminmax;\n vec2 u_bminmax;\n float u_opacity;\n float u_noDataValue;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n vec2 u_rminmax;\n vec2 u_gminmax;\n vec2 u_bminmax;\n float u_opacity;\n float u_noDataValue;\n};\n\nin vec2 v_texCoord;\n\nout vec4 outputColor;\n\nvoid main() {\n\n  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;\n\n  if(rgb == vec3(u_noDataValue)) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n\n  if(outputColor.a < 0.01)\n    discard;\n \n}",triangulation:vm,primitive:lq.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return u=t.sent,t.abrupt("return",[u]);case 15:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(i=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),a}(pQ),raster3d:mE,rasterTerrainRgb:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.clampLow,r=void 0===n||n,i=t.clampHigh,o=void 0===i||i,a=t.noDataValue,s=t.domain,u=t.rampColors,c=t.colorTexture,l=t.rScaler,f=t.gScaler,h=t.bScaler,p=t.offset,d=s||iJ(u),v=c;c?this.layer.textureService.setColorTexture(c,u,d):v=this.layer.textureService.getColorTexture(u,d);var m={u_unpack:[void 0===l?6553.6:l,void 0===f?25.6:f,void 0===h?.1:h,void 0===p?1e4:p],u_domain:d,u_opacity:e||1,u_noDataValue:void 0===a?-9999999:a,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_texture:this.texture,u_colorTexture:v};return this.textures=[this.texture,v],this.getUniformsBufferInfo(m)}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),e=this.layer.getSource(),n=this.rendererService.createTexture2D,t.next=5,e.data.images;case 5:return r=t.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:lq.LINEAR,mag:lq.LINEAR}),t.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n   vec4 u_unpack;\n   vec2 u_domain;\n   float u_opacity;\n   float u_noDataValue;\n   float u_clampLow;\n   float u_clampHigh;\n};\nout vec2 v_texCoord;\n#pragma include "projection"\n\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nlayout(std140) uniform commonUniforms {\n vec4 u_unpack;\n vec2 u_domain;\n float u_opacity;\n float u_noDataValue;\n float u_clampLow;\n float u_clampHigh;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return  texture(SAMPLER_2D(u_colorTexture), coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n     outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    outputColor = getColor(value);\n    outputColor.a =  outputColor.a * u_opacity ;\n      if(outputColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:vm,primitive:lq.TRIANGLES,depth:{enable:!1}});case 9:return i=t.sent,t.abrupt("return",[i]);case 11:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(pQ)},mL=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","RasterLayer"),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new mT[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return({raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}})[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}},{key:"getLegend",value:function(t){return"color"!==t?{type:void 0,field:void 0,items:[]}:vR(this.getLayerConfig().rampColors,t)}}]),i}(pG),mZ=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","TileDebugLayer"),(0,ac.Z)((0,se.Z)(t),"zIndex",1e4),(0,ac.Z)((0,se.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}},t)})),function(){return n.apply(this,arguments)})}]),i}(pG),mP=oD.isNumber,mO=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t,n={u_opacity:mP(e)?e:1};return this.getUniformsBufferInfo(n)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.zIndex=-997,t.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) vec4 a_Color;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\n#pragma include "scene_uniforms"\nout vec3 vVertexNormal;\nout vec4 v_Color;\nout float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\nin vec3 vVertexNormal;\nin float v_offset;\nin vec4 v_Color;\n\n#pragma include "scene_uniforms"\nout vec4 outputColor;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n',triangulation:vx,depth:{enable:!1},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(pQ),mR=function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"earthTime",3.4),(0,ac.Z)((0,se.Z)(t),"sunX",1e3),(0,ac.Z)((0,se.Z)(t),"sunY",1e3),(0,ac.Z)((0,se.Z)(t),"sunZ",1e3),(0,ac.Z)((0,se.Z)(t),"sunRadius",Math.sqrt(t.sunX*t.sunX+t.sunY*t.sunY+t.sunZ*t.sunZ)),t}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=t.globalOptions;null!=e&&e.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY));var r={u_sunLight:[this.sunX,this.sunY,this.sunZ,0],u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}},{key:"setEarthTime",value:function(t){this.earthTime=t,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r,i=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(null==(e=this.layer.getLayerConfig().globalOptions)?void 0:e.earthTime)!==void 0&&this.setEarthTime(e.earthTime),n=this.layer.getSource(),r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n.data.images.then(function(t){i.texture=r({data:t[0],width:t[0].width,height:t[0].height}),i.textures=[i.texture],i.layerService.reRender()}),this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.zIndex=-998,t.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:'// attribute vec4 a_Color;\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nlayout(std140) uniform commonUniforms {\n	vec4 u_sunLight: [1.0, -10.5, 12.0,0.0];\n	float u_ambientRatio : 0.5;\n	float u_diffuseRatio : 0.3;\n	float u_specularRatio : 0.2;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nout float v_lightWeight;\n\nfloat calc_lighting(vec4 pos) {\n\n	vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n	vec3 worldNormal = a_Normal;\n\n	// cal light weight\n	vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n	vec3 lightDir = normalize(u_sunLight.xyz);\n\n	vec3 halfDir = normalize(viewDir+lightDir);\n	// lambert\n	float lambert = dot(worldNormal, lightDir);\n	// specular\n	float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n	//sum to light weight\n	float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n	return lightWeight;\n}\n\nvoid main() {\n\n	v_texCoord = a_Uv;\n\n	float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n	v_lightWeight = lightWeight;\n\n	gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:"uniform sampler2D u_texture;\n\nin vec2 v_texCoord;\nin float v_lightWeight;\nout vec4 outputColor;\n\nvoid main() {\n    vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    outputColor = color;\n}\n",triangulation:vx,depth:{enable:!0},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(pQ),mI=oD.isNumber,mD={base:mR,atomSphere:mO,bloomSphere:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t,n={u_opacity:mI(e)?e:1};return this.getUniformsBufferInfo(n)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.zIndex=-999,t.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) vec4 a_Color;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\n#pragma include "scene_uniforms"\n\nout vec3 vVertexNormal;\nout vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:'\nin vec3 vVertexNormal;\nin vec4 v_Color;\n\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\nout vec4 outputColor;\n#pragma include "scene_uniforms"\nvoid main() {\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n',triangulation:v_,depth:{enable:!1},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hL.Attribute,descriptor:{name:"a_Size",shaderLocation:pY.SIZE,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hL.Attribute,descriptor:{name:"a_Normal",shaderLocation:pY.NORMAL,buffer:{usage:lq.STATIC_DRAW,data:[],type:lq.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",shaderLocation:pY.UV,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(pQ)},mN=["base","atomSphere","bloomSphere"],mz=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","EarthLayer"),(0,ac.Z)((0,se.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new mD[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"setEarthTime",value:function(t){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(t):console.warn("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"base";return 0>mN.indexOf(n)&&(n="base"),n}}]),i}(pG),mj={fill:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){return(0,rK.Z)(this,o),i.apply(this,arguments)}return(0,rX.Z)(o,[{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,rW.Z)((0,rW.Z)({},t.uniformsOption),e.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.color,r={u_color:iH(void 0===n?"#000":n),u_opacity:(void 0===e?1:e)||1};return this.getUniformsBufferInfo(r)}},{key:"initModels",value:(n=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(r=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.initUniformsBuffer(),t.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'layout(location = 0) in vec3 a_Position;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"layout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\nout vec4 outputColor;\n\nvoid main() {\n  outputColor = u_color;\n  outputColor.a *= u_opacity;\n}\n",triangulation:vh,depth:{enable:!1},pick:!1});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(pQ)},mB=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","MaskLayer"),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new mj[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),i}(pG);function mF(t,e,n){var r=mU(t,t.VERTEX_SHADER,e),i=mU(t,t.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=t.createProgram();if(!o)return null;if(t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))return console.warn("Failed to link program: "+t.getProgramInfoLog(o)),t.deleteProgram(o),t.deleteShader(i),t.deleteShader(r),null;for(var a=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),s=0;s<a;s++){var u=t.getActiveAttrib(o,s);o[u.name]=t.getAttribLocation(o,u.name)}for(var c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),l=0;l<c;l++){var f=t.getActiveUniform(o,l);o[f.name]=t.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function mU(t,e,n){var r=t.createShader(e);return null==r?(console.warn("unable to create shader"),null):(t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))?r:(console.warn("Failed to compile shader: "+t.getShaderInfoLog(r)),t.deleteShader(r),null)}function mV(t,e,n,r,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),o}function mH(t,e,n){t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e)}function mG(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n}function mW(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r.addColorStop(+a,t[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),e=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function mY(t,e,n,r){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,t.FLOAT,!1,0,0)}function mq(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,e),n&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}var mX=function(){function t(e){(0,rK.Z)(this,t),(0,ac.Z)(this,"width",512),(0,ac.Z)(this,"height",512),(0,ac.Z)(this,"numParticles",65536),this.gl=e.glContext,this.width=e.imageWidth,this.height=e.imageHeight,this.fadeOpacity=e.fadeOpacity,this.speedFactor=e.speedFactor,this.dropRate=e.dropRate,this.dropRateBump=e.dropRateBump,this.rampColors=e.rampColors,this.init()}return(0,rX.Z)(t,[{key:"init",value:function(){var t=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=mF(t,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=mF(t,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=mF(t,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=mG(t,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=t.createFramebuffer(),this.colorRampTexture=mV(this.gl,this.gl.LINEAR,mW(this.rampColors),16,16);var e=new Uint8Array(this.width*this.height*4);this.backgroundTexture=mV(t,t.NEAREST,e,this.width,this.height),this.screenTexture=mV(t,t.NEAREST,e,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=mV(t,t.NEAREST,r,n,n),this.particleStateTexture1=mV(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=mG(t,o)}},{key:"setWind",value:function(t){var e,n,r,i;this.windData=t,this.windTexture=(e=this.gl,n=this.gl.LINEAR,r=t.image,i=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),i)}},{key:"updateParticelNum",value:function(t){var e=this.gl;if(t!==this.numParticles){this.numParticles=t;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=mV(e,e.NEAREST,r,n,n),this.particleStateTexture1=mV(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=mG(e,o)}}},{key:"updateWindDir",value:function(t,e,n,r){this.windData.uMin=t,this.windData.uMax=e,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(t){if(this.isColorChanged(t)){this.rampColors=t;var e=this.gl;e.deleteTexture(this.colorRampTexture),this.colorRampTexture=mV(e,e.LINEAR,mW(t),16,16)}}},{key:"isColorChanged",value:function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var r=Number(e[n]);if(!this.rampColors[r]||this.rampColors[r]&&this.rampColors[r]!==t[r])return!0}return!1}},{key:"reSize",value:function(t,e){if(t!==this.width||e!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=t,this.height=e;var r=new Uint8Array(t*e*4);this.backgroundTexture=mV(n,n.NEAREST,r,t,e),this.screenTexture=mV(n,n.NEAREST,r,t,e)}}},{key:"draw",value:function(){if(null===(t=this.windData)||void 0===t||!t.image)return{d:new Uint8Array([0,0,0,0]),w:1,h:1};var t,e=this.gl;return mH(e,this.windTexture,0),mH(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}},{key:"drawScreen",value:function(){var t=this.gl;mq(t,this.framebuffer,this.screenTexture),t.viewport(0,0,this.width,this.height),t.disable(t.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.pixels),mq(t,null,null),t.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var e=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=e}},{key:"drawFullTexture",value:function(t,e){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),mH(n,t,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,e),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var t=this.gl,e=this.drawProgram;t.useProgram(e),mY(t,this.particleIndexBuffer,e.a_index,1),mH(t,this.colorRampTexture,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1i(e.u_color_ramp,2),t.uniform1f(e.u_particles_res,this.particleStateResolution),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.drawArrays(t.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var t=this.gl;mq(t,this.framebuffer,this.particleStateTexture1),t.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var e=this.updateProgram;t.useProgram(e),mY(t,this.quadBuffer,e.a_pos,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1f(e.u_rand_seed,Math.random()),t.uniform2f(e.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.uniform1f(e.u_speed_factor,this.speedFactor),t.uniform1f(e.u_drop_rate,this.dropRate),t.uniform1f(e.u_drop_rate_bump,this.dropRateBump),t.drawArrays(t.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,mq(t,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),t}(),mK={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},m$={wind:function(t){(0,r$.Z)(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(o);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function o(){var t;(0,rK.Z)(this,o);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"sizeScale",.5),(0,ac.Z)((0,se.Z)(t),"frequency",new af(7.2)),t}return(0,rX.Z)(o,[{key:"render",value:function(t){var e=this;this.drawColorMode(t),this.frequency.run(function(){e.drawWind()})}},{key:"getUninforms",value:function(){throw Error("Method not implemented.")}},{key:"initModels",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0===(n=(e=this.layer.getLayerConfig()).uMin)?-21.32:n,o=void 0===(i=e.uMax)?26.8:i,s=void 0===(a=e.vMin)?-21.57:a,c=void 0===(u=e.vMax)?21.42:u,f=void 0===(l=e.fadeOpacity)?.996:l,p=void 0===(h=e.speedFactor)?.25:h,v=void 0===(d=e.dropRate)?.003:d,g=void 0===(m=e.dropRateBump)?.01:m,b=void 0===(y=e.rampColors)?mK:y,_=void 0===(x=e.sizeScale)?.5:x,S=this.rendererService.createTexture2D,w=this.layer.getSource(),this.texture=S({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),k=this.rendererService.getGLContext(),this.imageCoords=null===(E=w.data)||void 0===E?void 0:E.dataArray[0].coordinates,null===(A=w.data)||void 0===A||null===(A=A.images)||void 0===A||A.then(function(t){M.sizeScale=_*M.getZoomScale();var e,n=M.getWindSize(),i=n.imageWidth,a=n.imageHeight,u={glContext:k,imageWidth:i,imageHeight:a,fadeOpacity:f,speedFactor:p,dropRate:v,dropRateBump:g,rampColors:b};M.wind=new mX(u),M.wind.setWind({uMin:r,uMax:o,vMin:s,vMax:c,image:t[0]}),null===(e=M.texture)||void 0===e||e.destroy(),M.texture=S({width:i,height:a}),M.layerService.reRender()}),t.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:vm,primitive:lq.TRIANGLES,depth:{enable:!1}});case 10:return C=t.sent,this.colorModel=C,t.abrupt("return",[C]);case 13:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getWindSize",value:function(){var t=this.mapService.lngLatToPixel(this.imageCoords[0]),e=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((e.x-t.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((t.y-e.y)*this.sizeScale),2048)}}},{key:"buildModels",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.wind)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hL.Attribute,descriptor:{name:"a_Uv",buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var t=this.layer.getLayerConfig(),e=t.uMin,n=t.uMax,r=t.vMin,i=t.vMax,o=t.numParticles,a=t.fadeOpacity,s=t.speedFactor,u=t.dropRate,c=t.dropRateBump,l=t.rampColors,f=t.sizeScale,h=void 0===f?.5:f,p=void 0===o?65535:o,d=Math.floor(this.mapService.getZoom());if("number"==typeof h&&h!==this.sizeScale||d!==this.cacheZoom){var v=this.getZoomScale();this.sizeScale=h,p*=v;var m=this.getWindSize(),g=m.imageWidth,y=m.imageHeight;this.wind.reSize(g,y),this.cacheZoom=d}this.wind.updateWindDir(void 0===e?-21.32:e,void 0===n?26.8:n,void 0===r?-21.57:r,void 0===i?21.42:i),this.wind.updateParticelNum(p),this.wind.updateColorRampTexture(void 0===l?mK:l),this.wind.fadeOpacity=void 0===a?.996:a,this.wind.speedFactor=void 0===s?.25:s,this.wind.dropRate=void 0===u?.003:u,this.wind.dropRateBump=void 0===c?.01:c;var b=this.wind.draw(),x=b.d,_=b.w,S=b.h;this.rendererService.setBaseState(),this.texture.update({data:x,width:_,height:S})}}},{key:"drawColorMode",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig().opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(e)}),this.layer.hooks.afterRender.call()}}]),o}(pQ)},mQ=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"type","WindLayer"),t}return(0,rX.Z)(i,[{key:"buildModels",value:(n=st(sr().mark(function t(){var e;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new m$[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(t),this}},{key:"getDefaultConfig",value:function(){return({wind:{}})[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),i}(pG),mJ=oD.cloneDeep,m0=(e8=(0,cn.b2)(),e9=(0,cn.f3)(ci.IMapService),nt=(0,cn.f3)(ci.IFontService),e8((nn=lS((ne=function(){function t(){(0,rK.Z)(this,t),l_(this,"mapService",nn,this),l_(this,"fontService",nr,this)}return(0,rX.Z)(t,[{key:"apply",value:function(t,e){var n,r=this,i=e.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",st(sr().mark(function e(){return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.log(hA.MappingStart,lv.INIT),r.generateMaping(t,{styleAttributeService:i}),t.log(hA.MappingEnd,lv.INIT);case 3:case"end":return e.stop()}},e)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",(n=st(sr().mark(function e(n){var o;return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",n);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(hA.MappingStart,lv.UPDATE),o=r.generateMaping(t,{styleAttributeService:i}),t.log(hA.MappingEnd,lv.UPDATE),e.abrupt("return",o);case 7:case"end":return e.stop()}},e)})),function(t){return n.apply(this,arguments)})),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var e=t.getSource();if(!t.layerModelNeedUpdate&&e&&e.inited){var n=i.getLayerStyleAttributes()||[],o=i.getLayerStyleAttribute("filter"),a=e.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=n.filter(function(t){return t.needRemapping}),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter(function(t){return r.applyAttributeMapping(o,t)[0]})),s.length){var c=r.mapping(t,s,u,t.getEncodedData());t.setEncodedData(c)}}}})}},{key:"generateMaping",value:function(t,e){var n=this,r=e.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter(function(t){return n.applyAttributeMapping(o,t)[0]})),s=t.processData(s);var u=this.mapping(t,i,s,void 0);return t.setEncodedData(u),t.emit("dataUpdate",null),!0}},{key:"mapping",value:function(t,e,n,r){var i=this,o=e.filter(function(t){return void 0!==t.scale}).filter(function(t){return"filter"!==t.name}),a=n.map(function(t,e){var n=r?r[e]:{},a=(0,rW.Z)({id:t._id,coordinates:t.coordinates},n);return o.forEach(function(e){var n=i.applyAttributeMapping(e,t);("color"===e.name||"stroke"===e.name)&&(n=n.map(function(t){return iH(t)})),a[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(a.shape=i.fontService.getIconFontKey(a[e.name]))}),a});return e.forEach(function(t){t.needRemapping=!1}),this.adjustData2Amap2Coordinates(a,t),this.adjustData2SimpleCoordinates(a),a}},{key:"adjustData2Amap2Coordinates",value:function(t,e){var n=this;if(t.length>0&&"GAODE2.x"===this.mapService.version){var r=e.coordCenter||e.getSource().center;t.filter(function(t){return!t.originCoordinates}).map(function(t){t.version="GAODE2.x",t.originCoordinates=mJ(t.coordinates),t.coordinates=n.mapService.coordToAMap2RelativeCoordinates(t.coordinates,r)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var e=this;t.length>0&&"SIMPLE"===this.mapService.version&&t.map(function(t){t.simpleCoordinate||(t.coordinates=e.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var e=this;if("number"==typeof t[0])return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map(function(t){var r=[];t.map(function(t){r.push(e.mapService.simpleMapCoord.unproject(t))}),n.push(r)}),n}var r=[];return t.map(function(t){r.push(e.mapService.simpleMapCoord.unproject(t))}),r}},{key:"applyAttributeMapping",value:function(t,e){if(!t.scale)return[];var n,r=(null==t||null===(n=t.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach(function(n){var r,o=n.field;(e.hasOwnProperty(o)||(null===(r=t.scale)||void 0===r?void 0:r.type)==="variable")&&i.push(e[o])}),t.mapping?t.mapping(i):[]}},{key:"getArrowPoints",value:function(t,e){var n=aO([e[0]-t[0],e[1]-t[1]]);return[t[0]+1e-4*n[0],t[1]+1e-4*n[1]]}}]),t}()).prototype,"mapService",[e9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nr=lS(ne.prototype,"fontService",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne))||ne),m1=(0,cn.b2)()(ni=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(ci.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",st(sr().mark(function n(){var r,i;return sr().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.log(hA.SourceInitStart,lv.INIT),(r=t.getSource())||(r=new pe((i=t.sourceOption||t.defaultSourceConfig).data,i.options),t.setSource(r)),!r.inited){n.next=8;break}e.updateClusterData(t),t.log(hA.SourceInitEnd,lv.INIT),n.next=10;break;case 8:return n.next=10,new Promise(function(n){r.on("update",function(r){"inited"===r.type&&(e.updateClusterData(t),t.log(hA.SourceInitEnd,lv.INIT)),n(null)})});case 10:case"end":return n.stop()}},n)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",st(sr().mark(function n(){var r,i,o;return sr().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.updateClusterData(t),i=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}},n)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var e=t.getSource(),n=e.cluster,r=e.clusterOptions.zoom,i=this.mapService.getZoom()-1,o=t.dataState.dataSourceNeedUpdate;return n&&o&&e.updateClusterData(Math.floor(i)),!!(n&&Math.abs(t.clusterZoom-i)>=1)&&((void 0===r?0:r)!==Math.floor(i)&&e.updateClusterData(Math.floor(i)),t.clusterZoom=i,!0)}}]),t}())||ni;function m2(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function m3(t){var e;return 1===t.length&&(e=t,t=function(t,n){return m2(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;0>t(e[o],n)?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}var m5=m3(m2),m4=m5.right;function m7(t,e){var n,r,i,o=t.length,a=-1;if(null==e){for(;++a<o;)if(null!=(n=t[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=e(t[a],a,t))&&n>=n)for(r=i=n;++a<o;)null!=(n=e(t[a],a,t))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}m5.left;var m6=Array.prototype;m6.slice,m6.map;var m8=Math.sqrt(50),m9=Math.sqrt(10),gt=Math.sqrt(2);function ge(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=gn(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),o=Array(i=Math.ceil((e=Math.floor(e/a))-t+1));++s<i;)o[s]=(t+s)*a;else for(o=Array(i=Math.ceil((t=Math.floor(t*a))-(e=Math.ceil(e*a))+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o}function gn(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=m8?10:o>=m9?5:o>=gt?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=m8?10:o>=m9?5:o>=gt?2:1)}function gr(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=m8?i*=10:o>=m9?i*=5:o>=gt&&(i*=2),e<t?-i:i}function gi(t){return null===t?NaN:+t}function go(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function ga(t){return function(){return t}}function gs(t,e){var n=e-t;return n?function(e){return t+e*n}:ga(isNaN(t)?e:t)}var gu=function t(e){var n,r=1==(n=+(n=e))?gs:function(t,e){var r,i,o;return e-t?(r=t,i=e,r=Math.pow(r,o=n),i=Math.pow(i,o)-r,o=1/o,function(t){return Math.pow(r+t*i,o)}):ga(isNaN(t)?e:t)};function i(t,e){var n=r((t=iR(t)).r,(e=iR(e)).r),i=r(t.g,e.g),o=r(t.b,e.b),a=gs(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1);function gc(t){return function(e){var n,r,i=e.length,o=Array(i),a=Array(i),s=Array(i);for(n=0;n<i;++n)r=iR(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var gl=gc(function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return go((n-r/e)*e,a,i,o,s)}});function gf(){}function gh(t,e){var n=new gf;if(t instanceof gf)t.each(function(t,e){n.set(e,t)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}function gp(){}gc(function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return go((n-r/e)*e,i,o,a,s)}}),gf.prototype=gh.prototype={constructor:gf,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,e){return this["$"+t]=e,this},remove:function(t){var e="$"+t;return e in this&&delete this[e]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)"$"===e[0]&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)"$"===e[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var e in this)"$"===e[0]&&t(this[e],e.slice(1),this)}};var gd=gh.prototype;gp.prototype=(function(t,e){var n=new gp;if(t instanceof gp)t.each(function(t){n.add(t)});else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}).prototype={constructor:gp,has:gd.has,add:function(t){return this["$"+(t+="")]=t,this},remove:gd.remove,clear:gd.clear,values:gd.keys,size:gd.size,empty:gd.empty,each:gd.each};var gv=Array.prototype,gm=gv.map,gg=gv.slice;function gy(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function gb(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t)}return this}var gx={name:"implicit"};function g_(){var t=gh(),e=[],n=[],r=gx;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==gx)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=gh();for(var r,o,a=-1,s=n.length;++a<s;)t.has(o=(r=n[a])+"")||t.set(o,e.push(r));return i},i.range=function(t){return arguments.length?(n=gg.call(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return g_(e,n).unknown(r)},gy.apply(i,arguments),i}function gS(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var gw=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gk=RegExp(gw.source,"g");function gC(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function gE(t){return+t}var gA=[0,1];function gM(t){return t}function gT(t,e){var n;return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n})}function gL(t){var e,n=t[0],r=t[t.length-1];return n>r&&(e=n,n=r,r=e),function(t){return Math.max(n,Math.min(r,t))}}function gZ(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=gT(i,r),o=n(a,o)):(r=gT(r,i),o=n(o,a)),function(t){return o(r(t))}}function gP(t,e,n){var r=Math.min(t.length,e.length)-1,i=Array(r),o=Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=gT(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=m4(t,e,1,r)-1;return o[n](i[n](e))}}function gO(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function gR(){var t,e,n,r,i,o,a=gA,s=gA,u=function t(e,n){var r,i,o=typeof n;return null==n||"boolean"===o?ga(n):("number"===o?gS:"string"===o?(i=iZ(n))?(n=i,gu):function(t,e){var n,r,i,o,a,s=gw.lastIndex=gk.lastIndex=0,u=-1,c=[],l=[];for(t+="",e+="";(i=gw.exec(t))&&(o=gk.exec(e));)(a=o.index)>s&&(a=e.slice(s,a),c[u]?c[u]+=a:c[++u]=a),(i=i[0])===(o=o[0])?c[u]?c[u]+=o:c[++u]=o:(c[++u]=null,l.push({i:u,x:gS(i,o)})),s=gk.lastIndex;return s<e.length&&(a=e.slice(s),c[u]?c[u]+=a:c[++u]=a),c.length<2?l[0]?(n=l[0].x,function(t){return n(t)+""}):(r=e,function(){return r}):(e=l.length,function(t){for(var n,r=0;r<e;++r)c[(n=l[r]).i]=n.x(t);return c.join("")})}:n instanceof iZ?gu:n instanceof Date?function(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}:(r=n,!ArrayBuffer.isView(r)||r instanceof DataView)?Array.isArray(n)?function(e,n){var r,i=n?n.length:0,o=e?Math.min(i,e.length):0,a=Array(o),s=Array(i);for(r=0;r<o;++r)a[r]=t(e[r],n[r]);for(;r<i;++r)s[r]=n[r];return function(t){for(r=0;r<o;++r)s[r]=a[r](t);return s}}:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?function(e,n){var r,i={},o={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===n||"object"!=typeof n)&&(n={}),n)r in e?i[r]=t(e[r],n[r]):o[r]=n[r];return function(t){for(r in i)o[r]=i[r](t);return o}}:gS:function(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}})(e,n)},c=gM;function l(){return r=Math.min(a.length,s.length)>2?gP:gZ,i=o=null,f}function f(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(c(e)))}return f.invert=function(n){return c(e((o||(o=r(s,a.map(t),gS)))(n)))},f.domain=function(t){return arguments.length?(a=gm.call(t,gE),c===gM||(c=gL(a)),l()):a.slice()},f.range=function(t){return arguments.length?(s=gg.call(t),l()):s.slice()},f.rangeRound=function(t){return s=gg.call(t),u=gC,l()},f.clamp=function(t){return arguments.length?(c=t?gL(a):gM,f):c!==gM},f.interpolate=function(t){return arguments.length?(u=t,l()):u},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,l()}}var gI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function gD(t){var e;if(!(e=gI.exec(t)))throw Error("invalid format: "+t);return new gN({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function gN(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function gz(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function gj(t){return(t=gz(Math.abs(t)))?t[1]:NaN}function gB(t,e){var n=gz(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+Array(i-r.length+2).join("0")}gD.prototype=gN.prototype,gN.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var gF={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return gB(100*t,e)},r:gB,s:function(t,e){var n=gz(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(no=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+Array(1-o).join("0")+gz(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function gU(t){return t}var gV=Array.prototype.map,gH=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function gG(t){var e=t.domain;return t.ticks=function(t){var n=e();return ge(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return function(t,e,n,r){var i,o,a=gr(t,e,n);switch((r=gD(null==r?",f":r)).type){case"s":var s=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(o=Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(gj(s)/3)))-gj(Math.abs(a))))||(r.precision=o),nu(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(o=Math.max(0,gj(Math.abs(Math.max(Math.abs(t),Math.abs(e)))-(i=Math.abs(i=a)))-gj(i))+1)||(r.precision=o-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(o=Math.max(0,-gj(Math.abs(a))))||(r.precision=o-("%"===r.type)*2)}return ns(r)}(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=gn(s,u,n))>0?r=gn(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=gn(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,e(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,e(i)),t},t}function gW(t,e){t=t.slice();var n,r=0,i=t.length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function gY(t){return Math.log(t)}function gq(t){return Math.exp(t)}function gX(t){return-Math.log(-t)}function gK(t){return-Math.exp(-t)}function g$(t){return isFinite(t)?+("1e"+t):t<0?0:t}function gQ(t){return function(e){return-t(-e)}}function gJ(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function g0(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function g1(t){return t<0?-t*t:t*t}ns=(na=function(t){var e,n,r,i=void 0===t.grouping||void 0===t.thousands?gU:(e=gV.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),o=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",s=void 0===t.decimal?".":t.decimal+"",u=void 0===t.numerals?gU:(r=gV.call(t.numerals,String),function(t){return t.replace(/[0-9]/g,function(t){return r[+t]})}),c=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",f=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=gD(t)).fill,n=t.align,r=t.sign,h=t.symbol,p=t.zero,d=t.width,v=t.comma,m=t.precision,g=t.trim,y=t.type;"n"===y?(v=!0,y="g"):gF[y]||(void 0===m&&(m=12),g=!0,y="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var b="$"===h?o:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?a:/[%p]/.test(y)?c:"",_=gF[y],S=/[defgprs%]/.test(y);function w(t){var o,a,c,h=b,w=x;if("c"===y)w=_(t)+w,t="";else{var k=(t=+t)<0||1/t<0;if(t=isNaN(t)?f:_(Math.abs(t),m),g&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),k&&0==+t&&"+"!==r&&(k=!1),h=(k?"("===r?r:l:"-"===r||"("===r?"":r)+h,w=("s"===y?gH[8+no/3]:"")+w+(k&&"("===r?")":""),S){for(o=-1,a=t.length;++o<a;)if(48>(c=t.charCodeAt(o))||c>57){w=(46===c?s+t.slice(o+1):t.slice(o))+w,t=t.slice(0,o);break}}}v&&!p&&(t=i(t,1/0));var C=h.length+t.length+w.length,E=C<d?Array(d-C+1).join(e):"";switch(v&&p&&(t=i(E+t,E.length?d-w.length:1/0),E=""),n){case"<":t=h+t+w+E;break;case"=":t=h+E+t+w;break;case"^":t=E.slice(0,C=E.length>>1)+h+t+w+E.slice(C);break;default:t=E+h+t+w}return u(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),w.toString=function(){return t+""},w}return{format:h,formatPrefix:function(t,e){var n=h(((t=gD(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(gj(e)/3))),i=Math.pow(10,-r),o=gH[8+r/3];return function(t){return n(i*t)+o}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"})).format,nu=na.formatPrefix;var g2=new Date,g3=new Date;function g5(t,e,n,r){function i(e){return t(e=0==arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r)||!(o>0))return s;do s.push(a=new Date(+n)),e(n,o),t(n);while(a<n&&n<r);return s},i.filter=function(n){return g5(function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},function(t,r){if(t>=t){if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}})},n&&(i.count=function(e,r){return g2.setTime(+e),g3.setTime(+r),t(g2),t(g3),Math.floor(n(g2,g3))},i.every=function(t){return isFinite(t=Math.floor(t))&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var g4=g5(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});g4.every=function(t){return isFinite(t=Math.floor(t))&&t>0?g5(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n*t)}):null},g4.range;var g7=g5(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12},function(t){return t.getMonth()});function g6(t){return g5(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5})}g7.range;var g8=g6(0),g9=g6(1),yt=g6(2),ye=g6(3),yn=g6(4),yr=g6(5),yi=g6(6);g8.range,g9.range,yt.range,ye.range,yn.range,yr.range,yi.range;var yo=g5(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/864e5},function(t){return t.getDate()-1});yo.range;var ya=g5(function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getHours()});ya.range;var ys=g5(function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())},function(t,e){t.setTime(+t+6e4*e)},function(t,e){return(e-t)/6e4},function(t){return t.getMinutes()});ys.range;var yu=g5(function(t){t.setTime(t-t.getMilliseconds())},function(t,e){t.setTime(+t+1e3*e)},function(t,e){return(e-t)/1e3},function(t){return t.getUTCSeconds()});yu.range;var yc=g5(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});function yl(t){return g5(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/6048e5})}yc.every=function(t){return isFinite(t=Math.floor(t))&&t>0?t>1?g5(function(e){e.setTime(Math.floor(e/t)*t)},function(e,n){e.setTime(+e+n*t)},function(e,n){return(n-e)/t}):yc:null},yc.range;var yf=yl(0),yh=yl(1),yp=yl(2),yd=yl(3),yv=yl(4),ym=yl(5),yg=yl(6);yf.range,yh.range,yp.range,yd.range,yv.range,ym.range,yg.range;var yy=g5(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/864e5},function(t){return t.getUTCDate()-1});yy.range;var yb=g5(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});function yx(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function y_(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function yS(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}yb.every=function(t){return isFinite(t=Math.floor(t))&&t>0?g5(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null},yb.range;var yw={"-":"",_:" ",0:"0"},yk=/^\s*\d+/,yC=/^%/,yE=/[\\^$*+?|[\]().{}]/g;function yA(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?Array(n-o+1).join(e)+i:i)}function yM(t){return t.replace(yE,"\\$&")}function yT(t){return RegExp("^(?:"+t.map(yM).join("|")+")","i")}function yL(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function yZ(t,e,n){var r=yk.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function yP(t,e,n){var r=yk.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function yO(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function yR(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function yI(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function yD(t,e,n){var r=yk.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function yN(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function yz(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function yj(t,e,n){var r=yk.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function yB(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function yF(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function yU(t,e,n){var r=yk.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function yV(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function yH(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function yG(t,e,n){var r=yk.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function yW(t,e,n){var r=yk.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function yY(t,e,n){var r=yk.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function yq(t,e,n){var r=yC.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function yX(t,e,n){var r=yk.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function yK(t,e,n){var r=yk.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function y$(t,e){return yA(t.getDate(),e,2)}function yQ(t,e){return yA(t.getHours(),e,2)}function yJ(t,e){return yA(t.getHours()%12||12,e,2)}function y0(t,e){return yA(1+yo.count(g4(t),t),e,3)}function y1(t,e){return yA(t.getMilliseconds(),e,3)}function y2(t,e){return y1(t,e)+"000"}function y3(t,e){return yA(t.getMonth()+1,e,2)}function y5(t,e){return yA(t.getMinutes(),e,2)}function y4(t,e){return yA(t.getSeconds(),e,2)}function y7(t){var e=t.getDay();return 0===e?7:e}function y6(t,e){return yA(g8.count(g4(t)-1,t),e,2)}function y8(t){var e=t.getDay();return e>=4||0===e?yn(t):yn.ceil(t)}function y9(t,e){return t=y8(t),yA(yn.count(g4(t),t)+(4===g4(t).getDay()),e,2)}function bt(t){return t.getDay()}function be(t,e){return yA(g9.count(g4(t)-1,t),e,2)}function bn(t,e){return yA(t.getFullYear()%100,e,2)}function br(t,e){return yA((t=y8(t)).getFullYear()%100,e,2)}function bi(t,e){return yA(t.getFullYear()%1e4,e,4)}function bo(t,e){var n=t.getDay();return yA((t=n>=4||0===n?yn(t):yn.ceil(t)).getFullYear()%1e4,e,4)}function ba(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+yA(e/60|0,"0",2)+yA(e%60,"0",2)}function bs(t,e){return yA(t.getUTCDate(),e,2)}function bu(t,e){return yA(t.getUTCHours(),e,2)}function bc(t,e){return yA(t.getUTCHours()%12||12,e,2)}function bl(t,e){return yA(1+yy.count(yb(t),t),e,3)}function bf(t,e){return yA(t.getUTCMilliseconds(),e,3)}function bh(t,e){return bf(t,e)+"000"}function bp(t,e){return yA(t.getUTCMonth()+1,e,2)}function bd(t,e){return yA(t.getUTCMinutes(),e,2)}function bv(t,e){return yA(t.getUTCSeconds(),e,2)}function bm(t){var e=t.getUTCDay();return 0===e?7:e}function bg(t,e){return yA(yf.count(yb(t)-1,t),e,2)}function by(t){var e=t.getUTCDay();return e>=4||0===e?yv(t):yv.ceil(t)}function bb(t,e){return t=by(t),yA(yv.count(yb(t),t)+(4===yb(t).getUTCDay()),e,2)}function bx(t){return t.getUTCDay()}function b_(t,e){return yA(yh.count(yb(t)-1,t),e,2)}function bS(t,e){return yA(t.getUTCFullYear()%100,e,2)}function bw(t,e){return yA((t=by(t)).getUTCFullYear()%100,e,2)}function bk(t,e){return yA(t.getUTCFullYear()%1e4,e,4)}function bC(t,e){var n=t.getUTCDay();return yA((t=n>=4||0===n?yv(t):yv.ceil(t)).getUTCFullYear()%1e4,e,4)}function bE(){return"+0000"}function bA(){return"%"}function bM(t){return+t}function bT(t){return Math.floor(+t/1e3)}function bL(t){return new Date(t)}function bZ(t){return t instanceof Date?+t:+new Date(+t)}function bP(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}nl=(nc=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,c=yT(i),l=yL(i),f=yT(o),h=yL(o),p=yT(a),d=yL(a),v=yT(s),m=yL(s),g=yT(u),y=yL(u),b={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:y$,e:y$,f:y2,g:br,G:bo,H:yQ,I:yJ,j:y0,L:y1,m:y3,M:y5,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:bM,s:bT,S:y4,u:y7,U:y6,V:y9,w:bt,W:be,x:null,X:null,y:bn,Y:bi,Z:ba,"%":bA},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:bs,e:bs,f:bh,g:bw,G:bC,H:bu,I:bc,j:bl,L:bf,m:bp,M:bd,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:bM,s:bT,S:bv,u:bm,U:bg,V:bb,w:bx,W:b_,x:null,X:null,y:bS,Y:bk,Z:bE,"%":bA},_={a:function(t,e,n){var r=p.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return k(t,e,n,r)},d:yF,e:yF,f:yY,g:yN,G:yD,H:yV,I:yV,j:yU,L:yW,m:yB,M:yH,p:function(t,e,n){var r=c.exec(e.slice(n));return r?(t.p=l[r[0].toLowerCase()],n+r[0].length):-1},q:yj,Q:yX,s:yK,S:yG,u:yP,U:yO,V:yR,w:yZ,W:yI,x:function(t,e,r){return k(t,n,e,r)},X:function(t,e,n){return k(t,r,e,n)},y:yN,Y:yD,Z:yz,"%":yq};function S(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,c=t.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=yw[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function w(t,e){return function(n){var r,i,o=yS(1900,void 0,1);if(k(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(!e||"Z"in o||(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(r=(i=(r=y_(yS(o.y,0,1))).getUTCDay())>4||0===i?yh.ceil(r):yh(r),r=yy.offset(r,(o.V-1)*7),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(r=(i=(r=yx(yS(o.y,0,1))).getDay())>4||0===i?g9.ceil(r):g9(r),r=yo.offset(r,(o.V-1)*7),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?y_(yS(o.y,0,1)).getUTCDay():yx(yS(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,y_(o)):yx(o)}}function k(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return -1;if(37===(i=e.charCodeAt(a++))){if(!(o=_[(i=e.charAt(a++))in yw?e.charAt(a++):i])||(r=o(t,n,r))<0)return -1}else if(i!=n.charCodeAt(r++))return -1}return r}return b.x=S(n,b),b.X=S(r,b),b.c=S(e,b),x.x=S(n,x),x.X=S(r,x),x.c=S(e,x),{format:function(t){var e=S(t+="",b);return e.toString=function(){return t},e},parse:function(t){var e=w(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=S(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=w(t+="",!0);return e.toString=function(){return t},e}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})).format,nc.parse,nc.utcFormat,nc.utcParse;var bO=oD.isNil,bR=oD.isString,bI=oD.uniq,bD=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,bN=(nf={},(0,ac.Z)(nf,hM.LINEAR,function t(){var e=gR()(gM,gM);return e.copy=function(){return gO(e,t())},gy.apply(e,arguments),gG(e)}),(0,ac.Z)(nf,hM.POWER,function t(){var e,n,r,i=(n=(e=gR())(gM,gM),r=1,n.exponent=function(t){return arguments.length?1==(r=+t)?e(gM,gM):.5===r?e(g0,g1):e(gJ(r),gJ(1/r)):r},gG(n));return i.copy=function(){return gO(i,t()).exponent(i.exponent())},gy.apply(i,arguments),i}),(0,ac.Z)(nf,hM.LOG,function t(){var e=(function(t){var e,n,r=t(gY,gq),i=r.domain,o=10;function a(){var a,s;return e=(a=o)===Math.E?Math.log:10===a&&Math.log10||2===a&&Math.log2||(a=Math.log(a),function(t){return Math.log(t)/a}),n=10===(s=o)?g$:s===Math.E?Math.exp:function(t){return Math.pow(s,t)},i()[0]<0?(e=gQ(e),n=gQ(n),t(gX,gK)):t(gY,gq),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(h=s,s=u,u=h);var c,l,f,h=e(s),p=e(u),d=null==t?10:+t,v=[];if(!(o%1)&&p-h<d){if(h=Math.round(h)-1,p=Math.round(p)+1,s>0){for(;h<p;++h)for(l=1,c=n(h);l<o;++l)if(!((f=c*l)<s)){if(f>u)break;v.push(f)}}else for(;h<p;++h)for(l=o-1,c=n(h);l>=1;--l)if(!((f=c*l)<s)){if(f>u)break;v.push(f)}}else v=ge(h,p,Math.min(p-h,d)).map(n);return r?v.reverse():v},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=ns(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(gW(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r})(gR()).domain([1,10]);return e.copy=function(){return gO(e,t()).base(e.base())},gy.apply(e,arguments),e}),(0,ac.Z)(nf,hM.IDENTITY,function t(e){var n,r=[];function i(t){return null==t?n:t}return i.invert=i,i.domain=i.range=function(t){return t?(r=t,t):r},i.unknown=function(t){return t?(n=t,t):n},i.copy=function(){return t(e).unknown(n)},i}),(0,ac.Z)(nf,hM.SEQUENTIAL,function t(){var e=gG((function(){var t,e,n,r,i,o=0,a=1,s=gM,u=!1;function c(e){return isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}return c.domain=function(i){return arguments.length?(t=r(o=+i[0]),e=r(a=+i[1]),n=t===e?0:1/(e-t),c):[o,a]},c.clamp=function(t){return arguments.length?(u=!!t,c):u},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.unknown=function(t){return arguments.length?(i=t,c):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),c}})()(gM));return e.copy=function(){return bP(e,t())},gb.apply(e,arguments)}),(0,ac.Z)(nf,hM.TIME,function(){return gy.apply((function t(e,n,r,i,o,a,s,u,c){var l=gR()(gM,gM),f=l.invert,h=l.domain,p=c(".%L"),d=c(":%S"),v=c("%I:%M"),m=c("%I %p"),g=c("%a %d"),y=c("%b %d"),b=c("%B"),x=c("%Y"),_=[[s,1,1e3],[s,5,5e3],[s,15,15e3],[s,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[o,1,36e5],[o,3,108e5],[o,6,216e5],[o,12,432e5],[i,1,864e5],[i,2,1728e5],[r,1,6048e5],[n,1,2592e6],[n,3,7776e6],[e,1,31536e6]];function S(t){return(s(t)<t?p:a(t)<t?d:o(t)<t?v:i(t)<t?m:n(t)<t?r(t)<t?g:y:e(t)<t?b:x)(t)}function w(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=m3(function(t){return t[2]}).right(_,o);a===_.length?(i=gr(n/31536e6,r/31536e6,t),t=e):a?(i=(a=_[o/_[a-1][2]<_[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(gr(n,r,t),1),t=u)}return null==i?t:t.every(i)}return l.invert=function(t){return new Date(f(t))},l.domain=function(t){return arguments.length?h(gm.call(t,bZ)):h().map(bL)},l.ticks=function(t,e){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=w(t,i,o,e))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(t,e){return null==e?S:c(e)},l.nice=function(t,e){var n=h();return(t=w(t,n[0],n[n.length-1],e))?h(gW(n,t)):l},l.copy=function(){return gO(l,t(e,n,r,i,o,a,s,u,c))},l})(g4,g7,g8,yo,ya,ys,yu,yc,nl).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),(0,ac.Z)(nf,hM.QUANTILE,function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=Array(e-1);++t<e;)i[t-1]=function(t,e,n){if(null==n&&(n=gi),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}(n,t/e);return a}function a(t){return isNaN(t=+t)?e:r[m4(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(var e,r=0,i=t.length;r<i;++r)null==(e=t[r])||isNaN(e=+e)||n.push(e);return n.sort(m2),o()},a.range=function(t){return arguments.length?(r=gg.call(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},gy.apply(a,arguments)}),(0,ac.Z)(nf,hM.QUANTIZE,function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return t<=t?a[m4(o,t,0,i)]:e}function u(){var t=-1;for(o=Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=gg.call(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length&&(e=t),s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},gy.apply(gG(s),arguments)}),(0,ac.Z)(nf,hM.THRESHOLD,function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return t<=t?r[m4(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(i=Math.min((n=gg.call(t)).length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=gg.call(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},gy.apply(o,arguments)}),(0,ac.Z)(nf,hM.CAT,g_),(0,ac.Z)(nf,hM.DIVERGING,function t(){var e=gG((function(){var t,e,n,r,i,o,a,s=0,u=.5,c=1,l=gM,f=!1;function h(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(t<e?r:i),l(f?Math.max(0,Math.min(1,t)):t))}return h.domain=function(a){return arguments.length?(t=o(s=+a[0]),e=o(u=+a[1]),n=o(c=+a[2]),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),h):[s,u,c]},h.clamp=function(t){return arguments.length?(f=!!t,h):f},h.interpolator=function(t){return arguments.length?(l=t,h):l},h.unknown=function(t){return arguments.length?(a=t,h):a},function(a){return o=a,t=a(s),e=a(u),n=a(c),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),h}})()(gM));return e.copy=function(){return bP(e,t())},gb.apply(e,arguments)}),nf),bz=(0,cn.b2)()(nh=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"scaleOptions",{})}return(0,rX.Z)(t,[{key:"apply",value:function(t,e){var n,r=this,i=e.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",st(sr().mark(function e(){var n,o,a;return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.log(hA.ScaleInitStart,lv.INIT),r.scaleOptions=t.getScaleOptions(),o=i.getLayerStyleAttributes(),!(Array.isArray(a=null===(n=t.getSource())||void 0===n?void 0:n.data.dataArray)&&0===a.length)){e.next=8;break}return e.abrupt("return");case 8:r.caculateScalesForAttributes(o||[],a);case 9:t.log(hA.ScaleInitEnd,lv.INIT);case 10:case"end":return e.stop()}},e)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",(n=st(sr().mark(function e(n){var o,a;return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",n);case 2:if(t.log(hA.ScaleInitStart,lv.UPDATE),r.scaleOptions=t.getScaleOptions(),o=i.getLayerStyleAttributes(),!(Array.isArray(a=t.getSource().data.dataArray)&&0===a.length)){e.next=8;break}return e.abrupt("return",!0);case 8:return r.caculateScalesForAttributes(o||[],a),t.log(hA.ScaleInitEnd,lv.UPDATE),t.layerModelNeedUpdate=!0,e.abrupt("return",!0);case 12:case"end":return e.stop()}},e)})),function(t){return n.apply(this,arguments)})),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var e=i.getLayerStyleAttributes(),n=t.getSource().data.dataArray;if((!Array.isArray(n)||0!==n.length)&&e){var o=e.filter(function(t){return t.needRescale});o.length&&r.caculateScalesForAttributes(o,n)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var n=this;t.forEach(function(t){if(t.scale){var r=t.scale,i=t.scale.field;r.names=n.parseFields(bO(i)?[]:i);var o=[];r.names.forEach(function(r){var i;o.push(n.createScale(r,t.name,null===(i=t.scale)||void 0===i?void 0:i.values,e))}),o.some(function(t){return t.type===hT.VARIABLE})?(r.type=hT.VARIABLE,o.forEach(function(t){if(!r.callback&&"text"!==r.values)switch(null===(e=t.option)||void 0===e?void 0:e.type){case hM.LOG:case hM.LINEAR:case hM.POWER:if(r.values&&r.values.length>2){var e,n,i=t.scale.ticks(r.values.length);t.scale.domain(i)}r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case hM.QUANTILE:case hM.QUANTIZE:case hM.THRESHOLD:t.scale.range(r.values);break;case hM.IDENTITY:break;case hM.CAT:r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case hM.DIVERGING:case hM.SEQUENTIAL:t.scale.interpolator(gl(r.values))}"text"===r.values&&t.scale.range(null===(n=t.option)||void 0===n?void 0:n.domain)})):(r.type=hT.CONSTANT,r.defaultValues=o.map(function(t,e){return t.scale(r.names[e])})),r.scalers=o.map(function(t){return{field:t.field,func:t.scale,option:t.option}}),t.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:bR(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,n,r){var i,o,a=this.scaleOptions[e]&&(null===(i=this.scaleOptions[e])||void 0===i?void 0:i.field)===t?this.scaleOptions[e]:this.scaleOptions[t],s={field:t,scale:void 0,type:hT.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=g_([t]),s.type=hT.CONSTANT),s;var u=null===(o=r.find(function(e){return!bO(e[t])}))||void 0===o?void 0:o[t];if(this.isNumber(t)||bO(u)&&!a)s.scale=g_([t]),s.type=hT.CONSTANT;else{var c=a&&a.type||this.getDefaultType(u);"text"===n&&(c=hM.CAT),void 0===n&&(c=hM.IDENTITY);var l=this.createScaleConfig(c,t,a,r);s.scale=this.createDefaultScale(l),s.option=l}return s}},{key:"getDefaultType",value:function(t){var e=hM.LINEAR;return"string"==typeof t&&(e=bD.test(t)?hM.TIME:hM.CAT),e}},{key:"createScaleConfig",value:function(t,e,n,r){var i={type:t},o=[];if(t===hM.QUANTILE){var a=new Map;null==r||r.forEach(function(t){a.set(t._id,t[e])}),o=Array.from(a.values())}else o=(null==r?void 0:r.map(function(t){return t[e]}))||[];if(null!=n&&n.domain)i.domain=null==n?void 0:n.domain;else if(t===hM.CAT||t===hM.IDENTITY)i.domain=bI(o);else if(t===hM.QUANTILE)i.domain=o;else if(t===hM.DIVERGING){var s=m7(o),u=(null==n?void 0:n.neutral)!==void 0?null==n?void 0:n.neutral:(s[0]+s[1])/2;i.domain=[s[0],u,s[1]]}else i.domain=m7(o);return(0,rW.Z)((0,rW.Z)({},i),n)}},{key:"createDefaultScale",value:function(t){var e=t.type,n=t.domain,r=t.unknown,i=t.clamp,o=t.nice,a=bN[e]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),t}())||nh,bj=(0,cn.b2)()(np=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.animateStatus&&t.models.forEach(function(e){e.addUniforms((0,rW.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),t}())||np,bB=(0,cn.b2)()(nd=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var e,n=t.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!t.tileLayer&&r&&r.length>0&&((e=t.masks).push.apply(e,(0,i2.Z)(r)),t.updateLayerConfig({mask:i}))})}}]),t}())||nd,bF=function(){var t;function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;(0,rK.Z)(this,e),(0,ac.Z)(this,"tileResource",new Map),(0,ac.Z)(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}return(0,rX.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(e){return e.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(e){return e.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(e){return e.isLoaded&&e.visible&&e.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var e=this.layerTiles.findIndex(function(e){return e.key===t}),n=this.layerTiles.splice(e,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(t){var e=this.getTile(t.key);if(t.isVisible){if(t.parent){var n=this.isChildrenLoaded(t.parent);null==e||e.updateVisible(n)}else null==e||e.updateVisible(!0)}else if(t.parent){var r=this.isChildrenLoaded(t.parent);null==e||e.updateVisible(!r)}else null==e||e.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var e=t.parent;if(!e)return!0;var n=this.getTile(null==e?void 0:e.key);return null!=n&&!!n.isLoaded}},{key:"isChildrenLoaded",value:function(t){var e=this,n=null==t?void 0:t.children;return 0===n.length||n.every(function(t){var n=e.getTile(null==t?void 0:t.key);return!n||(null==n?void 0:n.isLoaded)===!0})}},{key:"render",value:(t=st(sr().mark(function t(){var e,n=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getRenderLayers().map(function(){var t=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.layerService.renderTileLayer(e);case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),t.next=4,Promise.all(e);case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(t){return t.visible&&t.isLoaded}),e=[];return t.map(function(t){return e.push.apply(e,(0,i2.Z)(t.getLayers()))}),e}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(t){return t.isLoaded}),e=[];return t.map(function(t){return e.push.apply(e,(0,i2.Z)(t.getLayers()))}),e}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),bU=n(46362),bV=function(t,e,n){void 0===n&&(n={});var r=(0,rY.wA)(t),i=(0,rY.wA)(e),o=bU.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?(0,ap.yu)(o[0],n.properties):(0,ap.tw)(o,n.properties)},bH=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"getCombineFeature",value:function(t){var e=null,n=t[0];return t.map(function(t){var n=ap.yu(t.coordinates);e=null===e?n:bV(e,n)}),n&&(e.properties=(0,rW.Z)({},n)),e}}]),t}(),bG="select",bW="active",bY=function(){var t;function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;(0,rK.Z)(this,e),(0,ac.Z)(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new bH}return(0,rX.Z)(e,[{key:"pickRender",value:function(t){var e=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e){var n=e.getMainLayer();null==n||n.layerPickService.pickRender(t)}}},{key:"pick",value:(t=st(sr().mark(function t(e,n){var r,i,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.parent.getContainer().get(ci.IPickingService),"RasterLayer"!==e.type){t.next=8;break}if(!((i=this.tileLayerService.getVisibleTileBylngLat(n.lngLat))&&void 0!==i.getMainLayer())){t.next=7;break}return o=i.getMainLayer(),t.abrupt("return",o.layerPickService.pickRasterLayer(o,n,this.parent));case 7:return t.abrupt("return",!1);case 8:return this.pickRender(n),t.abrupt("return",r.pickFromPickingFBO(e,n));case 10:case"end":return t.stop()}},t,this)})),function(e,n){return t.apply(this,arguments)})},{key:"selectFeature",value:function(t){var e=(0,i3.Z)(t,3),n=e[0],r=e[1],i=e[2],o=this.color2PickId(n,r,i);this.tilePickID.set(bG,o),this.updateHighLight(n,r,i,bG)}},{key:"highlightPickedFeature",value:function(t){var e=(0,i3.Z)(t,3),n=e[0],r=e[1],i=e[2],o=this.color2PickId(n,r,i);this.tilePickID.set(bW,o),this.updateHighLight(n,r,i,bW)}},{key:"updateHighLight",value:function(t,e,n,r){this.tileLayerService.tiles.map(function(i){var o=i.getMainLayer();switch(r){case bG:null==o||o.hooks.beforeSelect.call([t,e,n]);break;case bW:null==o||o.hooks.beforeHighlight.call([t,e,n])}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(bG),e=this.tilePickID.get(bW);if(t){var n=this.pickId2Color(t),r=(0,i3.Z)(n,3),i=r[0],o=r[1],a=r[2];this.updateHighLight(i,o,a,bG);return}if(e){var s=this.pickId2Color(e),u=(0,i3.Z)(s,3),c=u[0],l=u[1],f=u[2];this.updateHighLight(c,l,f,bW);return}}},{key:"color2PickId",value:function(t,e,n){return iG(new Uint8Array([t,e,n]))}},{key:"pickId2Color",value:function(t){return iW(t)}},{key:"getFeatureById",value:function(t){var e=this.tileLayerService.getTiles().filter(function(t){return t.visible}),n=[];return e.forEach(function(e){n.push.apply(n,(0,i2.Z)(e.getFeatureById(t)))}),n}},{key:"pickRasterLayer",value:function(t,e,n){return!1}}]),e}(),bq=function(t){(0,r$.Z)(a,t);var e,n,r,i,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(a);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function a(t,e){var n;return(0,rK.Z)(this,a),n=o.call(this),(0,ac.Z)((0,se.Z)(n),"visible",!0),(0,ac.Z)((0,se.Z)(n),"layers",[]),(0,ac.Z)((0,se.Z)(n),"isLoaded",!1),(0,ac.Z)((0,se.Z)(n),"tileMaskLayers",[]),n.parent=e,n.sourceTile=t,n.x=t.x,n.y=t.y,n.z=t.z,n.key="".concat(n.x,"_").concat(n.y,"_").concat(n.z),n}return(0,rX.Z)(a,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var e=(0,i3.Z)(this.sourceTile.bounds,4),n=e[0],r=e[1],i=e[2],o=e[3],a=t.lng,s=t.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var t,e=this.parent.getLayerConfig();return(0,rW.Z)((0,rW.Z)({},e),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:-1!==["PolygonLayer","LineLayer"].indexOf(this.parent.type),mask:e.mask||(null===(t=e.maskLayers)||void 0===t?void 0:t.length)!==0&&e.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,e=this.parent.getLayerConfig().maskLayers,n=[];return null==e||e.forEach(function(e){if(!e.tileLayer)return n.push(e),e;var r=e.tileLayer.getTile(t.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)}),n}},{key:"addTileMask",value:(n=st(sr().mark(function t(){var e,n,r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new mC({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),n=h_(this.parent.sceneContainer),e.setContainer(n,this.parent.sceneContainer),t.next=5,e.init();case 5:return this.tileMask=e,void 0!==(r=this.getMainLayer())&&(r.tileMask=e),t.abrupt("return",e);case 9:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"addMask",value:(r=st(sr().mark(function t(e,n){var r;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=h_(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),t.next=4,n.init();case 4:e.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"addLayer",value:(i=st(sr().mark(function t(e){var n;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.isTileLayer=!0,n=h_(this.parent.sceneContainer),e.setContainer(n,this.parent.sceneContainer),this.layers.push(e),t.next=6,e.init();case 6:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,e){this.layers.forEach(function(n){n.updateLayerConfig((0,ac.Z)({},t,e))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;null===(t=this.tileMask)||void 0===t||t.destroy(),this.layers.forEach(function(t){return t.destroy()})}}]),a}(so.EventEmitter),bX=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.getSourceOption()).data.features[0].properties,r=new vQ().source(e.data,e.options).size(1).shape("line").color("red"),i=new mg({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),t.next=6,this.addLayer(r);case 6:return t.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),i}(bq),bK=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new vN((0,rW.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach(function(t){var n,r;i[t](null===(n=e[t])||void 0===n?void 0:n.field,null===(r=e[t])||void 0===r?void 0:r.values)}),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),i}(bq),b$=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new mB((0,rW.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach(function(t){var n,r;i[t](null===(n=e[t])||void 0===n?void 0:n.field,null===(r=e[t])||void 0===r?void 0:r.values)}),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getFeatures",value:function(t){return t?this.sourceTile.data.getTileData(t):[]}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.parent.getLayerConfig(),n=e.sourceLayer,r=e.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:t.transforms}}}}]),i}(bq),bQ=["rasterData"],bJ=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new mL((0,rW.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach(function(t){var n,r;i[t](null===(n=e[t])||void 0===n?void 0:n.field,null===(r=e[t])||void 0===r?void 0:r.values)}),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.data,n=e.rasterData,r=(0,lY.Z)(e,bQ);return{data:n,options:{parser:(0,rW.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:t.transforms}}}}]),i}(bq),b0=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new mL((0,rW.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach(function(t){var n,r;i[t](null===(n=e[t])||void 0===n?void 0:n.field,null===(r=e[t])||void 0===r?void 0:r.values)}),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),i}(bq),b1=["rasterData"],b2={positions:[0,1],colors:["#000","#fff"]},b3=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=(i=this.getLayerOptions()).rampColors,a=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,a),s=new mL((0,rW.Z)((0,rW.Z)({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),e&&Object.keys(e).forEach(function(t){var n,r;s[t](null===(n=e[t])||void 0===n?void 0:n.field,null===(r=e[t])||void 0===r?void 0:r.values)}),t.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.data,n=e.rasterData,r=(0,lY.Z)(e,b1);return{data:n,options:{parser:(0,rW.Z)({type:"raster",extent:this.sourceTile.bounds},r),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.rampColors,o=void 0===i?b2:i,a=n.domain;this.colorTexture=this.parent.textureService.getColorTexture(o,a||iJ(o)),this.layers.forEach(function(e){return e.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),i}(bq),b5=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){return(0,rK.Z)(this,i),r.apply(this,arguments)}return(0,rX.Z)(i,[{key:"initTileLayer",value:(n=st(sr().mark(function t(){var e,n,r,i,o;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:var a;if(e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r="PolygonLayer"===(a=this.parent.type)?mC:"LineLayer"===a?vQ:mg,i=this.getSourceOption()){t.next=8;break}return this.isLoaded=!0,this.emit("loaded"),t.abrupt("return");case 8:return o=new r((0,rW.Z)({},n)).source(i.data,i.options),Object.keys(e).forEach(function(t){var n,r;o[t](null===(n=e[t])||void 0===n?void 0:n.field,null===(r=e[t])||void 0===r?void 0:r.values)}),t.next=12,this.addLayer(o);case 12:if(!n.tileMask){t.next=15;break}return t.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(o),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.parent.getLayerConfig(),n=e.sourceLayer,r=e.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(void 0===n?"defaultLayer":n)},options:{parser:{type:"geojson",featureId:void 0===r?"id":r},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){"text"===t.getModelType()&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){return this.sourceTile.data.getTileData(t)}},{key:"getFeatureById",value:function(t){var e=this.getMainLayer();return e?e.getSource().data.dataArray.filter(function(e){return e._id===t}):[]}}]),i}(bq),b4=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],b7=oD.debounce,b6=function(){var t;function e(t){var n=this;(0,rK.Z)(this,e),(0,ac.Z)(this,"initedTileset",!1),(0,ac.Z)(this,"mapchange",function(){if(!1!==n.parent.isVisible()){var t,e=n.getCurrentView(),r=e.latLonBounds,i=e.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(t=n.tilesetManager)||void 0===t||t.throttleUpdate(i,r))}}),(0,ac.Z)(this,"viewchange",b7(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.get(ci.IRendererService),this.layerService=r.get(ci.ILayerService),this.mapService=r.get(ci.IMapService),this.pickingService=r.get(ci.IPickingService),this.tileLayerService=new bF({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new bY({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}return(0,rX.Z)(e,[{key:"initTileSetManager",value:function(){var t,e=this.parent.getSource();if(this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),!1!==this.parent.isVisible()){var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(i,r)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds();return{latLonBounds:[t[0][0],t[0][1],t[1][0],t[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(t){}),this.tilesetManager.on("tile-unload",function(e){t.tileUnLoad(e)}),this.tilesetManager.on("tile-error",function(e,n){t.tileError(e)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(t=this.tilesetManager)||void 0===t||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){this.tilesetManager.clear();var t,e=this.getCurrentView(),n=e.latLonBounds,r=e.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(r,n)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:(t=st(sr().mark(function t(){var e,n,r,i=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.tilesetManager){t.next=2;break}return t.abrupt("return");case 2:return e=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),r=this.tilesetManager.tiles.filter(function(t){return t.isLoaded}).filter(function(t){return t.isVisibleChange}).filter(function(t){return t.data}).filter(function(t){return t.z>=e&&t.z<n}),t.next=7,Promise.all(r.map(function(){var t=st(sr().mark(function t(e){var n;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i.tileLayerService.hasTile(e.key)){t.next=9;break}return n=new(function(t){switch(t.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return b5;case"TileDebugLayer":return bX;case"MaskLayer":return b$;case"RasterLayer":switch(t.getSource().parser.dataType){case hO.RGB:case hO.CUSTOMRGB:return bJ;case hO.ARRAYBUFFER:case hO.CUSTOMARRAYBUFFER:return b3;case hO.TERRAINRGB:case hO.CUSTOMTERRAINRGB:return b0;default:return bK}default:return b5}}(i.parent))(e,i.parent),t.next=5,n.initTileLayer();case 5:i.tilePickService.setPickState(),0!==n.getLayers().length&&(i.tileLayerService.addTile(n),i.tileLayerService.updateTileVisible(e),i.layerService.reRender()),t.next=12;break;case 9:i.tileLayerService.updateTileVisible(e),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 7:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 8:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var e=this;b4.forEach(function(n){var r=t[n].bind(t);t[n]=function(){for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),e.getLayers().map(function(t){t[n].apply(t,o)}),"style"===n&&e.getTiles().forEach(function(t){return t.styleUpdate.apply(t,o)}),t}})}}]),e}(),b8=(0,cn.b2)()(nv=function(){var t,e,n;function r(){(0,rK.Z)(this,r)}return(0,rX.Z)(r,[{key:"build",value:(t=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.prepareBuildModel(),t.next=3,e.buildModels();case 3:case"end":return t.stop()}},t)})),function(e){return t.apply(this,arguments)})},{key:"initLayerModel",value:(e=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"prepareLayerModel",value:(n=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"apply",value:function(t){var e,n=this;t.hooks.init.tapPromise("LayerModelPlugin",st(sr().mark(function e(){return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.getSource().isTile){e.next=4;break}return t.prepareBuildModel(),t.tileLayer=new b6(t),e.abrupt("return");case 4:return t.log(hA.BuildModelStart,lv.INIT),e.next=7,n.initLayerModel(t);case 7:t.log(hA.BuildModelEnd,lv.INIT);case 8:case"end":return e.stop()}},e)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",(e=st(sr().mark(function e(r){return sr().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",!1);case 2:if(!t.getSource().isTile){e.next=5;break}return t.tileLayer=new b6(t),e.abrupt("return",!1);case 5:return t.log(hA.BuildModelStart,lv.UPDATE),e.next=8,n.prepareLayerModel(t);case 8:return t.log(hA.BuildModelEnd,lv.UPDATE),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}))}}]),r}())||nv,b9=(0,cn.b2)()(nm=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&t.fitBounds(r),t.styleNeedUpdate=!1})}}]),t}())||nm,xt=["type"],xe={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},xn={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},xr={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},xi={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},xo=(0,cn.b2)()(ng=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){t.getLayerConfig().enableLighting&&t.models.forEach(function(t){var e,n;return t.addUniforms((0,rW.Z)({},(n={u_DirectionalLights:[,,,].fill((0,rW.Z)({},xr)),u_NumOfDirectionalLights:0,u_SpotLights:[,,,].fill((0,rW.Z)({},xi)),u_NumOfSpotLights:0},e&&e.length||(e=[xn]),e.forEach(function(t){var e=t.type,r=void 0===e?"directional":e,i=(0,lY.Z)(t,xt),o=xe[r].lights,a=xe[r].num,s=n[a];n[o][s]=(0,rW.Z)((0,rW.Z)({},n[o][s]),i),n[a]++}),n)))})})}}]),t}())||ng,xa=(0,cn.b2)()(ny=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.rendererService,i=e.postProcessingPassFactory,o=e.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var e=t.getLayerConfig(),r=e.enableMultiPassRenderer,a=e.passes;n.enabled=!!r&&!1!==t.getLayerConfig().enableMultiPassRenderer,n.enabled&&(t.multiPassRenderer=pP(t,void 0===a?[]:a,i,o),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(n.enabled){var e=r.getViewportSize(),i=e.width,o=e.height;t.multiPassRenderer.resize(i,o)}})}}]),t}())||ny,xs=oD.isNumber,xu={ENCODE:1,HIGHLIGHT:2},xc=(0,cn.b2)()(nb=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"pickOption2Array",value:function(){var t=[];return this.pickingUniformMap.forEach(function(e,n){xs(e)?t.push(e):t.push.apply(t,(0,i2.Z)(e))}),t}},{key:"updatePickOption",value:function(t,e){var n=this;Object.keys(t).forEach(function(e){n.pickingUniformMap.set(e,t[e])});var r=e.getLayerConfig().pickingBuffer||0,i=Number(e.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",r),this.pickingUniformMap.set("u_shaderPick",i),e.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(t,e){var n=this;e.rendererService;var r=e.styleAttributeService;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_EnableSelect",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",function(){var e=t.getLayerConfig().enablePicking;r.registerStyleAttribute({name:"pickingColor",type:hL.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:pY.PICKING_COLOR,buffer:{data:[],type:lq.FLOAT},size:3,update:function(t){var n=t.id;return e?iW(n):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){t.getLayerConfig().enablePicking&&t.isVisible()&&(n.updatePickOption({u_PickingStage:xu.ENCODE},t),t.models.forEach(function(t){return t.addUniforms({u_PickingStage:xu.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){t.getLayerConfig().enablePicking&&t.isVisible()&&(n.updatePickOption({u_PickingStage:xu.HIGHLIGHT},t),t.models.forEach(function(t){return t.addUniforms({u_PickingStage:xu.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(e){var r=t.getLayerConfig(),i=r.highlightColor,o=r.activeMix,a="string"==typeof i?iH(i):i||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:iG(new Uint8Array(e))});var s={u_PickingStage:xu.HIGHLIGHT,u_PickingColor:e,u_HighlightColor:a.map(function(t){return 255*t}),u_activeMix:void 0===o?0:o};n.updatePickOption(s,t),t.models.forEach(function(t){return t.addUniforms(s)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(e){var r=t.getLayerConfig(),i=r.selectColor,o=r.selectMix,a="string"==typeof i?iH(i):i||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:iG(new Uint8Array(e))});var s={u_PickingStage:xu.HIGHLIGHT,u_PickingColor:e,u_HighlightColor:a.map(function(t){return 255*t}),u_activeMix:void 0===o?0:o,u_CurrentSelectedId:e,u_SelectColor:a.map(function(t){return 255*t}),u_EnableSelect:1};n.updatePickOption(s,t),t.models.forEach(function(t){return t.addUniforms(s)})})}}]),t}())||nb,xl=["mvt","geojsonvt","testTile"],xf=(0,cn.b2)()(nx=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){var e;e=t.getSource(),xl.includes(e.parser.type)||n.registerBuiltinAttributes(r,t)})}},{key:"registerBuiltinAttributes",value:function(t,e){if("MaskLayer"===e.type){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:hL.Attribute,descriptor:{name:"a_Position",shaderLocation:pY.POSITION,buffer:{data:[],type:lq.FLOAT},size:3,update:function(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:hL.Attribute,descriptor:{name:"a_Color",shaderLocation:pY.COLOR,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:4,update:function(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:hL.Attribute,descriptor:{name:"a_vertexId",shaderLocation:pY.VERTEX_ID,buffer:{usage:lq.DYNAMIC_DRAW,data:[],type:lq.FLOAT},size:1,update:function(t,e){return[e]}}})}}]),t}())||nx,xh=(n_=(0,cn.b2)(),nS=(0,cn.f3)(ci.ICameraService),nw=(0,cn.f3)(ci.ICoordinateSystemService),nk=(0,cn.f3)(ci.IRendererService),nC=(0,cn.f3)(ci.IMapService),nE=(0,cn.f3)(ci.ILayerService),n_((nM=lS((nA=function(){function t(){(0,rK.Z)(this,t),l_(this,"cameraService",nM,this),l_(this,"coordinateSystemService",nT,this),l_(this,"rendererService",nL,this),l_(this,"mapService",nZ,this),l_(this,"layerService",nP,this)}return(0,rX.Z)(t,[{key:"apply",value:function(t){var e,n=this,r=this.mapService.version,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];this.rendererService.uniformBuffers[0]||(e=this.rendererService.createBuffer({data:new Float32Array(92),isUBO:!0}),this.rendererService.uniformBuffers[0]=e),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var e=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(e),"GAODE2.x"===r&&(n.setLayerCenter(t),i=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter(),t.getLayerUniformBuffer().subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,i2.Z)(i),(0,i2.Z)(o))).buffer)}));var a=n.rendererService.getViewportSize(),s=a.width,u=a.height,c=n.generateUBO(i,o,s,u),l=c.data,f=c.uniforms;n.layerService.alreadyInRendering&&n.rendererService.uniformBuffers[0]&&n.rendererService.uniformBuffers[0].subData({offset:0,data:l}),"WebGL1"===n.rendererService.queryVerdorInfo()&&t.models.forEach(function(e){e.addUniforms((0,rW.Z)((0,rW.Z)({},f),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){void 0===t.coordCenter&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,e,n,r){var i,o=this.cameraService.getProjectionMatrix(),a=this.cameraService.getViewMatrix(),s=this.cameraService.getViewProjectionMatrix(),u=this.cameraService.getModelMatrix(),c=this.coordinateSystemService.getViewportCenterProjection(),l=this.coordinateSystemService.getPixelsPerDegree(),f=this.cameraService.getZoom(),h=this.coordinateSystemService.getPixelsPerDegree2(),p=this.cameraService.getZoomScale(),d=this.coordinateSystemService.getPixelsPerMeter(),v=this.coordinateSystemService.getCoordinateSystem(),m=this.cameraService.getCameraPosition(),g=window.devicePixelRatio,y=this.coordinateSystemService.getViewportCenter(),b=[n,r],x=this.cameraService.getFocalDistance();return{data:[].concat((0,i2.Z)(a),(0,i2.Z)(o),(0,i2.Z)(s),(0,i2.Z)(u),(0,i2.Z)(c),(0,i2.Z)(l),[f],(0,i2.Z)(h),[p],(0,i2.Z)(d),[v],(0,i2.Z)(m),[g],(0,i2.Z)(y),b,[x,0,0,0]),uniforms:(i={},(0,ac.Z)(i,hE.ProjectionMatrix,o),(0,ac.Z)(i,hE.ViewMatrix,a),(0,ac.Z)(i,hE.ViewProjectionMatrix,s),(0,ac.Z)(i,hE.Zoom,f),(0,ac.Z)(i,hE.ZoomScale,p),(0,ac.Z)(i,hE.FocalDistance,x),(0,ac.Z)(i,hE.CameraPosition,m),(0,ac.Z)(i,lT.CoordinateSystem,v),(0,ac.Z)(i,lT.ViewportCenter,y),(0,ac.Z)(i,lT.ViewportCenterProjection,c),(0,ac.Z)(i,lT.PixelsPerDegree,l),(0,ac.Z)(i,lT.PixelsPerDegree2,h),(0,ac.Z)(i,lT.PixelsPerMeter,d),(0,ac.Z)(i,lT.Mvp,t),(0,ac.Z)(i,"u_sceneCenterMercator",e),(0,ac.Z)(i,"u_ViewportSize",b),(0,ac.Z)(i,"u_ModelMatrix",u),(0,ac.Z)(i,"u_DevicePixelRatio",g),i)}}}]),t}()).prototype,"cameraService",[nS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nT=lS(nA.prototype,"coordinateSystemService",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=lS(nA.prototype,"rendererService",[nk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nZ=lS(nA.prototype,"mapService",[nC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nP=lS(nA.prototype,"layerService",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nA))||nA),xp=(0,cn.b2)()(nO=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(e){e&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),t}())||nO,xd=(0,cn.b2)()(nR=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){n.initStyleAttribute(t,{styleAttributeService:r})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){!t.layerModelNeedUpdate&&t.inited&&n.updateStyleAttribute(t,{styleAttributeService:r})})}},{key:"updateStyleAttribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices){t.layerModelNeedUpdate=!0,r.forEach(function(t){return t.needRegenerateVertices=!1});return}r.filter(function(t){return t.needRegenerateVertices}).forEach(function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex,t),e.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,e){var n=e.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter(function(t){return t.needRegenerateVertices}).forEach(function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1})}}]),t}())||nR;hy.bind(ci.ILayerPlugin).to(m1).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xf).inRequestScope(),hy.bind(ci.ILayerPlugin).to(bz).inRequestScope(),hy.bind(ci.ILayerPlugin).to(m0).inRequestScope(),hy.bind(ci.ILayerPlugin).to(b9).inRequestScope(),hy.bind(ci.ILayerPlugin).to(bB).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xd).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xp).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xa).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xh).inRequestScope(),hy.bind(ci.ILayerPlugin).to(bj).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xo).inRequestScope(),hy.bind(ci.ILayerPlugin).to(xc).inRequestScope(),hy.bind(ci.ILayerPlugin).to(b8).inRequestScope();var xv=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"isMoving",!1),(0,ac.Z)((0,se.Z)(t),"move",function(e){switch(e.stopPropagation(),e.type){case"touchcancel":case"touchend":case"mouseup":var n;t.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(e){document.removeEventListener(e,t.move)}),null===(n=t.scene)||void 0===n||n.render();break;case"mousedown":case"touchstart":t.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(e){document.addEventListener(e,t.move)});case"mousemove":case"touchmove":if(t.isMoving){if("vertical"===t.controlOption.orientation){if("pageX"in e?r=e.pageX:e.touches&&e.touches.length&&e.touches[0].pageX?r=e.touches[0].pageX:e.changedTouches&&e.changedTouches.length&&(r=e.changedTouches[0].pageX),!r)break;var r,i=t.getContainerDOMRect(),o=t.getContainerSize(),a=o[0],s=a-Math.min(Math.max(0,a-(r-((null==i?void 0:i.left)||0)+window.scrollX-document.documentElement.clientLeft)),a),u=s/a;t.setOptions({ratio:u}),t.emit("moving",{size:[s,o[1]],ratio:[u,0]})}else{if("pageY"in e?c=e.pageY:e.touches&&e.touches.length&&e.touches[0].pageY?c=e.touches[0].pageY:e.changedTouches&&e.changedTouches.length&&(c=e.changedTouches[0].pageY),!c)break;var c,l=t.getContainerDOMRect(),f=t.getContainerSize(),h=f[1],p=h-Math.min(Math.max(0,h-(c-((null==l?void 0:l.top)||0)+window.scrollY-document.documentElement.clientTop)),h),d=p/h;t.setOptions({ratio:d}),t.emit("moving",{size:[f[0],p],ratio:[0,d]})}}}}),(0,ac.Z)((0,se.Z)(t),"getMaskLayer",function(){return new mC({visible:!1}).source({type:"FeatureCollection",features:[]}).shape("fill").color("red").style({opacity:.1})}),(0,ac.Z)((0,se.Z)(t),"updateMask",function(){if(t.mapsService){var e,n=t.getMaskGeoData();null===(e=t.maskLayer)||void 0===e||e.setData(n)}}),t}return(0,rX.Z)(r,[{key:"getDefault",value:function(){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this)),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}},{key:"onAdd",value:function(){var t=oF("div","l7-control-swipe");oF("button","l7-control-swipe__button",t);var e=this.controlOption,n=e.orientation,r=void 0===n?"vertical":n,i=e.ratio,o=void 0===i?.5:i;return"horizontal"===r?(t.style.top=100*o+"%",t.style.left=""):(t.style.left=100*o+"%",t.style.top=""),t.classList.add(r),t}},{key:"addTo",value:function(t){this.mapsService=t.get(ci.IMapService),this.renderService=t.get(ci.IRendererService),this.layerService=t.get(ci.ILayerService),this.controlService=t.get(ci.IControlService),this.configService=t.get(ci.IGlobalConfigService),this.scene=t.get(ci.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd();var e=this.controlOption,n=e.className,r=e.style,i=e.layers,o=e.rightLayers;n&&this.setClassName(n),r&&this.setStyle(r),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.updateMask(),this.registerEvent(),this.addMaskToLayers(i,!1),this.addMaskToLayers(o,!0);var a=h_(t);return this.maskLayer.setContainer(a,t),this.scene.addLayer(this.maskLayer),this.emit("add",this),this}},{key:"onRemove",value:function(){if(this.maskLayer){var t,e=this.controlOption,n=e.layers,r=e.rightLayers;this.removeMaskFromLayers(n),this.removeMaskFromLayers(r),null===(t=this.layerService)||void 0===t||t.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}},{key:"show",value:function(){oH(this.container,"l7-control-swipe_hide");var t,e=this.controlOption,n=e.layers,r=e.rightLayers;n.forEach(function(t){return t.enableMask()}),r.forEach(function(t){return t.enableMask()}),null===(t=this.scene)||void 0===t||t.render(),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){oV(this.container,"l7-control-swipe_hide");var t,e=this.controlOption,n=e.layers,r=e.rightLayers;n.forEach(function(t){return t.disableMask()}),r.forEach(function(t){return t.disableMask()}),null===(t=this.scene)||void 0===t||t.render(),this.isShow=!1,this.emit("hide",this)}},{key:"setOptions",value:function(t){var e=(0,rW.Z)((0,rW.Z)({},this.controlOption),t);if(t.className&&this.setClassName(t.className),t.style&&this.setStyle(t.style),(t.orientation||void 0!==t.ratio)&&this.setOrientationAndRatio(e.orientation,e.ratio),t.layers){var n=t.layers,r=this.controlOption.layers;this.setLayers(n,r,!1)}if(t.rightLayers){var i=t.rightLayers,o=this.controlOption.rightLayers;this.setLayers(i,o,!0)}this.controlOption=e,this.updateMask()}},{key:"registerEvent",value:function(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}},{key:"unRegisterEvent",value:function(){var t;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),null===(t=this.mapsService)||void 0===t||t.off("camerachange",this.updateMask)}},{key:"setOrientationAndRatio",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.container.classList.remove("horizontal","vertical"),this.container.classList.add(t),"horizontal"===t?(this.container.style.top=100*e+"%",this.container.style.left=""):(this.container.style.left=100*e+"%",this.container.style.top="")}},{key:"setLayers",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.filter(function(t){return!1===e.includes(t)}),i=e.filter(function(e){return!1===t.includes(e)});this.addMaskToLayers(r,n),this.removeMaskFromLayers(i)}},{key:"addMaskToLayers",value:function(t,e){var n=this;t.forEach(function(t){t.updateLayerConfig({maskInside:!e}),t.addMask(n.maskLayer)})}},{key:"removeMaskFromLayers",value:function(t){var e=this;t.forEach(function(t){t.updateLayerConfig({maskInside:!0}),t.removeMask(e.maskLayer)})}},{key:"getMaskGeoData",value:function(){var t,e=this.controlOption,n=e.ratio,r=void 0===n?.5:n,i=e.orientation,o=this.getBounds(),a=(0,i3.Z)(o,2),s=a[0],u=a[1],c=(0,i3.Z)(s,2),l=c[0],f=c[1],h=(0,i3.Z)(u,2),p=h[0],d=h[1];if("vertical"===(void 0===i?"vertical":i)){var v=l+(p-l)*r;t=[[l,d],[v,d],[v,f],s,[l,d]]}else{var m=this.getContainerSize(),g=this.mapsService.containerToLngLat([m[0],m[1]*r]).lat;t=[[l,d],u,[p,g],[l,g],[l,d]]}return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[t]}}]}}},{key:"getContainerDOMRect",value:function(){var t;return null===(t=this.mapsService.getContainer())||void 0===t?void 0:t.getBoundingClientRect()}},{key:"getContainerSize",value:function(){return this.mapsService.getSize()}},{key:"getBounds",value:function(){return this.mapsService.getBounds()}},{key:"addLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Array.isArray(t)?t:[t];if(e){var r,i=(r=this.controlOption.rightLayers).concat.apply(r,(0,i2.Z)(n));this.setOptions({rightLayers:i})}else{var o,a=(o=this.controlOption.layers).concat.apply(o,(0,i2.Z)(n));this.setOptions({layers:a})}}},{key:"removeLayer",value:function(t){var e=Array.isArray(t)?t:[t],n=this.controlOption.layers.filter(function(t){return e.includes(t)}),r=this.controlOption.rightLayers.filter(function(t){return e.includes(t)});this.setOptions({layers:n,rightLayers:r})}},{key:"removeLayers",value:function(){this.setOptions({layers:[],rightLayers:[]})}}]),r}(po),xm=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"zoomIn",function(){!t.disabled&&t.mapsService.getZoom()<t.mapsService.getMaxZoom()&&t.mapsService.zoomIn()}),(0,ac.Z)((0,se.Z)(t),"zoomOut",function(){!t.disabled&&t.mapsService.getZoom()>t.mapsService.getMinZoom()&&t.mapsService.zoomOut()}),(0,ac.Z)((0,se.Z)(t),"updateDisabled",function(){var e=t.mapsService;t.zoomInButton.removeAttribute("disabled"),t.zoomOutButton.removeAttribute("disabled"),(t.disabled||e.getZoom()<=e.getMinZoom())&&t.zoomOutButton.setAttribute("disabled","true"),t.controlOption.showZoom&&t.zoomNumDiv&&(t.zoomNumDiv.innerText=String(Math.floor(e.getZoom()))),(t.disabled||e.getZoom()>=e.getMaxZoom())&&t.zoomInButton.setAttribute("disabled","true")}),t}return(0,rX.Z)(r,[{key:"getDefault",value:function(t){return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:la.BOTTOMRIGHT,name:"zoom",zoomInText:ph("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:ph("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(t){fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=oF("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){o8(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,e,n,r,i){var o=oF("button",n,r);return"string"==typeof t?o.innerHTML=t:o.append(t),o.title=e,i&&o.addEventListener("click",i),o}}]),r}(po),xg=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){(0,rK.Z)(this,r),e=n.call(this),(0,ac.Z)((0,se.Z)(e),"isShow",!0),(0,ac.Z)((0,se.Z)(e),"onMouseMove",function(t){var n,r=e.mapsService.getMapContainer(),i=null!==(n=null==r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},o=i.left,a=i.top;e.setPopupPosition(t.clientX-(void 0===o?0:o),t.clientY-(void 0===a?0:a))}),(0,ac.Z)((0,se.Z)(e),"updateLngLatPosition",function(){if(e.mapsService&&!e.popupOption.followCursor){var t=e.lngLat,n=t.lng,r=t.lat,i=e.mapsService.lngLatToContainer([n,r]),o=i.x,a=i.y;e.setPopupPosition(o,a)}}),(0,ac.Z)((0,se.Z)(e),"updateLngLatPositionWhenZoom",function(t){if(e.mapsService&&!e.popupOption.followCursor){var n=e.lngLat,r=n.lng,i=n.lat,o=e.mapsService.lngLatToContainer([r,i]);o.x,o.y;var a=t.map,s=a.getSize();s.x=s.x/2,s.y=s.y/2;var u=t.center,c=t.zoom,l=a.DE(e.lngLat,c,u);l.x=Math.round(l.x),l.y=Math.round(l.y),e.setPopupPosition(l.x,l.y,!0)}}),(0,ac.Z)((0,se.Z)(e),"onKeyDown",function(t){27===t.keyCode&&e.remove()}),(0,ac.Z)((0,se.Z)(e),"onCloseButtonClick",function(t){t.stopPropagation&&t.stopPropagation(),e.hide()}),(0,ac.Z)((0,se.Z)(e),"updatePosition",function(t){var n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=!!e.lngLat,i=e.popupOption,o=i.className,a=i.style,s=i.maxWidth,u=i.anchor,c=i.stopPropagation;if(e.mapsService&&r&&e.content){var l=e.mapsService.getMarkerContainer();!e.container&&l&&(e.container=oF("div","l7-popup ".concat(null!=o?o:""," ").concat(e.isShow?"":"l7-popup-hide"),l),a&&e.container.setAttribute("style",a),e.tip=oF("div","l7-popup-tip",e.container),e.container.appendChild(e.content),c&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(t){e.container.addEventListener(t,function(t){t.stopPropagation()})}),e.container.style.whiteSpace="nowrap"),n?e.updateLngLatPositionWhenZoom(t):e.updateLngLatPosition(),o$(e.container,"".concat(ip[u])),id(e.container,u,"popup"),s?e.container.getBoundingClientRect().width>parseFloat(s)&&(e.container.style.width=s):e.container.style.removeProperty("width")}}),(0,ac.Z)((0,se.Z)(e),"updateWhenZoom",function(t){e.updatePosition(t,!0)}),(0,ac.Z)((0,se.Z)(e),"update",function(){e.updatePosition(null,!1)}),e.popupOption=(0,rW.Z)((0,rW.Z)({},e.getDefault(null!=t?t:{})),t);var e,i=e.popupOption.lngLat;return i&&(e.lngLat=i),e}return(0,rX.Z)(r,[{key:"lngLat",get:function(){var t;return null!==(t=this.popupOption.lngLat)&&void 0!==t?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(ci.IMapService),this.sceneService=t.get(ci.ISceneService),this.layerService=t.get(ci.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var e=this.popupOption,n=e.html,r=e.text,i=e.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&void 0!==this&&this.isOpen())return this.content&&oU(this.content),this.container&&(oU(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,rW.Z)((0,rW.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(oU(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&oH(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&oV(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=oF("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),o8(this.contentTitle),at(this.contentTitle,t)):this.contentTitle&&(oU(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,e=t.lng,n=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([e,n]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var e=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){e.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:ih.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),at(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var e=this,n=this.mapsService;n&&(null==n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){null==n||n.on("click",e.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var e,n=null===(e=this.mapsService)||void 0===e?void 0:e.getContainer();n&&(null==n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(null==n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&oU(this.content),this.contentTitle=void 0,this.content=oF("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var e=ph("l7-icon-guanbi");oV(e,"l7-popup-close-button"),this.content.appendChild(e),this.popupOption.closeButtonOffsets&&(e.style.right=this.popupOption.closeButtonOffsets[0]+"px",e.style.top=this.popupOption.closeButtonOffsets[1]+"px"),e.setAttribute("aria-label","Close popup"),e.addEventListener("click",function(){t.hide()}),e.addEventListener("pointerup",function(t){t.stopPropagation()}),e.addEventListener("pointerdown",function(t){t.stopPropagation()}),this.closeButton=e}else this.closeButton=void 0;this.contentPanel=oF("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.container){var r=this.popupOption.offsets;this.container.style.left=t+r[0]+"px",this.container.style.top=e-r[1]+"px",n?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}},{key:"checkUpdateOption",value:function(t,e){return e.some(function(e){return e in t})}}]),r}(so.EventEmitter),xy=oD.get,xb=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"layerClickCountByFrame",0),(0,ac.Z)((0,se.Z)(t),"layerConfigMap",new WeakMap),(0,ac.Z)((0,se.Z)(t),"onLayerClick",function(e,n){requestAnimationFrame(function(){if(t.popupOption.closeOnClick&&t.layerClickCountByFrame++,t.isShow&&t.isSameFeature(e,n.featureId))t.hide();else{var r=t.getLayerInfoFrag(e,n),i=r.title,o=r.content;t.setDOMContent(o),t.setLnglat(n.lngLat),t.setTitle(i),t.setDisplayFeatureInfo({layer:e,featureId:n.featureId}),t.show()}})}),(0,ac.Z)((0,se.Z)(t),"onSceneClick",function(){t.layerClickCountByFrame=0,requestAnimationFrame(function(){t.layerClickCountByFrame||t.hide()})}),(0,ac.Z)((0,se.Z)(t),"onLayerHide",function(){t.hide(),t.setDisplayFeatureInfo(void 0)}),(0,ac.Z)((0,se.Z)(t),"updateCloseOnClick",function(){}),t}return(0,rX.Z)(r,[{key:"layerConfigItems",get:function(){var t,e=this.popupOption,n=e.config,r=e.items;return null!==(t=null!=n?n:r)&&void 0!==t?t:[]}},{key:"addTo",value:function(t){return fX((0,rJ.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return fX((0,rJ.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){this.unbindLayerEvent();var e=(0,rW.Z)({},t),n=e.trigger||this.popupOption.trigger,i=e.items||this.popupOption.items,o=(null==i?void 0:i.length)===0;e.followCursor="hover"===n&&!o;var a=this.isShow;return fX((0,rJ.Z)(r.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),(o||!a)&&this.hide(),this}},{key:"getDefault",value:function(t){var e="hover"===t.trigger;return(0,rW.Z)((0,rW.Z)({},fX((0,rJ.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:e,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,e=this.popupOption,n=e.trigger,r=e.closeOnClick;this.layerConfigItems.forEach(function(e){var i=t.getLayerByConfig(e);if(i){var o=(0,rW.Z)({},e);if("hover"===n){var a=t.onLayerMouseMove.bind(t,i),s=t.onLayerMouseOut.bind(t,i);o.onMouseMove=a,o.onMouseOut=s,null==i||i.on("mousemove",a),null==i||i.on("mouseout",s)}else{var u,c,l=t.onLayerClick.bind(t,i);o.onClick=l,null==i||i.on("click",l);var f=null===(c=t.mapsService)||void 0===c?void 0:c.getMapContainer();f&&r&&f.addEventListener("click",t.onSceneClick)}var h=null==i||null===(u=i.getSource)||void 0===u?void 0:u.call(i),p=t.onSourceUpdate.bind(t);null==h||h.on("update",p),o.onSourceUpdate=p,t.layerConfigMap.set(i,o)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(e){var n,r,i=t.getLayerByConfig(e),o=i&&t.layerConfigMap.get(i);if(o){var a=o.onMouseMove,s=o.onMouseOut,u=o.onClick,c=o.onSourceUpdate;a&&i.off("mousemove",a),s&&i.off("mouseout",s),u&&i.off("click",u),c&&(null==i||null===(r=i.getSource())||void 0===r||r.off("update",c));var l=null===(n=t.mapsService)||void 0===n?void 0:n.getMapContainer();l&&l.removeEventListener("click",t.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(t,e){if(!this.isSameFeature(t,e.featureId)){var n=this.getLayerInfoFrag(t,e),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.setDisplayFeatureInfo({layer:t,featureId:e.featureId}),this.show()}}},{key:"onLayerMouseOut",value:function(t,e){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.setDisplayFeatureInfo(void 0)}},{key:"getLayerInfoFrag",value:function(t,e){var n,r=this.layerConfigMap.get(t),i=document.createDocumentFragment();if(r){var o=e.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;a&&at(n=document.createDocumentFragment(),a instanceof Function?a(o):a),u?at(i,u instanceof Function?u(o):u):null!=s&&s.length&&(null==s||s.forEach(function(t){var n,r,a="string"==typeof t?{field:t}:t,s=a.field,u=a.formatField,c=a.formatValue,l=a.getValue,f=oF("div","l7-layer-popup__row"),h=l?l(e.feature):xy(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=c instanceof Function?c(h,o):c)&&void 0!==r?r:h,v=oF("span","l7-layer-popup__key",f);at(v,p),at(v,document.createTextNode("："));var m=oF("span","l7-layer-popup__value",f);Array.isArray(d)&&d.every(function(t){return!(t instanceof Object)})&&(d=d.map(function(t){return String(t)}).join(",")),at(m,d),i.appendChild(f)}))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(t){var e=t.layer;return e instanceof Object?e:"string"==typeof e?this.layerService.getLayer(e)||this.layerService.getLayerByName(e):void 0}},{key:"isSameFeature",value:function(t,e){var n=this.displayFeatureInfo;return n&&t===n.layer&&e===n.featureId}},{key:"setDisplayFeatureInfo",value:function(t){var e=this.displayFeatureInfo;e&&e.layer.off("hide",this.onLayerHide),t&&t.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=t}}]),r}(xg);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 999;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 999;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 24px;\n  padding: 0 16px;\n  font-size: 12px;\n  line-height: 24px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  max-width: 460px;\n  max-height: 400px;\n  margin: 12px 0 0 12px;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.l7-select-control--image .l7-select-control-item {\n  position: relative;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);\n          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  margin-right: 12px;\n  margin-bottom: 12px;\n  overflow: hidden;\n  font-size: 12px;\n  border: 1px solid #fff;\n  border-radius: 2px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 100%;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.l7-select-control--image .l7-select-control-item input[type='radio'] {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  overflow: hidden;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-control-zoom .l7-button-control {\n  font-size: 16px;\n  border-bottom: 1px solid #f0f0f0;\n  border-radius: 0;\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:last-child {\n  border-bottom: 0;\n}\n.l7-control-zoom .l7-control-zoom__number {\n  color: #595959;\n  padding: 0;\n}\n.l7-control-zoom .l7-control-zoom__number:hover {\n  background-color: #fff;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n.l7-control-swipe {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 6;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -ms-touch-action: none;\n      touch-action: none;\n}\n.l7-control-swipe_hide {\n  display: none;\n}\n.l7-control-swipe:before {\n  position: absolute;\n  top: -5000px;\n  bottom: -5000px;\n  left: 50%;\n  z-index: -1;\n  width: 4px;\n  background: #fff;\n  -webkit-transform: translate(-2px, 0);\n          transform: translate(-2px, 0);\n  content: '';\n}\n.l7-control-swipe.horizontal:before {\n  top: 50%;\n  right: -5000px;\n  bottom: auto;\n  left: -5000px;\n  width: auto;\n  height: 4px;\n}\n.l7-control-swipe__button {\n  display: block;\n  width: 28px;\n  height: 28px;\n  margin: 0;\n  padding: 0;\n  color: #595959;\n  font-weight: bold;\n  font-size: inherit;\n  text-align: center;\n  text-decoration: none;\n  background-color: #fff;\n  border: none;\n  border-radius: 2px;\n  outline: none;\n}\n.l7-control-swipe,\n.l7-control-swipe__button {\n  cursor: ew-resize;\n}\n.l7-control-swipe.horizontal,\n.l7-control-swipe.horizontal button {\n  cursor: ns-resize;\n}\n.l7-control-swipe:after,\n.l7-control-swipe__button:before,\n.l7-control-swipe__button:after {\n  position: absolute;\n  top: 25%;\n  bottom: 25%;\n  left: 50%;\n  width: 2px;\n  background: currentColor;\n  -webkit-transform: translate(-1px, 0);\n          transform: translate(-1px, 0);\n  content: '';\n}\n.l7-control-swipe__button:after {\n  -webkit-transform: translateX(4px);\n          transform: translateX(4px);\n}\n.l7-control-swipe__button:before {\n  -webkit-transform: translateX(-6px);\n          transform: translateX(-6px);\n}\n");var xx=(nI=hm(ci.IGlobalConfigService),nN=lS((nD=function(){function t(e){(0,rK.Z)(this,t),l_(this,"configService",nN,this),this.config=e}return(0,rX.Z)(t,[{key:"setContainer",value:function(t,e,n){t.bind(ci.MapConfig).toConstantValue((0,rW.Z)((0,rW.Z)({},this.config),{},{id:e,canvas:n})),t.bind(ci.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw Error("Method not implemented.")}}]),t}()).prototype,"configService",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nD),x_=n(11261),xS=n.n(x_);function xw(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xk(t,e){var n,r=lC([],e,t);return n=1/r[3],r[0]=r[0]*n,r[1]=r[1]*n,r[2]=r[2]*n,r[3]=r[3]*n,r}function xC(t,e){if(!t)throw Error(e||"viewport-mercator-project: assertion failed.")}var xE=Math.PI,xA=xE/4,xM=xE/180,xT=180/xE;function xL(t){return Math.pow(2,t)}function xZ(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1];return xC(Number.isFinite(r)&&Number.isFinite(e)),xC(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),[(e*=512)*(r*xM+xE)/(2*xE),e*(xE-Math.log(Math.tan(xA+i*xM*.5)))/(2*xE)]}function xP(t,e){var n=(0,i3.Z)(t,2);return[(n[0]/(e*=512)*(2*xE)-xE)*xT,2*(Math.atan(Math.exp(xE-n[1]/e*(2*xE)))-xA)*xT]}function xO(t,e){var n,r,i,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=(0,i3.Z)(t,3),u=s[0],c=s[1],l=s[2];if(xC(Number.isFinite(u)&&Number.isFinite(c),"invalid pixel coordinate"),Number.isFinite(l))return xk(e,[u,c,l,1]);var f=xk(e,[u,c,0,1]),h=xk(e,[u,c,1,1]),p=f[2],d=h[2];return n=[],r=p===d?0:((a||0)-p)/(d-p),i=f[0],o=f[1],n[0]=i+r*(h[0]-i),n[1]=o+r*(h[1]-o),n}var xR=xw(),xI=function(t){function e(){var t,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=A.width,L=A.height,Z=A.latitude,P=void 0===Z?0:Z,O=A.longitude,R=void 0===O?0:O,I=A.zoom,D=void 0===I?0:I,N=A.pitch,z=void 0===N?0:N,j=A.bearing,B=void 0===j?0:j,F=A.altitude,U=void 0===F?1.5:F,V=A.nearZMultiplier,H=A.farZMultiplier;(0,rK.Z)(this,e),M=M||1,L=L||1;var G=xL(D);U=Math.max(.75,U);var W=xZ([R,P],G);W[2]=0;var Y=(n=(t={width:M,height:L,pitch:z,bearing:B,altitude:U,nearZMultiplier:V||1/L,farZMultiplier:H||1.01}).width,r=t.height,i=t.pitch,c$([],(a=(o={width:n,height:r,altitude:t.altitude,pitch:i,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}).width,s=o.height,c=void 0===(u=o.altitude)?1.5:u,l=o.pitch,f=o.nearZMultiplier,h=o.farZMultiplier,p=(void 0===l?0:l)*xM,v=Math.sin(d=Math.atan(.5/c))*c/Math.sin(Math.PI/2-p-d),m={fov:2*Math.atan(s/2/c),aspect:a/s,focalDistance:c,near:void 0===f?1:f,far:(Math.cos(Math.PI/2-p)*v+c)*(void 0===h?1:h)}).fov,m.aspect,m.near,m.far)),q=(y=(g={height:L,center:W,pitch:z,bearing:B,altitude:U,flipY:!0}).height,b=g.pitch,x=g.bearing,_=g.altitude,w=void 0===(S=g.center)?null:S,k=g.flipY,cT(C=xw(),C,[0,0,-_]),cL(C,C,[1,1,1/y]),cP(C,C,-b*xM),cR(C,C,x*xM),void 0!==k&&k&&cL(C,C,[1,-1,1]),w&&cT(C,C,dg([],w)),C);return(E=(0,rQ.Z)(this,(0,rJ.Z)(e).call(this,{width:M,height:L,viewMatrix:q,projectionMatrix:Y}))).latitude=P,E.longitude=R,E.zoom=D,E.pitch=z,E.bearing=B,E.altitude=U,E.scale=G,E.center=W,E.pixelsPerMeter=function(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision;i=void 0!==i?i:xL(r),xC(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var a={},s=512*i,u=Math.cos(e*xM),c=s/360,l=c/u,f=s/4003e4/u;if(a.pixelsPerMeter=[f,-f,f],a.metersPerPixel=[1/f,-1/f,1/f],a.pixelsPerDegree=[c,-l,f],a.degreesPerPixel=[1/c,-1/l,1/f],void 0!==o&&o){var h=xM*Math.tan(e*xM)/u,p=c*h/2,d=s/4003e4*h,v=d/l*f;a.pixelsPerDegree2=[0,-p,d],a.pixelsPerMeter2=[v,0,v]}return a}((0,se.Z)((0,se.Z)(E))).pixelsPerMeter[2],Object.freeze((0,se.Z)((0,se.Z)(E))),E}return(0,r$.Z)(e,t),(0,rX.Z)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return xZ(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return xP(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e,n=t.lngLat,r=xO(t.pos,this.pixelUnprojectionMatrix),i=s6([],xZ(n,this.scale),((e=[])[0]=-r[0],e[1]=-r[1],e));return xP(s6([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=function(t){var e=t.width,n=t.height,r=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=t.padding,u=void 0===s?0:s,c=t.offset,l=void 0===c?[0,0]:c,f=(0,i3.Z)(r,2),h=(0,i3.Z)(f[0],2),p=h[0],d=h[1],v=(0,i3.Z)(f[1],2),m=v[0],g=v[1];if(Number.isFinite(u)){var y=u;u={top:y,bottom:y,left:y,right:y}}else xC(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var b=new xI({width:e,height:n,longitude:0,latitude:0,zoom:0}),x=b.project([p,g]),_=b.project([m,d]),S=[Math.max(Math.abs(_[0]-x[0]),o),Math.max(Math.abs(_[1]-x[1]),o)],w=[e-u.left-u.right-2*Math.abs(l[0]),n-u.top-u.bottom-2*Math.abs(l[1])];xC(w[0]>0&&w[1]>0);var k=w[0]/S[0],C=w[1]/S[1],E=(u.right-u.left)/2/k,A=(u.bottom-u.top)/2/C,M=[(_[0]+x[0])/2+E,(_[1]+x[1])/2+A],L=b.unproject(M),Z=b.zoom+Math.log2(Math.abs(Math.min(k,C)));return{longitude:L[0],latitude:L[1],zoom:Math.min(Z,void 0===a?24:a)}}(Object.assign({width:r,height:i,bounds:t},n));return new e({width:r,height:i,longitude:o.longitude,latitude:o.latitude,zoom:o.zoom})}}]),e}(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?xR:i,a=e.projectionMatrix,s=void 0===a?xR:a;(0,rK.Z)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=xw();cM(u,u,this.projectionMatrix),cM(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var c=xw();cL(c,c,[this.width/2,-this.height/2,1]),cT(c,c,[1,-1,0]),cM(c,c,this.viewProjectionMatrix);var l=cC(xw(),c);if(!l)throw Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=l,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,rX.Z)(t,[{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&ln(e.projectionMatrix,this.projectionMatrix)&&ln(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e,n,r,i,o,a,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=u.topLeft,l=(e=this.projectPosition(t),n=this.pixelProjectionMatrix,i=(r=(0,i3.Z)(e,3))[0],o=r[1],s=void 0===(a=r[2])?0:a,xC(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(s)),xk(n,[i,o,s,1])),f=(0,i3.Z)(l,2),h=f[0],p=f[1],d=void 0===c||c?p:this.height-p;return 2===t.length?[h,d]:[h,d,l[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=e.targetZ,i=(0,i3.Z)(t,3),o=i[0],a=i[1],s=i[2],u=void 0===n||n?a:this.height-a,c=r&&r*this.pixelsPerMeter,l=xO([o,u,s],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(l),h=(0,i3.Z)(f,3),p=h[0],d=h[1],v=h[2];return Number.isFinite(s)?[p,d,v]:Number.isFinite(r)?[p,d,r]:[p,d]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=(0,i3.Z)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=(0,i3.Z)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}}]),t}()),xD=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new xI((0,rW.Z)((0,rW.Z)({},s),{},{width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),xN=function(){function t(e){(0,rK.Z)(this,t),(0,ac.Z)(this,"size",1e4),this.size=e||1e4}return(0,rX.Z)(t,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){return 360/Math.PI*Math.atan(Math.exp((180-(1-t/this.size)*360)*Math.PI/180))-90}},{key:"project",value:function(t){return[this.mercatorXfromLng(t[0]),this.mercatorYfromLat(t[1])]}},{key:"unproject",value:function(t){return[this.lngFromMercatorX(t[0]),this.latFromMercatorY(t[1])]}}]),t}();function xz(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("number"==typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return(0,rW.Z)((0,rW.Z)({},{top:0,right:0,bottom:0,left:0}),t)}var xj={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},xB=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n.amap-copyright {\n  display: none !important;\n}\n");var xF={"GAODE1.x":{contextmenu:"rightclick"},"GAODE2.x":{contextmenu:"rightclick",camerachange:"viewchange"}},xU=0;window.forceWebGL=!0;var xV="15cd8a57710d40c9b7c0e3cc120f1200",xH=!1,xG=[],xW=(nz=(0,cn.b2)(),nj=(0,cn.f3)(ci.IGlobalConfigService),nB=(0,cn.f3)(ci.MapConfig),nF=(0,cn.f3)(ci.ICoordinateSystemService),nU=(0,cn.f3)(ci.IEventEmitter),nz((nH=lS((nV=function(){var t;function e(){var t=this;(0,rK.Z)(this,e),(0,ac.Z)(this,"version",aG["GAODE1.x"]),(0,ac.Z)(this,"simpleMapCoord",new xN),(0,ac.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),l_(this,"configService",nH,this),l_(this,"config",nG,this),l_(this,"coordinateSystemService",nW,this),l_(this,"eventEmitter",nY,this),(0,ac.Z)(this,"handleCameraChanged",function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,c=n.aspect,l=n.position,f=t.getCenter(),h=f.lng,p=f.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:c,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[h,p],offsetOrigin:[l.x,l.y]});var d=t.config.offsetZoom;t.viewport.getZoom()>(void 0===d?12:d)?t.coordinateSystemService.setCoordinateSystem(lM.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(lM.P20),t.cameraChangedCallback(t.viewport)}})}return(0,rX.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=oF("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==hZ.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(xF[this.version][t]||t,e)}},{key:"off",value:function(t,e){-1!==hZ.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(xF[this.version][t]||t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=xz(t.padding),r=this.lngLatToPixel([e.lng,e.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=xz(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyleValue(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"getMapStyleConfig",value:function(){return xj}},{key:"getMapStyleValue",value:function(t){return this.getMapStyleConfig()[t]||t}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t);return[e.x,-e.y]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cy();return cT(o,o,p9(i[0],i[1],e)),cL(o,o,p9(r[0],r[1],r[2])),cP(o,o,n[0]),cO(o,o,n[1]),cR(o,o,n[2]),o}},{key:"init",value:(t=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.config).id,i=void 0===(r=e.style)?"light":r,a=void 0===(o=e.minZoom)?0:o,u=void 0===(s=e.maxZoom)?18:s,l=void 0===(c=e.token)?xV:c,f=e.mapInstance,p=void 0===(h=e.plugin)?[]:h,d=(0,lY.Z)(e,xB),t.next=3,new Promise(function(t){var e=function(){if(f)v.map=f,v.$mapContainer=v.map.getContainer(),setTimeout(function(){v.map.on("camerachange",v.handleCameraChanged),t()},30);else{v.$mapContainer=v.creatMapContainer(n);var e=(0,rW.Z)({mapStyle:v.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",function(){setTimeout(function(){return v.handleAfterMapChange()})}),v.map=r,setTimeout(function(){t()},10)}};xH||f?xH&&window.AMap||f?e():xG.push(e):(l===xV&&console.warn("%c".concat(v.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),xH=!0,p.push("Map3D"),xS().load({key:l,version:"1.4.15",plugins:p}).then(function(){e(),xG.length&&(xG.forEach(function(t){return t()}),xG=[])}).catch(function(t){throw Error(t)}))});case 3:this.viewport=new xD;case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(r2(AMap.LngLat,(0,i2.Z)(t)),r2(AMap.LngLat,(0,i2.Z)(e))),r=this.lngLatToCoord(t),i=(0,i3.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,i3.Z)(s,2);return Math.sqrt(Math.pow(o-u[0],2)+Math.pow(a-u[1],2))/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){null===(t=this.$mapContainer)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$mapContainer),delete window.initAMap;var t,e=document.getElementById("amap-script");e&&document.head.removeChild(e),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+xU++,e.appendChild(n),n}}]),e}()).prototype,"configService",[nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nG=lS(nV.prototype,"config",[nB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nW=lS(nV.prototype,"coordinateSystemService",[nF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nY=lS(nV.prototype,"eventEmitter",[nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nV))||nV);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var xY=((tr=xY||{}).notload="notload",tr.loading="loading",tr.loaded="loaded",tr.failed="failed",tr),xq={key:"",AMap:{version:"2.0",plugins:[]}},xX={AMap:xY.notload},xK=[],x$=function(t){if("function"==typeof t){if(xX.AMap===xY.loaded){t(window.AMap);return}xK.push(t)}},xQ={load:(ti=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){if(xX.AMap===xY.failed)n("");else if(xX.AMap===xY.notload){var r=e.key,i=e.version,o=e.plugins;if(!r){n("请填写key");return}window.AMap&&"lbs.amap.com"!==location.host&&n("禁止多种API加载方式混用"),xq.key=r,xq.AMap.version=i||xq.AMap.version,xq.AMap.plugins=o||xq.AMap.plugins,xX.AMap=xY.loading;var a=document.body||document.head;window._onAPILoaded=function(e){e?(xX.AMap=xY.failed,n(e)):(xX.AMap=xY.loaded,t(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+xq.AMap.version+"&key="+r+"&plugin="+xq.AMap.plugins.join(","),s.onerror=function(t){xX.AMap=xY.failed,n(t)},a.appendChild(s)}else if(xX.AMap===xY.loaded){if(e.key&&e.key!==xq.key){n("多个不一致的 key");return}if(e.version&&e.version!==xq.AMap.version){n("不允许多个版本 JSAPI 混用");return}var u=[];e.plugins&&e.plugins.forEach(function(t){-1===xq.AMap.plugins.indexOf(t)&&u.push(t)}),u.length&&window.AMap.plugin(u,function(){t(window.AMap)})}else{if(e.key&&e.key!==xq.key){n("多个不一致的 key");return}if(e.version&&e.version!==xq.AMap.version){n("不允许多个版本 JSAPI 混用");return}var c=[];e.plugins&&e.plugins.forEach(function(t){-1===xq.AMap.plugins.indexOf(t)&&c.push(t)}),x$(function(){c.length&&window.AMap.plugin(c,function(){t(window.AMap)})})}}));case 1:case"end":return t.stop()}},t)})),function(t){return ti.apply(this,arguments)}),reset:function(){delete window.AMap,xq={key:"",AMap:{version:"1.4.15",plugins:[]}},xX={AMap:xY.notload}}},xJ=Math.PI/180,x0=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"projectionMatrix",cy()),(0,ac.Z)(this,"viewMatrix",cy()),(0,ac.Z)(this,"viewProjectionMatrix",cy()),(0,ac.Z)(this,"ViewProjectionMatrixUncentered",cy()),(0,ac.Z)(this,"viewUncenteredMatrix",cy())}return(0,rX.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=t.pitch,r=t.bearing,i=t.center,o=t.offsetOrigin,a=void 0===o?[0,0]:o,s=t.cameraHeight,u=void 0===s?1:s,c=t.aspect,l=t.near,f=t.far,h=t.fov;this.zoom=void 0===e?1:e,this.center=void 0===i?[0,0]:i;var p=(void 0===n?0:n)*xJ,d=(360-(void 0===r?0:r))*xJ;c$(this.projectionMatrix,void 0===h?0:h,void 0===c?1:c,void 0===l?.1:l,void 0===f?1e3:f);var v=p9(u*Math.sin(p)*Math.sin(d),-u*Math.sin(p)*Math.cos(d),u*Math.cos(p)),m=p9(-Math.cos(p)*Math.sin(d),Math.cos(p)*Math.cos(d),Math.sin(p));c3(this.viewMatrix,v,p9(0,0,0),m),this.viewUncenteredMatrix=cb(this.viewMatrix),cT(this.viewMatrix,this.viewMatrix,p9(-a[0],a[1],0)),cM(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),cM(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=(0,i3.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),n=Math.PI/180,r=t[0]*n,i=e*n;i=Math.log(Math.tan(Math.PI/4+i/2));var o=-.5/Math.PI;return n=.5,[r=268435456*(.5/Math.PI*r+.5)-215440491,i=-(268435456*(o*i+n)-106744817)]}}]),t}(),x1=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var x2="15cd8a57710d40c9b7c0e3cc120f1200",x3=!1,x5=[],x4=(0,cn.b2)()(nq=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"version","GAODE1.x"),(0,ac.Z)((0,se.Z)(t),"handleCameraChanged",function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,c=n.aspect,l=n.position,f=t.getCenter(),h=f.lng,p=f.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:c,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[h,p],offsetOrigin:[l.x,l.y]});var d=t.config.offsetZoom;t.viewport.getZoom()>(void 0===d?12:d)?t.coordinateSystemService.setCoordinateSystem(lM.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(lM.P20),t.cameraChangedCallback(t.viewport)}}),t}return(0,rX.Z)(i,[{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cy();return cT(o,o,p9(i[0],i[1],e)),cL(o,o,p9(r[0],r[1],r[2])),cP(o,o,n[0]),cO(o,o,n[1]),cR(o,o,n[2]),o}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=this.config).id,i=void 0===(r=e.style)?"light":r,a=void 0===(o=e.minZoom)?0:o,u=void 0===(s=e.maxZoom)?18:s,l=void 0===(c=e.token)?x2:c,f=e.mapInstance,p=void 0===(h=e.plugin)?[]:h,d=(0,lY.Z)(e,x1),t.next=3,new Promise(function(t){var e=function(){if(f)v.map=f,v.$mapContainer=v.map.getContainer(),setTimeout(function(){v.map.on("camerachange",v.handleCameraChanged),t()},30);else{v.$mapContainer=v.creatMapContainer(n);var e=(0,rW.Z)({mapStyle:v.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",function(){setTimeout(function(){return v.handleAfterMapChange()})}),v.map=r,setTimeout(function(){t()},10)}};x3||f?x3&&window.AMap||f?e():x5.push(e):(l===x2&&console.warn(v.configService.getSceneWarninfo("MapToken")),x3=!0,p.push("Map3D"),xQ.load({key:l,version:"1.4.15",plugins:p}).then(function(t){e(),x5.length&&(x5.forEach(function(t){return t()}),x5=[])}).catch(function(t){throw Error(t)}))});case 3:this.viewport=new x0;case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(r2(AMap.LngLat,(0,i2.Z)(t)),r2(AMap.LngLat,(0,i2.Z)(e))),r=this.lngLatToCoord(t),i=(0,i3.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,i3.Z)(s,2);return Math.sqrt(Math.pow(o-u[0],2)+Math.pow(a-u[1],2))/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}}]),i}(xW))||nq,x7=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return x4}}]),r}(xx),x6=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"projectionMatrix",cy()),(0,ac.Z)(this,"viewMatrix",cy()),(0,ac.Z)(this,"viewProjectionMatrix",cy()),(0,ac.Z)(this,"ViewProjectionMatrixUncentered",cy()),(0,ac.Z)(this,"viewUncenteredMatrix",cy())}return(0,rX.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=t.center,r=t.offsetOrigin,i=void 0===r?[0,0]:r,o=t.cameraPosition,a=t.up,s=t.lookAt,u=t.aspect,c=t.near,l=t.far,f=t.fov;this.zoom=void 0===e?1:e,this.center=void 0===n?[0,0]:n,c$(this.projectionMatrix,(void 0===f?45:f)/180*Math.PI,void 0===u?1:u,void 0===c?.1:c,void 0===l?1e3:l);var h=p9.apply(rO,(0,i2.Z)(void 0===o?[0,0,0]:o)),p=p9.apply(rO,(0,i2.Z)(void 0===s?[0,0,0]:s)),d=p9.apply(rO,(0,i2.Z)(void 0===a?[0,1,0]:a));c3(this.viewMatrix,h,p,d),this.viewUncenteredMatrix=cb(this.viewMatrix),cT(this.viewMatrix,this.viewMatrix,p9(-i[0],i[1],0)),cM(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),cM(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=(0,i3.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),n=Math.PI/180,r=t[0]*n,i=e*n;i=Math.log(Math.tan(Math.PI/4+i/2));var o=-.5/Math.PI;return n=.5,[r=268435456*(.5/Math.PI*r+.5)-215440491,i=-(268435456*(o*i+n)-106744817)]}}]),t}(),x8=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n.amap-copyright {\n  display: none !important;\n}\n");var x9=[108.92361,34.54083];window.forceWebGL=!0;var _t="f59bcf249433f8b05caaee19f349b3d7",_e=(0,cn.b2)()(nX=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"version","GAODE2.x"),(0,ac.Z)((0,se.Z)(t),"handleViewChanged",function(e){var n=t.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,c=n.up;t.emit("mapchange");var l=t.map.customCoords.getCenter();t.cameraChangedCallback&&(t.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:c,near:i,zoom:t.map.getZoom()-1,center:l,offsetOrigin:[s[0],s[1]]}),t.coordinateSystemService.setCoordinateSystem(lM.P20_2),t.cameraChangedCallback(t.viewport))}),t}return(0,rX.Z)(i,[{key:"setCustomCoordCenter",value:function(t){this.sceneCenter=t,this.sceneCenterMercator=aE.apply(void 0,(0,i2.Z)(t))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(t,e){var n=e||this.sceneCenterMercator,r=this._sub(aE(t[0],t[1]),n);return t[2]&&r.push(t[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(t,e){var n=this,r=aE(e[0],e[1]);return"number"==typeof t[0]?this.lngLatToCoordByLayer(t,r):t.map(function(t){return Array.isArray(t)&&"number"==typeof t[0]?n.lngLatToCoordByLayer(t,r):t.map(function(t){return n.lngLatToCoordByLayer(t,r)})})}},{key:"setCoordCenter",value:function(t){this.map.customCoords.setCenter(t||x9),this.setCustomCoordCenter(t||x9)}},{key:"lngLatToCoord",value:function(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(aE(t[0],t[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map(function(t){return"number"==typeof t[0]?e.lngLatToCoord(t):t.map(function(t){return e.lngLatToCoord(t)})})}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=oF("div","l7-marker-container2",e)}}}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(t){var e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lngLatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(t),o=cy();return cT(o,o,p9(i[0],i[1],e)),cL(o,o,p9(r[0],r[1],r[2])),cP(o,o,n[0]),cO(o,o,n[1]),cR(o,o,n[2]),o}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(e=this.config).id,i=void 0===(r=e.style)?"light":r,a=void 0===(o=e.minZoom)?0:o,u=void 0===(s=e.maxZoom)?24:s,l=void 0===(c=e.token)?_t:c,f=e.mapInstance,p=void 0===(h=e.plugin)?[]:h,e.version,d=(0,lY.Z)(e,x8),this.viewport=new x6,window.AMap||f){t.next=6;break}return p.push("Map3D"),t.next=6,xS().load({key:l,version:"2.0",plugins:p});case 6:f?(this.map=f,this.$mapContainer=this.map.getContainer(),m=this.map.getCenter(),null===(v=this.map.customCoords)||void 0===v||v.setCenter([m.lng,m.lat]),this.setCustomCoordCenter([m.lng,m.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),(y=(0,rW.Z)({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d)).zoom&&(y.zoom+=1),l===_t&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;")),b=new AMap.Map(this.$mapContainer,y),this.map=b,x=b.getCenter(),null===(g=this.map.customCoords)||void 0===g||g.setCenter([x.lng,x.lat]),this.setCustomCoordCenter([x.lng,x.lat]),b.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,e=(null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams())||{},n=e.fov,r=e.near,i=e.far,o=e.aspect,a=e.position,s=e.lookAt,u=e.up;this.emit("mapchange");var c=this.map.customCoords.getCenter(),l=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:l-1,center:c,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(lM.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,e){var n=[0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}}]),i}(xW))||nX,_n=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return _e}}]),r}(xx),_r={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},_i={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},_o=(nK=(0,cn.b2)(),n$=(0,cn.f3)(ci.MapConfig),nQ=(0,cn.f3)(ci.IGlobalConfigService),nJ=(0,cn.f3)(ci.ICoordinateSystemService),n0=(0,cn.f3)(ci.IEventEmitter),nK((n2=lS((n1=function(){function t(){var e=this;(0,rK.Z)(this,t),(0,ac.Z)(this,"version","DEFAUlTMAP"),(0,ac.Z)(this,"simpleMapCoord",new xN),(0,ac.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),l_(this,"config",n2,this),l_(this,"configService",n3,this),l_(this,"coordinateSystemService",n5,this),l_(this,"eventEmitter",n4,this),(0,ac.Z)(this,"handleCameraChanged",function(t){var n=e.map.getCenter(),r=n.lat,i=n.lng;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[i,r],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0}),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})}return(0,rX.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=oF("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,e){-1!==hZ.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(_i[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(_i[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if("SIMPLE"===this.version)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,e){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,e=null!==(t=this.map.getStyle().sprite)&&void 0!==t?t:"";if(/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e))return null==e?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles");return e}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return _r}},{key:"getMapStyleValue",value:function(t){var e;return null!==(e=this.getMapStyleConfig()[t])&&void 0!==e?e:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate;this.viewport.getZoom()>12&&(void 0===t||t)?this.coordinateSystemService.setCoordinateSystem(lM.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(lM.LNGLAT)}}]),t}()).prototype,"config",[n$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=lS(n1.prototype,"configService",[nQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n5=lS(n1.prototype,"coordinateSystemService",[nJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n4=lS(n1.prototype,"eventEmitter",[n0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n1))||n1);if(!window)throw Error("BMapGL JSAPI can only be used in Browser.");var _a=((to=_a||{}).notload="notload",to.loading="loading",to.loaded="loaded",to.failed="failed",to),_s={key:"",BMapGL:{version:"1.0"}},_u={BMapGL:_a.notload},_c=[],_l=function(t){if("function"==typeof t){if(_u.BMapGL===_a.loaded){t(window.BMapGL);return}_c.push(t)}},_f={load:function(t){return new Promise(function(e,n){if(_u.BMapGL===_a.failed)n("");else if(_u.BMapGL===_a.notload){var r=t.key,i=t.version;if(!r){n("请填写key");return}_s.key=r,_s.BMapGL.version=i||_s.BMapGL.version,_u.BMapGL=_a.loading;var o=document.body||document.head;window.___onBMapGLAPILoaded=function(t){if(delete window.___onBMapGLAPILoaded,t)_u.BMapGL=_a.failed,n(t);else for(_u.BMapGL=_a.loaded;_c.length;)_c.splice(0,1)[0](window.BMapGL)};var a=document.createElement("script");a.type="text/javascript",a.src="https://api.map.baidu.com/api?type=webgl&v=".concat(_s.BMapGL.version,"&ak=").concat(_s.key,"&callback=___onBMapGLAPILoaded"),a.onerror=function(t){_u.BMapGL=_a.failed,n(t)},o.appendChild(a),_l(e)}else if(_u.BMapGL===_a.loaded){if(t.key&&t.key!==_s.key){n("多个不一致的 key");return}if(t.version&&t.version!==_s.BMapGL.version){n("不允许多个版本 JSAPI 混用");return}e(window.BMapGL)}else{if(t.key&&t.key!==_s.key){n("多个不一致的 key");return}if(t.version&&t.version!==_s.BMapGL.version){n("不允许多个版本 JSAPI 混用");return}_l(e)}})},reset:function(){delete window.BMapGL,_s={key:"",BMapGL:{version:"1.0"}},_u={BMapGL:_a.notload}}},_h=["id","center","zoom","token","mapInstance","version","mapSize","minZoom","maxZoom"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".BMap_cpyCtrl .anchorBL {\n  display: none !important;\n}\n\n.anchorBL {\n  display: none !important;\n}\n");var _p={mapmove:"moving",contextmenu:"rightclick",camerachange:"update",zoomchange:"zoomend"},_d="zLhopYPPERGtpGOgimcdKcCimGRyyIsh",_v=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"styleConfig",{normal:[]}),(0,ac.Z)((0,se.Z)(t),"currentStyle","normal"),(0,ac.Z)((0,se.Z)(t),"evtCbProxyMap",new Map),(0,ac.Z)((0,se.Z)(t),"handleCameraChanged",function(){t.emit("mapchange");var e=t.getMap(),n=e.getCenter(),r={center:[n.lng,n.lat],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:360-e.getHeading(),pitch:e.getTilt(),zoom:e.getZoom()-1.75};t.viewport.syncWithMapCamera(r),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}),t}return(0,rX.Z)(i,[{key:"getMap",value:function(){return this.map}},{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.viewport=new xD,n=(e=this.config).id,i=void 0===(r=e.center)?[121.30654632240122,31.25744185633306]:r,a=void 0===(o=e.zoom)?12:o,u=void 0===(s=e.token)?_d:s,c=e.mapInstance,f=void 0===(l=e.version)?"1.0":l,p=void 0===(h=e.mapSize)?1e4:h,v=void 0===(d=e.minZoom)?0:d,g=void 0===(m=e.maxZoom)?21:m,y=(0,lY.Z)(e,_h),this.viewport=new xD,this.version=f,this.simpleMapCoord.setSize(p),window.BMapGL||c){t.next=8;break}return t.next=8,_f.load({key:u,version:"1.0"});case 8:if(!c){t.next=17;break}this.map=c,this.$mapContainer=this.map.getContainer(),b=new BMapGL.Point(i[0],i[1]),this.map.isLoaded()||this.map.centerAndZoom(b,a),this.initMapByConfig(this.config),this.map.on("update",this.handleCameraChanged),t.next=32;break;case 17:if(x=(0,rW.Z)({enableWheelZoom:!0,minZoom:v,maxZoom:g},y),u===_d&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),n){t.next=21;break}throw Error("No container id specified");case 21:_=oz(n),S=(0,i2.Z)(_.childNodes),w=new BMapGL.Map(_,x),this.$mapContainer=w.getContainer(),S.forEach(function(t){C.$mapContainer.appendChild(t)}),S=null,this.map=w,k=new BMapGL.Point(i[0],i[1]),this.map.centerAndZoom(k,a),this.initMapByConfig(this.config),w.on("update",this.handleCameraChanged);case 32:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.getMap().destroy()}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.map.getPanes().markerPane}},{key:"on",value:function(t,e){if(-1!==hZ.indexOf(t)){this.eventEmitter.on(t,e);return}var n=this.evtCbProxyMap.get(t);if(n||this.evtCbProxyMap.set(t,n=new Map),!n.get(e)){var r=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];!n[0]||"object"!==(0,u5.Z)(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),e.apply(void 0,n)};n.set(e,r),this.map.on(_p[t]||t,r)}}},{key:"off",value:function(t,e){if(-1!==hZ.indexOf(t)){this.eventEmitter.off(t,e);return}var n,r,i=null===(n=this.evtCbProxyMap.get(t))||void 0===n?void 0:n.get(e);i&&(null===(r=this.evtCbProxyMap.get(t))||void 0===r||r.delete(e),this.map.off(_p[t]||t,i))}},{key:"once",value:function(t,e){this.eventEmitter.once(t,e)}},{key:"getContainer",value:function(){return this.getMap().getContainer()}},{key:"getSize",value:function(){var t=this.getMap().getSize();return[t.width,t.height]}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"getType",value:function(){return"bmap"}},{key:"getZoom",value:function(){return this.getMap().getZoom()}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=xz(t.padding),r=this.lngLatToPixel([e.lng,e.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.lng,lat:o.lat}}},{key:"getPitch",value:function(){return this.getMap().getTilt()}},{key:"getRotation",value:function(){return 360-this.getMap().getHeading()}},{key:"getBounds",value:function(){var t=this.getMap().getBounds(),e=t.getNorthEast(),n=t.getSouthWest();return[[n.lng,n.lat],[e.lng,e.lat]]}},{key:"getMapContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapStyleConfig",value:function(){return this.styleConfig}},{key:"getMapStyleValue",value:function(t){return this.styleConfig[t]}},{key:"setMapStyle",value:function(t){if(this.currentStyle!==t){var e=Array.isArray(t)?t:this.styleConfig[t]||t;if(Array.isArray(e)){this.map.setMapStyleV2({styleJson:e}),this.currentStyle=t;return}if("string"==typeof e){this.map.setMapStyleV2({styleId:e}),this.currentStyle=t;return}}}},{key:"setRotation",value:function(t){this.getMap().setHeading(t)}},{key:"zoomIn",value:function(){this.getMap().zoomIn()}},{key:"zoomOut",value:function(){this.getMap().zoomOut()}},{key:"panTo",value:function(t){this.getMap().panTo(new BMapGL.Point(t[0],t[1]))}},{key:"panBy",value:function(t,e){this.getMap().panBy(t,e)}},{key:"fitBounds",value:function(t,e){this.map.setViewport(t.map(function(t){return new BMapGL.Point(t[0],t[1])}),e)}},{key:"setZoomAndCenter",value:function(t,e){var n=(0,i3.Z)(e,2),r=n[0],i=n[1];this.getMap().centerAndZoom(new BMapGL.Point(r,i),t+1.75)}},{key:"setCenter",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1],o={lng:r,lat:i};if(null!=e&&e.padding){var a=xz(e.padding),s=this.lngLatToPixel([r,i]),u=[(a.right-a.left)/2,(a.bottom-a.top)/2];o=this.pixelToLngLat([s.x+u[0],s.y+u[1]])}this.getMap().setCenter(new BMapGL.Point(o.lng,o.lat))}},{key:"setPitch",value:function(t){this.getMap().setTilt(t)}},{key:"setZoom",value:function(t){this.getMap().setZoom(t)}},{key:"setMapStatus",value:function(t){var e=this,n=this.getMap();Object.keys(t).map(function(r){switch(r){case"doubleClickZoom":t.doubleClickZoom?n.enableDoubleClickZoom():n.disableDoubleClickZoom();break;case"dragEnable":t.dragEnable?n.enableDragging():n.disableDragging();break;case"keyboardEnable":t.keyboardEnable?n.enableKeyboard():n.disableKeyboard();break;case"resizeEnable":t.resizeEnable?n.enableAutoResize():n.disableAutoResize();break;case"rotateEnable":t.rotateEnable?(n.enableRotate(),n.enableRotateGestures()):(n.disableRotate(),n.disableRotateGestures());break;case"zoomEnable":t.zoomEnable?(e.map.enableDoubleClickZoom(),e.map.enableScrollWheelZoom(),e.map.enablePinchToZoom()):(e.map.disableDoubleClickZoom(),e.map.disableScrollWheelZoom(),e.map.disablePinchToZoom());break;case"showIndoorMap":n.setDisplayOptions({indoor:!!t.showIndoorMap})}})}},{key:"meterToCoord",value:function(t,e){var n=this.getMap().getDistance(r2(BMapGL.Point,(0,i2.Z)(t)),r2(BMapGL.Point,(0,i2.Z)(e))),r=this.lngLatToCoord(t),i=(0,i3.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,i3.Z)(s,2);return Math.sqrt(Math.pow(o-u[0],2)+Math.pow(a-u[1],2))/n}},{key:"pixelToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.getMap().pixelToPoint(new BMapGL.Pixel(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToPixel",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.getMap().pointToPixel(new BMapGL.Point(n,r));return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.getMap().overlayPixelToPoint(new BMapGL.Pixel(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.getMap().pointToOverlayPixel(new BMapGL.Point(n,r));return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.getMap().pointToPixel(new BMapGL.Point(n,r));return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map(function(t){return Array.isArray(t[0])?e.lngLatToCoords(t):e.lngLatToCoord(t)})}},{key:"lngLatToMercator",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1],o=this.getMap().lnglatToMercator(r,i),a=(0,i3.Z)(o,2);return{x:a[0],y:a[1],z:e}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cy();return cT(o,o,p9(i[0],i[1],e)),cL(o,o,p9(r[0],r[1],r[2])),cP(o,o,n[0]),cO(o,o,n[1]),cR(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw Error("Method not implemented.")}},{key:"exportMap",value:function(t){var e=this.getMap()._webglPainter._canvas;return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"hideLogo",value:function(){var t=this.map.getContainer();t&&oV(t,"bmap-contianer--hide-logo")}},{key:"initMapByConfig",value:function(t){var e=t.style,n=t.pitch,r=void 0===n?0:n,i=t.rotation,o=void 0===i?0:i,a=t.logoVisible;e&&this.setMapStyle(e),r&&this.setPitch(r),o&&this.setRotation(o),!1===(void 0===a||a)&&this.hideLogo()}}]),i}(_o),_m=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return _v}}]),r}(xx),_g=n(87421),_y=n.n(_g);function _b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function _x(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function __(t,e,n){return Math.min(n,Math.max(e,t))}function _S(t,e,n,r){var i=new(_y())(t,e,n,r);return function(t){return i.solve(t)}}var _w=_S(.25,.1,.25,1);function _k(){var t;return null==n7&&"undefined"!=typeof window&&window.matchMedia&&(n7=window.matchMedia("(prefers-reduced-motion: reduce)")),null===(t=n7)||void 0===t?void 0:t.matches}var _C=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),_E=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,_A=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function _M(t){var e=_E(t);return{cancel:function(){return _A(e)}}}var _T=function(){function t(e,n){if((0,rK.Z)(this,t),isNaN(e)||isNaN(n))throw Error("Invalid LngLat object: (".concat(e,", ").concat(n,")"));if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}return(0,rX.Z)(t,[{key:"wrap",value:function(){return new t(_x(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e;return 6371008.8*Math.acos(Math.min(Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e),1))}}],[{key:"convert",value:function(e){if(e instanceof t)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"===(0,u5.Z)(e)&&null!==e)return new t(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),t}(),_L=function(){function t(e,n){(0,rK.Z)(this,t),e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}return(0,rX.Z)(t,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof _T?new _T(t.lng,t.lat):_T.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof _T?new _T(t.lng,t.lat):_T.convert(t),this}},{key:"extend",value:function(e){var n,r,i=this.sw,o=this.ne;if(e instanceof _T)n=e,r=e;else if(!(e instanceof t))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(t.convert(e)):this.extend(_T.convert(e)):this;else if(n=e.sw,r=e.ne,!n||!r)return this;return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new _T(n.lng,n.lat),this.ne=new _T(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new _T((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new _T(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new _T(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var e=_T.convert(t),n=e.lng,r=e.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(e){return e instanceof t?e:new t(e)}}]),t}(),_Z=function(){function t(e,n){(0,rK.Z)(this,t),this.x=e,this.y=n}return(0,rX.Z)(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(t,e){return this.clone()._rotateAround(t,e)}},{key:"_matMult",value:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}}],[{key:"convert",value:function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}}]),t}(),_P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if((0,rK.Z)(this,t),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return(0,rX.Z)(t,[{key:"interpolate",value:function(t,e,n){return null!=e.top&&null!=t.top&&(this.top=t.top*(1-n)+e.top*n),null!=e.bottom&&null!=t.bottom&&(this.bottom=t.bottom*(1-n)+e.bottom*n),null!=e.left&&null!=t.left&&(this.left=t.left*(1-n)+e.left*n),null!=e.right&&null!=t.right&&(this.right=t.right*(1-n)+e.right*n),this}},{key:"getCenter",value:function(t,e){return new _Z(__((this.left+t-this.right)/2,0,t),__((this.top+e-this.bottom)/2,0,e))}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}(),_O=2*Math.PI*6371008.8;function _R(t){return _O*Math.cos(t*Math.PI/180)}function _I(t){return(180+t)/360}function _D(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function _N(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var _z=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,rK.Z)(this,t),this.x=+e,this.y=+n,this.z=+r}return(0,rX.Z)(t,[{key:"toLngLat",value:function(){return new _T(360*this.x-180,_N(this.y))}},{key:"toAltitude",value:function(){return this.z*_R(_N(this.y))}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/_O*(1/Math.cos(_N(this.y)*Math.PI/180))}}],[{key:"fromLngLat",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=_T.convert(e);return new t(_I(r.lng),_D(r.lat),n/_R(r.lat))}}]),t}();function _j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var _B=function(){function t(e,n,r,i,o){(0,rK.Z)(this,t),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new _T(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new _P,this.posMatrixCache={},this.alignedPosMatrixCache={}}return(0,rX.Z)(t,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new _Z(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var e,n,r,i,o,a,s,u,c,l,f=-_x(t,-180,180)*Math.PI/180;this.angle!==f&&(this.unmodified=!1,this.angle=f,this.calcMatrices(),this.rotationMatrix=(e=new s2(4),s2!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e),n=this.rotationMatrix,r=this.rotationMatrix,i=this.angle,o=r[0],a=r[1],s=r[2],u=r[3],c=Math.sin(i),l=Math.cos(i),n[0]=o*l+s*c,n[1]=a*l+u*c,n[2]=-(o*c)+s*l,n[3]=-(a*c)+u*l)}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var e=__(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==e&&(this.unmodified=!1,this._pitch=e,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==e&&(this.unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){(t.lat!==this._center.lat||t.lng!==this._center.lng)&&(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.center=this._center,e.zoom=this.zoom,e.angle=this.angle,e.fov=this._fov,e.pitch=this._pitch,e.unmodified=this.unmodified,e.edgeInsets=this.edgeInsets.clone(),e.calcMatrices(),e}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,e,n){this.unmodified=!1,this.edgeInsets.interpolate(t,e,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){return Math.max(0,(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize)))}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var e=__(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new _Z(_I(t.lng)*this.worldSize,_D(e)*this.worldSize)}},{key:"unproject",value:function(t){return new _z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,e){var n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new _z(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var e=new Float64Array([t.x,t.y,0,1]),n=new Float64Array([t.x,t.y,1,1]);lC(e,e,this.pixelMatrixInverse),lC(n,n,this.pixelMatrixInverse);var r=e[3],i=n[3],o=e[0]/r,a=n[0]/i,s=e[1]/r,u=n[1]/i,c=e[2]/r,l=n[2]/i,f=c===l?0:(0-c)/(l-c);return new _z((o*(1-f)+a*f)/this.worldSize,(s*(1-f)+u*f)/this.worldSize)}},{key:"getBounds",value:function(){return new _L().extend(this.pointLocation(new _Z(0,0))).extend(this.pointLocation(new _Z(this.width,0))).extend(this.pointLocation(new _Z(this.width,this.height))).extend(this.pointLocation(new _Z(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new _L([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new _Z(0,0)),e=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]);return lC(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new _Z(0,t))}},{key:"getCameraQueryGeometry",value:function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];var n,r=e.x,i=e.y,o=e.x,a=e.y,s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _j(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(t){s.e(t)}finally{s.f()}return[new _Z(r,i),new _Z(o,i),new _Z(o,a),new _Z(r,a),new _Z(r,i)]}},{key:"coordinatePoint",value:function(t){var e=lk(t.x*this.worldSize,t.y*this.worldSize,0,1);return lC(e,e,this.pixelMatrix),new _Z(e[0]/e[3],e[1]/e[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return _z.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var t,e,n,r,i=-90,o=90,a=-180,s=180,u=this.size,c=this.unmodified;if(this.latRange){var l=this.latRange;i=_D(l[1])*this.worldSize,t=(o=_D(l[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var f=this.lngRange;a=_I(f[0])*this.worldSize,e=(s=_I(f[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var h=this.point,p=Math.max(e||0,t||0);if(p){this.center=this.unproject(new _Z(e?(s+a)/2:h.x,t?(o+i)/2:h.y)),this.zoom+=this.scaleZoom(p),this.unmodified=c,this.constraining=!1;return}if(this.latRange){var d=h.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var m=h.x,g=u.x/2;m-g<a&&(n=a+g),m+g>s&&(n=s-g)}(void 0!==n||void 0!==r)&&(this.center=this.unproject(new _Z(void 0!==n?n:h.x,void 0!==r?r:h.y))),this.unmodified=c,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var t=this._fov/2,e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(__(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance,c=this.height/50,l=new Float64Array(16);c$(l,this._fov,this.width/this.height,c,1.01*u),l[8]=-(2*e.x)/this.width,l[9]=2*e.y/this.height,cL(l,l,[1,-1,1]),cT(l,l,[0,0,-this.cameraToCenterDistance]),cP(l,l,this._pitch),cR(l,l,this.angle),cT(l,l,[-a,-s,0]),this.mercatorMatrix=cL([],l,[this.worldSize,this.worldSize,this.worldSize]),cL(l,l,[1,1,1/_R(this.center.lat)*this.worldSize,1]),this.projMatrix=l,this.invProjMatrix=cC([],this.projMatrix);var f=this.width%2/2,h=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*f+d*h,m=s-Math.round(s)+p*h+d*f,g=new Float64Array(l);if(cT(g,g,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=g,cL(l=cy(),l,[this.width/2,-this.height/2,1]),cT(l,l,[1,-1,0]),this.labelPlaneMatrix=l,cL(l=cy(),l,[1,-1,1]),cT(l,l,[-1,-1,0]),cL(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=cM(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(l=cC(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");this.pixelMatrixInverse=l,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),t}(),_F=oD.merge,_U=(0,rX.Z)(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,rK.Z)(this,t),_F(this,n),this.type=e}),_V=oD.merge,_H=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){(0,rK.Z)(this,r),e=n.call(this),(0,ac.Z)((0,se.Z)(e),"renderFrameCallback",function(){var t=Math.min((_C()-e.easeStart)/e.easeOptions.duration,1);e.onEaseFrame(e.easeOptions.easing(t)),t<1?e.easeFrameId=e.requestRenderFrame(e.renderFrameCallback):e.stop()}),e.options=t;var e,i=t.minZoom,o=t.maxZoom,a=t.minPitch,s=t.maxPitch,u=t.renderWorldCopies;return e.moving=!1,e.zooming=!1,e.bearingSnap=t.bearingSnap,e.pitchEnabled=t.pitchEnabled,e.rotateEnabled=t.rotateEnabled,e.transform=new _B(i,o,a,s,u),e}return(0,rX.Z)(r,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center;return new _T(t.lng,t.lat)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,e){return this.jumpTo({center:t},e)}},{key:"setPitch",value:function(t,e){return this.jumpTo({pitch:t},e),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,e,n){return this.easeTo(_V({center:t},e),n)}},{key:"panBy",value:function(t,e,n){return t=_Z.convert(t).mult(-1),this.panTo(this.transform.center,function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0;i<n.length;i++){var o=n[i];for(var a in o)void 0!==o[a]&&(t[a]=o[a])}return t}({offset:t},e||{}),n)}},{key:"zoomOut",value:function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}},{key:"setBearing",value:function(t,e){return this.jumpTo({bearing:t},e),this}},{key:"setZoom",value:function(t,e){return this.jumpTo({zoom:t},e),this}},{key:"zoomIn",value:function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}},{key:"zoomTo",value:function(t,e,n){return this.easeTo(_V({zoom:t},e),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,e){return this.jumpTo({padding:t},e),this}},{key:"rotateTo",value:function(t,e,n){return this.easeTo(_V({bearing:t},e),n)}},{key:"resetNorth",value:function(t,e){return this.rotateTo(0,_V({duration:1e3},t),e),this}},{key:"resetNorthPitch",value:function(t,e){return this.easeTo(_V({bearing:0,pitch:0,duration:1e3},t),e),this}},{key:"fitBounds",value:function(t,e,n){return this.fitInternal(this.cameraForBounds(t,e),e,n)}},{key:"cameraForBounds",value:function(t,e){return t=_L.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)}},{key:"snapToNorth",value:function(t,e){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,e):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==t.zoom&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=_T.convert(t.center)),void 0!==t.bearing&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),void 0!==t.pitch&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),void 0===t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this.emit("movestart",new _U("movestart",e)),this.emit("move",new _U("move",e)),r&&(this.emit("zoomstart",new _U("zoomstart",e)),this.emit("zoom",new _U("zoom",e)),this.emit("zoomend",new _U("zoomend",e))),i&&(this.emit("rotatestart",new _U("rotatestart",e)),this.emit("rotate",new _U("rotate",e)),this.emit("rotateend",new _U("rotateend",e))),o&&(this.emit("pitchstart",new _U("pitchstart",e)),this.emit("pitch",new _U("pitch",e)),this.emit("pitchend",new _U("pitchend",e))),this.emit("moveend",new _U("moveend",e))}},{key:"easeTo",value:function(){var t,e,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;(!1===(r=_V({offset:[0,0],duration:500,easing:_w},r)).animate||!r.essential&&_k())&&(r.duration=0);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),c=this.getPadding(),l=r.zoom?+r.zoom:a,f=r.bearing?this.normalizeBearing(r.bearing,s):s,h=r.pitch?+r.pitch:u,p=r.padding?r.padding:o.padding,d=_Z.convert(r.offset),v=o.centerPoint.add(d),m=o.pointLocation(v),g=_T.convert(r.center||m);this.normalizeCenter(g);var y=o.project(m),b=o.project(g).sub(y),x=o.zoomScale(l-a);r.around&&(t=_T.convert(r.around),e=o.locationPoint(t));var _={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||l!==a,this.rotating=this.rotating||s!==f,this.pitching=this.pitching||h!==u,this.padding=!o.isPaddingEqual(p),this.easeId=r.easeId,this.prepareEase(i,r.noMoveStart,_),clearTimeout(this.easeEndTimeoutID),this.ease(function(r){if(n.zooming&&(o.zoom=a*(1-r)+l*r),n.rotating&&n.rotateEnabled&&(o.bearing=s*(1-r)+f*r),n.pitching&&n.pitchEnabled&&(o.pitch=u*(1-r)+h*r),n.padding&&(o.interpolatePadding(c,p,r),v=o.centerPoint.add(d)),t)o.setLocationAtPoint(t,e);else{var m=o.zoomScale(o.zoom-a),g=Math.pow(l>a?Math.min(2,x):Math.max(.5,x),1-r),_=o.unproject(y.add(b.mult(r*g)).mult(m));o.setLocationAtPoint(o.renderWorldCopies?_.wrap():_,v)}n.fireMoveEvents(i)},function(t){n.afterEase(i,t)},r),this}},{key:"flyTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.essential&&_k()){var r=function(t,e){var n,r={},i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _b(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in t&&(r[o]=t[o])}}catch(t){i.e(t)}finally{i.f()}return r}(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=_V({offset:[0,0],speed:1.2,curve:1.42,easing:_w},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),c=e.zoom?__(+e.zoom,i.minZoom,i.maxZoom):o,l=e.bearing?this.normalizeBearing(e.bearing,a):a,f=e.pitch?+e.pitch:s,h="padding"in e?e.padding:i.padding,p=i.zoomScale(c-o),d=_Z.convert(e.offset),v=i.centerPoint.add(d),m=i.pointLocation(v),g=_T.convert(e.center||m);this.normalizeCenter(g);var y=i.project(m),b=i.project(g).sub(y),x=e.curve,_=Math.max(i.width,i.height),S=_/p,w=b.mag();if("minZoom"in e){var k=__(Math.min(e.minZoom,o,c),i.minZoom,i.maxZoom);x=Math.sqrt(_/i.zoomScale(k-o)/w*2)}var C=x*x;function E(t){var e=(S*S-_*_+(t?-1:1)*C*C*w*w)/(2*(t?S:_)*C*w);return Math.log(Math.sqrt(e*e+1)-e)}function A(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}var L=E(0),Z=function(t){return M(L)/M(L+x*t)},P=function(t){var e;return(M(L)*(A(e=L+x*t)/M(e))-A(L))/C*_/w},O=(E(1)-L)/x;if(1e-6>Math.abs(w)||!isFinite(O)){if(1e-6>Math.abs(_-S))return this.easeTo(e,n);var R=S<_?-1:1;O=Math.abs(Math.log(S/_))/x,P=function(){return 0},Z=function(t){return Math.exp(R*x*t)}}if("duration"in e)e.duration=+e.duration;else{var I="screenSpeed"in e?+e.screenSpeed/x:+e.speed;e.duration=1e3*O/I}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this.zooming=!0,this.rotating=a!==l,this.pitching=f!==s,this.padding=!i.isPaddingEqual(h),this.prepareEase(n,!1),this.ease(function(e){var r=e*O,p=1/Z(r);i.zoom=1===e?c:o+i.scaleZoom(p),t.rotating&&(i.bearing=a*(1-e)+l*e),t.pitching&&(i.pitch=s*(1-e)+f*e),t.padding&&(i.interpolatePadding(u,h,e),v=i.centerPoint.add(d));var m=1===e?g:i.unproject(y.add(b.mult(P(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?m.wrap():m,v),t.fireMoveEvents(n)},function(){return t.afterEase(n)},e),this}},{key:"fitScreenCoordinates",value:function(t,e,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(_Z.convert(t)),this.transform.pointLocation(_Z.convert(e)),n,r),r,i)}},{key:"stop",value:function(t,e){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,e)}return this}},{key:"normalizeBearing",value:function(t,e){var n=Math.abs((t=_x(t,-180,180))-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new _U("move",t)),this.zooming&&this.emit("zoom",new _U("zoom",t)),this.rotating&&this.emit("rotate",new _U("rotate",t)),this.pitching&&this.emit("rotate",new _U("pitch",t))}},{key:"prepareEase",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,e||n.moving||this.emit("movestart",new _U("movestart",t)),this.zooming&&!n.zooming&&this.emit("zoomstart",new _U("zoomstart",t)),this.rotating&&!n.rotating&&this.emit("rotatestart",new _U("rotatestart",t)),this.pitching&&!n.pitching&&this.emit("pitchstart",new _U("pitchstart",t))}},{key:"afterEase",value:function(t,e){if(!this.easeId||!e||this.easeId!==e){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new _U("zoomend",t)),r&&this.emit("rotateend",new _U("rotateend",t)),i&&this.emit("pitchend",new _U("pitchend",t)),this.emit("moveend",new _U("moveend",t))}}},{key:"ease",value:function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this.easeStart=_C(),this.easeOptions=n,this.onEaseFrame=t,this.onEaseEnd=e,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,e,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=_V({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=_V(i,r.padding);var a=this.transform,s=a.padding,u=a.project(_T.convert(t)),c=a.project(_T.convert(e)),l=u.rotate(-n*Math.PI/180),f=c.rotate(-n*Math.PI/180),h=new _Z(Math.max(l.x,f.x),Math.max(l.y,f.y)),p=new _Z(Math.min(l.x,f.x),Math.min(l.y,f.y)),d=h.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,m=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(m<0)&&!(v<0)){var g=Math.min(a.scaleZoom(a.scale*Math.min(v,m)),r.maxZoom),y=_Z.convert(r.offset),b=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,_=new _Z(y.x+b,y.y+x).mult(a.scale/a.zoomScale(g));return{center:a.unproject(u.add(c).div(2).sub(_)),zoom:g,bearing:n}}}},{key:"fitInternal",value:function(t,e,n){return t?(e=_V(t,e),delete e.padding,e.linear?this.easeTo(e,n):this.flyTo(e,n)):this}}]),r}(so.EventEmitter);function _G(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _W(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _W(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _W(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var _Y={};_Y.create=function(t,e,n){var r=window.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r},_Y.createNS=function(t,e){return window.document.createElementNS(t,e)};var _q=window.document&&window.document.documentElement.style;function _X(t){if(!_q)return t[0];var e,n=_G(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r in _q)return r}}catch(t){n.e(t)}finally{n.f()}return t[0]}var _K=_X(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);_Y.disableDrag=function(){_q&&_K&&(n6=_q[_K],_q[_K]="none")},_Y.enableDrag=function(){_q&&_K&&(_q[_K]=n6)};var _$=_X(["transform","WebkitTransform"]);_Y.setTransform=function(t,e){t.style[_$]=e};var _Q=!1;try{var _J=Object.defineProperty({},"passive",{get:function(){_Q=!0}});window.addEventListener("test",_J,_J),window.removeEventListener("test",_J,_J)}catch(t){_Q=!1}_Y.addEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&_Q?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},_Y.removeEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&_Q?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var _0=function t(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",t,!0)};_Y.suppressClick=function(){window.addEventListener("click",_0,!0),setTimeout(function(){window.removeEventListener("click",_0,!0)},0)},_Y.mousePos=function(t,e){var n=t.getBoundingClientRect();return new _Z(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},_Y.touchPos=function(t,e){var n,r=t.getBoundingClientRect(),i=[],o=_G(e);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.push(new _Z(a.clientX-r.left-t.clientLeft,a.clientY-r.top-t.clientTop))}}catch(t){o.e(t)}finally{o.f()}return i},_Y.mouseButton=function(t){return t.button},_Y.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var _1=oD.merge,_2=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t,e,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,rK.Z)(this,r);var s=_Y.mousePos(e.getCanvasContainer(),i),u=e.unproject(s);return(o=n.call(this,t,_1({point:s,lngLat:u,originalEvent:i},a))).defaultPrevented=!1,o.target=e,o}return(0,rX.Z)(r,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),r}(_U),_3=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t,e,i){(0,rK.Z)(this,r);var o,a="touchend"===t?i.changedTouches:i.touches,s=_Y.touchPos(e.getCanvasContainer(),a),u=s.map(function(t){return e.unproject(t)}),c=s.reduce(function(t,e,n,r){return t.add(e.div(r.length))},new _Z(0,0)),l=e.unproject(c);return(o=n.call(this,t,{points:s,point:c,lngLats:u,lngLat:l,originalEvent:i})).defaultPrevented=!1,o}return(0,rX.Z)(r,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),r}(_U),_5=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t,e,i){var o;return(0,rK.Z)(this,r),(o=n.call(this,t,{originalEvent:i})).defaultPrevented=!1,o}return(0,rX.Z)(r,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),r}(_U),_4=function(){function t(e){(0,rK.Z)(this,t),this.map=e}return(0,rX.Z)(t,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new _2(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new _2("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new _2(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),t}(),_7=function(){function t(e,n){(0,rK.Z)(this,t),this.map=e,this.el=e.getCanvasContainer(),this.container=e.getContainer(),this.clickTolerance=n.clickTolerance||1}return(0,rX.Z)(t,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(_Y.disableDrag(),this.startPos=this.lastPos=e,this.active=!0)}},{key:"mousemoveWindow",value:function(t,e){if(this.active&&!(this.lastPos.equals(e)||!this.box&&e.dist(this.startPos)<this.clickTolerance)){var n=this.startPos;this.lastPos=e,this.box||(this.box=_Y.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var r=Math.min(n.x,e.x),i=Math.max(n.x,e.x),o=Math.min(n.y,e.y),a=Math.max(n.y,e.y);_Y.setTransform(this.box,"translate(".concat(r,"px,").concat(o,"px)")),this.box&&(this.box.style.width="".concat(i-r,"px"),this.box.style.height="".concat(a-o,"px"))}}},{key:"mouseupWindow",value:function(t,e){var n=this;if(this.active&&0===t.button){var r=this.startPos;if(this.reset(),_Y.suppressClick(),r.x!==e.x||r.y!==e.y)return this.map.emit("boxzoomend",new _U("boxzoomend",{originalEvent:t})),{cameraAnimation:function(t){return t.fitScreenCoordinates(r,e,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(t){this.active&&27===t.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(_Y.remove(this.box),this.box=null),_Y.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,e){return this.map.emit(t,new _U(t,{originalEvent:e}))}}]),t}(),_6=function(){function t(){(0,rK.Z)(this,t),this.reset()}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),_8=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){var t;(0,rK.Z)(this,r);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t=n.call.apply(n,[this].concat(i)),(0,ac.Z)((0,se.Z)(t),"type","renderFrame"),t}return(0,rX.Z)(r)}(_U);function _9(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var St=oD.merge,Se={linearity:.3,easing:_S(0,0,.3,1)},Sn=St({deceleration:2500,maxSpeed:1400},Se),Sr=St({deceleration:20,maxSpeed:1400},Se),Si=St({deceleration:1e3,maxSpeed:360},Se),So=St({deceleration:1e3,maxSpeed:90},Se),Sa=function(){function t(e){(0,rK.Z)(this,t),this.map=e,this.clear()}return(0,rX.Z)(t,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:_C(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,e=_C();t.length>0&&e-t[0].time>160;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var e,n={zoom:0,bearing:0,pitch:0,pan:new _Z(0,0),pinchAround:void 0,around:void 0},r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _9(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _9(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.inertiaBuffer);try{for(r.s();!(e=r.n()).done;){var i=e.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(t){r.e(t)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=Su(n.pan.mag(),o,St({},Sn,t||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,Ss(a,s)}if(n.zoom){var u=Su(n.zoom,o,Sr);a.zoom=this.map.transform.zoom+u.amount,Ss(a,u)}if(n.bearing){var c=Su(n.bearing,o,Si);a.bearing=this.map.transform.bearing+__(c.amount,-179,179),Ss(a,c)}if(n.pitch){var l=Su(n.pitch,o,So);a.pitch=this.map.transform.pitch+l.amount,Ss(a,l)}if(a.zoom||a.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;a.around=f?this.map.unproject(f):this.map.getCenter()}return this.clear(),St(a,{noMoveStart:!0})}}}]),t}();function Ss(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Su(t,e,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=__(t*i/(e/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:s/2*a}}var Sc=function(){function t(){(0,rK.Z)(this,t),this.panStep=100,this.bearingStep=15,this.pitchStep=10}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var e=this;if(!t.altKey&&!t.ctrlKey&&!t.metaKey){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Sl,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e.bearingStep,pitch:s.getPitch()+i*e.pitchStep,offset:[-o*e.panStep,-a*e.panStep],center:s.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function Sl(t){return t*(2-t)}var Sf=function(){function t(e,n){(0,rK.Z)(this,t),this.map=e,this.clickTolerance=n.clickTolerance}return(0,rX.Z)(t,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new _5(t.type,this.map,t))}},{key:"mousedown",value:function(t,e){return this.mousedownPos=e,this.firePreventable(new _2(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new _2(t.type,this.map,t))}},{key:"click",value:function(t,e){this.mousedownPos&&this.mousedownPos.dist(e)>=this.clickTolerance||this.map.emit(t.type,new _2(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new _2(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new _2(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new _2(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new _3(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new _3(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new _3(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new _3(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),t}(),Sh=(n8={},(0,ac.Z)(n8,0,1),(0,ac.Z)(n8,2,2),n8),Sp=function(){function t(e){(0,rK.Z)(this,t),this.reset(),this.clickTolerance=e.clickTolerance||1}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,e){if(!this.lastPoint){var n=_Y.mouseButton(t);this.correctButton(t,n)&&(this.lastPoint=e,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(t,e){var n,r=this.lastPoint;if(r){if(t.preventDefault(),n=Sh[this.eventButton],void 0===t.buttons||(t.buttons&n)!==n){this.reset();return}if(!(!this.moved&&e.dist(r)<this.clickTolerance))return this.moved=!0,this.lastPoint=e,this.move(r,e)}}},{key:"mouseupWindow",value:function(t){this.lastPoint&&_Y.mouseButton(t)===this.eventButton&&(this.moved&&_Y.suppressClick(),this.reset())}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,e){return!1}},{key:"move",value:function(t,e){}}]),t}(),Sd=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"mousedown",value:function(t,e){fX((0,rJ.Z)(r.prototype),"mousedown",this).call(this,t,e),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,e){return{around:e,panDelta:e.sub(t)}}},{key:"correctButton",value:function(t,e){return 0===e&&!t.ctrlKey}}]),r}(Sp),Sv=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=-((e.y-t.y)*.5);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),r}(Sp),Sm=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=(e.x-t.x)*.8;if(n)return this.active=!0,{bearingDelta:n}}}]),r}(Sp),Sg=1/450,Sy=function(){function t(e,n){var r=this;(0,rK.Z)(this,t),(0,ac.Z)(this,"onScrollFrame",function(){if(r.frameId&&(r.frameId=null,r.isActive())){var t,e=r.map.transform;if(0!==r.delta){var n="wheel"===r.type&&Math.abs(r.delta)>4.000244140625?r.wheelZoomRate:r.defaultZoomRate,i=2/(1+Math.exp(-Math.abs(r.delta*n)));r.delta<0&&0!==i&&(i=1/i);var o="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(o*i))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,c=!1;if("wheel"===r.type&&s&&u){var l=Math.min((_C()-r.lastWheelEventTime)/200,1),f=u(l);t=s*(1-f)+a*f,l<1?r.frameId||(r.frameId=!0):c=!0}else t=a,c=!0;return r.active=!0,c&&(r.active=!1,r.finishTimeout=setTimeout(function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout},200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:t-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}}),this.map=e,this.el=e.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=Sg}return(0,rX.Z)(t,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&"center"===t.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=_C(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==e&&e%4.000244140625==0?this.type="wheel":0!==e&&4>Math.abs(e)?this.type="trackpad":r>400?(this.type=null,this.lastValue=e,this.timeout=setTimeout(this.onTimeout,40,t)):!this.type&&(this.type=200>Math.abs(r*e)?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,e+=this.lastValue)),t.shiftKey&&e&&(e/=4),this.type&&(this.lastWheelEvent=t,this.delta-=e,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var e=_Y.mousePos(this.el,t);this.around=_T.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(e)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var e=_w;if(this.prevEase){var n=this.prevEase,r=(_C()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;e=_S(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:_C(),duration:t,easing:e},e}}]),t}(),Sb=function(){function t(e,n){(0,rK.Z)(this,t),this.clickZoom=e,this.tapZoom=n}return(0,rX.Z)(t,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),t}(),Sx=function(){function t(e,n,r){(0,rK.Z)(this,t),this.el=e,this.mousePan=n,this.touchPan=r}return(0,rX.Z)(t,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),t}(),S_=function(){function t(e,n,r){(0,rK.Z)(this,t),this.pitchWithRotate=e.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return(0,rX.Z)(t,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),t}(),SS=function(){function t(e,n,r,i){(0,rK.Z)(this,t),this.el=e,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return(0,rX.Z)(t,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),t}();function Sw(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}function Sk(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var SC=function(){function t(e){(0,rK.Z)(this,t),this.reset(),this.numTouches=e.numTouches}return(0,rX.Z)(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,e,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){var e,n=new _Z(0,0),r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Sk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sk(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n._add(i)}}catch(t){r.e(t)}finally{r.f()}return n.div(t.length)}(e),this.touches=Sw(n,e)))}},{key:"touchmove",value:function(t,e,n){if(!this.aborted&&this.centroid){var r=Sw(n,e);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),SE=function(){function t(e){(0,rK.Z)(this,t),this.singleTap=new SC(e),this.numTaps=e.numTaps,this.reset()}return(0,rX.Z)(t,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,e,n){this.singleTap.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.singleTap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||30>this.lastTap.dist(r);if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),t}(),SA=function(){function t(){(0,rK.Z)(this,t),this.tap=new SE({numTouches:1,numTaps:1}),this.reset()}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,e,n){!this.swipePoint&&(this.tapTime&&t.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=e[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(t,e,n))}},{key:"touchmove",value:function(t,e,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=e[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,t.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(t,e,n)&&(this.tapTime=t.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),SM=function(){function t(){(0,rK.Z)(this,t),this.zoomIn=new SE({numTouches:1,numTaps:2}),this.zoomOut=new SE({numTouches:2,numTaps:1}),this.reset()}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,e,n){this.zoomIn.touchstart(t,e,n),this.zoomOut.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.zoomIn.touchmove(t,e,n),this.zoomOut.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this,i=this.zoomIn.touchend(t,e,n),o=this.zoomOut.touchend(t,e,n);return i?(this.active=!0,t.preventDefault(),setTimeout(function(){return r.reset()},0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this.active=!0,t.preventDefault(),setTimeout(function(){return r.reset()},0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),ST=function(){function t(e){(0,rK.Z)(this,t),this.minTouches=1,this.clickTolerance=e.clickTolerance||1,this.reset()}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new _Z(0,0)}},{key:"touchstart",value:function(t,e,n){return this.calculateTransform(t,e,n)}},{key:"touchmove",value:function(t,e,n){if(this.active)return t.preventDefault(),this.calculateTransform(t,e,n)}},{key:"touchend",value:function(t,e,n){this.calculateTransform(t,e,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,e,n){n.length>0&&(this.active=!0);var r=Sw(n,e),i=new _Z(0,0),o=new _Z(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],c=this.touches[s];c&&(i._add(u),o._add(u.sub(c)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var l=o.div(a);if(this.sum._add(l),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:l}}}}]),t}(),SL=function(){function t(){(0,rK.Z)(this,t),this.reset()}return(0,rX.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,e,n){}},{key:"touchstart",value:function(t,e,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([e[0],e[1]]))}},{key:"touchmove",value:function(t,e,n){if(this.firstTwoTouches){t.preventDefault();var r=(0,i3.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=SZ(n,e,i),s=SZ(n,e,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,t)}}}},{key:"touchend",value:function(t,e,n){if(this.firstTwoTouches){var r=(0,i3.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=SZ(n,e,i),s=SZ(n,e,o);a&&s||(this.active&&_Y.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&"center"===t.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function SZ(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function SP(t){return Math.abs(t.y)>Math.abs(t.x)}var SO=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"reset",value:function(){fX((0,rJ.Z)(r.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,SP(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,e,n){var r=t[0].sub(this.lastPoints[0]),i=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid)return this.lastPoints=t,this.active=!0,{pitchDelta:-((r.y+i.y)/2*.5)}}},{key:"gestureBeginsVertically",value:function(t,e,n){if(void 0!==this.valid)return this.valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i){if(void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100)return;return!1}var o=t.y>0==e.y>0;return SP(t)&&SP(e)&&o}}}]),r}(SL);function SR(t,e){return 180*t.angleWith(e)/Math.PI}var SI=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"reset",value:function(){fX((0,rJ.Z)(r.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.vector;if(this.vector=t[0].sub(t[1]),!(!this.active&&this.isBelowThreshold(this.vector)))return this.active=!0,{bearingDelta:SR(this.vector,n),pinchAround:e}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var e=Math.PI*this.minDiameter;return Math.abs(SR(t,this.startVector))<25/e*360}}]),r}(SL);function SD(t,e){return Math.log(t/e)/Math.LN2}var SN=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"reset",value:function(){fX((0,rJ.Z)(r.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.distance;if(this.distance=t[0].dist(t[1]),!(!this.active&&.1>Math.abs(SD(this.distance,this.startDistance))))return this.active=!0,{zoomDelta:SD(this.distance,n),pinchAround:e}}}]),r}(SL);function Sz(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Sj(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sj(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Sj(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var SB=oD.merge,SF=function(t){return t.zoom||t.drag||t.pitch||t.rotate};function SU(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var SV=function(){function t(e,n){var r=this;(0,rK.Z)(this,t),(0,ac.Z)(this,"handleWindowEvent",function(t){r.handleEvent(t,"".concat(t.type,"Window"))}),(0,ac.Z)(this,"handleEvent",function(t,e){if("blur"===t.type){r.stop();return}r.updatingCamera=!0;var n,i="renderFrame"===t.type?void 0:t,o={needsRenderFrame:!1},a={},s={},u=t.touches?r.getMapTouches(t.touches):void 0,c=u?_Y.touchPos(r.el,u):_Y.mousePos(r.el,t),l=Sz(r.handlers);try{for(l.s();!(n=l.n()).done;){var f=n.value,h=f.handlerName,p=f.handler,d=f.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,h))p.reset();else{var m=e||t.type;p&&p[m]&&(v=p[m](t,c,u),r.mergeIHandlerResult(o,a,v,h,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[h]=p)}}}catch(t){l.e(t)}finally{l.f()}var g={};for(var y in r.previousActiveHandlers)s[y]||(g[y]=i);r.previousActiveHandlers=s,(Object.keys(g).length||SU(o))&&(r.changes.push([o,a,g]),r.triggerRenderFrame()),(Object.keys(s).length||SU(o))&&r.map.stop(!0),r.updatingCamera=!1;var b=o.cameraAnimation;b&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],b(r.map))}),this.map=e,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new Sa(e),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;this.listeners=[],this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=Sz(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=(0,i3.Z)(o.value,3),u=s[0],c=s[1],l=s[2];_Y.addEventListener(u,c,u===window.document?this.handleWindowEvent:this.handleEvent,l)}}catch(t){a.e(t)}finally{a.f()}}return(0,rX.Z)(t,[{key:"destroy",value:function(){var t,e=Sz(this.listeners);try{for(e.s();!(t=e.n()).done;){var n=(0,i3.Z)(t.value,3),r=n[0],i=n[1],o=n[2];_Y.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t,e=Sz(this.handlers);try{for(e.s();!(t=e.n()).done;)t.value.handler.reset()}catch(t){e.e(t)}finally{e.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t,e=Sz(this.handlers);try{for(e.s();!(t=e.n()).done;)if(t.value.handler.isActive())return!0}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return!!SF(this.eventsInProgress)||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,e,n,r,i){if(n){SB(t,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(e.zoom=o),void 0!==n.panDelta&&(e.drag=o),void 0!==n.pitchDelta&&(e.pitch=o),void 0!==n.bearingDelta&&(e.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var t=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame(function(e){delete t.frameId,t.handleEvent(new _8("renderFrame",{timeStamp:e})),t.applyChanges()}))}},{key:"addDefaultHandlers",value:function(t){var e=this.map,n=e.getCanvasContainer();this.add("mapEvent",new Sf(e,t));var r=e.boxZoom=new _7(e,t);this.add("boxZoom",r);var i=new SM,o=new _6;e.doubleClickZoom=new Sb(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new SA;this.add("tapDragZoom",a);var s=e.touchPitch=new SO;this.add("touchPitch",s);var u=new Sv(t),c=new Sm(t);e.dragRotate=new S_(t,u,c),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",c,["mouseRotate"]);var l=new Sd(t),f=new ST(t);e.dragPan=new Sx(n,l,f),this.add("mousePan",l),this.add("touchPan",f,["touchZoom","touchRotate"]);var h=new SI,p=new SN;e.touchZoomRotate=new SS(n,p,h,a),this.add("touchRotate",h,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=e.scrollZoom=new Sy(e,this);this.add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new Sc;this.add("keyboard",v),this.add("blockableMapEvent",new _4(e));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m++){var y=g[m];t.interactive&&t[y]&&e[y].enable(t[y])}}},{key:"add",value:function(t,e,n){this.handlers.push({handlerName:t,handler:e,allowed:n}),this.handlersById[t]=e}},{key:"blockedByActive",value:function(t,e,n){for(var r in t)if(r!==n&&(!e||0>e.indexOf(r)))return!0;return!1}},{key:"getMapTouches",value:function(t){var e,n=[],r=Sz(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.target;this.el.contains(o)&&n.push(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var t,e={},n={},r={},i=Sz(this.changes);try{for(i.s();!(t=i.n()).done;){var o=(0,i3.Z)(t.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(e.panDelta=(e.panDelta||new _Z(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),SB(n,s),SB(r,u)}}catch(t){i.e(t)}finally{i.f()}this.updateMapTransform(e,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(t,e,n){var r=this.map,i=r.transform;if(!SU(t))return this.fireEvents(e,n);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,c=t.pinchAround,l=t.around;void 0!==c&&(l=c),r.stop(!0),l=l||r.transform.centerPoint;var f=i.pointLocation(o?l.sub(o):l);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(f,l),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(e,n)}},{key:"fireEvents",value:function(t,e){var n,r=this,i=SF(this.eventsInProgress),o=SF(t),a={};for(var s in t)if(t[s]){var u=t[s].originalEvent;this.eventsInProgress[s]||(a["".concat(s,"start")]=u),this.eventsInProgress[s]=t[s]}for(var c in!i&&o&&this.fireEvent("movestart",o.originalEvent),a)a[c]&&this.fireEvent(c,a[c]);for(var l in t.rotate&&(this.bearingChanged=!0),o&&this.fireEvent("move",o.originalEvent),t)if(t[l]){var f=t[l].originalEvent;this.fireEvent(l,f)}var h={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,m=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],n=e[v]||m,h["".concat(p,"end")]=n)}for(var g in h)h[g]&&this.fireEvent(g,h[g]);var y=SF(this.eventsInProgress);if((i||o)&&!y){this.updatingCamera=!0;var b=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(t){return 0!==t&&-r.bearingSnap<t&&t<r.bearingSnap};b?(x(b.bearing||this.map.getBearing())&&(b.bearing=0),this.map.easeTo(b,{originalEvent:n})):(this.map.emit("moveend",new _U("moveend",{originalEvent:n})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,e){this.map.emit(t,new _U(t,e?{originalEvent:e}:{}))}}]),t}(),SH=null,SG=[],SW=window.performance,SY={create:"create",load:"load",fullLoad:"fullLoad"},Sq={mark:function(t){SW.mark(t)},frame:function(t){if(null!=SH){var e=t-SH;SG.push(e)}SH=t},clearMetrics:function(){for(var t in SH=null,SG=[],SW.clearMeasures("loadTime"),SW.clearMeasures("fullLoadTime"),SY)SW.clearMarks(SY[t])},getPerformanceMetrics:function(){var t=SW.measure("loadTime",SY.create,SY.load).duration,e=SW.measure("fullLoadTime",SY.create,SY.fullLoad).duration,n=SG.length,r=SG.reduce(function(t,e){return t+e},0)/n/1e3,i=SG.filter(function(t){return t>33.333333333333336}).reduce(function(t,e){return t+(e-33.333333333333336)/33.333333333333336},0);return{loadTime:t,fullLoadTime:e,fps:1/r,percentDroppedFrames:i/(n+i)*100}}};function SX(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return SK(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SK(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function SK(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var S$=function(){function t(){(0,rK.Z)(this,t),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return(0,rX.Z)(t,[{key:"add",value:function(t){var e=++this.id;return this.queue.push({callback:t,id:e,cancelled:!1}),e}},{key:"remove",value:function(t){var e,n=this.currentlyRunning,r=SX(n?this.queue.concat(n):this.queue);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.id===t){i.cancelled=!0;return}}}catch(t){r.e(t)}finally{r.f()}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.currentlyRunning=this.queue;this.queue=[];var n,r=SX(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(t),this.cleared))break}}catch(t){r.e(t)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),t}();!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var SQ=oD.merge,SJ={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},S0=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e;return(0,rK.Z)(this,r),e=n.call(this,SQ({},SJ,t)),(0,ac.Z)((0,se.Z)(e),"renderTaskQueue",new S$),(0,ac.Z)((0,se.Z)(e),"trackResize",!0),(0,ac.Z)((0,se.Z)(e),"onWindowOnline",function(){e.update()}),(0,ac.Z)((0,se.Z)(e),"onWindowResize",function(t){e.trackResize&&e.resize({originalEvent:t}).update()}),e.initContainer(),e.resize(),e.handlers=new SV((0,se.Z)(e),e.options),"undefined"!=typeof window&&(window.addEventListener("online",e.onWindowOnline,!1),window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("orientationchange",e.onWindowResize,!1)),e}return(0,rX.Z)(r,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",t)),this.emit("move",new Event("move",t))),this.emit("resize",new Event("resize",t)),i&&this.emit("moveend",new Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(_T.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(_Z.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(_L.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear(),this.handlers.destroy(),"undefined"!=typeof window&&(window.removeEventListener("online",this.onWindowOnline,!1),window.removeEventListener("resize",this.onWindowResize,!1),window.removeEventListener("orientationchange",this.onWindowResize,!1))}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=_M(function(e){Sq.frame(e),t.frame=null,t.update(e)}))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=_M(function(n){Sq.frame(n),e.frame=null,e.renderTaskQueue.run(t)}))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw Error("Invalid type: 'container' must be a String or HTMLElement.");var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=oF("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(t=this.container.clientWidth||400,e=this.container.clientHeight||300),[t,e]}},{key:"resizeCanvas",value:function(t,e){var n=o1||1;this.canvas.width=n*t,this.canvas.height=n*e,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px")}}]),r}(_H),S1=oD.throttle,S2=function(){function t(e){var n=this;(0,rK.Z)(this,t),(0,ac.Z)(this,"onHashChange",function(){var t=n.getCurrentHash();if(t.length>=3&&!t.some(function(t){return isNaN(+t)})){var e=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(t[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1}),(0,ac.Z)(this,"getCurrentHash",function(){var t,e=window.location.hash.replace("#","");return n.hashName?(e.split("&").map(function(t){return t.split("=")}).forEach(function(e){e[0]===n.hashName&&(t=e)}),(t&&t[1]||"").split("/")):e.split("/")}),(0,ac.Z)(this,"updateHashUnthrottled",function(){var t=n.getHashString();try{window.history.replaceState(window.history.state,"",t)}catch(t){}}),this.hashName=e&&encodeURIComponent(e),this.updateHash=S1(this.updateHashUnthrottled,300)}return(0,rX.Z)(t,[{key:"addTo",value:function(t){return this.map=t,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var e=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.pow(10,Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10)),i=Math.round(e.lng*r)/r,o=Math.round(e.lat*r)/r,a=this.map.getBearing(),s=this.map.getPitch(),u="";if(t?u+="/".concat(i,"/").concat(o,"/").concat(n):u+="".concat(n,"/").concat(o,"/").concat(i),(a||s)&&(u+="/".concat(Math.round(10*a)/10)),s&&(u+="/".concat(Math.round(s))),this.hashName){var c=this.hashName,l=!1,f=window.location.hash.slice(1).split("&").map(function(t){var e=t.split("=")[0];return e===c?(l=!0,"".concat(e,"=").concat(u)):t}).filter(function(t){return t});return l||f.push("".concat(c,"=").concat(u)),"#".concat(f.join("&"))}return"#".concat(u)}}]),t}();!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n"),function(){"function"!=typeof window.CustomEvent&&(t.prototype=window.Event.prototype,window.CustomEvent=t);function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}}();var S3=oD.merge,S5={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},S4=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){(0,rK.Z)(this,r),e=n.call(this,S3({},S5,t)),(0,ac.Z)((0,se.Z)(e),"renderTaskQueue",new S$),(0,ac.Z)((0,se.Z)(e),"trackResize",!0),(0,ac.Z)((0,se.Z)(e),"onWindowOnline",function(){e.update()}),(0,ac.Z)((0,se.Z)(e),"onWindowResize",function(t){e.trackResize&&e.resize({originalEvent:t}).update()}),e.initContainer(),e.resize(),e.handlers=new SV((0,se.Z)(e),e.options),"undefined"!=typeof window&&(window.addEventListener("online",e.onWindowOnline,!1),window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("orientationchange",e.onWindowResize,!1));var e,i="string"==typeof t.hash&&t.hash||void 0;return t.hash&&(e.hash=new S2(i).addTo((0,se.Z)(e))),e.hash&&e.hash.onHashChange()||(e.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(e.resize(),e.fitBounds(t.bounds,S3({},t.fitBoundsOptions,{duration:0})))),e}return(0,rX.Z)(r,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=(0,i3.Z)(e,2),r=n[0],i=n[1];this.transform.resize(r,i);var o=!this.moving;return o&&(this.stop(),this.emit("movestart",new window.CustomEvent("movestart",t)),this.emit("move",new window.CustomEvent("move",t))),this.emit("resize",new window.CustomEvent("resize",t)),o&&this.emit("moveend",new window.CustomEvent("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(_T.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(_Z.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(_L.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear(),this.handlers.destroy(),"undefined"!=typeof window&&(window.removeEventListener("online",this.onWindowOnline,!1),window.removeEventListener("resize",this.onWindowResize,!1),window.removeEventListener("orientationchange",this.onWindowResize,!1))}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=_M(function(e){Sq.frame(e),t.frame=null,t.update(e)}))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=_M(function(n){Sq.frame(n),e.frame=null,e.renderTaskQueue.run(t)}))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw Error("Invalid type: 'container' must be a String or HTMLElement.");var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=oF("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(t=this.container.clientWidth,e=this.container.clientHeight,t=0===t?400:t,e=0===e?300:e),[t,e]}}]),r}(_H),S7=function(){function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"xzReg",-(.6*Math.PI)),(0,ac.Z)(this,"yReg",.2*Math.PI),(0,ac.Z)(this,"earthCameraRadius",200),(0,ac.Z)(this,"earthCameraZoom",1),(0,ac.Z)(this,"cameraPosition",p7()),(0,ac.Z)(this,"projectionMatrix",cy()),(0,ac.Z)(this,"modelMatrix",cy()),(0,ac.Z)(this,"viewMatrix",cy()),(0,ac.Z)(this,"viewProjectionMatrix",cy()),(0,ac.Z)(this,"ViewProjectionMatrixUncentered",cy()),(0,ac.Z)(this,"viewUncenteredMatrix",cy())}return(0,rX.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.viewportHeight,n=t.viewportWidth;c$(this.projectionMatrix,20,(void 0===n?1:n)/(void 0===e?1:e),.1,1e4);var r=this.earthCameraRadius*Math.cos(this.xzReg),i=this.earthCameraRadius*Math.sin(this.xzReg),o=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=p9(r,o,i),db(this.cameraPosition,this.cameraPosition),di(this.cameraPosition,this.cameraPosition,p9(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),dh(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var a=p7();d_(a,this.cameraPosition,p9(0,1,0));var s=p9(0,1,0);d_(s,a,this.cameraPosition);var u=p9(0,0,0);c3(this.viewMatrix,this.cameraPosition,u,s),this.viewUncenteredMatrix=cb(this.viewMatrix),cM(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),cM(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(t){this.xzReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(t){this.yReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(t){this.earthCameraZoom+=t,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),S6=["id","style","rotation"],S8={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},S9=(0,cn.b2)()(n9=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"version","GLOBEL"),(0,ac.Z)((0,se.Z)(t),"dragging",!1),(0,ac.Z)((0,se.Z)(t),"handleCameraChanged",function(e){t.emit("mapchange"),t.handleCameraChanging=!0,t.handleCameraTimer&&clearTimeout(t.handleCameraTimer),t.handleCameraTimer=setTimeout(function(){t.handleCameraChanging=!1},2e3),e.type&&e.originalEvent&&("wheel"===e.originalEvent.type&&t.viewport.scaleZoom(-(.01*Math.sign(e.originalEvent.wheelDelta)*1)),Math.abs(e.originalEvent.movementX)>Math.abs(e.originalEvent.movementY)?e.originalEvent.movementX>0?t.viewport.rotateY(.02):e.originalEvent.movementX<0&&t.viewport.rotateY(-.02):e.originalEvent.movementY>0?t.viewport.rotateX(.02):e.originalEvent.movementY<0&&t.viewport.rotateX(-.02));var n=t.config.offsetCoordinate;t.viewport.syncWithMapCamera({viewportHeight:t.map.transform.height,viewportWidth:t.map.transform.width}),t.viewport.getZoom()>12&&(void 0===n||n)?t.coordinateSystemService.setCoordinateSystem(lM.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(lM.LNGLAT),t.cameraChangedCallback(t.viewport)}),t}return(0,rX.Z)(i,[{key:"lngLatToMercator",value:function(t,e){throw Error("Method not implemented.")}},{key:"getModelMatrix",value:function(t,e,n,r,i){throw Error("Method not implemented.")}},{key:"on",value:function(t,e){-1!==hZ.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(S8[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(S8[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=void 0===(n=(e=this.config).id)?"map":n,o=void 0===(i=e.style)?"light":i,s=void 0===(a=e.rotation)?0:a,u=(0,lY.Z)(e,S6),this.viewport=new S7,this.$mapContainer=this.creatMapContainer(r),this.map=new S0((0,rW.Z)({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var t;null===(t=this.$mapContainer)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"rotateY",value:function(t){var e=t||{},n=e.force,r=e.reg;(!this.handleCameraChanging||void 0!==n&&n)&&this.viewport&&(this.viewport.rotateY(void 0===r?.01:r),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),i}(_o))||n9,wt=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return S9}}]),r}(xx),we=["id","style","rotation","mapInstance","version","mapSize","interactive"],wn=(0,cn.b2)()(rt=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"version",aG.DEFAULT),t}return(0,rX.Z)(i,[{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=_z.fromLngLat(t,e),r=n.x,i=n.y,o=n.z;return{x:void 0===r?0:r,y:void 0===i?0:i,z:void 0===o?0:o}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=_z.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=cy();return cT(s,s,p9(o.x-i.x,o.y-i.y,o.z||0-i.z)),cL(s,s,p9(a*r[0],-a*r[1],a*r[2])),cP(s,s,n[0]),cO(s,s,n[1]),cR(s,s,n[2]),s}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=void 0===(n=(e=this.config).id)?"map":n,o=void 0===(i=e.style)?"light":i,s=void 0===(a=e.rotation)?0:a,u=e.mapInstance,l=void 0===(c=e.version)?"DEFAULTMAP":c,h=void 0===(f=e.mapSize)?1e4:f,d=void 0===(p=e.interactive)||p,v=(0,lY.Z)(e,we),this.viewport=new xD,this.version=l,this.simpleMapCoord.setSize(h),"SIMPLE"===l&&v.center&&(v.center=this.simpleMapCoord.unproject(v.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new S4((0,rW.Z)({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},v))),this.map.on("load",function(){m.handleCameraChanged()}),d&&this.map.on("move",this.handleCameraChanged),setTimeout(function(){m.handleCameraChanged()},100),this.handleCameraChanged();case 10:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}}]),i}(_o))||rt,wr=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return wn}}]),r}(xx),wi=n(12782),wo=n.n(wi),wa=function(){function t(){(0,rK.Z)(this,t)}return(0,rX.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new xI({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),ws=["id","attributionControl","style","token","rotation","mapInstance"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=wo();var wu=0,wc="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",wl=(0,cn.b2)()(re=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"version","MAPBOX"),t}return(0,rX.Z)(i,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=n.y,o=n.z;return{x:void 0===r?0:r,y:void 0===i?0:i,z:void 0===o?0:o}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=cy();return cT(s,s,p9(o.x-i.x,o.y-i.y,o.z||0-i.z)),cL(s,s,p9(a*r[0],-a*r[1],a*r[2])),cP(s,s,n[0]),cO(s,s,n[1]),cR(s,s,n[2]),s}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=void 0===(n=(e=this.config).id)?"map":n,o=void 0!==(i=e.attributionControl)&&i,s=void 0===(a=e.style)?"light":a,c=void 0===(u=e.token)?wc:u,f=void 0===(l=e.rotation)?0:l,h=e.mapInstance,p=(0,lY.Z)(e,ws),this.viewport=new wa,h||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),c!==wc||"blank"===s||window.mapboxgl.accessToken||h||console.warn(this.configService.getSceneWarninfo("MapToken")),h||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=c),h?(this.map=h,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map((0,rW.Z)({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:f},p))),this.map.on("load",function(){d.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var t;null===(t=this.$mapContainer)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new(wo()).LngLat(t[0],t[1]),r=new(wo()).LngLat(e[0],e[1]),i=n.distanceTo(r),o=wo().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=wo().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y;return 8388608*Math.sqrt(Math.pow(s-a.x,2)+Math.pow(u-a.y,2))/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+wu++,e.appendChild(n),n}}]),i}(_o))||re;!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var wf=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return wl}}]),r}(xx),wh=n(76228),wp=n.n(wh),wd=["id","attributionControl","style","rotation","mapInstance"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".maplibregl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:-webkit-full-screen{height:100%;width:100%}.maplibregl-map:-moz-full-screen{height:100%;width:100%}.maplibregl-map:-ms-fullscreen{height:100%;width:100%}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{-ms-touch-action:none;touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{-ms-touch-action:none;touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.maplibregl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23999' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{-webkit-animation:maplibregl-spin 2s linear infinite;animation:maplibregl-spin 2s linear infinite}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}}@-webkit-keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (-ms-high-contrast:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;-webkit-box-sizing:content-box;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\");border:0;border-radius:12px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;-webkit-box-sizing:border-box;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:-webkit-box;display:-ms-flexbox;display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.maplibregl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.maplibregl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{-ms-flex-item-align:start;align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{-ms-flex-item-align:end;align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{-webkit-animation:maplibregl-user-location-dot-pulse 2s infinite;animation:maplibregl-user-location-dot-pulse 2s infinite;content:\"\";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35);-webkit-box-sizing:border-box;box-sizing:border-box;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@-webkit-keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:rgba(0,0,0,.4);color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:1.4em;inset:0;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;-webkit-transition:opacity 1s ease 1s;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;-webkit-transition:opacity .05s;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}"),window.maplibregl=wp();var wv=0,wm=(0,cn.b2)()(rn=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"version",aG.MAPBOX),t}return(0,rX.Z)(i,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.maplibregl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=n.y,o=n.z;return{x:void 0===r?0:r,y:void 0===i?0:i,z:void 0===o?0:o}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.maplibregl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=cy();return cT(s,s,p9(o.x-i.x,o.y-i.y,o.z||0-i.z)),cL(s,s,p9(a*r[0],-a*r[1],a*r[2])),cP(s,s,n[0]),cO(s,s,n[1]),cR(s,s,n[2]),s}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=void 0===(n=(e=this.config).id)?"map":n,o=void 0!==(i=e.attributionControl)&&i,s=void 0===(a=e.style)?"light":a,c=void 0===(u=e.rotation)?0:u,l=e.mapInstance,f=(0,lY.Z)(e,wd),this.viewport=new wa,l||window.maplibregl||console.error(this.configService.getSceneWarninfo("SDK")),l?(this.map=l,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.maplibregl.Map((0,rW.Z)({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:c},f))),this.map.on("load",function(){h.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 7:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var t;null===(t=this.$mapContainer)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new(wp()).LngLat(t[0],t[1]),r=new(wp()).LngLat(e[0],e[1]),i=n.distanceTo(r),o=wp().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=wp().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y;return 8388608*Math.sqrt(Math.pow(s-a.x,2)+Math.pow(u-a.y,2))/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+wv++,e.appendChild(n),n}}]),i}(_o))||rn,wg=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return wm}}]),r}(xx);if(!window)throw Error("TMap JSAPI can only be used in Browser.");var wy=((ta=wy||{}).notload="notload",ta.loading="loading",ta.loaded="loaded",ta.failed="failed",ta),wb={key:"",version:"1.exp",libraries:[]},w_={TMap:wy.notload},wS=[],ww=function(t){if("function"==typeof t){if(w_.TMap===wy.loaded){t(window.AMap);return}wS.push(t)}},wk={load:function(t){return new Promise(function(e,n){if(w_.TMap===wy.failed)n("");else if(w_.TMap===wy.notload){var r=t.key,i=t.version,o=t.libraries;if(!r){n("请填写key");return}wb.key=r,wb.version=i||wb.version,wb.libraries=o||wb.libraries,w_.TMap=wy.loading,window._onTMapAPILoaded=function(t){if(delete window._onTMapAPILoaded,t)w_.TMap=wy.failed,n(t);else for(w_.TMap=wy.loaded;wS.length;)wS.splice(0,1)[0](window.TMap)};var a=document.createElement("script");a.type="text/javascript",a.async=!1,a.src="https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v="+wb.version+"&key="+r+"&plugin="+wb.libraries.join(","),a.onerror=function(t){w_.TMap=wy.failed,n(t)},(document.body||document.head).appendChild(a),ww(e)}else if(w_.TMap===wy.loaded){if(t.key&&t.key!==wb.key){n("多个不一致的 key");return}if(t.version&&t.version!==wb.version){n("不允许多个版本 JSAPI 混用");return}ww(e)}})},reset:function(){delete window.TMap,w_={TMap:wy.notload}}},wC=["id","mapInstance","center","token","version","libraries","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}("img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text {\n  display: none !important;\n}\n");var wE={mapmove:"center_changed",camerachange:["drag","pan","rotate","pitch","zoom"],zoomchange:"zoom",dragging:"drag"},wA=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"viewport",null),(0,ac.Z)((0,se.Z)(t),"evtCbProxyMap",new Map),(0,ac.Z)((0,se.Z)(t),"handleCameraChanged",function(){t.emit("mapchange");var e=t.map,n=e.getCenter(),r={center:[n.lng,n.lat],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:e.getHeading(),pitch:e.getPitch(),zoom:e.getZoom()-1};t.viewport.syncWithMapCamera(r),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}),t}return(0,rX.Z)(i,[{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.viewport=new xD,r=(n=this.config).id,i=n.mapInstance,a=void 0===(o=n.center)?[121.30654632240122,31.25744185633306]:o,u=void 0===(s=n.token)?"OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77":s,l=void 0===(c=n.version)?"1.exp":c,h=void 0===(f=n.libraries)?[]:f,d=void 0===(p=n.minZoom)?3:p,m=void 0===(v=n.maxZoom)?18:v,y=void 0===(g=n.rotation)?0:g,x=void 0===(b=n.pitch)?0:b,S=void 0===(_=n.mapSize)?1e4:_,k=void 0===(w=n.logoVisible)||w,C=(0,lY.Z)(n,wC),window.TMap||i){t.next=5;break}return t.next=5,wk.load({key:u,version:l,libraries:h});case 5:if(!i){t.next=11;break}this.map=i,this.$mapContainer=this.map.getContainer(),!1===k&&this.hideLogo(),t.next=18;break;case 11:if(r){t.next=13;break}throw Error("No container id specified");case 13:E=oz(r),A=new TMap.Map(E,(0,rW.Z)({maxZoom:m,minZoom:d,rotation:y,pitch:x,showControl:!1,center:new TMap.LatLng(a[1],a[0])},C)),this.map=A,this.$mapContainer=A.getContainer(),!1===k&&this.hideLogo();case 18:this.map.canvasContainer.style.position="absolute",(M=null===(e=this.map.controlManager.controlContainer)||void 0===e?void 0:e.parentNode)&&(M.style.zIndex=2),this.simpleMapCoord.setSize(S),this.map.on("drag",this.handleCameraChanged),this.map.on("pan",this.handleCameraChanged),this.map.on("rotate",this.handleCameraChanged),this.map.on("pitch",this.handleCameraChanged),this.map.on("zoom",this.handleCameraChanged),this.handleCameraChanged();case 28:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.map.destroy()}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();this.markerContainer=oF("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1"),this.markerContainer.style.zIndex="2"}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){var n=this;if(-1!==hZ.indexOf(t))this.eventEmitter.on(t,e);else{var r=function(t){var r=n.evtCbProxyMap.get(t);if(r||n.evtCbProxyMap.set(t,r=new Map),!r.get(e)){var i=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];!n[0]||"object"!==(0,u5.Z)(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),e.apply(void 0,n)};r.set(e,i),n.map.on(t,i)}};Array.isArray(wE[t])?wE[t].forEach(function(e){r(e||t)}):r(wE[t]||t)}}},{key:"off",value:function(t,e){var n=this;if(-1!==hZ.indexOf(t)){this.eventEmitter.off(t,e);return}var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(t))||void 0===i?void 0:i.get(e);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(e),n.map.off(r,a))};Array.isArray(wE[t])?wE[t].forEach(function(e){r(e||t)}):r(wE[t]||t)}},{key:"once",value:function(){throw Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"tmap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return{lng:t.lng,lat:t.lat}}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().getNorthEast(),e=this.map.getBounds().getSouthWest();return[[e.lng,e.lat],[t.lng,t.lat]]}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByTagName("canvas")[0]}},{key:"getMapStyleConfig",value:function(){throw Error("Method not implemented.")}},{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setMapStyle",value:function(t){this.map.setMapStyleId(t)}},{key:"setRotation",value:function(t){this.map.setRotation(t)}},{key:"zoomIn",value:function(){this.map.setZoom(this.getZoom()+1)}},{key:"zoomOut",value:function(){this.map.setZoom(this.getZoom()-1)}},{key:"panTo",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1];this.map.panTo(new TMap.LatLng(r,n))}},{key:"panBy",value:function(t,e){this.map.panBy([t,e])}},{key:"fitBounds",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1],o=new TMap.LatLng(r[1],r[0]),a=new TMap.LatLng(i[1],i[0]),s=new TMap.LatLngBounds(o,a);this.map.fitBounds(s,e)}},{key:"setZoomAndCenter",value:function(t,e){var n=(0,i3.Z)(e,2),r=n[0],i=n[1];this.map.setCenter(new TMap.LatLng(i,r)),this.map.setZoom(t)}},{key:"setCenter",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1];this.map.setCenter(new TMap.LatLng(r,n))}},{key:"setPitch",value:function(t){this.map.setPitch(t)}},{key:"setZoom",value:function(t){this.map.setZoom(t)}},{key:"setMapStatus",value:function(t){var e=this;Object.keys(t).map(function(n){switch(n){case"doubleClickZoom":e.map.setDoubleClickZoom(!!t.doubleClickZoom);break;case"dragEnable":e.map.setDraggable(!!t.dragEnable);break;case"rotateEnable":e.map.setRotatable(!!t.rotateEnable);break;case"zoomEnable":e.map.setDoubleClickZoom(!!t.zoomEnable),e.map.setScrollable(!!t.zoomEnable);break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may bot be supported")}})}},{key:"meterToCoord",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1],o=(0,i3.Z)(e,2),a=o[0],s=o[1],u=TMap.geometry.computeDistance([new TMap.LatLng(i,r),new TMap.LatLng(s,a)]),c=this.lngLatToCoord([r,i]),l=(0,i3.Z)(c,2),f=l[0],h=l[1],p=this.lngLatToCoord([a,s]),d=(0,i3.Z)(p,2);return Math.sqrt(Math.pow(f-d[0],2)+Math.pow(h-d[1],2))/u}},{key:"pixelToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.getCenter(),o=i.lng,a=i.lat,s=this.lngLatToPixel([o,a]),u=s.x,c=s.y,l=this.lngLatToContainer([o,a]),f=l.x,h=l.y,p=this.map.unprojectFromContainer(new TMap.Point(f+(n-u),h+(r-c))),d=p.lng,v=p.lat;return this.containerToLngLat([d,v])}},{key:"lngLatToPixel",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.projectToWorldPlane(new TMap.LatLng(r,n));return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.unprojectFromContainer(new TMap.Point(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.projectToContainer(new TMap.LatLng(r,n));return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.lngLatToPixel([n,r]);return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map(function(t){return Array.isArray(t[0])?e.lngLatToCoords(t):e.lngLatToCoord(t)})}},{key:"lngLatToMercator",value:function(t,e){var n=_z.fromLngLat(t,e),r=n.x,i=n.y,o=n.z;return{x:void 0===r?0:r,y:void 0===i?0:i,z:void 0===o?0:o}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cy();return cT(o,o,p9(i[0],i[1],e)),cL(o,o,p9(r[0],r[1],r[2])),cP(o,o,n[0]),cO(o,o,n[1]),cR(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw Error("Method not implemented.")}},{key:"exportMap",value:function(t){var e=this.getMapCanvasContainer();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"rotateY",value:function(){throw Error("Method not implemented.")}},{key:"hideLogo",value:function(){var t=this.map.getContainer();t&&oV(t,"tmap-contianer--hide-logo")}}]),i}(_o),wM=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return wA}}]),r}(xx),wT=function(t){var e=t.tk;return new Promise(function(t,n){var r=document.createElement("script");r.type="text/javascript",r.src="https://api.tianditu.gov.cn/api?v=4.0&tk=".concat(e),r.onload=function(){console.log("TianDiTu API script loaded."),t(!0)},r.onerror=function(){console.error("Failed to load TianDiTu API script."),t(!1)},document.head.appendChild(r)})},wL=["id","mapInstance","center","token","version","minZoom","maxZoom","logoVisible","zoom"],wZ=0,wP={zoomchange:["Ge"]},wO=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"viewport",null),(0,ac.Z)((0,se.Z)(t),"evtCbProxyMap",new Map),(0,ac.Z)((0,se.Z)(t),"handleCameraChanged",function(e){t.emit("mapchange");var n=t.map,r=t.map.getCenter(),i={center:[r.lng,r.lat],viewportHeight:n.getContainer().clientHeight,viewportWidth:n.getContainer().clientWidth,bearing:360,pitch:0,zoom:n.getZoom()-1};t.viewport&&(t.viewport.syncWithMapCamera(i),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport))}),t}return(0,rX.Z)(i,[{key:"addMarkerContainer",value:function(){var t=this.map.getContainer(),e=this.markerContainer=document.createElement("div");t.appendChild(e),e.setAttribute("tabindex","-1"),e.id="tdt-L7-marker",e.style.position="absolute",e.style.left="",e.style.top="",e.style.zIndex="600",e.style.width="0px",e.style.height="0px",e.style.overflow="visible"}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"resize",value:function(t){this.sceneContainer.style.width=t.newSize.x+"px",this.sceneContainer.style.height=t.newSize.y+"px"}},{key:"update",value:function(){var t=this.map.getBounds(),e=this.map.lngLatToLayerPoint({lng:t.getSouthWest().lng,lat:t.getNorthEast().lat}),n=e.x,r=e.y;this.sceneContainer.style.transition="",this.sceneContainer.style.transformOrigin="center",this.sceneContainer.style.transform="translate3d(".concat(n,"px, ").concat(r,"px, 0px) scale(1)"),this.markerContainer.style.transition="",this.markerContainer.style.transformOrigin="center",this.markerContainer.style.transform="translate3d(".concat(-n,"px, ").concat(-r,"px, 0px) scale(1)"),this.sceneContainer._tdt_pos=new T.Point(n,r),this.handleCameraChanged()}},{key:"getZoomScale",value:function(t,e){var n=this.map.options.IW;return e=void 0===e?this.map.getZoom():e,n.scale(t)/n.scale(e)}},{key:"zoomStartUpdate",value:function(t){var e=t.center,n=t.zoom,r=this.getZoomScale(n,this.map.getZoom()),i=T._Q.getPosition(this.sceneContainer),o=this.map.getSize().GQ(.5),a=this.map.options.IW.qW(this.map.getCenter(),n),s=this.map.options.IW.qW(e,n).DQ(a),u=new T.Point(o.x,o.y).GQ(-r);u.aQ(i),u.aQ(o),u.DQ(s),this.sceneContainer.style.transform="translate3d(".concat(u.x,"px,").concat(u.y,"px,0px) scale(").concat(r,")"),this.sceneContainer.style.transformOrigin="0 0",this.sceneContainer.style.transition="transform 0.25s cubic-bezier(0,0,0.25,1)",this.handleCameraChanged()}},{key:"getOverlayContainer",value:function(){var t,e=null===(t=this.map.getPanes())||void 0===t?void 0:t.overlayPane,n=document.createElement("div");e.parentElement.appendChild(n),n.id="tdt-L7";var r=this.map.getSize();return n.style.zIndex="200",n.style.width="".concat(r.x,"px"),n.style.height="".concat(r.y,"px"),this.sceneContainer=n,n}},{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.viewport=new xD,n=(e=this.config).id,r=e.mapInstance,o=void 0===(i=e.center)?[121.30654632240122,31.25744185633306]:i,s=void 0===(a=e.token)?"b15e548080c79819617367d3f6095c69":a,e.version,c=void 0===(u=e.minZoom)?1:u,f=void 0===(l=e.maxZoom)?18:l,e.logoVisible,p=void 0===(h=e.zoom)?3:h,(0,lY.Z)(e,wL),window.T){t.next=5;break}return t.next=5,wT({tk:s});case 5:if(!r){t.next=15;break}this.map=r,this.map.centerAndZoom(new window.T.LngLat(o[0],o[1]),p),this.$mapContainer=this.map.getContainer(),d=new window.T.LngLat(o[0],o[1]),this.map.centerAndZoom(d,p),this.setMinZoom(c),this.setMaxZoom(f),t.next=22;break;case 15:if(n){t.next=17;break}throw Error("No container id specified");case 17:this.$mapContainer=this.creatMapContainer(n),v=new T.Map(this.$mapContainer,{center:window.T.LngLat(o[0],o[1]),minZoom:c,maxZoom:f,zoom:p,projection:"EPSG:900913"}),this.map=v,m=new window.T.Control.Zoom,v.addControl(m);case 22:this.map.getContainer().querySelector(".tdt-pane").style.zIndex=1,this.handleCameraChanged(),this.map.on("move",this.update,this),this.map.on("Ge",this.zoomStartUpdate,this),this.map.on("resize",this.resize,this);case 29:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){}},{key:"on",value:function(t,e){var n=this;if(-1!==hZ.indexOf(t))this.eventEmitter.on(t,e);else{var r=function(t){var r=n.evtCbProxyMap.get(t);if(r||n.evtCbProxyMap.set(t,r=new Map),!r.get(e)){var i=function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];!r[0]||"object"!==(0,u5.Z)(r[0])||r[0].lngLat||r[0].lnglat||(r[0].lngLat=r[0].latlng||r[0].latLng,r[0].map=n.map),e.apply(void 0,r)};r.set(e,i),n.map.on(t,i)}};Array.isArray(wP[t])?wP[t].forEach(function(e){r(e||t)}):r(wP[t]||t)}}},{key:"off",value:function(t,e){var n=this;if(-1!==hZ.indexOf(t)){this.eventEmitter.off(t,e);return}var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(t))||void 0===i?void 0:i.get(e);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(e),n.map.off(r,a))};Array.isArray(wP[t])?wP[t].forEach(function(e){r(e||t)}):r(wP[t]||t)}},{key:"once",value:function(t,e){throw Error("Method not implemented.")}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getType",value:function(){return"tdtmap"}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("tdt-container")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.x,t.y]}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return 0}},{key:"getRotation",value:function(){return 0}},{key:"setRotation",value:function(t){this.map.setBearing(360)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([t,e])}},{key:"fitBounds",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1];this.map.setViewport([new window.T.LngLat(r[0],r[1]),new window.T.LngLat(i[0],i[1])])}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.enableDoubleClickZoom(),!1===t.doubleClickZoom&&this.map.disableDoubleClickZoom(),!1===t.dragEnable&&this.map.disableDrag(),!0===t.dragEnable&&this.map.enableDrag(),!1===t.keyboardEnable&&this.map.disableKeyboard(),!0===t.keyboardEnable&&this.map.enableKeyboard(),!1===t.zoomEnable&&this.map.disableScrollWheelZoom(),!0===t.zoomEnable&&this.map.enableScrollWheelZoom()}},{key:"getModelMatrix",value:function(t,e,n,r,i){throw Error("Method not implemented.")}},{key:"pixelToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.layerPointToLngLat({x:n,y:r});return{lng:i.lng,lat:i.lat}}},{key:"lngLatToPixel",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.lngLatToLayerPoint({lng:n,lat:r});return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.containerPointToLngLat({x:n,y:r});return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.lngLatToContainerPoint({lat:r,lng:n});return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.lngLatToPixel([n,r]);return[i.x,i.y]}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map(function(t){return Array.isArray(t[0])?e.lngLatToCoords(t):e.lngLatToCoord(t)})}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getSouthWest(),n=t.getNorthEast();return[[e.lng,e.lat],[n.lng,n.lat]]}},{key:"lngLatToMercator",value:function(t,e){var n=_z.fromLngLat(t,e),r=n.x,i=n.y,o=n.z;return{x:void 0===r?0:r,y:void 0===i?0:i,z:void 0===o?0:o}}},{key:"getCustomCoordCenter",value:function(){throw Error("Method not implemented.")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_tdt_div"+wZ++,e.appendChild(n),n}}]),i}(_o),wR=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return wO}}]),r}(xx);if(!window)throw Error("Google Map JSAPI can only be used in Browser.");var wI=((ts=wI||{}).notload="notload",ts.loading="loading",ts.loaded="loaded",ts.failed="failed",ts),wD={key:""},wN={GMap:wI.notload},wz=[],wj=function(t){if("function"==typeof t){if(wN.GMap===wI.loaded){t(window.google.maps.Map);return}wz.push(t)}},wB={load:function(t){return new Promise(function(e,n){if(wN.GMap===wI.failed)n("");else if(wN.GMap===wI.notload){var r=t.key;if(!r){n("请填写key");return}wD.key=r,wN.GMap=wI.loading,window.initMap=function(t){if(delete window.initMap,t)wN.GMap=wI.failed,n(t);else for(wN.GMap=wI.loaded;wz.length;)wz.splice(0,1)[0](window.google.maps.Map)};var i=document.createElement("script");i.type="text/javascript",i.async=!1,i.src="https://maps.googleapis.com/maps/api/js?key=".concat(wD.key,"&callback=initMap"),i.onerror=function(t){wN.GMap=wI.failed,n(t)},(document.body||document.head).appendChild(i),wj(e)}else if(wN.GMap===wI.loaded){if(t.key&&t.key!==wD.key){n("多个不一致的 key");return}wj(e)}})},reset:function(){delete window.google,wN={GMap:wI.notload}}},wF=["id","mapInstance","center","token","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}("img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text {\n  display: none !important;\n}\n");var wU={mapmove:"center_changed",camerachange:["drag","pan","rotate","tilt","zoom_changed"],zoomchange:"zoom_changed",dragging:"drag"},wV=function(t){(0,r$.Z)(i,t);var e,n,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(i);if(e){var r=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function i(){var t;(0,rK.Z)(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,ac.Z)((0,se.Z)(t),"viewport",null),(0,ac.Z)((0,se.Z)(t),"evtCbProxyMap",new Map),(0,ac.Z)((0,se.Z)(t),"handleCameraChanged",function(){t.emit("mapchange");var e=t.map,n=e.getCenter(),r=n.lng,i=n.lat,o={center:[r(),i()],viewportHeight:e.getDiv().clientHeight,viewportWidth:e.getDiv().clientWidth,bearing:e.getHeading(),pitch:e.getTilt(),zoom:e.getZoom()-1};t.viewport.syncWithMapCamera(o),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}),t}return(0,rX.Z)(i,[{key:"init",value:(n=st(sr().mark(function t(){var e,n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.viewport=new xD,r=(n=this.config).id,i=n.mapInstance,a=void 0===(o=n.center)?[121.30654632240122,31.25744185633306]:o,u=void 0===(s=n.token)?"AIzaSyDBDCfl4pvuDtaazdCog3LmhA7CQLhmcRE":s,l=void 0===(c=n.minZoom)?3:c,h=void 0===(f=n.maxZoom)?18:f,n.rotation,n.pitch,n.mapSize,d=void 0===(p=n.logoVisible)||p,v=(0,lY.Z)(n,wF),null!==(e=window.google)&&void 0!==e&&null!==(e=e.maps)&&void 0!==e&&e.Map||i){t.next=5;break}return t.next=5,wB.load({key:u});case 5:if(!i){t.next=11;break}this.map=i,this.$mapContainer=this.map.getDiv(),!1===d&&this.hideLogo(),t.next=18;break;case 11:if(r){t.next=13;break}throw Error("No container id specified");case 13:m=oz(r),g=new google.maps.Map(m,(0,rW.Z)({maxZoom:h,minZoom:l,zoomControl:!1,fullscreenControl:!1,center:new google.maps.LatLng(a[1],a[0])},v)),this.map=g,this.$mapContainer=g.getDiv(),!1===d&&this.hideLogo();case 18:google.maps.event.addListener(this.map,"drag",this.handleCameraChanged),google.maps.event.addListener(this.map,"pan",this.handleCameraChanged),google.maps.event.addListener(this.map,"rotate",this.handleCameraChanged),google.maps.event.addListener(this.map,"idle",this.handleCameraChanged),google.maps.event.addListener(this.map,"zoom_changed",this.handleCameraChanged),this.handleCameraChanged();case 24:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.map.setMap(null)}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){var n=this;if(-1!==hZ.indexOf(t))this.eventEmitter.on(t,e);else{var r=function(t){var r=n.evtCbProxyMap.get(t);if(r||n.evtCbProxyMap.set(t,r=new Map),!r.get(e)){var i=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];!n[0]||"object"!==(0,u5.Z)(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),e.apply(void 0,n)};r.set(e,i),n.map.on(t,i)}};Array.isArray(wU[t])?wU[t].forEach(function(e){r(e||t)}):r(wU[t]||t)}}},{key:"off",value:function(t,e){var n=this;if(-1!==hZ.indexOf(t)){this.eventEmitter.off(t,e);return}var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(t))||void 0===i?void 0:i.get(e);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(e),n.map.off(r,a))};Array.isArray(wU[t])?wU[t].forEach(function(e){r(e||t)}):r(wU[t]||t)}},{key:"once",value:function(){throw Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getDiv()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"googlemap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter(),e=t.lng,n=t.lat;return{lng:e(),lat:n()}}},{key:"getPitch",value:function(){return this.map.getTilt()}},{key:"getRotation",value:function(){return this.map.getHeading()}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=null==t?void 0:t.getNorthEast(),n=null==t?void 0:t.getSouthWest();return[[n.lng(),n.lat()],[e.lng(),e.lat()]]}},{key:"getMapContainer",value:function(){return this.map.getDiv()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getDiv())||void 0===t?void 0:t.getElementsByTagName("canvas")[0]}},{key:"getMapStyleConfig",value:function(){throw Error("Method not implemented.")}},{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setMapStyle",value:function(t){this.map.setMapStyleId(t)}},{key:"setRotation",value:function(t){this.map.setHeading(t)}},{key:"zoomIn",value:function(){var t=this.map.getZoom();this.map.setZoom(t+1)}},{key:"zoomOut",value:function(){var t=this.map.getZoom();this.map.setZoom(t-1)}},{key:"panTo",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1];this.map.panTo({lat:r,lng:n})}},{key:"panBy",value:function(t,e){this.map.panBy(t,e)}},{key:"fitBounds",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1],o=new google.maps.LatLngBounds({lat:r[1],lng:r[0]},{lat:i[1],lng:i[0]});this.map.fitBounds(o,e)}},{key:"setZoomAndCenter",value:function(t,e){var n=(0,i3.Z)(e,2),r=n[0],i=n[1];this.map.setZoom(t),this.map.setCenter({lat:i,lng:r})}},{key:"setCenter",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1];this.map.setCenter({lat:r,lng:n})}},{key:"setPitch",value:function(t){this.map.setTilt(t)}},{key:"setZoom",value:function(t){this.map.setZoom(t)}},{key:"setMapStatus",value:function(t){var e=this;Object.keys(t).map(function(n){switch(n){case"doubleClickZoom":e.map.setOptions({gestureHandling:t.doubleClickZoom?"auto":"none"});break;case"dragEnable":e.map.setOptions({draggable:t.dragEnable});break;case"rotateEnable":break;case"zoomEnable":e.map.setOptions({zoomControl:t.zoomEnable});break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may not be supported")}})}},{key:"meterToCoord",value:function(t,e){var n=(0,i3.Z)(t,2),r=n[0],i=n[1],o=(0,i3.Z)(e,2),a=o[0],s=o[1],u=google.maps.geometry.spherical.computeDistanceBetween([new google.maps.LatLng(i,r),new google.maps.LatLng(s,a)]),c=this.lngLatToCoord([r,i]),l=(0,i3.Z)(c,2),f=l[0],h=l[1],p=this.lngLatToCoord([a,s]),d=(0,i3.Z)(p,2);return Math.sqrt(Math.pow(f-d[0],2)+Math.pow(h-d[1],2))/u}},{key:"pixelToLngLat",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.map.getCenter(),o=i.lng,a=i.lat,s=this.lngLatToPixel([o(),a()]),u=s.x,c=s.y,l=this.lngLatToContainer([o(),a()]),f=l.x,h=l.y,p=this.map.unprojectFromContainer(new TMap.Point(f+(n-u),h+(r-c))),d=p.lng,v=p.lat;return this.containerToLngLat([d,v])}},{key:"lngLatToPixel",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=new google.maps.LatLng(r,n),o=this.map.getProjection().fromLatLngToPoint(i);return{x:o.x,y:o.y}}},{key:"containerToLngLat",value:function(t){var e,n=(0,i3.Z)(t,2),r=n[0],i=n[1],o=new google.maps.Point(r,i),a=null===(e=this.map.getProjection())||void 0===e?void 0:e.fromPointToLatLng(o);return{lng:a.lng(),lat:a.lat()}}},{key:"lngLatToContainer",value:function(t){var e,n,r=(0,i3.Z)(t,2),i=r[0],o=r[1],a=new google.maps.LatLng(o,i),s=null===(e=this.map.getProjection())||void 0===e||null===(n=e.fromLatLngToContainerPixel)||void 0===n?void 0:n.call(e,a);return{x:s.x,y:s.y}}},{key:"lngLatToCoord",value:function(t){var e=(0,i3.Z)(t,2),n=e[0],r=e[1],i=this.lngLatToPixel([n,r]);return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map(function(t){return Array.isArray(t[0])?e.lngLatToCoords(t):e.lngLatToCoord(t)})}},{key:"lngLatToMercator",value:function(t,e){var n=_z.fromLngLat(t,e),r=n.x,i=n.y,o=n.z;return{x:void 0===r?0:r,y:void 0===i?0:i,z:void 0===o?0:o}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cy();return cT(o,o,p9(i[0],i[1],e)),cL(o,o,p9(r[0],r[1],r[2])),cP(o,o,n[0]),cO(o,o,n[1]),cR(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw Error("Method not implemented.")}},{key:"exportMap",value:function(t){var e=this.getMapCanvasContainer();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"rotateY",value:function(){throw Error("Method not implemented.")}},{key:"hideLogo",value:function(){var t=this.map.getDiv();t&&oV(t,"tmap-contianer--hide-logo")}}]),i}(_o),wH=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(){return(0,rK.Z)(this,r),n.apply(this,arguments)}return(0,rX.Z)(r,[{key:"getServiceConstructor",value:function(){return wV}}]),r}(xx),wG=n(23196),wW=n.n(wG),wY=function(){function t(e,n){(0,rK.Z)(this,t);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return(0,rX.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),wq=(rr={},(0,ac.Z)(rr,lq.POINTS,"points"),(0,ac.Z)(rr,lq.LINES,"lines"),(0,ac.Z)(rr,lq.LINE_LOOP,"line loop"),(0,ac.Z)(rr,lq.LINE_STRIP,"line strip"),(0,ac.Z)(rr,lq.TRIANGLES,"triangles"),(0,ac.Z)(rr,lq.TRIANGLE_FAN,"triangle fan"),(0,ac.Z)(rr,lq.TRIANGLE_STRIP,"triangle strip"),rr),wX=(ri={},(0,ac.Z)(ri,lq.STATIC_DRAW,"static"),(0,ac.Z)(ri,lq.DYNAMIC_DRAW,"dynamic"),(0,ac.Z)(ri,lq.STREAM_DRAW,"stream"),ri),wK=(ro={},(0,ac.Z)(ro,lq.BYTE,"int8"),(0,ac.Z)(ro,lq.INT,"int32"),(0,ac.Z)(ro,lq.UNSIGNED_BYTE,"uint8"),(0,ac.Z)(ro,lq.UNSIGNED_SHORT,"uint16"),(0,ac.Z)(ro,lq.UNSIGNED_INT,"uint32"),(0,ac.Z)(ro,lq.FLOAT,"float"),ro),w$=(ra={},(0,ac.Z)(ra,lq.ALPHA,"alpha"),(0,ac.Z)(ra,lq.LUMINANCE,"luminance"),(0,ac.Z)(ra,lq.LUMINANCE_ALPHA,"luminance alpha"),(0,ac.Z)(ra,lq.RGB,"rgb"),(0,ac.Z)(ra,lq.RGBA,"rgba"),(0,ac.Z)(ra,lq.RGBA4,"rgba4"),(0,ac.Z)(ra,lq.RGB5_A1,"rgb5 a1"),(0,ac.Z)(ra,lq.RGB565,"rgb565"),(0,ac.Z)(ra,lq.DEPTH_COMPONENT,"depth"),(0,ac.Z)(ra,lq.DEPTH_STENCIL,"depth stencil"),ra),wQ=(rs={},(0,ac.Z)(rs,lq.DONT_CARE,"dont care"),(0,ac.Z)(rs,lq.NICEST,"nice"),(0,ac.Z)(rs,lq.FASTEST,"fast"),rs),wJ=(ru={},(0,ac.Z)(ru,lq.NEAREST,"nearest"),(0,ac.Z)(ru,lq.LINEAR,"linear"),(0,ac.Z)(ru,lq.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,ac.Z)(ru,lq.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,ac.Z)(ru,lq.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,ac.Z)(ru,lq.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ru),w0=(rc={},(0,ac.Z)(rc,lq.REPEAT,"repeat"),(0,ac.Z)(rc,lq.CLAMP_TO_EDGE,"clamp"),(0,ac.Z)(rc,lq.MIRRORED_REPEAT,"mirror"),rc),w1=(rl={},(0,ac.Z)(rl,lq.NONE,"none"),(0,ac.Z)(rl,lq.BROWSER_DEFAULT_WEBGL,"browser"),rl),w2=(rf={},(0,ac.Z)(rf,lq.NEVER,"never"),(0,ac.Z)(rf,lq.ALWAYS,"always"),(0,ac.Z)(rf,lq.LESS,"less"),(0,ac.Z)(rf,lq.LEQUAL,"lequal"),(0,ac.Z)(rf,lq.GREATER,"greater"),(0,ac.Z)(rf,lq.GEQUAL,"gequal"),(0,ac.Z)(rf,lq.EQUAL,"equal"),(0,ac.Z)(rf,lq.NOTEQUAL,"notequal"),rf),w3=(rh={},(0,ac.Z)(rh,lq.FUNC_ADD,"add"),(0,ac.Z)(rh,lq.MIN_EXT,"min"),(0,ac.Z)(rh,lq.MAX_EXT,"max"),(0,ac.Z)(rh,lq.FUNC_SUBTRACT,"subtract"),(0,ac.Z)(rh,lq.FUNC_REVERSE_SUBTRACT,"reverse subtract"),rh),w5=(rp={},(0,ac.Z)(rp,lq.ZERO,"zero"),(0,ac.Z)(rp,lq.ONE,"one"),(0,ac.Z)(rp,lq.SRC_COLOR,"src color"),(0,ac.Z)(rp,lq.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,ac.Z)(rp,lq.SRC_ALPHA,"src alpha"),(0,ac.Z)(rp,lq.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,ac.Z)(rp,lq.DST_COLOR,"dst color"),(0,ac.Z)(rp,lq.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,ac.Z)(rp,lq.DST_ALPHA,"dst alpha"),(0,ac.Z)(rp,lq.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,ac.Z)(rp,lq.CONSTANT_COLOR,"constant color"),(0,ac.Z)(rp,lq.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,ac.Z)(rp,lq.CONSTANT_ALPHA,"constant alpha"),(0,ac.Z)(rp,lq.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,ac.Z)(rp,lq.SRC_ALPHA_SATURATE,"src alpha saturate"),rp),w4=(rd={},(0,ac.Z)(rd,lq.NEVER,"never"),(0,ac.Z)(rd,lq.ALWAYS,"always"),(0,ac.Z)(rd,lq.LESS,"less"),(0,ac.Z)(rd,lq.LEQUAL,"lequal"),(0,ac.Z)(rd,lq.GREATER,"greater"),(0,ac.Z)(rd,lq.GEQUAL,"gequal"),(0,ac.Z)(rd,lq.EQUAL,"equal"),(0,ac.Z)(rd,lq.NOTEQUAL,"notequal"),rd),w7=(rv={},(0,ac.Z)(rv,lq.ZERO,"zero"),(0,ac.Z)(rv,lq.KEEP,"keep"),(0,ac.Z)(rv,lq.REPLACE,"replace"),(0,ac.Z)(rv,lq.INVERT,"invert"),(0,ac.Z)(rv,lq.INCR,"increment"),(0,ac.Z)(rv,lq.DECR,"decrement"),(0,ac.Z)(rv,lq.INCR_WRAP,"increment wrap"),(0,ac.Z)(rv,lq.DECR_WRAP,"decrement wrap"),rv),w6=(rm={},(0,ac.Z)(rm,lq.FRONT,"front"),(0,ac.Z)(rm,lq.BACK,"back"),rm),w8=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:wX[i||lq.STATIC_DRAW],type:wK[o||lq.UNSIGNED_BYTE]})}return(0,rX.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),w9=function(){function t(e,n){(0,rK.Z)(this,t);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:wX[i||lq.STATIC_DRAW],type:wK[o||lq.UNSIGNED_BYTE],count:a})}return(0,rX.Z)(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),t}(),kt=function(){function t(e,n){(0,rK.Z)(this,t);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map(function(t){return t.get()})),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return(0,rX.Z)(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}(),ke=n(16372),kn=oD.isPlainObject,kr=oD.isTypedArray,ki=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"destroyed",!1),(0,ac.Z)(this,"uniforms",{}),this.reGl=e;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,c=n.elements,l=n.depth,f=n.cull,h=n.instances,p={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:ke.Fp.LOWER_LEFT,clipSpaceNearZ:ke.R$.NEGATIVE_ONE,supportMRT:!1},d={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach(function(t){d[t]=e.prop(t)}));var v={};Object.keys(o).forEach(function(t){v[t]=o[t].get()});var m={attributes:v,frag:fz((0,ke.oX)(p,"frag",i,null,!1)),uniforms:d,vert:fz((0,ke.oX)(p,"vert",r,null,!1)),colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:wq[void 0===s?lq.TRIANGLES:s]};h&&(m.instances=h),u?m.count=u:c&&(m.elements=c.get()),this.initDepthDrawParams({depth:l},m),this.initCullDrawParams({cull:f},m),this.drawCommand=e(m),this.drawParams=m}return(0,rX.Z)(t,[{key:"updateAttributesAndElements",value:function(t,e){var n={};Object.keys(t).forEach(function(e){n[e]=t[e].get()}),this.drawParams.attributes=n,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var e={};Object.keys(t).forEach(function(n){e[n]=t[n].get()}),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,rW.Z)((0,rW.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=(0,rW.Z)((0,rW.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),r={};Object.keys(n).forEach(function(t){var e=(0,u5.Z)(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?r[t]=n[t]:r[t]=n[t].get()}),r.blend=e?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),r.stencil=this.getStencilDrawParams(t),r.colorMask=this.getColorMaskDrawParams(t,e),this.drawCommand(r)}}},{key:"destroy",value:function(){var t;null===(t=this.drawParams)||void 0===t||null===(t=t.elements)||void 0===t||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){null==t||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:w2[n.func||lq.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var e=t.blend||{},n=e.enable,r=e.func,i=e.equation,o=e.color;return{enable:!!n,func:{srcRGB:w5[r&&r.srcRGB||lq.SRC_ALPHA],srcAlpha:w5[r&&r.srcAlpha||lq.SRC_ALPHA],dstRGB:w5[r&&r.dstRGB||lq.ONE_MINUS_SRC_ALPHA],dstAlpha:w5[r&&r.dstAlpha||lq.ONE_MINUS_SRC_ALPHA]},equation:{rgb:w3[i&&i.rgb||lq.FUNC_ADD],alpha:w3[i&&i.alpha||lq.FUNC_ADD]},color:void 0===o?[0,0,0,0]:o}}},{key:"getStencilDrawParams",value:function(t){var e=t.stencil||{},n=e.enable,r=e.mask,i=e.func,o=void 0===i?{cmp:lq.ALWAYS,ref:0,mask:-1}:i,a=e.opFront,s=void 0===a?{fail:lq.KEEP,zfail:lq.KEEP,zpass:lq.KEEP}:a,u=e.opBack,c=void 0===u?{fail:lq.KEEP,zfail:lq.KEEP,zpass:lq.KEEP}:u;return{enable:!!n,mask:void 0===r?-1:r,func:(0,rW.Z)((0,rW.Z)({},o),{},{cmp:w4[o.cmp]}),opFront:{fail:w7[s.fail],zfail:w7[s.zfail],zpass:w7[s.zpass]},opBack:{fail:w7[c.fail],zfail:w7[c.zfail],zpass:w7[c.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,e){var n=t.stencil;return null!=n&&n.enable&&n.opFront&&!e?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?lq.BACK:i;e.cull={enable:!!r,face:w6[o]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach(function(r){e.extractUniformsRecursively(r,t[r],n,"")}),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;if(null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||kr(e)||""===e||"resize"in e){n["".concat(r&&r+".").concat(t)]=e;return}kn(e)&&Object.keys(e).forEach(function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))}),Array.isArray(e)&&e.forEach(function(e,o){Object.keys(e).forEach(function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))})})}}]),t}(),ko=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?lq.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,c=n.format,l=void 0===c?lq.RGBA:c,f=n.mipmap,h=void 0!==f&&f,p=n.wrapS,d=void 0===p?lq.CLAMP_TO_EDGE:p,v=n.wrapT,m=void 0===v?lq.CLAMP_TO_EDGE:v,g=n.aniso,y=n.alignment,b=n.premultiplyAlpha,x=n.mag,_=void 0===x?lq.NEAREST:x,S=n.min,w=void 0===S?lq.NEAREST:S,k=n.colorSpace,C=void 0===k?lq.BROWSER_DEFAULT_WEBGL:k,E=n.x,A=n.y,M=n.copy;this.width=a,this.height=s;var L={width:a,height:s,type:wK[o],format:w$[l],wrapS:w0[d],wrapT:w0[m],mag:wJ[_],min:wJ[w],alignment:void 0===y?1:y,flipY:void 0!==u&&u,colorSpace:w1[C],premultiplyAlpha:void 0!==b&&b,aniso:void 0===g?0:g,x:void 0===E?0:E,y:void 0===A?0:A,copy:void 0!==M&&M};r&&(L.data=r),"number"==typeof h?L.mipmap=wQ[h]:"boolean"==typeof h&&(L.mipmap=h),this.texture=e.texture(L)}return(0,rX.Z)(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;null===(t=this.texture)||void 0===t||t.destroy()}this.isDestroy=!0}}]),t}(),ka=(0,cn.b2)()(rg=function(){var t;function e(){var t,n,r=this;(0,rK.Z)(this,e),(0,ac.Z)(this,"uniformBuffers",[]),(0,ac.Z)(this,"queryVerdorInfo",function(){return"WebGL1"}),(0,ac.Z)(this,"createModel",function(t){return new ki(r.gl,t)}),(0,ac.Z)(this,"createAttribute",function(t){return new wY(r.gl,t)}),(0,ac.Z)(this,"createBuffer",function(t){return new w8(r.gl,t)}),(0,ac.Z)(this,"createElements",function(t){return new w9(r.gl,t)}),(0,ac.Z)(this,"createTexture2D",function(t){return new ko(r.gl,t)}),(0,ac.Z)(this,"createFramebuffer",function(t){return new kt(r.gl,t)}),(0,ac.Z)(this,"useFramebuffer",function(t,e){r.gl({framebuffer:t?t.get():null})(e)}),(0,ac.Z)(this,"useFramebufferAsync",(t=st(sr().mark(function t(e,n){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.gl({framebuffer:e?e.get():null})(n);case 1:case"end":return t.stop()}},t)})),function(e,n){return t.apply(this,arguments)})),(0,ac.Z)(this,"clear",function(t){var e,n=t.color,i=t.depth,o=t.stencil,a=t.framebuffer,s=void 0===a?null:a,u={color:n,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(e=r.gl)||void 0===e||e.clear(u)}),(0,ac.Z)(this,"viewport",function(t){var e=t.x,n=t.y,i=t.width,o=t.height;r.gl._gl.viewport(e,n,i,o),r.width=i,r.height=o,r.gl._refresh()}),(0,ac.Z)(this,"readPixels",function(t){var e=t.framebuffer,n={x:t.x,y:t.y,width:t.width,height:t.height};return e&&(n.framebuffer=e.get()),r.gl.read(n)}),(0,ac.Z)(this,"readPixelsAsync",(n=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.readPixels(e));case 1:case"end":return t.stop()}},t)})),function(t){return n.apply(this,arguments)})),(0,ac.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,ac.Z)(this,"getContainer",function(){var t;return null===(t=r.canvas)||void 0===t?void 0:t.parentElement}),(0,ac.Z)(this,"getCanvas",function(){return r.canvas}),(0,ac.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,ac.Z)(this,"destroy",function(){var t;r.canvas=null,null===(t=r.gl)||void 0===t||null===(t=t._gl)||void 0===t||null===(t=t.getExtension("WEBGL_lose_context"))||void 0===t||t.loseContext(),r.gl.destroy(),r.gl=null})}return(0,rX.Z)(e,[{key:"init",value:(t=st(sr().mark(function t(e,n,r){var i=this;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.canvas=e,!r){t.next=5;break}this.gl=r,t.next=8;break;case 5:return t.next=7,new Promise(function(t,e){wW()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){(n||!r)&&e(n),t(r)}})});case 7:this.gl=t.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return t.stop()}},t,this)})),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||rg,ks=function(){function t(e,n){(0,rK.Z)(this,t);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor,c=n.shaderLocation;this.buffer=r,this.attribute={shaderLocation:c,buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return(0,rX.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),ku=(ry={},(0,ac.Z)(ry,lq.FLOAT,Float32Array),(0,ac.Z)(ry,lq.UNSIGNED_BYTE,Uint8Array),(0,ac.Z)(ry,lq.SHORT,Int16Array),(0,ac.Z)(ry,lq.UNSIGNED_SHORT,Uint16Array),(0,ac.Z)(ry,lq.INT,Int32Array),(0,ac.Z)(ry,lq.UNSIGNED_INT,Uint32Array),ry),kc=(rb={},(0,ac.Z)(rb,lq.POINTS,ke.YV.POINTS),(0,ac.Z)(rb,lq.LINES,ke.YV.LINES),(0,ac.Z)(rb,lq.LINE_LOOP,ke.YV.LINES),(0,ac.Z)(rb,lq.LINE_STRIP,ke.YV.LINE_STRIP),(0,ac.Z)(rb,lq.TRIANGLES,ke.YV.TRIANGLES),(0,ac.Z)(rb,lq.TRIANGLE_FAN,ke.YV.TRIANGLES),(0,ac.Z)(rb,lq.TRIANGLE_STRIP,ke.YV.TRIANGLE_STRIP),rb),kl=(rx={},(0,ac.Z)(rx,1,ke.ED.F32_R),(0,ac.Z)(rx,2,ke.ED.F32_RG),(0,ac.Z)(rx,3,ke.ED.F32_RGB),(0,ac.Z)(rx,4,ke.ED.F32_RGBA),rx),kf=(r_={},(0,ac.Z)(r_,lq.STATIC_DRAW,ke.MP.STATIC),(0,ac.Z)(r_,lq.DYNAMIC_DRAW,ke.MP.DYNAMIC),(0,ac.Z)(r_,lq.STREAM_DRAW,ke.MP.DYNAMIC),r_),kh=(rS={},(0,ac.Z)(rS,lq.REPEAT,ke.OB.REPEAT),(0,ac.Z)(rS,lq.CLAMP_TO_EDGE,ke.OB.CLAMP_TO_EDGE),(0,ac.Z)(rS,lq.MIRRORED_REPEAT,ke.OB.MIRRORED_REPEAT),rS),kp=(rw={},(0,ac.Z)(rw,lq.NEVER,ke.wb.NEVER),(0,ac.Z)(rw,lq.ALWAYS,ke.wb.ALWAYS),(0,ac.Z)(rw,lq.LESS,ke.wb.LESS),(0,ac.Z)(rw,lq.LEQUAL,ke.wb.LEQUAL),(0,ac.Z)(rw,lq.GREATER,ke.wb.GREATER),(0,ac.Z)(rw,lq.GEQUAL,ke.wb.GEQUAL),(0,ac.Z)(rw,lq.EQUAL,ke.wb.EQUAL),(0,ac.Z)(rw,lq.NOTEQUAL,ke.wb.NOTEQUAL),rw),kd=(rk={},(0,ac.Z)(rk,lq.FRONT,ke.Wf.FRONT),(0,ac.Z)(rk,lq.BACK,ke.Wf.BACK),rk),kv=(rC={},(0,ac.Z)(rC,lq.FUNC_ADD,ke.bt.ADD),(0,ac.Z)(rC,lq.MIN_EXT,ke.bt.MIN),(0,ac.Z)(rC,lq.MAX_EXT,ke.bt.MAX),(0,ac.Z)(rC,lq.FUNC_SUBTRACT,ke.bt.SUBSTRACT),(0,ac.Z)(rC,lq.FUNC_REVERSE_SUBTRACT,ke.bt.REVERSE_SUBSTRACT),rC),km=(rE={},(0,ac.Z)(rE,lq.ZERO,ke.zi.ZERO),(0,ac.Z)(rE,lq.ONE,ke.zi.ONE),(0,ac.Z)(rE,lq.SRC_COLOR,ke.zi.SRC),(0,ac.Z)(rE,lq.ONE_MINUS_SRC_COLOR,ke.zi.ONE_MINUS_SRC),(0,ac.Z)(rE,lq.SRC_ALPHA,ke.zi.SRC_ALPHA),(0,ac.Z)(rE,lq.ONE_MINUS_SRC_ALPHA,ke.zi.ONE_MINUS_SRC_ALPHA),(0,ac.Z)(rE,lq.DST_COLOR,ke.zi.DST),(0,ac.Z)(rE,lq.ONE_MINUS_DST_COLOR,ke.zi.ONE_MINUS_DST),(0,ac.Z)(rE,lq.DST_ALPHA,ke.zi.DST_ALPHA),(0,ac.Z)(rE,lq.ONE_MINUS_DST_ALPHA,ke.zi.ONE_MINUS_DST_ALPHA),(0,ac.Z)(rE,lq.CONSTANT_COLOR,ke.zi.CONST),(0,ac.Z)(rE,lq.ONE_MINUS_CONSTANT_COLOR,ke.zi.ONE_MINUS_CONSTANT),(0,ac.Z)(rE,lq.CONSTANT_ALPHA,ke.zi.CONST),(0,ac.Z)(rE,lq.ONE_MINUS_CONSTANT_ALPHA,ke.zi.ONE_MINUS_CONSTANT),(0,ac.Z)(rE,lq.SRC_ALPHA_SATURATE,ke.zi.SRC_ALPHA_SATURATE),rE),kg=(rA={},(0,ac.Z)(rA,lq.REPLACE,ke.Kd.REPLACE),(0,ac.Z)(rA,lq.KEEP,ke.Kd.KEEP),(0,ac.Z)(rA,lq.ZERO,ke.Kd.ZERO),(0,ac.Z)(rA,lq.INVERT,ke.Kd.INVERT),(0,ac.Z)(rA,lq.INCR,ke.Kd.INCREMENT_CLAMP),(0,ac.Z)(rA,lq.DECR,ke.Kd.DECREMENT_CLAMP),(0,ac.Z)(rA,lq.INCR_WRAP,ke.Kd.INCREMENT_WRAP),(0,ac.Z)(rA,lq.DECR_WRAP,ke.Kd.DECREMENT_WRAP),rA),ky=(rM={},(0,ac.Z)(rM,lq.ALWAYS,ke.wb.ALWAYS),(0,ac.Z)(rM,lq.EQUAL,ke.wb.EQUAL),(0,ac.Z)(rM,lq.GEQUAL,ke.wb.GEQUAL),(0,ac.Z)(rM,lq.GREATER,ke.wb.GREATER),(0,ac.Z)(rM,lq.LEQUAL,ke.wb.LEQUAL),(0,ac.Z)(rM,lq.LESS,ke.wb.LESS),(0,ac.Z)(rM,lq.NEVER,ke.wb.NEVER),(0,ac.Z)(rM,lq.NOTEQUAL,ke.wb.NOTEQUAL),rM),kb={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function kx(t){return Object.prototype.toString.call(t) in kb}var k_=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"isDestroyed",!1);var r,i=n.data,o=n.usage,a=n.type,s=n.isUBO,u=n.label;r=kx(i)?i:new ku[this.type||lq.FLOAT](i),this.type=a,this.size=r.byteLength,this.buffer=e.createBuffer({viewOrSize:r,usage:s?ke.FB.UNIFORM:ke.FB.VERTEX,hint:kf[o||lq.STATIC_DRAW]}),u&&e.setResourceName(this.buffer,u)}return(0,rX.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var e,n=t.data,r=t.offset;e=kx(n)?n:new ku[this.type||lq.FLOAT](n),this.buffer.setSubData(r,new Uint8Array(e.buffer))}}]),t}();function kS(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return kw(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kw(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function kw(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function kk(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+=e,t+=t<<10,(t+=t>>>6)>>>0}function kC(t){return t+=t<<3,t^=t>>>11,(t+=t<<15)>>>0}function kE(t){return 0}var kA=(0,rX.Z)(function t(){(0,rK.Z)(this,t),(0,ac.Z)(this,"keys",[]),(0,ac.Z)(this,"values",[])}),kM=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"buckets",new Map),this.keyEqualFunc=e,this.keyHashFunc=n}return(0,rX.Z)(t,[{key:"findBucketIndex",value:function(t,e){for(var n=0;n<t.keys.length;n++)if(this.keyEqualFunc(e,t.keys[n]))return n;return -1}},{key:"findBucket",value:function(t){var e=this.keyHashFunc(t);return this.buckets.get(e)}},{key:"get",value:function(t){var e=this.findBucket(t);if(void 0===e)return null;var n=this.findBucketIndex(e,t);return n<0?null:e.values[n]}},{key:"add",value:function(t,e){var n=this.keyHashFunc(t);void 0===this.buckets.get(n)&&this.buckets.set(n,new kA);var r=this.buckets.get(n);r.keys.push(t),r.values.push(e)}},{key:"delete",value:function(t){var e=this.findBucket(t);if(void 0!==e){var n=this.findBucketIndex(e,t);-1!==n&&(e.keys.splice(n,1),e.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var t,e=0,n=kS(this.buckets.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;e+=r.values.length}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"values",value:sr().mark(function t(){var e,n,r,i;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=kS(this.buckets.values()),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=14;break}i=(r=n.value).values.length-1;case 6:if(!(i>=0)){t.next=12;break}return t.next=9,r.values[i];case 9:i--,t.next=6;break;case 12:t.next=3;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),e.e(t.t0);case 19:return t.prev=19,e.f(),t.finish(19);case 22:case"end":return t.stop()}},t,this,[[1,16,19,22]])})}]),t}();function kT(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return kL(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kL(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function kL(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function kZ(t,e){return t=kk(t,e.blendMode),t=kk(t,e.blendSrcFactor),t=kk(t,e.blendDstFactor)}function kP(t){var e=0;e=kk(0,t.program.id),null!==t.inputLayout&&(e=kk(e,t.inputLayout.id)),e=function(t,e){for(var n,r,i,o,a,s,u,c,l,f,h,p=0;p<e.attachmentsState.length;p++)l=kZ(l=t,(f=e.attachmentsState[p]).rgbBlendState),t=l=kk(l=kZ(l,f.alphaBlendState),f.channelWriteMask);return t=kk(t,(h=e.blendConstant||ke.Ab).r<<24|h.g<<16|h.b<<8|h.a),t=kk(t,e.depthCompare),t=kk(t,e.depthWrite?1:0),t=kk(t,null===(n=e.stencilFront)||void 0===n?void 0:n.compare),t=kk(t,null===(r=e.stencilFront)||void 0===r?void 0:r.passOp),t=kk(t,null===(i=e.stencilFront)||void 0===i?void 0:i.failOp),t=kk(t,null===(o=e.stencilFront)||void 0===o?void 0:o.depthFailOp),t=kk(t,null===(a=e.stencilBack)||void 0===a?void 0:a.compare),t=kk(t,null===(s=e.stencilBack)||void 0===s?void 0:s.passOp),t=kk(t,null===(u=e.stencilBack)||void 0===u?void 0:u.failOp),t=kk(t,null===(c=e.stencilBack)||void 0===c?void 0:c.depthFailOp),t=kk(t,e.stencilWrite?1:0),t=kk(t,e.cullMode),t=kk(t,e.frontFace?1:0),t=kk(t,e.polygonOffset?1:0)}(e,t.megaStateDescriptor);for(var n=0;n<t.colorAttachmentFormats.length;n++)e=kk(e,t.colorAttachmentFormats[n]||0);return kC(e=kk(e,t.depthStencilAttachmentFormat||0))}function kO(t){var e=0;if(t.samplerBindings)for(var n=0;n<t.samplerBindings.length;n++){var r=t.samplerBindings[n];null!==r&&null!==r.texture&&(e=kk(e,r.texture.id))}if(t.uniformBufferBindings)for(var i=0;i<t.uniformBufferBindings.length;i++){var o=t.uniformBufferBindings[i];null!==o&&null!==o.buffer&&(e=kk(e,o.buffer.id),e=kk(e,o.binding),e=kk(e,o.offset),e=kk(e,o.size))}if(t.storageBufferBindings)for(var a=0;a<t.storageBufferBindings.length;a++){var s=t.storageBufferBindings[a];null!==s&&null!==s.buffer&&(e=kk(e,s.buffer.id),e=kk(e,s.binding),e=kk(e,s.offset),e=kk(e,s.size))}if(t.storageTextureBindings)for(var u=0;u<t.storageTextureBindings.length;u++){var c=t.storageTextureBindings[u];null!==c&&null!==c.texture&&(e=kk(e,c.texture.id),e=kk(e,c.binding))}return kC(e)}function kR(t,e){var n,r,i,o;return(null===(n=t.vertex)||void 0===n?void 0:n.glsl)===(null===(r=e.vertex)||void 0===r?void 0:r.glsl)&&(null===(i=t.fragment)||void 0===i?void 0:i.glsl)===(null===(o=e.fragment)||void 0===o?void 0:o.glsl)}var kI=function(){function t(e){(0,rK.Z)(this,t),(0,ac.Z)(this,"bindingsCache",new kM(ke.PU,kO)),(0,ac.Z)(this,"renderPipelinesCache",new kM(ke.zC,kP)),(0,ac.Z)(this,"inputLayoutsCache",new kM(ke.F3,kE)),(0,ac.Z)(this,"programCache",new kM(kR,kE)),this.device=e}return(0,rX.Z)(t,[{key:"createBindings",value:function(t){var e=this.bindingsCache.get(t);if(null===e){var n,r=(0,ke.LJ)(t);r.uniformBufferBindings=null===(n=r.uniformBufferBindings)||void 0===n?void 0:n.filter(function(t){var e=t.size;return e&&e>0}),e=this.device.createBindings(r),this.bindingsCache.add(r,e)}return e}},{key:"createRenderPipeline",value:function(t){var e=this.renderPipelinesCache.get(t);if(null===e){var n=(0,ke.yA)(t);n.colorAttachmentFormats=n.colorAttachmentFormats.filter(function(t){return t}),e=this.device.createRenderPipeline(n),this.renderPipelinesCache.add(n,e)}return e}},{key:"createInputLayout",value:function(t){t.vertexBufferDescriptors=t.vertexBufferDescriptors.filter(function(t){return!!t});var e=this.inputLayoutsCache.get(t);if(null===e){var n=(0,ke.Id)(t);e=this.device.createInputLayout(n),this.inputLayoutsCache.add(n,e)}return e}},{key:"createProgram",value:function(t){var e=this.programCache.get(t);if(null===e){var n,r,i={vertex:{glsl:null===(n=t.vertex)||void 0===n?void 0:n.glsl},fragment:{glsl:null===(r=t.fragment)||void 0===r?void 0:r.glsl}};e=this.device.createProgram(t),this.programCache.add(i,e)}return e}},{key:"destroy",value:function(){var t,e=kT(this.bindingsCache.values());try{for(e.s();!(t=e.n()).done;)t.value.destroy()}catch(t){e.e(t)}finally{e.f()}var n,r=kT(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;)n.value.destroy()}catch(t){r.e(t)}finally{r.f()}var i,o=kT(this.inputLayoutsCache.values());try{for(o.s();!(i=o.n()).done;)i.value.destroy()}catch(t){o.e(t)}finally{o.f()}var a,s=kT(this.programCache.values());try{for(s.s();!(a=s.n()).done;)a.value.destroy()}catch(t){s.e(t)}finally{s.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}]),t}(),kD=function(){function t(e,n){(0,rK.Z)(this,t);var r,i=n.data,o=n.type,a=n.count;r=kx(i)?i:new ku[this.type||lq.UNSIGNED_INT](i),this.type=o,this.count=void 0===a?0:a,this.indexBuffer=e.createBuffer({viewOrSize:r,usage:ke.FB.INDEX})}return(0,rX.Z)(t,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var e,n=t.data;e=kx(n)?n:new ku[this.type||lq.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(e.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),t}();function kN(t){return!!(t&&t.texture)}var kz=function(){function t(e,n){(0,rK.Z)(this,t),(0,ac.Z)(this,"isDestroy",!1),this.device=e,this.options=n;var r=n.wrapS,i=void 0===r?lq.CLAMP_TO_EDGE:r,o=n.wrapT,a=void 0===o?lq.CLAMP_TO_EDGE:o,s=n.aniso,u=(n.mipmap,n.mag),c=void 0===u?lq.NEAREST:u,l=n.min,f=void 0===l?lq.NEAREST:l;this.createTexture(n),this.sampler=e.createSampler({addressModeU:kh[i],addressModeV:kh[a],minFilter:f===lq.NEAREST?ke.X9.POINT:ke.X9.BILINEAR,magFilter:c===lq.NEAREST?ke.X9.POINT:ke.X9.BILINEAR,mipmapFilter:ke.f$.NO_MIP,maxAnisotropy:s})}return(0,rX.Z)(t,[{key:"createTexture",value:function(t){var e=t.type,n=void 0===e?lq.UNSIGNED_BYTE:e,r=t.width,i=t.height,o=t.flipY,a=t.format,s=void 0===a?lq.RGBA:a,u=(t.aniso,t.alignment),c=t.usage,l=void 0===c?lj.SAMPLED:c,f=t.unorm,h=t.label,p=t.data;this.width=r,this.height=i;var d=ke.ED.U8_RGBA_RT;if(n===lq.UNSIGNED_BYTE&&s===lq.RGBA)d=void 0!==f&&f?ke.ED.U8_RGBA_NORM:ke.ED.U8_RGBA_RT;else if(n===lq.UNSIGNED_BYTE&&s===lq.LUMINANCE)d=ke.ED.U8_LUMINANCE;else if(n===lq.FLOAT&&s===lq.RGB)"WebGPU"===this.device.queryVendorInfo().platformString?(p&&(p=function(t,e){for(var n=t.length,r=Math.ceil(n/3),i=n+r,o=new Float32Array(i),a=0;a<i;a+=4)o[a]=t[a/4*3],o[a+1]=t[a/4*3+1],o[a+2]=t[a/4*3+2],o[a+3]=0;return o}(p,0)),d=ke.ED.F32_RGBA):d=ke.ED.F32_RGB;else if(n===lq.FLOAT&&s===lq.RGBA)d=ke.ED.F32_RGBA;else if(n===lq.FLOAT&&s===lq.RED)d=ke.ED.F32_R;else throw Error("create texture error, type: ".concat(n,", format: ").concat(s));this.texture=this.device.createTexture({format:d,width:r,height:i,usage:l===lj.SAMPLED?ke.v2.SAMPLED:ke.v2.RENDER_TARGET,pixelStore:{unpackFlipY:void 0!==o&&o,packAlignment:void 0===u?1:u},mipLevelCount:1}),h&&this.device.setResourceName(this.texture,h),p&&this.texture.setImageData([p])}},{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var e=t.data;this.texture.setImageData([e])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var e=t.width,n=t.height;(this.width!==e||this.height!==n)&&this.destroy(),this.options.width=e,this.options.height=n,this.createTexture(this.options),this.isDestroy=!1}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy&&!this.texture.destroyed){var t;null===(t=this.texture)||void 0===t||t.destroy()}this.isDestroy=!0}}]),t}(),kj=function(){function t(e,n){(0,rK.Z)(this,t),this.device=e,this.options=n,this.createColorRenderTarget(),this.createDepthRenderTarget()}return(0,rX.Z)(t,[{key:"createColorRenderTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.options,n=e.width,r=e.height,i=e.color;i&&(kN(i)?(t&&i.resize({width:n,height:r}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):n&&r&&(this.colorTexture=this.device.createTexture({format:ke.ED.U8_RGBA_RT,usage:ke.v2.RENDER_TARGET,width:n,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n,this.height=r))}},{key:"createDepthRenderTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.options,n=e.width,r=e.height,i=e.depth;i&&(kN(i)?(t&&i.resize({width:n,height:r}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):n&&r&&(this.depthTexture=this.device.createTexture({format:ke.ED.D24_S8,usage:ke.v2.RENDER_TARGET,width:n,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n,this.height=r))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var t,e;null===(t=this.colorRenderTarget)||void 0===t||t.destroy(),null===(e=this.depthRenderTarget)||void 0===e||e.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;(this.width!==e||this.height!==n)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=e,this.options.height=n,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}]),t}(),kB=oD.isPlainObject,kF=oD.isTypedArray,kU=function(){function t(e,n,r){var i=this;(0,rK.Z)(this,t),(0,ac.Z)(this,"destroyed",!1),(0,ac.Z)(this,"uniforms",{}),(0,ac.Z)(this,"vertexBuffers",[]),this.device=e,this.options=n,this.service=r;var o=n.vs,a=n.fs,s=n.attributes,u=n.uniforms,c=n.count,l=n.elements,f=n.diagnosticDerivativeUniformityEnabled;this.options=n;var h=f?"":this.service.viewportOrigin===ke.Fp.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:o},fragment:{glsl:a,postprocess:function(t){return h+t}}}),u&&(this.uniforms=this.extractUniforms(u));var p=[],d=0;Object.keys(s).forEach(function(t){var e=s[t],n=e.get();i.vertexBuffers.push(n.get());var r=e.attribute,o=r.offset,a=r.stride,u=r.size,c=void 0===u?1:u,l=r.divisor,f=r.shaderLocation;p.push({arrayStride:(void 0===a?0:a)||4*c,stepMode:ke.Kz.VERTEX,attributes:[{format:kl[c],shaderLocation:void 0===f?0:f,offset:void 0===o?0:o,divisor:void 0===l?0:l}]}),d=n.size/c}),c||(this.options.count=d),l&&(this.indexBuffer=l.get());var v=r.renderCache.createInputLayout({vertexBufferDescriptors:p,indexBufferFormat:l?ke.ED.U32_R:null,program:this.program});this.inputLayout=v,this.pipeline=this.createPipeline(n)}return(0,rX.Z)(t,[{key:"createPipeline",value:function(t,e){var n=t.primitive,r=void 0===n?lq.TRIANGLES:n,i=t.depth,o=t.cull,a=t.blend,s=t.stencil,u=this.initDepthDrawParams({depth:i}),c=!!(u&&u.enable),l=this.initCullDrawParams({cull:o}),f=!!(l&&l.enable),h=this.getBlendDrawParams({blend:a}),p=!!(h&&h.enable),d=this.getStencilDrawParams({stencil:s}),v=!!(d&&d.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:kc[r],colorAttachmentFormats:[ke.ED.U8_RGBA_RT],depthStencilAttachmentFormat:ke.ED.D24_S8,megaStateDescriptor:{attachmentsState:[e?{channelWriteMask:ke.GI.ALL,rgbBlendState:{blendMode:ke.bt.ADD,blendSrcFactor:ke.zi.ONE,blendDstFactor:ke.zi.ZERO},alphaBlendState:{blendMode:ke.bt.ADD,blendSrcFactor:ke.zi.ONE,blendDstFactor:ke.zi.ZERO}}:{channelWriteMask:v&&d.opFront.zpass===ke.Kd.REPLACE?ke.GI.NONE:ke.GI.ALL,rgbBlendState:{blendMode:p&&h.equation.rgb||ke.bt.ADD,blendSrcFactor:p&&h.func.srcRGB||ke.zi.SRC_ALPHA,blendDstFactor:p&&h.func.dstRGB||ke.zi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:p&&h.equation.alpha||ke.bt.ADD,blendSrcFactor:p&&h.func.srcAlpha||ke.zi.ONE,blendDstFactor:p&&h.func.dstAlpha||ke.zi.ONE}}],blendConstant:p?ke.Ab:void 0,depthWrite:c,depthCompare:c&&u.func||ke.wb.LESS,cullMode:f&&l.face||ke.Wf.NONE,stencilWrite:v,stencilFront:{compare:v?d.func.cmp:ke.wb.ALWAYS,passOp:d.opFront.zpass,failOp:d.opFront.fail,depthFailOp:d.opFront.zfail,mask:d.opFront.mask},stencilBack:{compare:v?d.func.cmp:ke.wb.ALWAYS,passOp:d.opBack.zpass,failOp:d.opBack.fail,depthFailOp:d.opBack.zfail,mask:d.opBack.mask}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=(0,rW.Z)((0,rW.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){var n=this,r=(0,rW.Z)((0,rW.Z)({},this.options),t),i=r.count,o=void 0===i?0:i,a=r.instances,s=r.elements,u=r.uniforms,c=r.uniformBuffers,l=r.textures;this.uniforms=(0,rW.Z)((0,rW.Z)({},this.uniforms),this.extractUniforms(void 0===u?{}:u));var f=this.service,h=f.renderPass,p=f.currentFramebuffer,d=f.width,v=f.height,m=f.renderCache;this.pipeline=this.createPipeline(r,e);var g=this.service.device,y=g.swapChainHeight;if(g.swapChainHeight=(null==p?void 0:p.height)||v,h.setViewport(0,0,(null==p?void 0:p.width)||d,(null==p?void 0:p.height)||v),g.swapChainHeight=y,h.setPipeline(this.pipeline),h.setStencilReference(1),h.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(t){return{buffer:t}}),s?{buffer:this.indexBuffer,offset:0}:null),c&&(this.bindings=m.createBindings({pipeline:this.pipeline,uniformBufferBindings:c.map(function(t,e){return{binding:e,buffer:t.get(),size:t.size}}),samplerBindings:null==l?void 0:l.map(function(t){return{texture:t.texture,sampler:t.sampler}})})),this.bindings&&(h.setBindings(this.bindings),Object.keys(this.uniforms).forEach(function(t){var e=n.uniforms[t];e instanceof kz?n.uniforms[t]=e.get():e instanceof kj&&(n.uniforms[t]=e.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),s){var b=s.count;0===b?h.draw(o,a):h.drawIndexed(b,a)}else h.draw(o,a)}},{key:"destroy",value:function(){var t,e,n;this.program.destroy(),null===(t=this.vertexBuffers)||void 0===t||t.forEach(function(t){return t.destroy()}),null===(e=this.indexBuffer)||void 0===e||e.destroy(),null===(n=this.bindings)||void 0===n||n.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var e=t.depth;if(e)return{enable:void 0===e.enable||!!e.enable,mask:void 0===e.mask||!!e.mask,func:kp[e.func||lq.LESS],range:e.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var e=t.blend||{},n=e.enable,r=e.func,i=e.equation,o=e.color;return{enable:!!n,func:{srcRGB:km[r&&r.srcRGB||lq.SRC_ALPHA],srcAlpha:km[r&&r.srcAlpha||lq.SRC_ALPHA],dstRGB:km[r&&r.dstRGB||lq.ONE_MINUS_SRC_ALPHA],dstAlpha:km[r&&r.dstAlpha||lq.ONE_MINUS_SRC_ALPHA]},equation:{rgb:kv[i&&i.rgb||lq.FUNC_ADD],alpha:kv[i&&i.alpha||lq.FUNC_ADD]},color:void 0===o?[0,0,0,0]:o}}},{key:"getStencilDrawParams",value:function(t){var e=t.stencil||{},n=e.enable,r=e.mask,i=e.func,o=void 0===i?{cmp:lq.ALWAYS,ref:0,mask:4294967295}:i,a=e.opFront,s=void 0===a?{fail:lq.KEEP,zfail:lq.KEEP,zpass:lq.KEEP}:a,u=e.opBack,c=void 0===u?{fail:lq.KEEP,zfail:lq.KEEP,zpass:lq.KEEP}:u;return{enable:!!n,mask:void 0===r?4294967295:r,func:(0,rW.Z)((0,rW.Z)({},o),{},{cmp:ky[o.cmp]}),opFront:{fail:kg[s.fail],zfail:kg[s.zfail],zpass:kg[s.zpass],mask:o.mask},opBack:{fail:kg[c.fail],zfail:kg[c.zfail],zpass:kg[c.zpass],mask:o.mask}}}},{key:"initCullDrawParams",value:function(t){var e=t.cull;if(e){var n=e.enable,r=e.face;return{enable:!!n,face:kd[void 0===r?lq.BACK:r]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach(function(r){e.extractUniformsRecursively(r,t[r],n,"")}),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;if(null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||kF(e)||""===e||"resize"in e){n["".concat(r&&r+".").concat(t)]=e;return}kB(e)&&Object.keys(e).forEach(function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))}),Array.isArray(e)&&e.forEach(function(e,o){Object.keys(e).forEach(function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))})})}}]),t}(),kV=oD.isUndefined,kH=(0,cn.b2)()(rT=function(){var t;function e(){var t,n,r=this;(0,rK.Z)(this,e),(0,ac.Z)(this,"uniformBuffers",[]),(0,ac.Z)(this,"queryVerdorInfo",function(){return r.device.queryVendorInfo().platformString}),(0,ac.Z)(this,"createModel",function(t){return new kU(r.device,t,r)}),(0,ac.Z)(this,"createAttribute",function(t){return new ks(r.device,t)}),(0,ac.Z)(this,"createBuffer",function(t){return new k_(r.device,t)}),(0,ac.Z)(this,"createElements",function(t){return new kD(r.device,t)}),(0,ac.Z)(this,"createTexture2D",function(t){return new kz(r.device,t)}),(0,ac.Z)(this,"createFramebuffer",function(t){return new kj(r.device,t)}),(0,ac.Z)(this,"useFramebuffer",function(t,e){r.currentFramebuffer=t,r.beginFrame(),e(),r.endFrame(),r.currentFramebuffer=null}),(0,ac.Z)(this,"useFramebufferAsync",(t=st(sr().mark(function t(e,n){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.currentFramebuffer=e,r.preRenderPass=r.renderPass,r.beginFrame(),t.next=5,n();case 5:r.endFrame(),r.currentFramebuffer=null,r.renderPass=r.preRenderPass;case 8:case"end":return t.stop()}},t)})),function(e,n){return t.apply(this,arguments)})),(0,ac.Z)(this,"clear",function(t){var e=t.color,n=t.depth,i=t.stencil,o=t.framebuffer,a=void 0===o?null:o;if(a)a.clearOptions={color:e,depth:n,stencil:i};else{var s=r.queryVerdorInfo();if("WebGL1"===s){var u=r.getGLContext();kV(i)?kV(n)||(u.clearDepth(n),u.clear(u.DEPTH_BUFFER_BIT)):(u.clearStencil(i),u.clear(u.STENCIL_BUFFER_BIT))}else if("WebGL2"===s){var c=r.getGLContext();kV(i)?kV(n)||c.clearBufferfv(c.DEPTH,0,[n]):c.clearBufferiv(c.STENCIL,0,[i])}}}),(0,ac.Z)(this,"viewport",function(t){var e=t.width,n=t.height;r.swapChain.configureSwapChain(e,n),r.createMainColorDepthRT(e,n),r.width=e,r.height=n}),(0,ac.Z)(this,"readPixels",function(t){var e=t.framebuffer,n=t.x,i=t.y,o=t.width,a=t.height,s=r.device.createReadback(),u=e.colorTexture,c=s.readTextureSync(u,n,r.viewportOrigin===ke.Fp.LOWER_LEFT?i:r.height-i,o,a,new Uint8Array(o*a*4));return s.destroy(),c}),(0,ac.Z)(this,"readPixelsAsync",(n=st(sr().mark(function t(e){var n,i,o,a,s,u,c,l,f,h;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.framebuffer,i=e.x,o=e.y,a=e.width,s=e.height,u=r.device.createReadback(),c=n.colorTexture,t.next=5,u.readTexture(c,i,r.viewportOrigin===ke.Fp.LOWER_LEFT?o:r.height-o,a,s,new Uint8Array(a*s*4));case 5:if(l=t.sent,r.viewportOrigin!==ke.Fp.LOWER_LEFT)for(f=0;f<l.length;f+=4)h=l[f],l[f]=l[f+2],l[f+2]=h;return u.destroy(),t.abrupt("return",l);case 9:case"end":return t.stop()}},t)})),function(t){return n.apply(this,arguments)})),(0,ac.Z)(this,"getViewportSize",function(){return{width:r.width,height:r.height}}),(0,ac.Z)(this,"getContainer",function(){var t;return null===(t=r.canvas)||void 0===t?void 0:t.parentElement}),(0,ac.Z)(this,"getCanvas",function(){return r.canvas}),(0,ac.Z)(this,"getGLContext",function(){return r.device.gl}),(0,ac.Z)(this,"destroy",function(){var t;r.canvas=null,null===(t=r.uniformBuffers)||void 0===t||t.forEach(function(t){t.destroy()}),r.device.destroy(),r.renderCache.destroy()})}return(0,rX.Z)(e,[{key:"init",value:(t=st(sr().mark(function t(e,n){var r,i,o,a,s;return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.enableWebGPU,i=n.shaderCompilerPath,this.canvas=e,o=r?new ke.zo({shaderCompilerPath:i}):new ke.j8({targets:["webgl2","webgl1"],onContextLost:function(t){console.warn("context lost",t)},onContextCreationError:function(t){console.warn("context creation error",t)},onContextRestored:function(t){console.warn("context restored",t)}}),t.next=5,o.createSwapChain(e);case 5:(a=t.sent).configureSwapChain(e.width,e.height),this.device=a.getDevice(),this.swapChain=a,this.renderCache=new kI(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin,s=this.device.gl,this.extensionObject={OES_texture_float:!("undefined"!=typeof WebGL2RenderingContext&&s instanceof WebGL2RenderingContext)&&(!s||2!==s._version)&&this.device.OES_texture_float},this.createMainColorDepthRT(e.width,e.height);case 15:case"end":return t.stop()}},t,this)})),function(e,n){return t.apply(this,arguments)})},{key:"createMainColorDepthRT",value:function(t,e){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:ke.ED.U8_RGBA_RT,width:t,height:e,usage:ke.v2.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:ke.ED.D24_S8,width:t,height:e,usage:ke.v2.RENDER_TARGET}))}},{key:"beginFrame",value:function(){this.device.beginFrame();var t=this.currentFramebuffer,e=this.swapChain,n=this.mainColorRT,r=this.mainDepthRT,i=t?t.colorRenderTarget:n,o=t?null:e.getOnscreenTexture(),a=t?t.depthRenderTarget:r,s=(null==t?void 0:t.clearOptions)||{},u=s.color,c=void 0===u?[0,0,0,0]:u,l=s.depth,f=s.stencil,h=i?(0,ke.RH)(255*c[0],255*c[1],255*c[2],c[3]):ke.Ab,p=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[o],colorClearColor:[h],colorStore:[!0],depthStencilAttachment:a,depthClearValue:a?void 0===l?1:l:void 0,stencilClearValue:a?void 0===f?0:f:void 0});this.renderPass=p}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass),this.device.endFrame()}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||rT,kG=["selectstart","selecting","selectend"],kW=function(t){(0,r$.Z)(r,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,rJ.Z)(r);if(e){var i=(0,rJ.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,rQ.Z)(this,t)});function r(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,rK.Z)(this,r),e=n.call(this),(0,ac.Z)((0,se.Z)(e),"isEnable",!1),(0,ac.Z)((0,se.Z)(e),"onDragStart",function(t){e.box.style.display="block",e.startEvent=e.endEvent=t,e.syncBoxBound(),e.emit("selectstart",e.getLngLatBox(),e.startEvent,e.endEvent)}),(0,ac.Z)((0,se.Z)(e),"onDragging",function(t){e.endEvent=t,e.syncBoxBound(),e.emit("selecting",e.getLngLatBox(),e.startEvent,e.endEvent)}),(0,ac.Z)((0,se.Z)(e),"onDragEnd",function(t){e.endEvent=t,e.box.style.display="none",e.emit("selectend",e.getLngLatBox(),e.startEvent,e.endEvent)}),e.scene=t,e.options=i,e}return(0,rX.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var e=oF("div",void 0,this.container);e.classList.add("l7-select-box"),t&&e.classList.add(t),e.style.display="none",this.box=e}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,e=t.x,n=t.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(e,i),s=Math.min(n,o),u=Math.abs(e-i),c=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(c,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,e=t.lng,n=t.lat,r=this.endEvent.lngLat;return aF([[e,n],[r.lng,r.lat]])}}]),r}(so.EventEmitter),kY=function(){var t,e,n,r,i;function o(t){(0,rK.Z)(this,o);var e=t.id,n=t.map,r=t.canvas,i=t.renderer,a=hx();this.container=a,n.setContainer(a,e,r),a.bind(ci.IRendererService).to("regl"===(void 0===i?"regl":i)?ka:kH).inSingletonScope(),this.sceneService=a.get(ci.ISceneService),this.mapService=a.get(ci.IMapService),this.iconService=a.get(ci.IIconService),this.fontService=a.get(ci.IFontService),this.controlService=a.get(ci.IControlService),this.layerService=a.get(ci.ILayerService),this.debugService=a.get(ci.IDebugService),this.debugService.setEnable(t.debug),this.markerService=a.get(ci.IMarkerService),this.interactionService=a.get(ci.IInteractionService),this.popupService=a.get(ci.IPopupService),this.boxSelect=new kW(this,{}),this.initComponent(e),this.sceneService.init(t),this.initControl()}return(0,rX.Z)(o,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(t=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return t.stop()}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"exportMap",value:(e=st(sr().mark(function t(e){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"registerRenderService",value:function(t){var e=this;this.sceneService.loaded?new t(this).init():this.on("loaded",function(){new t(e).init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=this,n=h_(this.container);if(t.setContainer(n,this.container),this.sceneService.addLayer(t),t.inited){var r=this.initMask(t);this.addMask(r,t.id)}else t.on("inited",function(){var n=e.initMask(t);e.addMask(n,t.id)})}},{key:"initMask",value:function(t){var e=t.getLayerConfig(),n=e.mask,r=e.maskfence,i=e.maskColor,o=e.maskOpacity;if(n&&r)return new mB().source(r).shape("fill").style({color:void 0===i?"#000":i,opacity:void 0===o?0:o})}},{key:"addMask",value:function(t,e){if(t){var n=this.getLayer(e);if(n){var r=h_(this.container);t.setContainer(r,this.container),n.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:(n=st(sr().mark(function t(e,n){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layerService.remove(e,n);case 2:case"end":return t.stop()}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"removeAllLayer",value:(r=st(sr().mark(function t(){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layerService.removeAllLayers();case 2:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach(function(t){var n=(0,i3.Z)(t,2),r=n[0],i=n[1];e.fontService.addIconFont(r,i)})}},{key:"addFontFace",value:function(t,e){var n=this;this.fontService.once("fontloaded",function(t){n.emit("fontloaded",t)}),this.fontService.addFontFace(t,e)}},{key:"addImage",value:(i=st(sr().mark(function t(e,n){return sr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.iconService.addImage(e,n);case 2:case"end":return t.stop()}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,e){if(kG.includes(t)){var n;null===(n=this.boxSelect)||void 0===n||n.on(t,e)}else hP.includes(t)?this.sceneService.on(t,e):this.mapService.on(t,e)}},{key:"once",value:function(t,e){if(kG.includes(t)){var n;null===(n=this.boxSelect)||void 0===n||n.once(t,e)}else hP.includes(t)?this.sceneService.once(t,e):this.mapService.once(t,e)}},{key:"emit",value:function(t,e){-1===hP.indexOf(t)?this.mapService.on(t,e):this.sceneService.emit(t,e)}},{key:"off",value:function(t,e){if(kG.includes(t)){var n;null===(n=this.boxSelect)||void 0===n||n.off(t,e)}else hP.includes(t)?this.sceneService.off(t,e):this.mapService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(t,e||(0,rW.Z)((0,rW.Z)({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(ci.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.boxSelect.enable(),e&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return r5.REGISTERED_PROTOCOLS[t]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:oz(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,n=t.logoPosition;e&&this.addControl(new pk({position:n}))}}],[{key:"addProtocol",value:function(t,e){r5.REGISTERED_PROTOCOLS[t]=e}},{key:"removeProtocol",value:function(t){delete r5.REGISTERED_PROTOCOLS[t]}}]),o}(),kq="2.20.20"},5363:function(t,e,n){"use strict";n.r(e),n.d(e,{BubbleLayer:function(){return iM},ChoroplethLayer:function(){return iN},ContextMenu:function(){return s_},CustomControl:function(){return am},ExportImageControl:function(){return aX},FlowLayer:function(){return aa},FullscreenControl:function(){return a$},GeoLocateControl:function(){return aJ},HeatmapLayer:function(){return it},IconFontLayer:function(){return ah},IconImageLayer:function(){return ad},ImageLayer:function(){return ir},LarkMap:function(){return er},LayerPopup:function(){return sv},LayerSwitchControl:function(){return a5},LegendCategories:function(){return le},LegendIcon:function(){return cG},LegendProportion:function(){return cQ},LegendRamp:function(){return lv},LineLayer:function(){return io},LocationSearch:function(){return ck},LogoControl:function(){return si},MapThemeControl:function(){return a7},Marker:function(){return sc},MouseLocationControl:function(){return a8},PointLayer:function(){return is},PolygonLayer:function(){return ic},Popup:function(){return sf},RasterLayer:function(){return ih},RegionLocation:function(){return cV},ScaleControl:function(){return st},SyncScene:function(){return lD},Template:function(){return so},TextLayer:function(){return id},ZoomControl:function(){return sn},syncScene:function(){return lI},useControl:function(){return ea},useDraw:function(){return lw},useDrawGroup:function(){return lP},useLayer:function(){return ec},useLayerList:function(){return ef},useLayerManager:function(){return es},useScene:function(){return eo},version:function(){return lO}});var r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M,L=n(99769),Z=n(2265),P=n(93574),O=n.n(P),R=(r=Z.useEffect,function(t,e){var n,i,o=(0,Z.useRef)(),a=(0,Z.useRef)(0);void 0!==e&&(n=e,i=o.current,void 0===n&&(n=[]),void 0===i&&(i=[]),O()(n,i))||(o.current=e,a.current+=1),r(t,[a.current])}),I=n(16480),D=n.n(I),N="object"==typeof global&&global&&global.Object===Object&&global,z="object"==typeof self&&self&&self.Object===Object&&self,j=N||z||Function("return this")(),B=j.Symbol,F=Object.prototype,U=F.hasOwnProperty,V=F.toString,H=B?B.toStringTag:void 0,G=function(t){var e=U.call(t,H),n=t[H];try{t[H]=void 0;var r=!0}catch(t){}var i=V.call(t);return r&&(e?t[H]=n:delete t[H]),i},W=Object.prototype.toString,Y=B?B.toStringTag:void 0,q=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Y&&Y in Object(t)?G(t):W.call(t)},X=function(t){return null!=t&&"object"==typeof t},K=function(t){return"number"==typeof t||X(t)&&"[object Number]"==q(t)},$=function(){function t(){this._events={}}return t.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[t]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete e._events[t],i--,o--),s.apply(e,n)}};a(i),a(o)},t.prototype.off=function(t,e){if(t){if(e){for(var n=this._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[t]}else delete this._events[t]}else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}();function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,to(r.key),r)}}function te(t,e){return(te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function tn(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tr(t){return(tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ti(t,e,n){return(e=to(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function to(t){var e=function(t,e){if("object"!==Q(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==Q(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Q(e)?e:String(e)}var ta=0,ts=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&te(t,e)}(o,t);var e,n,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=tr(o);if(e){var r=tr(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return function(t,e){if(e&&("object"===Q(e)||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return tn(t)}(this,t)});function o(t){var e;return!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,o),ti(tn(e=i.call(this)),"scene",void 0),ti(tn(e),"options",void 0),ti(tn(e),"layerMap",new Map),e.scene=t.scene,e.options=t,e}return n=[{key:"hasLayer",value:function(t){return this.layerMap.has(t)}},{key:"addLayer",value:function(t){var e=this.getLayerId(t);this.layerMap.set(e,t),t.addTo(this.scene),this.emit("add",t)}},{key:"addLayers",value:function(t){var e=this;t.forEach(function(t){e.addLayer(t)})}},{key:"removeLayer",value:function(t){var e="string"==typeof t?t:this.getLayerId(t),n=this.layerMap.get(e);return!!n&&(this.layerMap.delete(e),n.remove(),this.emit("remove",e),!0)}},{key:"getLayers",value:function(){return Array.from(this.layerMap.values())}},{key:"getLayerById",value:function(t){return this.layerMap.get(t)}},{key:"getLayer",value:function(t){return this.getLayerById(t)}},{key:"removeAllLayer",value:function(){var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(t,e)}}(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.layerMap.values());try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}this.layerMap.clear()}},{key:"isEmpty",value:function(){return 0===this.layerMap.size}},{key:"getLayerId",value:function(t){return"id"in t?t.id:"".concat(ta++)}},{key:"destroy",value:function(){this.removeAllLayer()}}],tt(o.prototype,n),r&&tt(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}($),tu=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n},tc=(i={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},function(t){return null==i?void 0:i[t]}),tl=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},tf=Array.isArray,th=function(t){return"symbol"==typeof t||X(t)&&"[object Symbol]"==q(t)},tp=1/0,td=B?B.prototype:void 0,tv=td?td.toString:void 0,tm=function t(e){if("string"==typeof e)return e;if(tf(e))return tl(e,t)+"";if(th(e))return tv?tv.call(e):"";var n=e+"";return"0"==n&&1/e==-tp?"-0":n},tg=function(t){return null==t?"":tm(t)},ty=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tb=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),tx=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,t_=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,tS="\ud800-\udfff",tw="\\u2700-\\u27bf",tk="a-z\\xdf-\\xf6\\xf8-\\xff",tC="A-Z\\xc0-\\xd6\\xd8-\\xde",tE="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tA="['’]",tM="["+tE+"]",tT="["+tk+"]",tL="[^"+tS+tE+"\\d+"+tw+tk+tC+"]",tZ="(?:\ud83c[\udde6-\uddff]){2}",tP="[\ud800-\udbff][\udc00-\udfff]",tO="["+tC+"]",tR="(?:"+tT+"|"+tL+")",tI="(?:"+tA+"(?:d|ll|m|re|s|t|ve))?",tD="(?:"+tA+"(?:D|LL|M|RE|S|T|VE))?",tN="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\ud83c[\udffb-\udfff])?",tz="[\\ufe0e\\ufe0f]?",tj="(?:\\u200d(?:"+["[^"+tS+"]",tZ,tP].join("|")+")"+tz+tN+")*",tB="(?:"+["["+tw+"]",tZ,tP].join("|")+")"+(tz+tN+tj),tF=RegExp([tO+"?"+tT+"+"+tI+"(?="+[tM,tO,"$"].join("|")+")","(?:"+tO+"|"+tL+")+"+tD+"(?="+[tM,tO+tR,"$"].join("|")+")",tO+"?"+tR+"+"+tI,tO+"+"+tD,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",tB].join("|"),"g"),tU=function(t,e,n){if(t=tg(t),void 0===(e=n?void 0:e)){var r;return(r=t,t_.test(r))?t.match(tF)||[]:t.match(tx)||[]}return t.match(e)||[]},tV=RegExp("['’]","g"),tH=(o=function(t,e,n){return t+(n?"-":"")+e.toLowerCase()},function(t){var e;return tu(tU(((e=tg(e=t))&&e.replace(ty,tc).replace(tb,"")).replace(tV,"")),o,"")});function tG(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var tW=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.entries(null!=t?t:{}).map(function(t){var e=function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,2)||function(t,e){if(t){if("string"==typeof t)return tG(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tG(t,e)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=e[0],r=e[1],i=tH(n),o=r;return"number"==typeof o?o="".concat(o,"px"):"string"==typeof o&&(o=o.replace("'","")),"".concat(i," :").concat(o)}).join("; ")};function tY(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return tq(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tq(t,e)}}(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tq(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function tX(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object.entries(t).sort(function(t,e){var n=tY(t,1)[0],r=tY(e,1)[0];return n.localeCompare(r)}).map(function(t){var n=tY(t,2),r=n[0],i=n[1],o=String(i);return e&&(o=window.encodeURI(String(i))),"".concat(r,"=").concat(o)}).join("&")}function tK(t){return(tK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t$(){t$=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(e,n,r,o){var a,s,u=Object.create((n&&n.prototype instanceof m?n:m).prototype);return i(u,"_invoke",{value:(a=new A(o||[]),s=h,function(n,i){if(s===p)throw Error("Generator is already running");if(s===d){if("throw"===n)throw i;return{value:t,done:!0}}for(a.method=n,a.arg=i;;){var o=a.delegate;if(o){var u=function e(n,r){var i=r.method,o=n.iterator[i];if(o===t)return r.delegate=null,"throw"===i&&n.iterator.return&&(r.method="return",r.arg=t,e(n,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+i+"' method")),v;var a=f(o,n.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var s=a.arg;return s?s.done?(r[n.resultName]=s.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):s:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,v)}(o,a);if(u){if(u===v)continue;return u}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(s===h)throw s=d,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=p;var c=f(e,r,a);if("normal"===c.type){if(s=a.done?d:"suspendedYield",c.arg===v)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s=d,a.method="throw",a.arg=c.arg)}})}),u}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="executing",d="completed",v={};function m(){}function g(){}function y(){}var b={};c(b,a,function(){return this});var x=Object.getPrototypeOf,_=x&&x(x(M([])));_&&_!==n&&r.call(_,a)&&(b=_);var S=y.prototype=m.prototype=Object.create(b);function w(t){["next","throw","return"].forEach(function(e){c(t,e,function(t){return this._invoke(e,t)})})}function k(t,e){var n;i(this,"_invoke",{value:function(i,o){function a(){return new e(function(n,a){!function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==tK(l)&&r.call(l,"__await")?e.resolve(l.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(l).then(function(t){c.value=t,a(c)},function(t){return n("throw",t,a,s)})}s(u.arg)}(i,o,n,a)})}return n=n?n.then(a,a):a()}})}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw TypeError(tK(e)+" is not iterable")}return g.prototype=y,i(S,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:g,configurable:!0}),g.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},w(k.prototype),c(k.prototype,s,function(){return this}),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new k(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},w(S),c(S,u,"Generator"),c(S,a,function(){return this}),c(S,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function tQ(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){n(t);return}s.done?e(u):Promise.resolve(u).then(r,i)}var tJ=(a=t$().mark(function t(e,r){return t$().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("Map"!==e){t.next=2;break}return t.abrupt("return",new L.Map(r));case 2:if("Gaode"!==e){t.next=6;break}return t.abrupt("return",new L.GaodeMap(r));case 6:if("GaodeV1"!==e){t.next=10;break}return t.abrupt("return",new L.GaodeMapV1(r));case 10:if("GaodeV2"!==e){t.next=12;break}return t.abrupt("return",new L.GaodeMapV2(r));case 12:if("Tencent"!==e){t.next=14;break}return t.abrupt("return",Promise.resolve(Promise.resolve().then(n.bind(n,99769))).then(function(t){return new t.TencentMap(r)}));case 14:if("Baidu"!==e){t.next=16;break}return t.abrupt("return",Promise.resolve(Promise.resolve().then(n.bind(n,99769))).then(function(t){return new t.BaiduMap(r)}));case 16:return t.abrupt("return",Promise.resolve(Promise.resolve().then(n.bind(n,99769))).then(function(t){return new t.Mapbox(r)}));case 17:case"end":return t.stop()}},t)}),s=function(){var t=this,e=arguments;return new Promise(function(n,r){var i=a.apply(t,e);function o(t){tQ(i,n,r,o,s,"next",t)}function s(t){tQ(i,n,r,o,s,"throw",t)}o(void 0)})},function(t,e){return s.apply(this,arguments)}),t0=function(t,e){var n=(0,Z.useRef)();(0,Z.useEffect)(function(){var r,i=(r=n.current)?r.map(function(t,n){return Object.is(r[n],null==e?void 0:e[n])?-1:n}).filter(function(t){return t>=0}):e?e.map(function(t,e){return e}):[],o=n.current;return n.current=e,t(i,o,e)},e)},t1=function(t){var e=(0,Z.useRef)(t);return e.current=t,e},t2=function(t){var e=t1(t);(0,Z.useEffect)(function(){return function(){e.current()}},[])},t3={onLoaded:"loaded",onDestroy:"destroy",onResize:"resize",onMapMove:"mapmove",onMoveStart:"movestart",onMoveEnd:"moveend",onZoomChange:"zoomchange",onZoomStart:"zoomstart",onZoomEnd:"zoomend",onClick:"click",onDblclick:"dblclick",onContextMenu:"contextmenu",onMouseMove:"mousemove",onMouseWheel:"mousewheel",onMouseDown:"mousedown",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseUp:"mouseup",onDragStart:"dragstart",onDragging:"dragging",onDragEnd:"dragend"},t5=Object.keys(t3);function t4(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var t7=function(t,e){var n;t0(function(e,n,r){if(t){var i=e.filter(function(t){return!!t}).map(function(t){return t-1});e.includes(0)&&(i=t5.map(function(t,e){return e})),i.forEach(function(e){var i=t3[t5[e]],o=n[e+1],a=r[e+1];o&&t.off(i,o),a&&t.on(i,a)})}},[t].concat(function(t){if(Array.isArray(t))return t4(t)}(n=t5.map(function(t){return e[t]}))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return t4(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t4(t,e)}}(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),t2(function(){t&&t5.forEach(function(n){var r=t3[n],i=e[n];r&&i&&t.off(r,i)})})};function t6(t){return(t6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var t8=["id","style","className","map","mapType","mapOptions","onLayerManagerCreated","onSceneLoaded","children"];function t9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?t9(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==t6(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==t6(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===t6(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):t9(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var en=Z.createContext(null),er=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n,r=t.id,i=t.style,o=t.className,a=t.map,s=t.mapType,u=void 0===s?"Gaode":s,c=t.mapOptions,l=void 0===c?{}:c,f=t.onLayerManagerCreated,h=t.onSceneLoaded,p=t.children,d=function(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}(t,t8),v=(0,Z.useRef)(),m=function(t){if(Array.isArray(t))return t}(n=(0,Z.useState)(null))||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(n,2)||function(t,e){if(t){if("string"==typeof t)return ee(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(t,e)}}(n,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),g=m[0],y=m[1],b=(0,Z.useRef)({scene:null,layerManager:null}).current;(0,Z.useEffect)(function(){var t,e=!0;return Promise.resolve(void 0===a?tJ(u,l):"function"==typeof a?a():a).then(function(n){if(e){var r=new ts({scene:t=new L.Scene(et(et({},d),{},{id:v.current,map:n}))});b.scene=t,b.layerManager=r,t.once("loaded",function(){h&&h(t),f&&f(r),y(t)})}}).catch(function(t){console.error(t)}),function(){e=!1,t&&(b.scene=null,b.layerManager=null,t.destroy())}},[]),t7(g,t),(0,Z.useImperativeHandle)(e,function(){return{getScene:function(){return g},getMap:function(){return g.map}}},[g]),(0,Z.useEffect)(function(){g&&l.style&&g.setMapStyle(l.style)},[l.style]),R(function(){null!==g&&(l.center&&K(l.zoom)?g.setZoomAndCenter(l.zoom,l.center):K(l.zoom)?g.setZoom(l.zoom):l.center&&g.setCenter(l.center))},[l.zoom,l.center]),(0,Z.useEffect)(function(){g&&K(l.pitch)&&g.setPitch(l.pitch)},[l.pitch]),(0,Z.useEffect)(function(){g&&K(l.rotation)&&g.setRotation(l.rotation)},[l.rotation]);var x=(0,Z.useMemo)(function(){return et({position:"relative"},i)},[i]);return Z.createElement("div",{id:r,ref:v,style:x,className:D()("larkmap",o)},g&&Z.createElement(en.Provider,{value:b},p))})),ei=(u=Z.useEffect,function(t,e){var n=(0,Z.useRef)(!1);u(function(){return function(){n.current=!1}},[]),u(function(){if(n.current)return t();n.current=!0},e)}),eo=function(){var t=(0,Z.useContext)(en);if(!t)throw Error("The useScene must be used in the LarkMap container");return t.scene},ea=function(t,e,n){var r=eo(),i=(0,Z.useRef)();(0,Z.useEffect)(function(){var o=new L.Control(n);return o.onAdd=function(){return t(r)},o.onRemove=function(){},i.current=o,r.addControl(o),function(){"function"==typeof e&&e(r),i.current=null,r.removeControl(o)}},[]),ei(function(){var t;null===(t=i.current)||void 0===t||t.setOptions(n)},[n])},es=function(){var t=(0,Z.useContext)(en);if(!t)throw Error("The useLayerManager must be used in the LarkMap container");return t.layerManager};function eu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var ec=function(t){var e,n=es(),r=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)(n.getLayer(t)))||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return eu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eu(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=r[0],o=r[1];return(0,Z.useEffect)(function(){var e=function(e){t===e.id&&o(e)},r=function(e){t===e&&o(void 0)},i=n.getLayer(t);return i?o(i):(n.on("add",e),n.on("remove",r)),function(){void 0===i&&(n.off("add",e),n.off("remove",r))}},[t]),i};function el(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var ef=function(){var t,e=es(),n=function(t){if(Array.isArray(t))return t}(t=(0,Z.useState)((null==e?void 0:e.getLayers())||[]))||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,2)||function(t,e){if(t){if("string"==typeof t)return el(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return el(t,e)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=n[0],i=n[1];return(0,Z.useEffect)(function(){if(e){var t=function(){i(e.getLayers())};return e.on("add",t),e.on("remove",t),function(){e.off("add",t),e.off("remove",t)}}},[e]),r},eh=n(69703),ep={}.toString,ed=function(t,e){return ep.call(t)==="[object "+e+"]"},ev=function(t){return ed(t,"Function")},em=function(t){return Array.isArray?Array.isArray(t):ed(t,"Array")},eg=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e},ey=function(t,e){if(t){if(em(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(eg(t)){for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break}}},eb=function(t){return"object"==typeof t&&null!==t},ex=function(t){if(!eb(t)||!ed(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},e_=Array.prototype;e_.splice,e_.indexOf,Array.prototype.splice;var eS=function(t,e,n){if(!em(t)&&!ex(t))return t;var r=n;return ey(t,function(t,n){r=e(r,t,n)}),r},ew=function(t){return ed(t,"String")};Object.prototype.hasOwnProperty;var ek=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return ey(t,function(n,r){ev(t)&&"prototype"===r||e.push(n)}),e},eC=function(t){return ed(t,"Boolean")},eE=function(t){return void 0===t},eA=function(t){if("object"!=typeof t||null===t)return t;if(em(t)){e=[];for(var e,n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=eA(t[n]):e[n]=t[n]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=eA(t[i]):e[i]=t[i];return e};Object.prototype.hasOwnProperty;var eM=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},eT=function(t,e){if(t===e)return!0;if(!t||!e||ew(t)||ew(e))return!1;if(eM(t)||eM(e)){if(t.length!==e.length)return!1;for(var n=!0,r=0;r<t.length&&(n=eT(t[r],e[r]));r++);return n}if(eb(t)||eb(e)){var i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(var n=!0,r=0;r<i.length&&(n=eT(t[i[r]],e[i[r]]));r++);return n}return!1},eL=function(t,e,n){for(var r=0,i=ew(e)?e.split("."):e;t&&r<i.length;)t=t[i[r++]];return void 0===t||r<i.length?n:t};Object.prototype.hasOwnProperty;var eZ=function(t,e){return eS(t,function(t,n,r){return e.includes(r)||(t[r]=n),t},{})},eP={},eO=function(t){return eP[t=t||"g"]?eP[t]+=1:eP[t]=1,t+eP[t]};function eR(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={};return t.forEach(function(t,e){i[t]=n[e]}),delete i.undefined,e(i)}}!function(t,e){if(!ev(t))throw TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};n.cache=new Map}(function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return w||(w=document.createElement("canvas").getContext("2d")),w.font=[o,a,i,n+"px",r].join(" "),w.measureText(ew(t)?t:"").width},function(t,e){return void 0===e&&(e={}),(0,eh.pr)([t],ek(e)).join("")}),function(){function t(){this.map={}}t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length}}();var eI=function(){function t(){}return t.shape=function(e,n){if(ew(n))e.shape(n);else if(ev(n)){var r=[];e.shape(r.join("*"),eR(r,n))}else if(eg(n)){var i=n.field?n.field:"";if(ev(n.value)){var r=em(i)?i:i.split("*");e.shape(i,eR(r,n.value))}else e.shape(i,n.value);ew(i)&&n.scale&&t.scale(e,i,n.scale)}},t.size=function(e,n){if(ed(n,"Number"))e.size(n);else if(em(n))e.size(n);else if(ev(n)){var r=[];e.size(r.join("*"),eR(r,n))}else if(eg(n)){var i=n.field?n.field:"";if(ev(n.value)){var r=em(i)?i:i.split("*");e.size(i,eR(r,n.value))}else e.size(i,n.value);ew(i)&&n.scale&&t.scale(e,i,n.scale)}},t.color=function(e,n){if(ew(n))e.color(n);else if(ev(n)){var r=[];e.color(r.join("*"),eR(r,n))}else if(eg(n)){var i=n.field?n.field:"";if(ev(n.value)){var r=em(i)?i:i.split("*");e.color(i,eR(r,n.value))}else e.color(i,n.value);ew(i)&&n.scale&&t.scale(e,i,n.scale)}},t.scale=function(t,e,n){t.scale(e,n)},t.rotate=function(t,e){ew(e)||ev(e)||eg(e)},t.texture=function(t,e){ew(e)&&t.texture(e)},t.animate=function(t,e){(eC(e)||eg(e))&&t.animate(e)},t.filter=function(t,e){var n=e.field?e.field:"",r=em(n)?n:n.split("*");t.filter(r.join("*"),eR(r,e.value))},t.style=function(t,e){e&&t.style(e)},t.state=function(t,e){var n=e.active,r=e.select;n&&t.active(n),r&&t.select(r)},t}(),eD=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)!function t(e,n,r,i){for(var o in void 0===r&&(r=0),void 0===i&&(i=5),n)if(Object.prototype.hasOwnProperty.call(n,o)){var a=n[o];null!==a&&ex(a)?(ex(e[o])||(e[o]={}),r<i?t(e[o],a,r+1,i):e[o]=n[o]):Array.isArray(a)?(e[o]=[],e[o]=e[o].concat(a)):void 0!==a&&(e[o]=a)}}(t,e[r],0,1);return t},eN=function(t,e){var n=t.source,r=(0,eh._T)(t,["source"]),i=e.source,o=eD({},r,(0,eh._T)(e,["source"]));return i instanceof L.Source?o.source=i:n instanceof L.Source?o.source=n:o.source=(0,eh.pi)((0,eh.pi)({},n),i),o},ez=function(t,e){if(t instanceof L.Source&&e instanceof L.Source)return t!==e;var n=t.data,r=(0,eh._T)(t,["data"]),i=e.data,o=(0,eh._T)(e,["data"]);return n!==i||!eT(r,o)},ej=["click","dblclick","unclick","undblclick","contextmenu","uncontextmenu","mouseenter","unmouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","unpick"],eB=(0,eh.ev)(["show","hide","dataUpdate","destroy","legend","legend:color","legend:size"],(0,eh.CR)(ej),!1);(c=k||(k={})).CREATED="created",c.INITED="inited",c.ADD="add",c.REMOVE="remove",(l=C||(C={})).CREATED="created",l.INITED="inited",l.ADD="add",l.REMOVE="remove",(f=E||(E={})).INITED_LAYER="inited-layer",f.INITED_LAYERS="inited-layers";var eF=function(t){function e(e){var n=t.call(this)||this;n.isComposite=!1;var r=e.id,i=e.name,o=e.source,a=e.interaction;return n.id=r||eO("core-layer"),n.name=i||n.id,n.interaction=void 0!==a&&a,n.options=eN(n.getDefaultOptions(),e),n.lastOptions=n.options,n.layer=n.createLayer(),n.adaptorLayerAttr(!1),n.setSource(o),n.emit(k.CREATED,n),n}return(0,eh.ZT)(e,t),Object.defineProperty(e.prototype,"inited",{get:function(){return this.layer.inited},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this.layer.getSource()},enumerable:!1,configurable:!0}),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.getLayerConfig=function(){return eZ(this.options,["source","shape","color","size","scale","texture","style","animate","state"])},e.prototype.adaptorAttrOptions=function(t){return t},e.prototype.adaptorLayerAttr=function(t){void 0===t&&(t=!0);for(var e=["shape","color","size","scale","texture","filter","style","animate","state"],n=this.adaptorAttrOptions(this.options),r=this.adaptorAttrOptions(this.lastOptions),i=0;i<e.length;i++){var o=e[i],a=n[o],s=r[o];eE(a)||t&&eT(a,s)||eI[o](this.layer,a)}},e.prototype.setSource=function(t){if(t instanceof L.Source)this.layer.setSource(t);else{var e=t.data,n=(0,eh._T)(t,["data"]);this.layer.getSource()?this.layer.setData(e,n):this.layer.source(e,n)}},e.prototype.getSource=function(){return this.source},e.prototype.addTo=function(t){var e=this;this.scene=t,this.layer.once(k.INITED,function(){e.emit(k.INITED,e)}),this.layer.once(k.ADD,function(){e.emit(k.ADD,e)}),t.addLayer(this.layer)},e.prototype.remove=function(){this.scene&&(this.scene.removeLayer(this.layer),this.emit(k.REMOVE))},e.prototype.update=function(t,e){var n,r;void 0===e&&(e=!0),this.updateOption(t),this.updateConfig(t),e&&(null===(n=this.scene)||void 0===n||n.setEnableRender(!1)),(eE(this.options.visible)||this.options.visible)&&this.adaptorLayerAttr(),t.source&&ez(t.source,this.lastOptions.source)&&this.changeData(t.source),e&&(null===(r=this.scene)||void 0===r||r.setEnableRender(!0),this.render())},e.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=eN(this.options,t)},e.prototype.updateConfig=function(t){eE(t.zIndex)||eT(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(t.zIndex),eE(t.blend)||eT(this.lastOptions.blend,this.options.blend)||this.setBlend(t.blend),eE(t.minZoom)||eT(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(t.minZoom),eE(t.maxZoom)||eT(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMaxZoom(t.maxZoom),eE(t.visible)||eT(this.lastOptions.visible,this.options.visible)||(t.visible?this.show():this.hide())},e.prototype.render=function(){this.scene&&this.scene.render()},e.prototype.changeData=function(t){this.setSource(t)},e.prototype.setIndex=function(t){this.layer.setIndex(t)},e.prototype.setBlend=function(t){this.layer.setBlend(t)},e.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},e.prototype.show=function(){this.layer.inited&&this.layer.show()},e.prototype.hide=function(){this.layer.inited&&this.layer.hide()},e.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},e.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():!!eE(this.options.visible)||this.options.visible},e.prototype.boxSelect=function(t,e){this.layer.boxSelect(t,e)},e.prototype.fitBounds=function(t){this.layer.fitBounds(t)},e.prototype.getLegend=function(t){return this.layer.getLegend(t)},e.prototype.getLegendItems=function(t){return this.layer.getLegendItems(t)},e.prototype.on=function(e,n,r){return -1!==eB.indexOf(e)?this.layer.on(e,n):t.prototype.on.call(this,e,n,r),this},e.prototype.once=function(e,n){return -1!==eB.indexOf(e)?this.layer.once(e,n):t.prototype.once.call(this,e,n),this},e.prototype.off=function(e,n){return -1!==eB.indexOf(e)?this.layer.off(e,n):t.prototype.off.call(this,e,n),this},e.prototype.destroy=function(){this.layer.destroy()},e.DefaultOptions={},e}($),eU=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="heatmapLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.HeatmapLayer(t)},e}(eF),eV=function(t,e){return t===e||t!=t&&e!=e},eH=function(t,e){for(var n=t.length;n--;)if(eV(t[n][0],e))return n;return -1},eG=Array.prototype.splice;function eW(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}eW.prototype.clear=function(){this.__data__=[],this.size=0},eW.prototype.delete=function(t){var e=this.__data__,n=eH(e,t);return!(n<0)&&(n==e.length-1?e.pop():eG.call(e,n,1),--this.size,!0)},eW.prototype.get=function(t){var e=this.__data__,n=eH(e,t);return n<0?void 0:e[n][1]},eW.prototype.has=function(t){return eH(this.__data__,t)>-1},eW.prototype.set=function(t,e){var n=this.__data__,r=eH(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var eY=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},eq=function(t){if(!eY(t))return!1;var e=q(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},eX=j["__core-js_shared__"],eK=(h=/[^.]+$/.exec(eX&&eX.keys&&eX.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",e$=Function.prototype.toString,eQ=function(t){if(null!=t){try{return e$.call(t)}catch(t){}try{return t+""}catch(t){}}return""},eJ=/^\[object .+?Constructor\]$/,e0=Object.prototype,e1=Function.prototype.toString,e2=e0.hasOwnProperty,e3=RegExp("^"+e1.call(e2).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),e5=function(t,e){var n,r=null==t?void 0:t[e];return eY(n=r)&&(!eK||!(eK in n))&&(eq(n)?e3:eJ).test(eQ(n))?r:void 0},e4=e5(j,"Map"),e7=e5(Object,"create"),e6=Object.prototype.hasOwnProperty,e8=Object.prototype.hasOwnProperty;function e9(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}e9.prototype.clear=function(){this.__data__=e7?e7(null):{},this.size=0},e9.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},e9.prototype.get=function(t){var e=this.__data__;if(e7){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return e6.call(e,t)?e[t]:void 0},e9.prototype.has=function(t){var e=this.__data__;return e7?void 0!==e[t]:e8.call(e,t)},e9.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=e7&&void 0===e?"__lodash_hash_undefined__":e,this};var nt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t},ne=function(t,e){var n=t.__data__;return nt(e)?n["string"==typeof e?"string":"hash"]:n.map};function nn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function nr(t){var e=this.__data__=new eW(t);this.size=e.size}function ni(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new nn;++e<n;)this.add(t[e])}nn.prototype.clear=function(){this.size=0,this.__data__={hash:new e9,map:new(e4||eW),string:new e9}},nn.prototype.delete=function(t){var e=ne(this,t).delete(t);return this.size-=e?1:0,e},nn.prototype.get=function(t){return ne(this,t).get(t)},nn.prototype.has=function(t){return ne(this,t).has(t)},nn.prototype.set=function(t,e){var n=ne(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},nr.prototype.clear=function(){this.__data__=new eW,this.size=0},nr.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},nr.prototype.get=function(t){return this.__data__.get(t)},nr.prototype.has=function(t){return this.__data__.has(t)},nr.prototype.set=function(t,e){var n=this.__data__;if(n instanceof eW){var r=n.__data__;if(!e4||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new nn(r)}return n.set(t,e),this.size=n.size,this},ni.prototype.add=ni.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ni.prototype.has=function(t){return this.__data__.has(t)};var no=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},na=function(t,e){return t.has(e)},ns=function(t,e,n,r,i,o){var a=1&n,s=t.length,u=e.length;if(s!=u&&!(a&&u>s))return!1;var c=o.get(t),l=o.get(e);if(c&&l)return c==e&&l==t;var f=-1,h=!0,p=2&n?new ni:void 0;for(o.set(t,e),o.set(e,t);++f<s;){var d=t[f],v=e[f];if(r)var m=a?r(v,d,f,e,t,o):r(d,v,f,t,e,o);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!no(e,function(t,e){if(!na(p,e)&&(d===t||i(d,t,n,r,o)))return p.push(e)})){h=!1;break}}else if(!(d===v||i(d,v,n,r,o))){h=!1;break}}return o.delete(t),o.delete(e),h},nu=j.Uint8Array,nc=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n},nl=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},nf=B?B.prototype:void 0,nh=nf?nf.valueOf:void 0,np=function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!o(new nu(t),new nu(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return eV(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=nc;case"[object Set]":var u=1&r;if(s||(s=nl),t.size!=e.size&&!u)break;var c=a.get(t);if(c)return c==e;r|=2,a.set(t,e);var l=ns(s(t),s(e),r,i,o,a);return a.delete(t),l;case"[object Symbol]":if(nh)return nh.call(t)==nh.call(e)}return!1},nd=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},nv=function(t,e,n){var r=e(t);return tf(t)?r:nd(r,n(t))},nm=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o},ng=function(){return[]},ny=Object.prototype.propertyIsEnumerable,nb=Object.getOwnPropertySymbols,nx=nb?function(t){return null==t?[]:nm(nb(t=Object(t)),function(e){return ny.call(t,e)})}:ng,n_=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},nS=function(t){return X(t)&&"[object Arguments]"==q(t)},nw=Object.prototype,nk=nw.hasOwnProperty,nC=nw.propertyIsEnumerable,nE=nS(function(){return arguments}())?nS:function(t){return X(t)&&nk.call(t,"callee")&&!nC.call(t,"callee")},nA="object"==typeof exports&&exports&&!exports.nodeType&&exports,nM=nA&&"object"==typeof module&&module&&!module.nodeType&&module,nT=nM&&nM.exports===nA?j.Buffer:void 0,nL=(nT?nT.isBuffer:void 0)||function(){return!1},nZ=/^(?:0|[1-9]\d*)$/,nP=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&nZ.test(t))&&t>-1&&t%1==0&&t<e},nO=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},nR={};nR["[object Float32Array]"]=nR["[object Float64Array]"]=nR["[object Int8Array]"]=nR["[object Int16Array]"]=nR["[object Int32Array]"]=nR["[object Uint8Array]"]=nR["[object Uint8ClampedArray]"]=nR["[object Uint16Array]"]=nR["[object Uint32Array]"]=!0,nR["[object Arguments]"]=nR["[object Array]"]=nR["[object ArrayBuffer]"]=nR["[object Boolean]"]=nR["[object DataView]"]=nR["[object Date]"]=nR["[object Error]"]=nR["[object Function]"]=nR["[object Map]"]=nR["[object Number]"]=nR["[object Object]"]=nR["[object RegExp]"]=nR["[object Set]"]=nR["[object String]"]=nR["[object WeakMap]"]=!1;var nI=function(t){return function(e){return t(e)}},nD="object"==typeof exports&&exports&&!exports.nodeType&&exports,nN=nD&&"object"==typeof module&&module&&!module.nodeType&&module,nz=nN&&nN.exports===nD&&N.process,nj=function(){try{var t=nN&&nN.require&&nN.require("util").types;if(t)return t;return nz&&nz.binding&&nz.binding("util")}catch(t){}}(),nB=nj&&nj.isTypedArray,nF=nB?nI(nB):function(t){return X(t)&&nO(t.length)&&!!nR[q(t)]},nU=Object.prototype.hasOwnProperty,nV=function(t,e){var n=tf(t),r=!n&&nE(t),i=!n&&!r&&nL(t),o=!n&&!r&&!i&&nF(t),a=n||r||i||o,s=a?n_(t.length,String):[],u=s.length;for(var c in t)(e||nU.call(t,c))&&!(a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||nP(c,u)))&&s.push(c);return s},nH=Object.prototype,nG=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||nH)},nW=function(t,e){return function(n){return t(e(n))}},nY=nW(Object.keys,Object),nq=Object.prototype.hasOwnProperty,nX=function(t){if(!nG(t))return nY(t);var e=[];for(var n in Object(t))nq.call(t,n)&&"constructor"!=n&&e.push(n);return e},nK=function(t){return null!=t&&nO(t.length)&&!eq(t)},n$=function(t){return nK(t)?nV(t):nX(t)},nQ=function(t){return nv(t,n$,nx)},nJ=Object.prototype.hasOwnProperty,n0=function(t,e,n,r,i,o){var a=1&n,s=nQ(t),u=s.length;if(u!=nQ(e).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in e:nJ.call(e,l)))return!1}var f=o.get(t),h=o.get(e);if(f&&h)return f==e&&h==t;var p=!0;o.set(t,e),o.set(e,t);for(var d=a;++c<u;){var v=t[l=s[c]],m=e[l];if(r)var g=a?r(m,v,l,e,t,o):r(v,m,l,t,e,o);if(!(void 0===g?v===m||i(v,m,n,r,o):g)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var y=t.constructor,b=e.constructor;y!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return o.delete(t),o.delete(e),p},n1=e5(j,"DataView"),n2=e5(j,"Promise"),n3=e5(j,"Set"),n5=e5(j,"WeakMap"),n4="[object Map]",n7="[object Promise]",n6="[object Set]",n8="[object WeakMap]",n9="[object DataView]",rt=eQ(n1),re=eQ(e4),rn=eQ(n2),rr=eQ(n3),ri=eQ(n5),ro=q;(n1&&ro(new n1(new ArrayBuffer(1)))!=n9||e4&&ro(new e4)!=n4||n2&&ro(n2.resolve())!=n7||n3&&ro(new n3)!=n6||n5&&ro(new n5)!=n8)&&(ro=function(t){var e=q(t),n="[object Object]"==e?t.constructor:void 0,r=n?eQ(n):"";if(r)switch(r){case rt:return n9;case re:return n4;case rn:return n7;case rr:return n6;case ri:return n8}return e});var ra=ro,rs="[object Arguments]",ru="[object Array]",rc="[object Object]",rl=Object.prototype.hasOwnProperty,rf=function(t,e,n,r,i,o){var a=tf(t),s=tf(e),u=a?ru:ra(t),c=s?ru:ra(e);u=u==rs?rc:u,c=c==rs?rc:c;var l=u==rc,f=c==rc,h=u==c;if(h&&nL(t)){if(!nL(e))return!1;a=!0,l=!1}if(h&&!l)return o||(o=new nr),a||nF(t)?ns(t,e,n,r,i,o):np(t,e,u,n,r,i,o);if(!(1&n)){var p=l&&rl.call(t,"__wrapped__"),d=f&&rl.call(e,"__wrapped__");if(p||d){var v=p?t.value():t,m=d?e.value():e;return o||(o=new nr),i(v,m,n,r,o)}}return!!h&&(o||(o=new nr),n0(t,e,n,r,i,o))},rh=function t(e,n,r,i,o){return e===n||(null!=e&&null!=n&&(X(e)||X(n))?rf(e,n,r,i,t,o):e!=e&&n!=n)},rp=function(t,e){return rh(t,e)},rd=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},rv=function(){try{var t=e5(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),rm=function(t,e,n){"__proto__"==e&&rv?rv(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},rg=Object.prototype.hasOwnProperty,ry=function(t,e,n){var r=t[e];rg.call(t,e)&&eV(r,n)&&(void 0!==n||e in t)||rm(t,e,n)},rb=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?rm(n,s,u):ry(n,s,u)}return n},rx=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},r_=Object.prototype.hasOwnProperty,rS=function(t){if(!eY(t))return rx(t);var e=nG(t),n=[];for(var r in t)"constructor"==r&&(e||!r_.call(t,r))||n.push(r);return n},rw=function(t){return nK(t)?nV(t,!0):rS(t)},rk="object"==typeof exports&&exports&&!exports.nodeType&&exports,rC=rk&&"object"==typeof module&&module&&!module.nodeType&&module,rE=rC&&rC.exports===rk?j.Buffer:void 0,rA=rE?rE.allocUnsafe:void 0,rM=function(t,e){if(e)return t.slice();var n=t.length,r=rA?rA(n):new t.constructor(n);return t.copy(r),r},rT=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},rL=nW(Object.getPrototypeOf,Object),rZ=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)nd(e,nx(t)),t=rL(t);return e}:ng,rP=function(t){return nv(t,rw,rZ)},rO=Object.prototype.hasOwnProperty,rR=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&rO.call(t,"index")&&(n.index=t.index,n.input=t.input),n},rI=function(t){var e=new t.constructor(t.byteLength);return new nu(e).set(new nu(t)),e},rD=function(t,e){var n=e?rI(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},rN=/\w*$/,rz=function(t){var e=new t.constructor(t.source,rN.exec(t));return e.lastIndex=t.lastIndex,e},rj=B?B.prototype:void 0,rB=rj?rj.valueOf:void 0,rF=function(t,e){var n=e?rI(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)},rU=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return rI(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return rD(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return rF(t,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return rz(t);case"[object Symbol]":return rB?Object(rB.call(t)):{}}},rV=Object.create,rH=function(){function t(){}return function(e){if(!eY(e))return{};if(rV)return rV(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),rG=nj&&nj.isMap,rW=rG?nI(rG):function(t){return X(t)&&"[object Map]"==ra(t)},rY=nj&&nj.isSet,rq=rY?nI(rY):function(t){return X(t)&&"[object Set]"==ra(t)},rX="[object Arguments]",rK="[object Function]",r$="[object Object]",rQ={};rQ[rX]=rQ["[object Array]"]=rQ["[object ArrayBuffer]"]=rQ["[object DataView]"]=rQ["[object Boolean]"]=rQ["[object Date]"]=rQ["[object Float32Array]"]=rQ["[object Float64Array]"]=rQ["[object Int8Array]"]=rQ["[object Int16Array]"]=rQ["[object Int32Array]"]=rQ["[object Map]"]=rQ["[object Number]"]=rQ[r$]=rQ["[object RegExp]"]=rQ["[object Set]"]=rQ["[object String]"]=rQ["[object Symbol]"]=rQ["[object Uint8Array]"]=rQ["[object Uint8ClampedArray]"]=rQ["[object Uint16Array]"]=rQ["[object Uint32Array]"]=!0,rQ["[object Error]"]=rQ[rK]=rQ["[object WeakMap]"]=!1;var rJ=function t(e,n,r,i,o,a){var s,u=1&n,c=2&n,l=4&n;if(r&&(s=o?r(e,i,o,a):r(e)),void 0!==s)return s;if(!eY(e))return e;var f=tf(e);if(f){if(s=rR(e),!u)return rT(e,s)}else{var h,p,d,v,m=ra(e),g=m==rK||"[object GeneratorFunction]"==m;if(nL(e))return rM(e,u);if(m==r$||m==rX||g&&!o){if(s=c||g?{}:"function"!=typeof e.constructor||nG(e)?{}:rH(rL(e)),!u)return c?(p=(h=s)&&rb(e,rw(e),h),rb(e,rZ(e),p)):(v=(d=s)&&rb(e,n$(e),d),rb(e,nx(e),v))}else{if(!rQ[m])return o?e:{};s=rU(e,m,u)}}a||(a=new nr);var y=a.get(e);if(y)return y;a.set(e,s),rq(e)?e.forEach(function(i){s.add(t(i,n,r,i,e,a))}):rW(e)&&e.forEach(function(i,o){s.set(o,t(i,n,r,o,e,a))});var b=l?c?rP:nQ:c?rw:n$,x=f?void 0:b(e);return rd(x||e,function(i,o){x&&(i=e[o=i]),ry(s,o,t(i,n,r,o,e,a))}),s},r0=function(t){return rJ(t,5)};function r1(t){return(r1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r2=["onCreated","source"],r3=["data"],r5=["data"];function r4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function r7(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var r6=function(t,e){var n=e.onCreated,r=e.source,i=r7(e,r2),o=es(),a=(0,Z.useRef)(),s=(0,Z.useRef)(i),u=(0,Z.useRef)(r);return a.current||(a.current=new t(e),n&&a.current.once("inited",function(){return n(a.current)}),o.addLayer(a.current)),ei(function(){a.current&&!rp(s.current,i)&&(a.current.update(i),s.current=r0(i))},[i]),ei(function(){if(a.current){var t=r.data,e=r7(r,r3),n=u.current,i=n.data,o=r7(n,r5);t===i&&rp(e,o)||(a.current.changeData(r),u.current=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r4(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==r1(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==r1(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r1(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r4(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},r))}},[r]),(0,Z.useEffect)(function(){return function(){a.current&&(o.removeLayer(a.current),a.current=null)}},[]),a},r8={onRemove:"remove",onShow:"show",onHide:"hide",onDataUpdate:"dataUpdate",onLegend:"legend",onLegendColor:"legend:color",onLegendSize:"legend:size",onClick:"click",onUnClick:"unclick",onDblClick:"dblclick",onUndblclick:"undblclick",onContextMenu:"contextmenu",onUnContextMenu:"uncontextmenu",onMouseEnter:"mouseenter",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseUp:"mouseup",onMouseDown:"mousedown",onUnMousemove:"unmousemove",onUnMouseup:"unmouseup",onUnMousedown:"unmousedown",onUnPick:"unpick"},r9=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r8,r=(0,Z.useMemo)(function(){return Object.keys(n)},[n]),i=function(i){r.forEach(function(r){var o=n[r],a=e[r];r&&a&&t[i](o,a)})},o=function(){return i("on")},a=function(){return i("off")},s=(0,Z.useRef)(!0);s.current&&o(),(0,Z.useEffect)(function(){return s.current?s.current=!1:o(),function(){a()}},r.map(function(t){return e[t]})),t2(function(){a()})},it=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(eU,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),ie=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="imageLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.ImageLayer(t)},e}(eF),ir=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(ie,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),ii=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="lineLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.LineLayer(t)},e}(eF),io=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(ii,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),ia=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="pointLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.PointLayer(t)},e}(eF),is=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(ia,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),iu=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="polygonLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.PolygonLayer(t)},e}(eF),ic=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(iu,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),il=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="rasterLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.RasterLayer(t)},e}(eF),ih=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(il,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),ip=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type="textLayer",e}return(0,eh.ZT)(e,t),e.prototype.createLayer=function(){var t=this.getLayerConfig();return new L.PointLayer(t)},e.prototype.adaptorAttrOptions=function(t){var e=t.field,n=t.style,r=(void 0===n?{}:n)||{},i=r.fill,o=r.fontSize;return(0,eh.pi)({shape:{field:e,value:"text"},color:i,size:o},t)},e}(eF),id=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(ip,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null}));(p=A||(A={})).BubbleLayer="bubbleLayer",p.ChoroplethLayer="choroplethLayer",p.IconImageLayer="iconImageLayer",p.IconFontLayer="iconFontLayer",p.FlowLayer="flowLayer";var iv=function(t){function e(e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=t.call(this)||this;r.layerMap=new Map,r.name=n.name?n.name:eO("layerGroup");for(var i=0;i<e.length;i++){var o=e[i];r.addLayer(o)}return r}return(0,eh.ZT)(e,t),e.prototype.addTo=function(t){var e,n,r=this;this.scene=t;var i=0,o=this.layerMap.size;try{for(var a=(0,eh.XA)(this.layerMap.values()),s=a.next();!s.done;s=a.next()){var u=s.value;u.once("inited",function(t){i++,r.emit(E.INITED_LAYER,t),i===o&&r.emit(E.INITED_LAYERS)}),u.addTo(t)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},e.prototype.remove=function(){this.scene&&this.getLayers().forEach(function(t){return t.remove()})},e.prototype.hasLayer=function(t){var e="string"==typeof t?t:this.getLayerId(t);return this.layerMap.has(e)},e.prototype.addLayer=function(t){var e=this,n=this.getLayerId(t);this.layerMap.set(n,t),this.scene&&(t.once("inited",function(t){return e.emit(E.INITED_LAYER,t)}),t.addTo(this.scene))},e.prototype.addLayers=function(t){var e=this;t.forEach(function(t){e.addLayer(t)})},e.prototype.removeLayer=function(t){var e="string"==typeof t?t:this.getLayerId(t),n=this.layerMap.get(e);return!!n&&(this.layerMap.delete(e),this.scene&&n.remove(),!0)},e.prototype.getLayers=function(){return Array.from(this.layerMap.values())},e.prototype.getLayer=function(t){return this.layerMap.get(t)},e.prototype.getLayerByName=function(t){return this.getLayers().find(function(e){return e.name===t})},e.prototype.removeAllLayer=function(){var t,e;try{for(var n=(0,eh.XA)(this.layerMap.values()),r=n.next();!r.done;r=n.next()){var i=r.value;this.scene&&i.remove()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.layerMap.clear()},e.prototype.isEmpty=function(){return 0===this.layerMap.size},e.prototype.setZIndex=function(t){var e,n;try{for(var r=(0,eh.XA)(this.layerMap.values()),i=r.next();!i.done;i=r.next())i.value.setIndex(t)}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.prototype.getLayerId=function(t){return t.id},e.prototype.destroy=function(){this.remove(),this.off("*")},e}($),im=function(t){function e(e){var n=t.call(this)||this;n.isComposite=!0;var r=e.id,i=e.name;n.id=r||eO("composite-layer"),n.name=i||n.id,n.options=eN(n.getDefaultOptions(),e),n.lastOptions=n.options,n.source=n.createSource();var o=n.createSubLayers();return n.subLayers=new iv(o),n.emit(C.CREATED,n),n}return(0,eh.ZT)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createSource=function(){var t=this.options.source,e=t.data,n=(0,eh._T)(t,["data"]);return this.isSourceInstance(t)?t:new L.Source(e,n)},e.prototype.isSourceInstance=function(t){return t instanceof L.Source},e.prototype.setSubLayersSource=function(t){this.layer.changeData(t)},e.prototype.initSubLayersEvent=function(){},e.prototype.addTo=function(t){var e=this;this.scene=t,this.subLayers.once(E.INITED_LAYERS,function(){e.emit(C.INITED,e),e.emit(C.ADD,e)}),this.subLayers.addTo(t)},e.prototype.remove=function(){this.scene&&(this.subLayers.remove(),this.emit(C.REMOVE))},e.prototype.update=function(t,e){var n,r;void 0===e&&(e=!0),this.updateOption(t),e&&(null===(n=this.scene)||void 0===n||n.setEnableRender(!1)),t.source&&ez(t.source,this.lastOptions.source)&&this.changeData(t.source),this.updateSubLayers(t),e&&(null===(r=this.scene)||void 0===r||r.setEnableRender(!0),this.render())},e.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=eN(this.options,t)},e.prototype.render=function(){this.scene&&this.scene.render()},e.prototype.changeData=function(t){this.setSubLayersSource(t)},e.prototype.setIndex=function(t){this.subLayers.setZIndex(t)},e.prototype.setBlend=function(t){this.layer.setBlend(t)},e.prototype.setMinZoom=function(t){this.subLayers.getLayers().forEach(function(e){e.setMinZoom(t)})},e.prototype.setMaxZoom=function(t){this.subLayers.getLayers().forEach(function(e){e.setMaxZoom(t)})},e.prototype.show=function(){this.layer.inited&&this.update({visible:!0})},e.prototype.hide=function(){this.layer.inited&&this.update({visible:!1})},e.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},e.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():!!eE(this.options.visible)||this.options.visible},e.prototype.boxSelect=function(t,e){this.layer.boxSelect(t,e)},e.prototype.fitBounds=function(t){this.layer.fitBounds(t)},e.prototype.getLegend=function(t){return this.layer.getLegend(t)},e.prototype.getLegendItems=function(t){return this.layer.getLegendItems(t)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?t:[]},e.prototype.getInteractionSubLayers=function(){return this.subLayers.getLayers().filter(function(t){return!0===t.interaction})},e.prototype.destroy=function(){this.subLayers.destroy()},e.prototype.on=function(e,n,r){return -1!==eB.indexOf(e)?this.layer.on(e,n):t.prototype.on.call(this,e,n,r),this},e.prototype.once=function(e,n){return -1!==eB.indexOf(e)?this.layer.once(e,n):t.prototype.once.call(this,e,n),this},e.prototype.off=function(e,n){return -1!==eB.indexOf(e)?this.layer.off(e,n):t.prototype.off.call(this,e,n),this},e.LayerType=A,e.DefaultOptions={},e}($),ig={data:[],parser:{type:"json",x:"x",y:"y"}},iy={data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}},ib="#2f54eb",ix={active:{fillColor:!1,strokeColor:ib,lineWidth:1.5,lineOpacity:1},select:{fillColor:!1,strokeColor:ib,lineWidth:1.5,lineOpacity:1}},i_={visible:!0,source:ig,radius:12,fillColor:"#5FD3A6",lineWidth:1,state:{active:!1,select:!1},enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},iS=function(t){return eE(t)||(!1===t.active?ix.active=Object.assign(ix.active,{fillColor:!1,strokeColor:!1}):"object"==typeof t.active&&(!1===t.active.fillColor?ix.active.fillColor=!1:"string"==typeof t.active.fillColor&&(ix.active.fillColor=t.active.fillColor),!1===t.active.strokeColor?ix.active.strokeColor=!1:"string"==typeof t.active.strokeColor&&(ix.active.strokeColor=t.active.strokeColor),"number"==typeof t.active.lineWidth&&(ix.active.lineWidth=t.active.lineWidth),"number"==typeof t.active.lineOpacity&&(ix.active.lineOpacity=t.active.lineOpacity)),!1===t.select?ix.select=Object.assign(ix.select,{fillColor:!1,strokeColor:!1}):"object"==typeof t.select&&(!1===t.select.fillColor?ix.select.fillColor=!1:"string"==typeof t.select.fillColor&&(ix.select.fillColor=t.select.fillColor),!1===t.select.strokeColor?ix.select.strokeColor=!1:"string"==typeof t.select.strokeColor&&(ix.select.strokeColor=t.select.strokeColor),"number"==typeof t.select.lineWidth&&(ix.select.lineWidth=t.select.lineWidth),"number"==typeof t.select.lineOpacity&&(ix.select.lineOpacity=t.select.lineOpacity))),ix},iw=function(t){var e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.label,a=t.filter,s=e&&!!o&&(eE(null==o?void 0:o.visible)||(null==o?void 0:o.visible));return(0,eh.pi)((0,eh.pi)({zIndex:(void 0===i?0:i)+.1,minZoom:n,maxZoom:r,filter:a},o),{visible:s})},ik={};window.addEventListener("keydown",function(t){t.isComposing||229===t.keyCode||(ik[t.key]=!0)}),window.addEventListener("keyup",function(t){ik[t.key]=!1});var iC=function(t,e){return t&&(!e||!!ik[e])},iE=function(t){function e(e){var n=t.call(this,e)||this;return n.type=im.LayerType.BubbleLayer,n.selectData=[],n.layerState=ix,n.onHighlighHandle=function(t){var e=t.feature,r=t.featureId;n.setHighlightLayerSource(e,r)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(t){var e=t.feature,r=t.featureId;n.handleSelectData(r,e)},n.initSubLayersEvent(),n}return(0,eh.ZT)(e,t),Object.defineProperty(e.prototype,"layer",{get:function(){return this.fillLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillLayer",{get:function(){return this.subLayers.getLayer("fillLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightStrokeLayer",{get:function(){return this.subLayers.getLayer("highlightStrokeLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectFillLayer",{get:function(){return this.subLayers.getLayer("selectFillLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectStrokeLayer",{get:function(){return this.subLayers.getLayer("selectStrokeLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"labelLayer",{get:function(){return this.subLayers.getLayer("labelLayer")},enumerable:!1,configurable:!0}),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createSubLayers=function(){var t=this.source;return this.layerState=iS(this.options.state),[new ia((0,eh.pi)((0,eh.pi)({},this.getFillLayerOptions()),{id:"fillLayer",shape:"circle",source:t,interaction:!0})),new ia((0,eh.pi)((0,eh.pi)({},this.getHighlightStrokeLayerOptions()),{id:"highlightStrokeLayer",shape:"circle"})),new ia((0,eh.pi)((0,eh.pi)({},this.getSelectFillLayerOptions()),{id:"selectFillLayer",shape:"circle"})),new ia((0,eh.pi)((0,eh.pi)({},this.getSelectStrokeLayerOptions()),{id:"selectStrokeLayer",shape:"circle"})),new ip((0,eh.pi)((0,eh.pi)({},iw(this.options)),{id:"labelLayer",source:t}))]},e.prototype.getFillLayerOptions=function(){var t=eZ(this.options,["source"]),e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.fillColor,a=t.radius,s=t.opacity,u=t.strokeColor,c=t.lineOpacity,l=t.lineWidth,f=(0,eh._T)(t,["visible","minZoom","maxZoom","zIndex","fillColor","radius","opacity","strokeColor","lineOpacity","lineWidth"]),h=this.layerState,p={active:!1!==h.active.fillColor&&{color:h.active.fillColor},select:!1},d={opacity:s,stroke:u,strokeOpacity:eE(c)?s:c,strokeWidth:l};return(0,eh.pi)((0,eh.pi)({},f),{visible:e,minZoom:n,maxZoom:r,zIndex:void 0===i?0:i,color:o,size:a,state:p,style:d})},e.prototype.getHighlightStrokeLayerOptions=function(){var t,e=this.options,n=e.visible,r=e.minZoom,i=e.maxZoom,o=e.zIndex,a=e.radius,s=this.layerState,u={opacity:0,stroke:s.active.strokeColor||void 0,strokeOpacity:s.active.lineOpacity,strokeWidth:null===(t=s.active)||void 0===t?void 0:t.lineWidth};return{visible:n&&!!s.active.strokeColor,zIndex:(void 0===o?0:o)+.1,minZoom:r,maxZoom:i,source:ig,size:a,style:u}},e.prototype.getSelectFillLayerOptions=function(){var t=this.options,e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.radius,a=t.opacity,s=this.layerState.select.fillColor||void 0;return{visible:e&&!!s,zIndex:(void 0===i?0:i)+.1,minZoom:n,maxZoom:r,source:ig,color:s,size:o,style:{opacity:a},state:{select:!1,active:!1}}},e.prototype.getSelectStrokeLayerOptions=function(){var t=this.options,e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.radius,a=this.layerState,s={opacity:0,stroke:a.select.strokeColor||void 0,strokeOpacity:a.select.lineOpacity,strokeWidth:a.select.lineWidth};return{visible:e&&!!s.stroke,zIndex:(void 0===i?0:i)+.1,minZoom:n,maxZoom:r,source:ig,size:o,style:s}},e.prototype.setSubLayersSource=function(t){if(this.isSourceInstance(t))this.source=t,this.fillLayer.setSource(t),this.labelLayer.setSource(t);else{var e=t.data,n=(0,eh._T)(t,["data"]);this.source.setData(e,n)}this.highlightStrokeLayer.changeData(ig),this.selectFillLayer.changeData(ig),this.selectStrokeLayer.changeData(ig)},e.prototype.setHighlightLayerSource=function(t,e){if(void 0===e&&(e=-999),this.highlightData!==e){var n=t?[t]:[],r=this.source.parser,i="geojson"===r.type?{type:"FeatureCollection",features:n}:n;if(n.length){var o=this.fillLayer.layer.getEncodedData().find(function(t){return t.id===e}),a=null==o?void 0:o.size;this.highlightStrokeLayer.update({size:a,source:{data:i,parser:r}})}else this.highlightStrokeLayer.changeData({data:i,parser:r});this.highlightData=e}},e.prototype.setSelectLayerSource=function(t){if(void 0===t&&(t=[]),!(this.selectData.length===t.length&&eT(this.selectData.map(function(t){return t.featureId}),t.map(function(t){return t.featureId})))){var e=this.source.parser;if(t.length){var n="_Feature_Size_",r=this.fillLayer.layer.getEncodedData(),i=void 0;i="geojson"===e.type?{type:"FeatureCollection",features:t.map(function(t){var e,i,o=t.feature,a=t.featureId;return(0,eh.pi)((0,eh.pi)({},o),{properties:(0,eh.pi)((0,eh.pi)({},o.properties),((e={})[n]=null===(i=r.find(function(t){return t.id===a}))||void 0===i?void 0:i.size,e))})})}:t.map(function(t){var e,i,o=t.feature,a=t.featureId;return(0,eh.pi)((0,eh.pi)({},o),((e={})[n]=null===(i=r.find(function(t){return t.id===a}))||void 0===i?void 0:i.size,e))});var o={field:n,value:function(t){return t[n]}};this.selectFillLayer.update({size:o,source:{data:i,parser:e}}),this.selectStrokeLayer.update({size:o,source:{data:i,parser:e}})}else{var i="geojson"===e.type?{type:"FeatureCollection",features:[]}:[];this.selectFillLayer.changeData({data:i,parser:e}),this.selectStrokeLayer.changeData({data:i,parser:e})}this.selectData=t}},e.prototype.initSubLayersEvent=function(){this.fillLayer.off("mousemove",this.onHighlighHandle),this.fillLayer.off("mouseout",this.onHighlighHandle),this.fillLayer.off("click",this.onSelectHandle),this.selectData=[],this.highlightData=null,this.options.state&&(this.options.state.active&&(this.fillLayer.on("mousemove",this.onHighlighHandle),this.fillLayer.on("mouseout",this.onUnhighlighHandle)),this.options.state.select&&this.fillLayer.on("click",this.onSelectHandle))},e.prototype.handleSelectData=function(t,e,n){var r=this.options,i=iC(r.enabledMultiSelect,r.triggerMultiSelectKey)||n,o=eA(this.selectData),a=o.findIndex(function(e){return e.featureId===t});if(-1===a)i?o.push({feature:e,featureId:t}):o=[{feature:e,featureId:t}],this.emit("select",e,eA(o));else{var s=o[a];i?o.splice(a,1):o=[],this.emit("unselect",s,eA(o))}this.setSelectLayerSource(o)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.initSubLayersEvent()},e.prototype.updateOption=function(e){t.prototype.updateOption.call(this,e),this.layerState=iS(this.options.state)},e.prototype.updateSubLayers=function(t){this.fillLayer.update(this.getFillLayerOptions(),!1),this.highlightStrokeLayer.update(this.getHighlightStrokeLayerOptions(),!1),this.selectFillLayer.update(this.getSelectFillLayerOptions(),!1),this.selectStrokeLayer.update(this.getSelectStrokeLayerOptions(),!1),this.labelLayer.update(iw(this.options),!1),this.options.visible&&(eE(t.state)||eT(this.lastOptions.state,this.options.state)||this.updateHighlightSubLayers(),this.layerState.active.strokeColor&&this.setHighlightLayerSource(),(this.layerState.select.fillColor||this.layerState.select.strokeColor)&&this.setSelectLayerSource())},e.prototype.updateHighlightSubLayers=function(){var t=this.layerState,e=iS(this.lastOptions.state);e.active.strokeColor!==t.active.strokeColor&&(t.active.strokeColor?this.highlightStrokeLayer.show():this.highlightStrokeLayer.hide()),e.select.fillColor!==t.select.fillColor&&(t.select.fillColor?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.strokeColor!==t.select.strokeColor&&(t.select.strokeColor?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},e.prototype.setIndex=function(t){this.fillLayer.setIndex(t),this.highlightStrokeLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1),this.labelLayer.setIndex(t+.1)},e.prototype.setActive=function(t,e){var n=this.fillLayer.source,r=n.getFeatureId(t,e);if(eE(r)){console.warn("Feature non-existent by field: ".concat(t,",value: ").concat(e));return}if(this.layerState.active.fillColor&&this.fillLayer.layer.setActive(r),this.layerState.active.strokeColor){var i=n.getFeatureById(r);this.setHighlightLayerSource(i,r)}},e.prototype.setSelect=function(t,e){var n=this.fillLayer.source,r=n.getFeatureId(t,e);if(eE(r)){console.warn("Feature non-existent by field: ".concat(t,",value: ").concat(e));return}if(!1!==this.layerState.select.strokeColor||!1!==this.layerState.select.fillColor){var i=n.getFeatureById(r);this.handleSelectData(r,i,!0)}},e.prototype.boxSelect=function(t,e){this.fillLayer.boxSelect(t,e)},e.DefaultOptions=i_,e}(im),iA=Object.assign(r8,{onSelect:"select",onUnselect:"unselect"}),iM=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(iE,t);return r9(n.current,t,iA),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),iT={active:{fillColor:!1,strokeColor:ib,lineWidth:1,lineOpacity:1},select:{fillColor:!1,strokeColor:ib,lineWidth:1,lineOpacity:1}},iL={visible:!0,source:iy,lineWidth:1,state:{active:!1,select:!1},enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},iZ=function(t){return eE(t)||(!1===t.active?iT.active=Object.assign(iT.active,{fill:!1,stroke:!1}):"object"==typeof t.active&&(!1===t.active.fillColor?iT.active.fillColor=!1:"string"==typeof t.active.fillColor&&(iT.active.fillColor=t.active.fillColor),!1===t.active.strokeColor?iT.active.strokeColor=!1:"string"==typeof t.active.strokeColor&&(iT.active.strokeColor=t.active.strokeColor),"number"==typeof t.active.lineWidth&&(iT.active.lineWidth=t.active.lineWidth),"number"==typeof t.active.lineOpacity&&(iT.active.lineOpacity=t.active.lineOpacity)),!1===t.select?iT.select=Object.assign(iT.select,{fill:!1,stroke:!1}):"object"==typeof t.select&&(!1===t.select.fillColor?iT.select.fillColor=!1:"string"==typeof t.select.fillColor&&(iT.select.fillColor=t.select.fillColor),!1===t.select.strokeColor?iT.select.strokeColor=!1:"string"==typeof t.select.strokeColor&&(iT.select.strokeColor=t.select.strokeColor),"number"==typeof t.select.lineWidth&&(iT.select.lineWidth=t.select.lineWidth),"number"==typeof t.select.lineOpacity&&(iT.select.lineOpacity=t.select.lineOpacity))),iT},iP=function(t){return!(eE(t)||eC(t)||eE(t.coordinates)&&(eE(t.x)||eE(t.y))&&eE(t.geometry))},iO=function(t,e){var n=null==e?void 0:e.position;if(!iP(n))return t;var r=t.parser.type,i=t.transforms,o={data:t.originData,transforms:i};if(n.coordinates){var a=n.coordinates;o.parser={type:r,coordinates:a}}else if(n.x&&n.y){var s=n.x,u=n.y;o.parser={type:r,x:s,y:u}}else if(n.geometry){var c=n.geometry;o.parser={type:r,geometry:c}}return o},iR=function(t,e){return(0,eh.pi)((0,eh.pi)({},iw(t)),{source:iO(e,t.label)})},iI=function(t){function e(e){var n=t.call(this,e)||this;return n.type=im.LayerType.ChoroplethLayer,n.selectData=[],n.layerState=iT,n.onHighlighHandle=function(t){var e=t.feature,r=t.featureId;n.setHighlightLayerSource(e,r)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(t){var e=t.feature,r=t.featureId;n.handleSelectData(r,e)},n.initSubLayersEvent(),n}return(0,eh.ZT)(e,t),Object.defineProperty(e.prototype,"layer",{get:function(){return this.fillLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillLayer",{get:function(){return this.subLayers.getLayer("fillLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokeLayer",{get:function(){return this.subLayers.getLayer("strokeLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightStrokeLayer",{get:function(){return this.subLayers.getLayer("highlightStrokeLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectFillLayer",{get:function(){return this.subLayers.getLayer("selectFillLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectStrokeLayer",{get:function(){return this.subLayers.getLayer("selectStrokeLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"labelLayer",{get:function(){return this.subLayers.getLayer("labelLayer")},enumerable:!1,configurable:!0}),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createSubLayers=function(){var t=this.source;return this.layerState=iZ(this.options.state),[new iu((0,eh.pi)((0,eh.pi)({},this.getFillLayerOptions()),{id:"fillLayer",shape:"fill",source:t,interaction:!0})),new ii((0,eh.pi)((0,eh.pi)({},this.getStrokeLayerOptions()),{id:"strokeLayer",shape:"line",source:t})),new ii((0,eh.pi)((0,eh.pi)({},this.getHighlightStrokeLayerOptions()),{id:"highlightStrokeLayer"})),new iu((0,eh.pi)((0,eh.pi)({},this.getSelectFillLayerOptions()),{id:"selectFillLayer"})),new ii((0,eh.pi)((0,eh.pi)({},this.getSelectStrokeLayerOptions()),{id:"selectStrokeLayer"})),new ip((0,eh.pi)((0,eh.pi)({},iR(this.options,t)),{id:"labelLayer"}))]},e.prototype.getFillLayerOptions=function(){var t=eZ(this.options,["source"]),e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.fillColor,a=t.opacity,s=(0,eh._T)(t,["visible","minZoom","maxZoom","zIndex","fillColor","opacity"]),u=this.layerState,c={active:!1!==u.active.fillColor&&{color:u.active.fillColor},select:!1};return(0,eh.pi)((0,eh.pi)({},s),{visible:e,minZoom:n,maxZoom:r,zIndex:void 0===i?0:i,color:o,state:c,style:{opacity:a}})},e.prototype.getStrokeLayerOptions=function(){var t=this.options,e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.opacity,a=t.strokeColor,s=t.lineWidth,u=t.lineOpacity,c=t.lineDash,l=t.lineType,f=t.filter;return{visible:e&&!!s&&!!a,zIndex:void 0===i?0:i,minZoom:n,maxZoom:r,size:s,color:a,style:{opacity:eE(u)?o:u,dashArray:c,lineType:l},filter:f}},e.prototype.getHighlightStrokeLayerOptions=function(){var t=this.options,e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.lineWidth,a=this.layerState,s=a.active.strokeColor||void 0;return{visible:e&&!!s,zIndex:(void 0===i?0:i)+.1,minZoom:n,maxZoom:r,source:iy,size:a.active.lineWidth||o,color:s,style:{opacity:a.active.lineOpacity}}},e.prototype.getSelectFillLayerOptions=function(){var t=this.options,e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.opacity,a=this.layerState.select.fillColor||void 0;return{visible:e&&!!a,zIndex:(void 0===i?0:i)+.1,minZoom:n,maxZoom:r,source:iy,color:a,style:{opacity:o},state:{select:!1,active:!1}}},e.prototype.getSelectStrokeLayerOptions=function(){var t=this.options,e=t.visible,n=t.minZoom,r=t.maxZoom,i=t.zIndex,o=t.lineWidth,a=this.layerState,s=a.select.strokeColor||void 0;return{visible:e&&!!s,zIndex:(void 0===i?0:i)+.1,minZoom:n,maxZoom:r,source:iy,size:a.select.lineWidth||o,color:s,style:{opacity:a.select.lineOpacity}}},e.prototype.setSubLayersSource=function(t){var e;if(this.isSourceInstance(t))this.source=t,this.fillLayer.setSource(t),this.strokeLayer.setSource(t),this.labelLayer.setSource(t);else{var n=t.data,r=(0,eh._T)(t,["data"]);if(this.source.setData(n,r),iP(null===(e=this.options.label)||void 0===e?void 0:e.position)){var i=iO(this.source,this.options.label);this.labelLayer.changeData(i)}}this.highlightStrokeLayer.changeData(iy),this.selectFillLayer.changeData(iy),this.selectStrokeLayer.changeData(iy)},e.prototype.setHighlightLayerSource=function(t,e){if(void 0===e&&(e=-999),this.highlightData!==e){var n=t?[t]:[],r=this.source.parser,i="geojson"===r.type?{type:"FeatureCollection",features:n}:n;this.highlightStrokeLayer.changeData({data:i,parser:r}),this.highlightData=e}},e.prototype.setSelectLayerSource=function(t){if(void 0===t&&(t=[]),!(this.selectData.length===t.length&&eT(this.selectData.map(function(t){return t.featureId}),t.map(function(t){return t.featureId})))){var e=t.map(function(t){return t.feature}),n=this.source.parser,r="geojson"===n.type?{type:"FeatureCollection",features:e}:e;this.selectFillLayer.changeData({data:r,parser:n}),this.selectStrokeLayer.changeData({data:r,parser:n}),this.selectData=t}},e.prototype.initSubLayersEvent=function(){this.fillLayer.off("mousemove",this.onHighlighHandle),this.fillLayer.off("mouseout",this.onHighlighHandle),this.fillLayer.off("click",this.onSelectHandle),this.selectData=[],this.highlightData=null,this.options.state&&(this.options.state.active&&(this.fillLayer.on("mousemove",this.onHighlighHandle),this.fillLayer.on("mouseout",this.onUnhighlighHandle)),this.options.state.select&&this.fillLayer.on("click",this.onSelectHandle))},e.prototype.handleSelectData=function(t,e,n){var r=this.options,i=iC(r.enabledMultiSelect,r.triggerMultiSelectKey)||n,o=eA(this.selectData),a=o.findIndex(function(e){return e.featureId===t});if(-1===a)i?o.push({feature:e,featureId:t}):o=[{feature:e,featureId:t}],this.emit("select",e,eA(o));else{var s=o[a];i?o.splice(a,1):o=[],this.emit("unselect",s,eA(o))}this.setSelectLayerSource(o)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.initSubLayersEvent()},e.prototype.updateOption=function(e){t.prototype.updateOption.call(this,e),this.layerState=iZ(this.options.state)},e.prototype.updateSubLayers=function(t){this.fillLayer.update(this.getFillLayerOptions(),!1),this.strokeLayer.update(this.getStrokeLayerOptions(),!1),this.highlightStrokeLayer.update(this.getHighlightStrokeLayerOptions(),!1),this.selectFillLayer.update(this.getSelectFillLayerOptions(),!1),this.selectStrokeLayer.update(this.getSelectStrokeLayerOptions(),!1),this.labelLayer.update(iR(this.options,this.source),!1),this.options.visible&&(eE(t.state)||eT(this.lastOptions.state,this.options.state)||this.updateHighlightSubLayers(),this.layerState.active.strokeColor&&this.setHighlightLayerSource(),(this.layerState.select.fillColor||this.layerState.select.strokeColor)&&this.setSelectLayerSource())},e.prototype.updateHighlightSubLayers=function(){var t=this.layerState,e=iZ(this.lastOptions.state);e.active.strokeColor!==t.active.strokeColor&&(t.active.strokeColor?this.highlightStrokeLayer.show():this.highlightStrokeLayer.hide()),e.select.fillColor!==t.select.fillColor&&(t.select.fillColor?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.strokeColor!==t.select.strokeColor&&(t.select.strokeColor?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},e.prototype.setIndex=function(t){this.fillLayer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightStrokeLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1),this.labelLayer.setIndex(t+.1)},e.prototype.setActive=function(t,e){var n=this.fillLayer.source,r=n.getFeatureId(t,e);if(eE(r)){console.warn("Feature non-existent by field: ".concat(t,",value: ").concat(e));return}if(this.layerState.active.fillColor&&this.fillLayer.layer.setActive(r),this.layerState.active.strokeColor){var i=n.getFeatureById(r);this.setHighlightLayerSource(i,r)}},e.prototype.setSelect=function(t,e){var n=this.fillLayer.source,r=n.getFeatureId(t,e);if(eE(r)){console.warn("Feature non-existent by field: ".concat(t,",value: ").concat(e));return}if(!1!==this.layerState.select.strokeColor||!1!==this.layerState.select.fillColor){var i=n.getFeatureById(r);this.handleSelectData(r,i,!0)}},e.prototype.boxSelect=function(t,e){this.fillLayer.boxSelect(t,e)},e.DefaultOptions=iL,e}(im),iD=Object.assign(r8,{onSelect:"select",onUnselect:"unselect"}),iN=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(iI,t);return r9(n.current,t,iD),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),iz=n(7996),ij=n(49174);function iB(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=function t(e){var n={};return e&&Object.keys(e).forEach(function(r){var i=e[r];"object"==typeof i?null===i?n[r]=null:Array.isArray(i)?n[r]=i.map(function(t){return t}):n[r]=t(i):n[r]=i}),n}(t.properties),e.geometry=iF(t.geometry),e}function iF(t){var e={type:t.type};return(t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type)?e.geometries=t.geometries.map(function(t){return iF(t)}):e.coordinates=function t(e){return"object"!=typeof e[0]?e.slice():e.map(function(e){return t(e)})}(t.coordinates),e}var iU=function(t){if(!t)throw Error("geojson is required");switch(t.type){case"Feature":return iB(t);case"FeatureCollection":var e;return e={type:"FeatureCollection"},Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(t){return iB(t)}),e;case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return iF(t);default:throw Error("unknown GeoJSON type")}},iV=n(38425),iH=function(t,e){void 0===e&&(e={});var n=(0,iz.Z)(t),r=(n[0]+n[2])/2,i=(n[1]+n[3])/2;return(0,iV.xm)([r,i],e.properties,e)},iG=n(24274),iW=function(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return(0,iG.pZ)(t,function(t){n+=t[0],r+=t[1],i++},!0),(0,iV.xm)([n/i,r/i],e.properties)},iY=n(17037);function iq(t,e){var n=(0,iV.Ht)(t[1]),r=(0,iV.Ht)(e[1]),i=(0,iV.Ht)(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.atan2(i,Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)));return((0,iV.vi)(o)+360)%360}var iX=function(t,e,n){var r;return void 0===n&&(n={}),(r=n.final?iq((0,iY.c9)(e),(0,iY.c9)(t)):iq((0,iY.c9)(t),(0,iY.c9)(e)))>180?-(360-r):r},iK=function(t,e,n){void 0===n&&(n={});var r,i,o,a,s,u,c,l,f=(0,iY.c9)(t),h=(0,iY.c9)(e);h[0]+=h[0]-f[0]>180?-360:f[0]-h[0]>180?360:0;var p=(i=r=void 0===r?iV.rQ:Number(r),o=f[1]*Math.PI/180,s=(a=h[1]*Math.PI/180)-o,(u=Math.abs(h[0]-f[0])*Math.PI/180)>Math.PI&&(u-=2*Math.PI),l=Math.abs(c=Math.log(Math.tan(a/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)))>1e-11?s/c:Math.cos(o),Math.sqrt(s*s+l*l*u*u)*i);return(0,iV.vs)(p,"meters",n.units)},i$=function(t,e,n,r){void 0===r&&(r={});var i,o,a,s,u,c,l,f,h=(0,iV.vs)(Math.abs(e),r.units,"meters");e<0&&(h=-Math.abs(h));var p=(0,iY.c9)(t),d=(o=h/(i=void 0===i?iV.rQ:Number(i)),a=p[0]*Math.PI/180,Math.abs(l=(s=(0,iV.Ht)(p[1]))+(c=o*Math.cos(u=(0,iV.Ht)(n))))>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l),[(180*(a+o*Math.sin(u)/(Math.abs(f=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)))>1e-11?c/f:Math.cos(s)))/Math.PI+540)%360-180,180*l/Math.PI]);return d[0]+=d[0]-p[0]>180?-360:p[0]-d[0]>180?360:0,(0,iV.xm)(d,r.properties)};function iQ(t,e,n){var r="Point"===(0,iY.oL)(t);return n=function(t,e){if(null==e&&(e="centroid"),Array.isArray(e)||"object"==typeof e)return(0,iY.c9)(e);var n=t.bbox?t.bbox:(0,iz.Z)(t),r=n[0],i=n[1],o=n[2],a=n[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return(0,iV.xm)([r,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return(0,iV.xm)([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return(0,iV.xm)([r,a]);case"ne":case"northeast":case"eastnorth":case"topright":return(0,iV.xm)([o,a]);case"center":return iH(t);case void 0:case null:case"centroid":return iW(t);default:throw Error("invalid origin")}}(t,n),1===e||r||(0,iG.pZ)(t,function(t){var r=iK(n,t),i=iX(n,t),o=(0,iY.r7)(i$(n,r*e,i));t[0]=o[0],t[1]=o[1],3===t.length&&(t[2]*=e)}),t}var iJ=function(t,e,n){if(n=n||{},!(0,iV.Kn)(n))throw Error("options is invalid");var r=n.origin,i=n.mutate;if(!t)throw Error("geojson required");if("number"!=typeof e||0===e)throw Error("invalid factor");var o=Array.isArray(r)||"object"==typeof r;return(!0!==i&&(t=iU(t)),"FeatureCollection"!==t.type||o)?iQ(t,e,r):((0,iG.By)(t,function(n,i){t.features[i]=iQ(n,e,r)}),t)},i0=function(){return j.Date.now()},i1=/\s/,i2=function(t){for(var e=t.length;e--&&i1.test(t.charAt(e)););return e},i3=/^\s+/,i5=0/0,i4=/^[-+]0x[0-9a-f]+$/i,i7=/^0b[01]+$/i,i6=/^0o[0-7]+$/i,i8=parseInt,i9=function(t){if("number"==typeof t)return t;if(th(t))return i5;if(eY(t)){var e,n="function"==typeof t.valueOf?t.valueOf():t;t=eY(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=(e=t)?e.slice(0,i2(e)+1).replace(i3,""):e;var r=i7.test(t);return r||i6.test(t)?i8(t.slice(2),r?2:8):i4.test(t)?i5:+t},ot=Math.max,oe=Math.min,on=function(t,e,n){var r,i,o,a,s,u,c=0,l=!1,f=!1,h=!0;if("function"!=typeof t)throw TypeError("Expected a function");function p(e){var n=r,o=i;return r=i=void 0,c=e,a=t.apply(o,n)}function d(t){var n=t-u,r=t-c;return void 0===u||n>=e||n<0||f&&r>=o}function v(){var t,n,r,i=i0();if(d(i))return m(i);s=setTimeout(v,(t=i-u,n=i-c,r=e-t,f?oe(r,o-n):r))}function m(t){return(s=void 0,h&&r)?p(t):(r=i=void 0,a)}function g(){var t,n=i0(),o=d(n);if(r=arguments,i=this,u=n,o){if(void 0===s)return c=t=u,s=setTimeout(v,e),l?p(t):a;if(f)return clearTimeout(s),s=setTimeout(v,e),p(u)}return void 0===s&&(s=setTimeout(v,e)),a}return e=i9(e)||0,eY(n)&&(l=!!n.leading,o=(f="maxWait"in n)?ot(i9(n.maxWait)||0,e):o,h="trailing"in n?!!n.trailing:h),g.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},g.flush=function(){return void 0===s?a:m(i0())},g},or={data:[],parser:{type:"json",x:"lng",y:"lat"}},oi={data:[],parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}},oo={enableCircleSpread:!1,enableLineSpread:!1,circleStrokeColor:"#ccc",lineStroke:"#ccc"},oa=(0,eh.pi)((0,eh.pi)({},oo),{enableCircleSpread:!0,enableLineSpread:!0}),os={source:{data:[],parser:{type:"json",x:"f_lon",y:"f_lat",x1:"t_lon",y1:"t_lat",weight:"weight"}},enableCluster:!0,clusterType:"HCA",clusterZoomStep:1,clusterNodeSize:64,clusterRadius:40,clusterExtent:512,maxTopFlowNum:5e3,circleColor:"#fff",circleRadius:{field:"weight",value:[1,16]},circleStrokeColor:"#000",circleStrokeWidth:1,lineColor:{field:"weight",value:["#2a5674","#d1eeea"]},lineWidth:{field:"weight",value:[1,16]},lineStroke:"#000",lineStrokeWidth:1,fadeOpacityEnabled:!0,fadeOpacityAmount:0,showLocationName:!1,locationNameSize:12,locationNameColor:"#fff",locationNameStroke:"#000",locationNameStrokeWidth:1,state:{active:oo,select:oa}},ou="NOT_FOUND",oc=function(t,e){return t===e},ol=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return function(){for(var e,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];var a=0,s={memoizeOptions:void 0},u=i.pop();if("object"==typeof u&&(s=u,u=i.pop()),"function"!=typeof u)throw Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var c=s.memoizeOptions,l=void 0===c?n:c,f=Array.isArray(l)?l:[l],h=function(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every(function(t){return"function"==typeof t}))throw Error("createSelector expects all input-selectors to be functions, but received the following types: ["+e.map(function(t){return"function"==typeof t?"function "+(t.name||"unnamed")+"()":typeof t}).join(", ")+"]");return e}(i),p=t.apply(void 0,[function(){return a++,u.apply(null,arguments)}].concat(f)),d=t(function(){for(var t=[],n=h.length,r=0;r<n;r++)t.push(h[r].apply(null,arguments));return e=p.apply(null,t)});return Object.assign(d,{resultFunc:u,memoizedResultFunc:p,dependencies:h,lastResult:function(){return e},recomputations:function(){return a},resetRecomputations:function(){return a=0}}),d}}(function(t,e){var n,r,i="object"==typeof e?e:{equalityCheck:e},o=i.equalityCheck,a=i.maxSize,s=void 0===a?1:a,u=i.resultEqualityCheck,c=(n=void 0===o?oc:o,function(t,e){if(null===t||null===e||t.length!==e.length)return!1;for(var r=t.length,i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}),l=1===s?{get:function(t){return r&&c(r.key,t)?r.value:ou},put:function(t,e){r={key:t,value:e}},getEntries:function(){return r?[r]:[]},clear:function(){r=void 0}}:function(t,e){var n=[];function r(t){var r=n.findIndex(function(n){return e(t,n.key)});if(r>-1){var i=n[r];return r>0&&(n.splice(r,1),n.unshift(i)),i.value}return ou}return{get:r,put:function(e,i){r(e)===ou&&(n.unshift({key:e,value:i}),n.length>t&&n.pop())},getEntries:function(){return n},clear:function(){n=[]}}}(s,c);function f(){var e=l.get(arguments);if(e===ou){if(e=t.apply(null,arguments),u){var n=l.getEntries().find(function(t){return u(t.value,e)});n&&(e=n.value)}l.put(arguments,e)}return e}return f.clearCache=function(){return l.clear()},f}),of=0,oh=function(){return String(++of)},op=0;function od(t){return t/360+.5}function ov(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function om(t,e,n,r){og(t,n,r),og(e,2*n,2*r),og(e,2*n+1,2*r+1)}function og(t,e,n){let r=t[e];t[e]=t[n],t[n]=r}function oy(t,e,n,r){let i=t-n,o=e-r;return i*i+o*o}let ob=t=>t[0],ox=t=>t[1];class o_{constructor(t,e=ob,n=ox,r=64,i=Float64Array){this.nodeSize=r,this.points=t;let o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length);for(let r=0;r<t.length;r++)a[r]=r,s[2*r]=e(t[r]),s[2*r+1]=n(t[r]);!function t(e,n,r,i,o,a){if(o-i<=r)return;let s=i+o>>1;(function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){let s=o-i+1,u=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1),h=Math.max(i,Math.floor(r-u*l/s+f)),p=Math.min(o,Math.floor(r+(s-u)*l/s+f));t(e,n,r,h,p,a)}let s=n[2*r+a],u=i,c=o;for(om(e,n,i,r),n[2*o+a]>s&&om(e,n,i,o);u<c;){for(om(e,n,u,c),u++,c--;n[2*u+a]<s;)u++;for(;n[2*c+a]>s;)c--}n[2*i+a]===s?om(e,n,i,c):om(e,n,++c,o),c<=r&&(i=c+1),r<=c&&(o=c-1)}})(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}(a,s,r,0,a.length-1,0)}range(t,e,n,r){return function(t,e,n,r,i,o,a){let s,u;let c=[0,t.length-1,0],l=[];for(;c.length;){let f=c.pop(),h=c.pop(),p=c.pop();if(h-p<=a){for(let a=p;a<=h;a++)s=e[2*a],u=e[2*a+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(t[a]);continue}let d=Math.floor((p+h)/2);s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(t[d]);let v=(f+1)%2;(0===f?n<=s:r<=u)&&(c.push(p),c.push(d-1),c.push(v)),(0===f?i>=s:o>=u)&&(c.push(d+1),c.push(h),c.push(v))}return l}(this.ids,this.coords,t,e,n,r,this.nodeSize)}within(t,e,n){return function(t,e,n,r,i,o){let a=[0,t.length-1,0],s=[],u=i*i;for(;a.length;){let c=a.pop(),l=a.pop(),f=a.pop();if(l-f<=o){for(let i=f;i<=l;i++)oy(e[2*i],e[2*i+1],n,r)<=u&&s.push(t[i]);continue}let h=Math.floor((f+l)/2),p=e[2*h],d=e[2*h+1];oy(p,d,n,r)<=u&&s.push(t[h]);let v=(c+1)%2;(0===c?n-i<=p:r-i<=d)&&(a.push(f),a.push(h-1),a.push(v)),(0===c?n+i>=p:r+i>=d)&&(a.push(h+1),a.push(l),a.push(v))}return s}(this.ids,this.coords,t,e,n,this.nodeSize)}}var oS=function(t){return t.x},ow=function(t){return t.y};function ok(t,e){return new o_(t,oS,ow,e,window.Float32Array)}var oC=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.getSourceData=function(t,e){return t.data},e.getSourceParser=function(t,e){return t.parser},e.getMapZoom=function(t,e){return e.mapStatus.zoom},e.getMapBounds=function(t,e){return e.mapStatus.bounds},e.getEnableCluster=function(t,e){return e.enableCluster},e.getClusterType=function(t,e){return e.clusterType},e.getExtent=function(t,e){return e.clusterExtent},e.getNodeSize=function(t,e){return e.clusterNodeSize},e.getRadius=function(t,e){return e.clusterRadius},e.getMinZoom=function(t,e){return e.minZoom},e.getMaxZoom=function(t,e){return e.maxZoom},e.getZoomStep=function(t,e){return e.clusterZoomStep},e.getMaxTopFlowNum=function(t,e){return e.maxTopFlowNum},e.getOriginData=ol(e.getSourceData,e.getSourceParser,function(t,e){var n,r,i,o,a,s,u,c,l,f,h,p,d,v;return n={data:t,parser:e},r=new Map,i=new Map,o=n.data,s=(a=n.parser).type,u=a.x,c=a.y,l=a.x1,f=a.y1,h=a.weight,p=a.name,d=a.name1,v=function(t){var e=t.lng,n=t.lat,i=t.weight,o=t.name,a="".concat(e,"-").concat(n),s=r.get(a);return s||(s={id:oh(),lng:e,lat:n,weight:i,name:o},r.set(a,s)),s},"json"===s&&u&&c&&l&&f?o.forEach(function(t){var e=+eL(t,u,0),n=+eL(t,c,0),r=+eL(t,l,0),o=+eL(t,f,0),a=h?+eL(t,h,0):1,s="".concat(e,"-").concat(n,"-").concat(r,"-").concat(o),m=i.get(s);if(m)m.weight+=a;else{var g=p&&eL(t,p,void 0),y=d&&eL(t,d,void 0),b=v({lng:e,lat:n,weight:a,name:g}),x=v({lng:r,lat:o,weight:a,name:y});i.set(s,{id:String(++op),fromId:b.id,toId:x.id,weight:a})}}):console.error("FlowLayer 的 source 输入有误，请检查 source 传参"),{locations:Array.from(r.values()),flows:Array.from(i.values())}}),e.getClusterOptions=ol(e.getClusterType,e.getEnableCluster,e.getExtent,e.getNodeSize,e.getRadius,e.getMinZoom,e.getMaxZoom,e.getZoomStep,function(t,e,n,r,i,o,a,s){return{clusterType:t,enableCluster:e,clusterExtent:n,clusterNodeSize:r,clusterRadius:i,minZoom:o,maxZoom:a,clusterZoomStep:s}}),e.getClusterLevels=ol(e.getOriginData,e.getClusterOptions,function(t,e){var n;return n=t.locations,"HCA"===e.clusterType?function(t,e){var n,r,i=e.minZoom,o=e.maxZoom,a=e.clusterZoomStep,s=e.clusterNodeSize,u=e.enableCluster,c=[],l=t.map(function(t){return(0,eh.pi)((0,eh.pi)({},t),{x:od(t.lng),y:ov(t.lat),weight:t.weight,zoom:1/0,childIds:[]})}).sort(function(t,e){return t.weight-e.weight});if(c[o+1]=ok(l,s),u){for(var f=o+1,h=o;h>=i;h-=a){var p=function(t,e,n,r){for(var i,o,a=r.clusterRadius,s=r.clusterExtent,u=[],c=a/(s*Math.pow(2,e)),l=0;l<t.length;l++){var f=t[l];if(!(f.zoom<=e)){f.zoom=e;var h,p,d=n.within(f.x,f.y,c),v=f.weight||1,m=[f.id],g=f.x*v,y=f.y*v,b=oh();try{for(var x=(i=void 0,(0,eh.XA)(d)),_=x.next();!_.done;_=x.next()){var S=_.value,w=n.points[S];if(!(w.zoom<=e)){w.zoom=e;var k=w.weight||1;g+=w.x*k,y+=w.y*k,v+=k,m.push(w.id),w.parentId=b}}}catch(t){i={error:t}}finally{try{_&&!_.done&&(o=x.return)&&o.call(x)}finally{if(i)throw i.error}}m.length<=1?u.push(f):(f.parentId=b,u.push({id:b,lng:((h=g/v)-.5)*360,lat:360*Math.atan(Math.exp((180-360*(p=y/v))*Math.PI/180))/Math.PI-90,x:h,y:p,zoom:1/0,weight:v,childIds:m}))}}return u}(l,h,c[f],e);p.length===l.length?(c[h]=c[f],c[f]=void 0,f=h):(f=h,l=p.sort(function(t,e){return t.weight-e.weight}),c[h]=ok(l,s))}if(0===c.length)return[]}for(var d=[],v=function(t){var e=c[t];(null!==(n=null==e?void 0:e.points)&&void 0!==n?n:[]).length&&e&&d.push({locations:Array.from(null!==(r=null==e?void 0:e.points)&&void 0!==r?r:[]).map(function(e){return e.zoom=t,e}),locationTree:e,zoom:t})},h=c.length-1;h>=0;h--)v(h);return d}(n,e):[]}),e.getClusterIndex=ol(e.getClusterLevels,function(t){return function(t){var e=t.map(function(t){return t.zoom}).reverse(),n=new Map,r=new Map;function i(n){var r=function(t,e){if(!t.length)throw Error("No available zoom levels");var n=t.map(function(t){return Math.abs(t+1-e)});return t[n.indexOf(Math.min.apply(Math,(0,eh.ev)([],(0,eh.CR)(n),!1)))]}(e,n);return t.find(function(t){return t.zoom===r})}return t.forEach(function(t){t.locations.forEach(function(t){n.set(t.id,t)})}),{zoomList:e,clusterIdMap:n,getAppropriateLevel:i,getMapLocations:function(t,e){var n=(0,eh.CR)(e,4),r=n[0],o=n[1],a=n[2],s=n[3],u=i(t),c=u.locations,l=u.locationTree,f=Math.min(od(r),od(a)),h=Math.max(od(r),od(a)),p=Math.min(ov(o),ov(s)),d=Math.max(ov(o),ov(s));return l.range(f,p,h,d).map(function(t){return c[t]})},getLocationIdsFromCluster:function(t){for(var e,r=new Set,i=[t];i.length;){var o=i.pop();if(o){var a=n.get(o);a&&((null===(e=a.childIds)||void 0===e?void 0:e.length)?i.push.apply(i,(0,eh.ev)([],(0,eh.CR)(a.childIds),!1)):r.add(a.id))}}return Array.from(r.values())},findClusterForZoom:function(t,e){var i="".concat(t,"-").concat(e),o=r.get("".concat(t,"-").concat(e));if(o)return o;var a=n.get(t);if(a&&a.zoom<=e)return a;for(var s=(null==a?void 0:a.parentId)&&n.get(a.parentId)||void 0;a&&s&&(!(a.zoom>=e)||!(e>=s.zoom));)s=(null==(a=s)?void 0:a.parentId)&&n.get(a.parentId)||void 0;return(o=a&&a.zoom<=e?a:s)&&r.set(i,o),o}}}(t)}),e.getViewLocations=ol(e.getClusterIndex,e.getMapZoom,e.getMapBounds,function(t,e,n){return t.getMapLocations(e,n)}),e.getLocationWeightRange=ol(e.getClusterIndex,e.getMapZoom,function(t,e){var n=t.getAppropriateLevel(e).locations;return n.length?[n[0].weight,n[n.length-1].weight]:[0,0]}),e.getAggregatedFlows=ol(e.getClusterIndex,e.getOriginData,e.getMapZoom,function(t,e,n){var r,i,o;return r=e.flows,i=new Map,o=t.getAppropriateLevel(n).zoom,r.forEach(function(e){var n=e.fromId,r=e.toId,a=e.weight,s=t.findClusterForZoom(n,o),u=t.findClusterForZoom(r,o);if(s&&u&&s.id!==u.id){var c="".concat(s.id,"-").concat(u.id),l=i.get(c);l||(l={id:c,fromId:s.id,fromLng:s.lng,fromLat:s.lat,toId:u.id,toLng:u.lng,toLat:u.lat,weight:0},i.set(c,l)),l.weight+=a}}),Array.from(i.values()).sort(function(t,e){return t.weight-e.weight})}),e.getFilterFlows=ol(e.getViewLocations,e.getAggregatedFlows,e.getMaxTopFlowNum,function(t,e,n){if(e.length<=n)return e;var r=(0,eh.ev)([],(0,eh.CR)(e),!1),i=new Set(t.map(function(t){return t.id}));return(r=r.filter(function(t){return i.has(t.fromId)||i.has(t.toId)})).length>n&&(r=r.slice(r.length-n,r.length)),r}),e.getFilterLocations=ol(e.getViewLocations,e.getFilterFlows,function(t,e){var n=new Set(e.map(function(t){return[t.fromId,t.toId]}).flat());return t.filter(function(t){return n.has(t.id)})}),e.getFlowWeightRange=ol(e.getAggregatedFlows,function(t){return t.length?[t[0].weight,t[t.length-1].weight]:[0,0]}),e.getFilterFlowWeightRange=ol(e.getFilterFlows,function(t){return t.length?[t[0].weight,t[t.length-1].weight]:[0,0]}),e}return(0,eh.ZT)(e,t),e}($),oE={}.toString,oA=function(t,e){return oE.call(t)==="[object "+e+"]"},oM=function(t){return oA(t,"Function")},oT=function(t){return Array.isArray?Array.isArray(t):oA(t,"Array")},oL=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e},oZ=function(t,e){if(t){if(oT(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(oL(t)){for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break}}},oP=function(t){if(!("object"==typeof t&&null!==t)||!oA(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},oO=Array.prototype;oO.splice,oO.indexOf,Array.prototype.splice,Object.prototype.hasOwnProperty;var oR=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return oZ(t,function(n,r){oM(t)&&"prototype"===r||e.push(n)}),e},oI=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)!function t(e,n,r,i){for(var o in r=r||0,i=i||5,n)if(n.hasOwnProperty(o)){var a=n[o];null!==a&&oP(a)?(oP(e[o])||(e[o]={}),r<i?t(e[o],a,r+1,i):e[o]=n[o]):oT(a)?(e[o]=[],e[o]=e[o].concat(a)):void 0!==a&&(e[o]=a)}}(t,e[r]);return t};Object.prototype.hasOwnProperty,Object.prototype.hasOwnProperty;var oD=function(t){return t};!function(t,e){if(!oM(t))throw TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};n.cache=new Map}(function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return M||(M=document.createElement("canvas").getContext("2d")),M.font=[o,a,i,n+"px",r].join(" "),M.measureText(oA(t,"String")?t:"").width},function(t,e){return void 0===e&&(e={}),(0,eh.pr)([t],oR(e)).join("")}),function(){function t(){this.map={}}t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length}}();class oN{constructor(t){this.options=oI({},this.getDefaultOptions()),this.update(t)}getOptions(){return this.options}update(t={}){this.options=oI({},this.options,t),this.rescale(t)}rescale(t){}}function oz(t,e){return e-t?n=>(n-t)/(e-t):t=>.5}function oj(t,...e){return e.reduce((t,e)=>n=>t(e(n)),t)}var oB=n(95737),oF=n.n(oB);function oU(t,e,n){let r=n;return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?t+(e-t)*6*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function oV(t){let e=oF().get(t);if(!e)return null;let{model:n,value:r}=e;return"rgb"===n?r:"hsl"===n?function(t){let e=t[0]/360,n=t[1]/100,r=t[2]/100,i=t[3];if(0===n)return[255*r,255*r,255*r,i];let o=r<.5?r*(1+n):r+n-r*n,a=2*r-o;return[255*oU(a,o,e+1/3),255*oU(a,o,e),255*oU(a,o,e-1/3),i]}(r):null}let oH=(t,e)=>n=>t*(1-n)+e*n,oG=(t,e)=>{let n=oV(t),r=oV(e);return null===n||null===r?n?()=>t:()=>e:t=>{let e=[,,,,];for(let i=0;i<4;i+=1){let o=n[i],a=r[i];e[i]=o*(1-t)+a*t}let[i,o,a,s]=e;return`rgba(${Math.round(i)}, ${Math.round(o)}, ${Math.round(a)}, ${s})`}},oW=(t,e)=>"number"==typeof t&&"number"==typeof e?oH(t,e):"string"==typeof t&&"string"==typeof e?oG(t,e):()=>t,oY=(t,e)=>{let n=oH(t,e);return t=>Math.round(n(t))};function oq(t){return null!=t&&!Number.isNaN(t)}let oX=Math.sqrt(50),oK=Math.sqrt(10),o$=Math.sqrt(2);function oQ(t,e,n){let r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/10**i;return i>=0?(o>=oX?10:o>=oK?5:o>=o$?2:1)*10**i:-(10**-i)/(o>=oX?10:o>=oK?5:o>=o$?2:1)}let oJ=(t,e,n=5)=>{let r;let i=[t,e],o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&([s,u]=[u,s],[o,a]=[a,o]),(r=oQ(s,u,n))>0?r=oQ(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=oQ(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r),i},o0=(t,e,n)=>{let r,i;let[o,a]=t,[s,u]=e;return o<a?(r=oz(o,a),i=n(s,u)):(r=oz(a,o),i=n(u,s)),oj(i,r)},o1=(t,e,n)=>{let r=Math.min(t.length,e.length)-1,i=Array(r),o=Array(r),a=t[0]>t[r],s=a?[...t].reverse():t,u=a?[...e].reverse():e;for(let t=0;t<r;t+=1)i[t]=oz(s[t],s[t+1]),o[t]=n(u[t],u[t+1]);return e=>{let n=function(t,e,n,r,i){let o=1,a=r||t.length,s=t=>t;for(;o<a;){let n=Math.floor((o+a)/2);s(t[n])>e?a=n:o=n+1}return o}(t,e,0,r)-1,a=i[n];return oj(o[n],a)(e)}},o2=(t,e,n,r)=>(Math.min(t.length,e.length)>2?o1:o0)(t,e,r?oY:n);class o3 extends oN{getDefaultOptions(){return{domain:[0,1],range:[0,1],nice:!1,clamp:!1,round:!1,interpolate:oH,tickCount:5}}map(t){return oq(t)?this.output(t):this.options.unknown}invert(t){return oq(t)?this.input(t):this.options.unknown}nice(){if(!this.options.nice)return;let[t,e,n,...r]=this.getTickMethodOptions();this.options.domain=this.chooseNice()(t,e,n,...r)}getTicks(){let{tickMethod:t}=this.options,[e,n,r,...i]=this.getTickMethodOptions();return t(e,n,r,...i)}getTickMethodOptions(){let{domain:t,tickCount:e}=this.options;return[t[0],t[t.length-1],e]}chooseNice(){return oJ}rescale(){this.nice();let[t,e]=this.chooseTransforms();this.composeOutput(t,this.chooseClamp(t)),this.composeInput(t,e,this.chooseClamp(e))}chooseClamp(t){let{clamp:e,range:n}=this.options,r=this.options.domain.map(t),i=Math.min(r.length,n.length);return e?function(t,e){let n=e<t?e:t,r=t>e?t:e;return t=>Math.min(Math.max(n,t),r)}(r[0],r[i-1]):oD}composeOutput(t,e){let{domain:n,range:r,round:i,interpolate:o}=this.options,a=o2(n.map(t),r,o,i);this.output=oj(a,e,t)}composeInput(t,e,n){let{domain:r,range:i}=this.options,o=o2(i,r.map(t),oH);this.input=oj(e,n,o)}}let o5=t=>e=>-t(-e),o4=(t,e)=>{let n=Math.log(t),r=t===Math.E?Math.log:10===t?Math.log10:2===t?Math.log2:t=>Math.log(t)/n;return e?o5(r):r},o7=(t,e)=>{let n=t===Math.E?Math.exp:e=>t**e;return e?o5(n):n},o6=(t,e,n)=>{let r,i;let o=t,a=e;if(o===a&&n>0)return[o];let s=oQ(o,a,n);if(0===s||!Number.isFinite(s))return[];if(s>0){o=Math.ceil(o/s),i=Array(r=Math.ceil((a=Math.floor(a/s))-o+1));for(let t=0;t<r;t+=1)i[t]=(o+t)*s}else{o=Math.ceil(o*(s=-s)),i=Array(r=Math.ceil((a=Math.floor(a*s))-o+1));for(let t=0;t<r;t+=1)i[t]=(o+t)/s}return i},o8=(t,e,n,r=10)=>{let i=t<0,o=o7(r,i),a=o4(r,i),s=e<t,u=s?e:t,c=s?t:e,l=a(u),f=a(c),h=[];if(!(r%1)&&f-l<n){if(l=Math.floor(l),f=Math.ceil(f),i)for(;l<=f;l+=1){let t=o(l);for(let e=r-1;e>=1;e-=1){let n=t*e;if(n>c)break;n>=u&&h.push(n)}}else for(;l<=f;l+=1){let t=o(l);for(let e=1;e<r;e+=1){let n=t*e;if(n>c)break;n>=u&&h.push(n)}}2*h.length<n&&(h=o6(u,c,n))}else{let t=-1===n?f-l:Math.min(f-l,n);h=o6(l,f,t).map(o)}return s?h.reverse():h},o9=(t,e,n,r)=>{let i=t<0,o=o4(r,i),a=o7(r,i),s=t>e,u=[a(Math.floor(o(s?e:t))),a(Math.ceil(o(s?t:e)))];return s?u.reverse():u};class at extends o3{getDefaultOptions(){return{domain:[1,10],range:[0,1],base:10,interpolate:oW,tickMethod:o8,tickCount:5}}chooseNice(){return o9}getTickMethodOptions(){let{domain:t,tickCount:e,base:n}=this.options;return[t[0],t[t.length-1],e,n]}chooseTransforms(){let{base:t,domain:e}=this.options,n=e[0]<0;return[o4(t,n),o7(t,n)]}clone(){return new at(this.options)}}var ae=L.ScaleTypes.LINEAR;function an(t,e){var n;if(t instanceof Object&&!(t instanceof Function)&&!Array.isArray(t)){var r=t.field,i=t.value;if("weight"===r&&Array.isArray(i)&&i.length){var o=(null===(n=t.scale)||void 0===n?void 0:n.type)||ae;return(0,eh.pi)((0,eh.pi)({},t),{scale:{field:"size",type:o,domain:e}})}}return t}function ar(t,e){var n;if(t instanceof Object&&!(t instanceof Function)&&!Array.isArray(t)){var r=t.field,i=t.value;if("weight"===r&&Array.isArray(i)&&i.length){var o=(null===(n=t.scale)||void 0===n?void 0:n.type)||ae;return(0,eh.pi)((0,eh.pi)({},t),{scale:{field:"color",type:o,domain:e}})}}return t}var ai=function(t){function e(e){var n=t.call(this,e)||this;return n.type=im.LayerType.FlowLayer,n.dataProvider=new oC,n.matchZoom=0,n.onMapChange=on(function(){n.updateSubLayers()},400,{maxWait:400}),n.onCircleMouseMove=function(t){n.renderHighlightLayers(n._getCircleLayerActiveData(t,n._getFullActiveOptions()))},n.onCircleMouseOut=function(){n.clearHighlightLayers()},n.onLineMouseMove=function(t){n.renderHighlightLayers(n._getLineLayerActiveData(t,n._getFullActiveOptions()))},n.onLineMouseOut=function(){n.clearHighlightLayers()},n.onCircleClick=function(t){var e,r,i;t.feature.id!==(null===(i=null===(r=null===(e=n.circleSelectLayer)||void 0===e?void 0:e.options.source.data)||void 0===r?void 0:r[0])||void 0===i?void 0:i.id)?n.renderSelectLayers(n._getCircleLayerActiveData(t,n._getFullSelectOptions())):n.clearSelectLayers()},n.onLineClick=function(t){var e,r,i;t.feature.id!==(null===(i=null===(r=null===(e=n.lineSelectLayer)||void 0===e?void 0:e.options.source.data)||void 0===r?void 0:r[0])||void 0===i?void 0:i.id)?n.renderSelectLayers(n._getLineLayerActiveData(t,n._getFullSelectOptions())):n.clearSelectLayers()},n.initSubLayersEvent(),n}return(0,eh.ZT)(e,t),Object.defineProperty(e.prototype,"layer",{get:function(){return this.lineLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"circleLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("circleLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("lineLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"locationNameLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("locationNameLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"circleHighlightLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("circleHighlightLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"circleSelectLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("circleSelectLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineHighlightLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("lineHighlightLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineSelectLayer",{get:function(){var t;return null===(t=this.subLayers)||void 0===t?void 0:t.getLayer("lineSelectLayer")},enumerable:!1,configurable:!0}),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createSubLayers=function(){var t=this,e=new ia({id:"circleLayer",name:"circleLayer",source:or}),n=new ii({id:"lineLayer",name:"lineLayer",source:oi}),r=new ip({id:"locationNameLayer",name:"locationNameLayer",source:or}),i=new ia({id:"circleHighlightLayer",name:"circleHighlightLayer",source:or}),o=new ia({id:"circleSelectLayer",name:"circleSelectLayer",source:or}),a=new ii({id:"lineHighlightLayer",name:"lineHighlightLayer",source:oi}),s=new ii({id:"lineSelectLayer",name:"lineSelectLayer",source:oi});return ej.forEach(function(r){e.on(r,function(e){return t.emit("circleLayer:".concat(r),e)}),n.on(r,function(e){return t.emit("lineLayer:".concat(r),e)})}),[n,e,r,i,o,a,s]},e.prototype.update=function(e){t.prototype.update.call(this,e),this.initSubLayersEvent(),e.source!==this.options.source&&this.clearActiveLayers()},e.prototype.addTo=function(e){var n,r;this.scene=e,this.updateSubLayers(),t.prototype.addTo.call(this,e),null===(n=this.scene)||void 0===n||n.on("zoomchange",this.onMapChange),null===(r=this.scene)||void 0===r||r.on("mapmove",this.onMapChange)},e.prototype.remove=function(){var e,n;t.prototype.remove.call(this),null===(e=this.scene)||void 0===e||e.off("zoomchange",this.onMapChange),null===(n=this.scene)||void 0===n||n.off("mapmove",this.onMapChange)},e.prototype.updateSubLayers=function(){var t,e=this;this.updateClusterState(),null===(t=this.circleLayer)||void 0===t||t.update(this.getCircleLayerOptions()),this.getLocationNameLayerOptions().then(function(t){var n;null===(n=e.locationNameLayer)||void 0===n||n.update(t)}),requestAnimationFrame(function(){null===(t=e.lineLayer)||void 0===t||t.update(e.getLineLayerOptions()),null===(n=e.circleHighlightLayer)||void 0===n||n.update(e.getCircleHighlightLayerOptions()),null===(r=e.circleSelectLayer)||void 0===r||r.update(e.getCircleSelectLayerOptions()),null===(i=e.lineHighlightLayer)||void 0===i||i.update(e.getLineHighlightLayerOptions()),null===(o=e.lineSelectLayer)||void 0===o||o.update(e.getLineSelectLayerOptions());var t,n,r,i,o,a,s,u=null!==(s=null===(a=(0,e.dataProvider.getClusterIndex(e.options.source,e.dataProviderState).getAppropriateLevel)(e.dataProviderState.mapStatus.zoom))||void 0===a?void 0:a.zoom)&&void 0!==s?s:0;u!==e.matchZoom&&(e.clearActiveLayers(),e.matchZoom=u)})},e.prototype.initSubLayersEvent=function(){var t,e,n,r,i,o,a,s,u,c,l,f,h,p;null===(t=this.circleLayer)||void 0===t||t.off("mousemove",this.onCircleMouseMove),null===(e=this.circleLayer)||void 0===e||e.off("mouseout",this.onCircleMouseOut),null===(n=this.circleLayer)||void 0===n||n.off("click",this.onCircleClick),null===(r=this.lineLayer)||void 0===r||r.off("mousemove",this.onLineMouseMove),null===(i=this.lineLayer)||void 0===i||i.off("mouseout",this.onLineMouseOut),null===(o=this.lineLayer)||void 0===o||o.off("click",this.onLineClick),(null===(a=this.options.state)||void 0===a?void 0:a.active)&&(null===(s=this.circleLayer)||void 0===s||s.on("mousemove",this.onCircleMouseMove),null===(u=this.circleLayer)||void 0===u||u.on("mouseout",this.onCircleMouseOut),null===(c=this.lineLayer)||void 0===c||c.on("mousemove",this.onLineMouseMove),null===(l=this.lineLayer)||void 0===l||l.on("mouseout",this.onLineMouseOut)),(null===(f=this.options.state)||void 0===f?void 0:f.select)&&(null===(h=this.circleLayer)||void 0===h||h.on("click",this.onCircleClick),null===(p=this.lineLayer)||void 0===p||p.on("click",this.onLineClick))},e.prototype.updateClusterState=function(){var t=this.scene;if(t){var e=t.getMaxZoom(),n=t.getMinZoom(),r=iJ((0,ij.Z)(t.getBounds().flat()),1.1);this.dataProviderState=(0,eh.pi)((0,eh.pi)({},this.options),{mapStatus:{zoom:t.getZoom(),bounds:(0,iz.Z)(r)},maxZoom:e,minZoom:n})}},e.prototype.getCircleLayerOptions=function(){var t=this.options,e={source:{data:[],parser:{type:"json",x:"lng",y:"lat"}},shape:"circle",minZoom:t.minZoom,maxZoom:t.maxZoom,zIndex:t.zIndex,visible:t.visible,blend:t.blend,pickingBuffer:t.pickingBuffer,style:{stroke:t.circleStrokeColor,strokeWidth:t.circleStrokeWidth,opacity:t.circleOpacity}};if(this.dataProvider&&this.scene){var n=this.dataProvider.getLocationWeightRange(this.options.source,this.dataProviderState);e.source.data=this.dataProvider.getFilterLocations(this.options.source,this.dataProviderState),e.size=an(this.options.circleRadius,n),e.color=ar(this.options.circleColor,n)}return e},e.prototype.getLineLayerOptions=function(){var t=this.options,e=t.minZoom,n=t.maxZoom,r=t.zIndex,i=t.visible,o=t.blend,a=t.pickingBuffer,s=t.lineOpacity,u=t.lineWidth,c=t.lineColor,l=t.lineStroke,f=t.lineStrokeOpacity,h=t.lineStrokeWidth,p={source:{data:[],parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}},shape:"flowline",minZoom:e,maxZoom:n,zIndex:r,visible:i,blend:o,pickingBuffer:a,style:{gapWidth:h,stroke:l,strokeWidth:h,strokeOpacity:f,opacity:s}};if(this.dataProvider&&this.scene){var d,v,m,g=this.dataProvider.getFlowWeightRange(this.options.source,this.dataProviderState),y=this.dataProvider.getFilterFlowWeightRange(this.options.source,this.dataProviderState);if(p.source.data=this.dataProvider.getFilterFlows(this.options.source,this.dataProviderState),p.size=an(u,g),p.color=ar(c,g),this.options.fadeOpacityEnabled&&p.style&&(p.style.opacity=(d=this.options.fadeOpacityAmount,v=new at({domain:y,range:[0,1]}),m=(1-d/100)*1.5,{field:"weight",value:function(t){return v.map(t)*m}})),this.circleLayer&&p.style){var b=this.dataProvider.getClusterIndex(this.options.source,this.dataProviderState);p.style.offsets=function(t,e){var n,r=e.options.size;if("number"==typeof r)return[r,r];var i=null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.getScale("size");return{field:"fromId*toId",value:function(e,n){var r,o,a=t.clusterIdMap.get(e),s=t.clusterIdMap.get(n);return[null!==(r=a?null==i?void 0:i(a.weight):0)&&void 0!==r?r:0,null!==(o=s?null==i?void 0:i(s.weight):0)&&void 0!==o?o:0]}}}(b,this.circleLayer)}}return p},e.prototype.getLocationNameLayerOptions=function(){var t,e;return(0,eh.mG)(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b=this;return(0,eh.Jh)(this,function(x){switch(x.label){case 0:if(r=(n=this.options).minZoom,i=n.maxZoom,o=n.zIndex,a=n.visible,s=n.blend,u=n.pickingBuffer,c=n.showLocationName,l=n.getClusterLocationName,f=n.locationNameColor,h=n.locationNameSize,p=n.locationNameStroke,d=n.locationNameStrokeWidth,v=n.locationNameStrokeOpacity,m=n.locationNameOffset,g=Object.assign({},c&&null!==(e=null===(t=this.circleLayer)||void 0===t?void 0:t.options.source)&&void 0!==e?e:or),!l)return[3,2];return y=g,[4,Promise.all(g.data.map(function(t,e){return(0,eh.mG)(b,void 0,void 0,function(){var n;return(0,eh.Jh)(this,function(r){switch(r.label){case 0:if(t.name)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),n=t,[4,l(t,e)];case 2:return n.name=r.sent(),[3,4];case 3:return r.sent(),t.name="",[3,4];case 4:return[2,t]}})})}))];case 1:y.data=x.sent(),x.label=2;case 2:return[2,{source:g,field:"name",minZoom:r,maxZoom:i,zIndex:o,visible:a,blend:s,pickingBuffer:u,style:{fill:f,fontSize:h,stroke:p,strokeOpacity:v,strokeWidth:d,textOffset:m}}]}})})},e.prototype.getCircleHighlightLayerOptions=function(){return this._getCircleActiveLayerOptions(this._getFullActiveOptions())},e.prototype.getCircleSelectLayerOptions=function(){return this._getCircleActiveLayerOptions(this._getFullSelectOptions())},e.prototype.getLineHighlightLayerOptions=function(){return this._getLineActiveLayerOptions(this._getFullActiveOptions())},e.prototype.getLineSelectLayerOptions=function(){return this._getLineActiveLayerOptions(this._getFullSelectOptions())},e.prototype.renderHighlightLayers=function(t){var e,n,r=t.locations,i=t.flows;null===(e=this.circleHighlightLayer)||void 0===e||e.update({source:{data:r,parser:{type:"json",x:"lng",y:"lat"}}}),null===(n=this.lineHighlightLayer)||void 0===n||n.update({source:{data:i,parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}}})},e.prototype.renderSelectLayers=function(t){var e,n,r=t.locations,i=t.flows;null===(e=this.circleSelectLayer)||void 0===e||e.update({source:{data:r,parser:{type:"json",x:"lng",y:"lat"}}}),null===(n=this.lineSelectLayer)||void 0===n||n.update({source:{data:i,parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}}})},e.prototype.clearActiveLayers=function(){this.clearHighlightLayers(),this.clearSelectLayers()},e.prototype.clearHighlightLayers=function(){this.renderHighlightLayers({locations:[],flows:[]})},e.prototype.clearSelectLayers=function(){this.renderSelectLayers({locations:[],flows:[]})},e.prototype._getCircleLayerActiveData=function(t,e){var n=e.enableCircleSpread,r=t.feature,i=r.id,o=[];return n&&(o=this.dataProvider.getFilterFlows(this.options.source,this.dataProviderState).filter(function(t){return t.fromId===i||t.toId===i})),{locations:[r],flows:o}},e.prototype._getLineLayerActiveData=function(t,e){var n=e.enableLineSpread,r=t.feature,i=[],o=r.fromId,a=r.toId;if(n){var s=this.dataProvider.getClusterIndex(this.options.source,this.dataProviderState).clusterIdMap,u=s.get(o),c=s.get(a);u&&i.push(u),c&&i.push(c)}return{locations:i,flows:[r]}},e.prototype._getFullActiveOptions=function(){var t,e;return(0,eh.pi)((0,eh.pi)({},oo),(null===(t=this.options.state)||void 0===t?void 0:t.active)instanceof Object?null===(e=this.options.state)||void 0===e?void 0:e.active:{})},e.prototype._getFullSelectOptions=function(){var t,e;return(0,eh.pi)((0,eh.pi)({},oa),(null===(t=this.options.state)||void 0===t?void 0:t.select)instanceof Object?null===(e=this.options.state)||void 0===e?void 0:e.select:{})},e.prototype._getCircleActiveLayerOptions=function(t){var e,n,r=t.circleColor,i=t.circleStrokeColor,o=null!==(n=null===(e=this.circleLayer)||void 0===e?void 0:e.options)&&void 0!==n?n:{},a=o.color,s=o.size;return{color:null!=r?r:a,shape:o.shape,size:s,style:{stroke:i,strokeWidth:o.style.strokeWidth}}},e.prototype._getLineActiveLayerOptions=function(t){var e,n,r=t.lineColor,i=t.lineStroke,o=null!==(n=null===(e=this.lineLayer)||void 0===e?void 0:e.options)&&void 0!==n?n:{},a=o.color,s=o.size,u=o.shape,c=o.style;return{color:null!=r?r:a,size:s,shape:u,style:{stroke:i,strokeWidth:c.lineStrokeWidth,gapWidth:c.lineStrokeWidth,offsets:c.offsets}}},e.DefaultOptions=os,e}(im),ao={onRemove:r8.onRemove,onShow:r8.onShow,onHide:r8.onHide,onDataUpdate:r8.onDataUpdate,onLegend:r8.onLegend,onLegendColor:r8.onLegendColor,onLegendSize:r8.onLegendSize,onCircleLayerClick:"circleLayer:"+r8.onClick,onCircleLayerUnClick:"circleLayer:"+r8.onUnClick,onCircleLayerDblClick:"circleLayer:"+r8.onDblClick,onCircleLayerUndblclick:"circleLayer:"+r8.onUndblclick,onCircleLayerContextMenu:"circleLayer:"+r8.onContextMenu,onCircleLayerUnContextMenu:"circleLayer:"+r8.onUnContextMenu,onCircleLayerMouseEnter:"circleLayer:"+r8.onMouseEnter,onCircleLayerMouseMove:"circleLayer:"+r8.onMouseMove,onCircleLayerMouseOut:"circleLayer:"+r8.onMouseOut,onCircleLayerMouseUp:"circleLayer:"+r8.onMouseUp,onCircleLayerMouseDown:"circleLayer:"+r8.onMouseDown,onCircleLayerUnMousemove:"circleLayer:"+r8.onUnMousemove,onCircleLayerUnMouseup:"circleLayer:"+r8.onUnMouseup,onCircleLayerUnMousedown:"circleLayer:"+r8.onUnMousedown,onCircleLayerUnPick:"circleLayer:"+r8.onUnPick,onLineLayerClick:"lineLayer:"+r8.onClick,onLineLayerUnClick:"lineLayer:"+r8.onUnClick,onLineLayerDblClick:"lineLayer:"+r8.onDblClick,onLineLayerUndblclick:"lineLayer:"+r8.onUndblclick,onLineLayerContextMenu:"lineLayer:"+r8.onContextMenu,onLineLayerUnContextMenu:"lineLayer:"+r8.onUnContextMenu,onLineLayerMouseEnter:"lineLayer:"+r8.onMouseEnter,onLineLayerMouseMove:"lineLayer:"+r8.onMouseMove,onLineLayerMouseOut:"lineLayer:"+r8.onMouseOut,onLineLayerMouseUp:"lineLayer:"+r8.onMouseUp,onLineLayerMouseDown:"lineLayer:"+r8.onMouseDown,onLineLayerUnMousemove:"lineLayer:"+r8.onUnMousemove,onLineLayerUnMouseup:"lineLayer:"+r8.onUnMouseup,onLineLayerUnMousedown:"lineLayer:"+r8.onUnMousedown,onLineLayerUnPick:"lineLayer:"+r8.onUnPick},aa=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(ai,t);return r9(n.current,t,ao),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),as={active:{enable:!1,color:ib},select:{enable:!1,radius:10,opacity:1}},au={visible:!0,source:ig,radius:12,icon:{value:"1"},state:{active:!1,select:!1},blend:"normal",enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},ac=function(t){return(0,eh.pi)((0,eh.pi)({},as),t)},al=function(t){function e(e){var n=t.call(this,e)||this;return n.layerState=as,n.type=im.LayerType.IconImageLayer,n.selectData=[],n.onSelectHandle=function(t){var e=t.feature,r=t.featureId;n.handleSelectData(r,e)},n.initSubLayersEvent(),n}return(0,eh.ZT)(e,t),Object.defineProperty(e.prototype,"layer",{get:function(){return this.iconLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconLayer",{get:function(){return this.subLayers.getLayer("iconLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconLabelLayer",{get:function(){return this.subLayers.getLayer("labelLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectIconLayer",{get:function(){return this.subLayers.getLayer("selectIconLayer")},enumerable:!1,configurable:!0}),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.addTo=function(t){this.scene=t,this.initAssets(),this.subLayers.addTo(t),this.emit(C.ADD)},e.prototype.getIconLayerOptions=function(){var t,e=eZ(this.options,["source"]),n=e.visible,r=e.minZoom,i=e.maxZoom,o=e.zIndex,a=e.radius,s=e.opacity,u=e.icon,c=e.fillColor,l=e.iconStyle,f=(0,eh._T)(e,["visible","minZoom","maxZoom","zIndex","radius","opacity","icon","fillColor","iconStyle"]),h={active:null===(t=this.options.state)||void 0===t?void 0:t.active,select:!1},p=(0,eh.pi)({opacity:s},l);return(0,eh.pi)((0,eh.pi)({},f),{visible:n,minZoom:r,maxZoom:i,zIndex:void 0===o?0:o,shape:u,size:a,state:h,color:c,style:p})},e.prototype.getHighLightLayerOptions=function(){var t,e=this.options,n=e.visible,r=e.minZoom,i=e.maxZoom,o=e.zIndex,a=e.icon,s=null===(t=this.layerState)||void 0===t?void 0:t.select,u=s.radius,c=s.opacity;return{visible:n,blend:L.BlendType.normal,zIndex:(void 0===o?0:o)+.1,minZoom:r,maxZoom:i,source:ig,size:void 0===u?5:u,style:{opacity:void 0===c?1:c},shape:(null==s?void 0:s.icon)||a,state:{select:!1,active:!1}}},e.prototype.handleSelectData=function(t,e,n){var r=this.options,i=iC(r.enabledMultiSelect,r.triggerMultiSelectKey)||n,o=eA(this.selectData),a=o.findIndex(function(e){return e.featureId===t});if(-1===a)i?o.push({feature:e,featureId:t}):o=[{feature:e,featureId:t}],this.emit("select",e,eA(o));else{var s=o[a];i?o.splice(a,1):o=[],this.emit("unselect",s,eA(o))}this.setSelectLayerSource(o)},e.prototype.createSubLayers=function(){var t=this.source;this.layerState=ac(this.options.state);var e=new ia((0,eh.pi)((0,eh.pi)({},this.getIconLayerOptions()),{id:"iconLayer",source:t,interaction:!0})),n=new ia((0,eh.pi)({id:"selectIconLayer"},this.getHighLightLayerOptions()));return[e,new ip((0,eh.pi)((0,eh.pi)({},iw(this.options)),{id:"labelLayer",source:t})),n]},e.prototype.updateSubLayers=function(t){this.iconLayer.update(this.getIconLayerOptions(),!1),this.iconLabelLayer.update(iw(this.options),!1)},e.prototype.setSelectLayerSource=function(t){if(void 0===t&&(t=[]),!(this.selectData.length===t.length&&eT(this.selectData.map(function(t){return t.featureId}),t.map(function(t){return t.featureId})))){var e=t.map(function(t){return t.feature}),n=this.source.parser,r="geojson"===n.type?{type:"FeatureCollection",features:e}:e;this.selectIconLayer.changeData({data:r,parser:n}),this.selectData=t}},e.prototype.setSubLayersSource=function(t){if(this.isSourceInstance(t))this.source=t,this.iconLayer.setSource(t),this.iconLabelLayer.setSource(t);else{var e=t.data,n=(0,eh._T)(t,["data"]);this.source.setData(e,n)}this.selectIconLayer.changeData(ig)},e.prototype.initSubLayersEvent=function(){this.iconLayer.off("click",this.onSelectHandle),this.selectData=[],this.options.state&&this.options.state.select&&this.iconLayer.on("click",this.onSelectHandle)},e.prototype.updateOption=function(e){t.prototype.updateOption.call(this,e),this.layerState=ac(this.options.state)},e.prototype.setIndex=function(t){this.iconLayer.setIndex(t),this.iconLabelLayer.setIndex(t),this.selectIconLayer.setIndex(t+.1)},e.prototype.setActive=function(t,e){var n=this.iconLayer.source.getFeatureId(t,e);if(eE(n)){console.warn("Feature non-existent by field: ".concat(t,",value: ").concat(e));return}this.iconLayer.layer.setActive(n)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.initSubLayersEvent()},e.prototype.setSelect=function(t,e){var n,r,i=this.iconLayer.source,o=i.getFeatureId(t,e);if(eE(o)){console.warn("Feature non-existent by field: ".concat(t,",value: ").concat(e));return}if(null===(n=this.layerState)||void 0===n||!n.select||!1===(null===(r=this.layerState)||void 0===r?void 0:r.select).enable){var a=i.getFeatureById(o);this.handleSelectData(o,a,!0)}},e.prototype.boxSelect=function(t,e){this.iconLayer.boxSelect(t,e)},e.DefaultOptions=au,e}(im),af=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type=im.LayerType.IconFontLayer,e.fontLoaded=!0,e}return(0,eh.ZT)(e,t),e.prototype.addTo=function(t){var e=this;this.scene=t,this.initAssets();var n=function(){e.subLayers.once(E.INITED_LAYERS,function(){e.emit(C.INITED,e),e.emit(C.ADD,e)}),e.subLayers.addTo(t)};this.fontLoaded?n():this.on("fontloaded",function(){n()})},e.prototype.initAssets=function(){this.loadIconFontAtlas()},e.prototype.loadIconFontAtlas=function(){var t=this,e=this.options.iconAtlas,n=e.fontFamily,r=e.fontPath,i=e.iconFonts,o=this.scene;n&&r&&(this.fontLoaded=!1,null==o||o.once("fontloaded",function(e){t.emit("fontloaded",e),t.fontLoaded=!0}),null==o||o.addFontFace(n,r)),null==o||o.addIconFonts(i)},e.DefaultOptions=au,e}(al),ah=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(af,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),ap=function(t){function e(){var e=t.apply(this,(0,eh.ev)([],(0,eh.CR)(arguments),!1))||this;return e.type=im.LayerType.IconImageLayer,e}return(0,eh.ZT)(e,t),e.prototype.addTo=function(t){var e=this;this.scene=t,this.initAssets().then(function(){e.subLayers.once(E.INITED_LAYERS,function(){e.emit(C.INITED,e),e.emit(C.ADD,e)}),e.subLayers.addTo(t)})},e.prototype.initAssets=function(){return(0,eh.mG)(this,void 0,void 0,function(){return(0,eh.Jh)(this,function(t){switch(t.label){case 0:return[4,this.loadIconAtlas()];case 1:return t.sent(),[2]}})})},e.prototype.updateAssets=function(){return(0,eh.mG)(this,void 0,void 0,function(){return(0,eh.Jh)(this,function(t){switch(t.label){case 0:return[4,this.loadIconAtlas()];case 1:return t.sent(),[2]}})})},e.prototype.updateSubLayers=function(e){var n=this;e.iconAtlas&&!rp(e.iconAtlas,this.lastOptions.iconAtlas)?this.updateAssets().then(function(){t.prototype.updateSubLayers.call(n,e)}):t.prototype.updateSubLayers.call(this,e)},e.prototype.loadIconAtlas=function(){return(0,eh.mG)(this,void 0,void 0,function(){var t,e,n=this;return(0,eh.Jh)(this,function(r){switch(r.label){case 0:if(t=this.options.iconAtlas,!(e=this.scene))return[2];return[4,Promise.all(Object.entries(t).filter(function(t){var n=(0,eh.CR)(t,1)[0];return!1===e.hasImage(n)}).map(function(t){var r=(0,eh.CR)(t,2),i=r[0],o=r[1];return(0,eh.mG)(n,void 0,void 0,function(){return(0,eh.Jh)(this,function(t){switch(t.label){case 0:return[4,e.addImage(i,o)];case 1:return[2,t.sent()]}})})}))];case 1:return r.sent(),[2]}})})},e.DefaultOptions=au,e}(al),ad=(0,Z.memo)((0,Z.forwardRef)(function(t,e){var n=r6(ap,t);return r9(n.current,t),(0,Z.useImperativeHandle)(e,function(){return n.current}),null})),av=n(54887),am=function(t){var e=t.className,n=t.style,r=t.children,i=t.position,o=t.name,a=(0,Z.useRef)(document.createElement("div")),s=tW(n);return ea((0,Z.useCallback)(function(){return a.current},[]),void 0,(0,Z.useMemo)(function(){return{position:i,name:o,className:e,style:s}},[i,o,e,s])),(0,av.createPortal)(r,a.current)};am.defaultProps={position:"topleft"};var ag=function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){var u=(s=n[i])[0],c=t[u],l=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var f=new nr;if(r)var h=r(c,l,u,t,e,f);if(!(void 0===h?rh(l,c,3,r,f):h))return!1}}return!0},ay=function(t){return t==t&&!eY(t)},ab=function(t){for(var e=n$(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,ay(i)]}return e},ax=function(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}},a_=function(t){var e=ab(t);return 1==e.length&&e[0][2]?ax(e[0][0],e[0][1]):function(n){return n===t||ag(n,t,e)}},aS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,aw=/^\w*$/,ak=function(t,e){if(tf(t))return!1;var n=typeof t;return!!("number"==n||"symbol"==n||"boolean"==n||null==t||th(t))||aw.test(t)||!aS.test(t)||null!=e&&t in Object(e)};function aC(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(aC.Cache||nn),n}aC.Cache=nn;var aE=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,aA=/\\(\\)?/g,aM=(v=(d=aC(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(aE,function(t,n,r,i){e.push(r?i.replace(aA,"$1"):n||t)}),e},function(t){return 500===v.size&&v.clear(),t})).cache,d),aT=function(t,e){return tf(t)?t:ak(t,e)?[t]:aM(tg(t))},aL=1/0,aZ=function(t){if("string"==typeof t||th(t))return t;var e=t+"";return"0"==e&&1/t==-aL?"-0":e},aP=function(t,e){e=aT(e,t);for(var n=0,r=e.length;null!=t&&n<r;)t=t[aZ(e[n++])];return n&&n==r?t:void 0},aO=function(t,e,n){var r=null==t?void 0:aP(t,e);return void 0===r?n:r},aR=function(t,e){return null!=t&&e in Object(t)},aI=function(t,e,n){e=aT(e,t);for(var r=-1,i=e.length,o=!1;++r<i;){var a=aZ(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&nO(i)&&nP(a,i)&&(tf(t)||nE(t))},aD=function(t){return t},aN=function(t){var e;return ak(t)?(e=aZ(t),function(t){return null==t?void 0:t[e]}):function(e){return aP(e,t)}},az=function(t){if("function"==typeof t)return t;if(null==t)return aD;if("object"==typeof t){var e,n;return tf(t)?(e=t[0],n=t[1],ak(e)&&ay(n)?ax(aZ(e),n):function(t){var r=aO(t,e);return void 0===r&&r===n?null!=t&&aI(t,e,aR):rh(n,r,3)}):a_(t)}return aN(t)},aj=function(t){if("function"!=typeof t)throw TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}},aB=function(t,e,n,r){if(!eY(t))return t;e=aT(e,t);for(var i=-1,o=e.length,a=o-1,s=t;null!=s&&++i<o;){var u=aZ(e[i]),c=n;if("__proto__"===u||"constructor"===u||"prototype"===u)break;if(i!=a){var l=s[u];void 0===(c=r?r(l,u,s):void 0)&&(c=eY(l)?l:nP(e[i+1])?[]:{})}ry(s,u,c),s=s[u]}return t},aF=function(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=aP(t,a);n(s,a)&&aB(o,aT(a,t),s)}return o},aU=function(t,e){if(null==t)return{};var n=tl(rP(t),function(t){return[t]});return e=az(e),aF(t,n,function(t,n){return e(t,n[0])})},aV=function(t,e){return aU(t,aj(az(e)))};function aH(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var aG=function(t,e){var n,r=(0,Z.useMemo)(function(){return Object.keys(e)},[e]);(0,Z.useEffect)(function(){return t&&r.forEach(function(n){var r=e[n];r&&t.on(n,r)}),function(){t&&r.forEach(function(n){var r=e[n];r&&t.off(n,r)})}},[t].concat(function(t){if(Array.isArray(t))return aH(t)}(n=Object.values(e))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return aH(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return aH(t,e)}}(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),t2(function(){t&&r.forEach(function(n){var r=e[n];r&&t.off(n,r)})})},aW=function(t,e){var n=(0,Z.useRef)(!0),r=(0,Z.useMemo)(function(){return Object.keys(e)},[e]);t0(function(i){if(n.current){n.current=!1;return}var o={};i.forEach(function(t){var n=r[t];o[n]=e[n]}),null==t||t.setOptions(o)},Object.values(e))},aY=function(t){var e=(0,Z.useRef)(document.createElement("span"));return{portal:t?(0,av.createPortal)(t,e.current):null,dom:t?e.current:void 0}};function aq(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var aX=function(t){var e,n=t.onExport,r=t.onShow,i=t.onHide,o=t.onAdd,a=t.onRemove,s=t.imageType,u=t.btnIcon,c=t.btnText,l=t.title,f=t.vertical,h=t.position,p=t.className,d=t.style,v=eo(),m=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return aq(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return aq(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),g=m[0],y=m[1],b=(0,Z.useMemo)(function(){return tW(d)},[d]),x=aY(u),_=x.portal,S=x.dom,w=(0,Z.useMemo)(function(){return{btnText:c,title:l,vertical:f,position:h,className:p,imageType:s,style:b,btnIcon:S,onExport:n}},[c,l,f,h,p,b,s,n,S]);return(0,Z.useEffect)(function(){var t=new L.ExportImage(aV(w,function(t){return void 0===t}));return y(t),v.addControl(t),function(){v.removeControl(t),y(void 0)}},[]),aW(g,w),aG(g,{add:o,remove:a,show:r,hide:i}),Z.createElement(Z.Fragment,null,_)};function aK(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var a$=function(t){var e,n=t.onShow,r=t.onHide,i=t.onAdd,o=t.onRemove,a=t.onFullscreenChange,s=t.btnIcon,u=t.btnText,c=t.title,l=t.vertical,f=t.exitBtnIcon,h=t.exitBtnText,p=t.exitTitle,d=t.position,v=t.className,m=t.style,g=eo(),y=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return aK(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return aK(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),b=y[0],x=y[1],_=(0,Z.useMemo)(function(){return tW(m)},[m]),S=aY(s),w=S.portal,k=S.dom,C=aY(f),E=C.portal,A=C.dom,M=(0,Z.useMemo)(function(){return{btnText:u,title:c,vertical:l,exitBtnText:h,exitTitle:p,position:d,className:v,style:_,btnIcon:k,exitBtnIcon:A}},[u,c,l,h,p,d,v,_,k,A]);return(0,Z.useEffect)(function(){var t=new L.Fullscreen(aV(M,function(t){return void 0===t}));return x(t),g.addControl(t),function(){g.removeControl(t),x(void 0)}},[]),aW(b,M),aG(b,{add:i,remove:o,show:n,hide:r,fullscreenChange:a}),Z.createElement(Z.Fragment,null,w,E)};function aQ(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var aJ=function(t){var e,n=t.transform,r=t.onShow,i=t.onHide,o=t.onAdd,a=t.onRemove,s=t.btnIcon,u=t.btnText,c=t.title,l=t.vertical,f=t.position,h=t.className,p=t.style,d=eo(),v=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return aQ(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return aQ(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),m=v[0],g=v[1],y=(0,Z.useMemo)(function(){return tW(p)},[p]),b=aY(s),x=b.portal,_=b.dom,S=(0,Z.useMemo)(function(){return{btnText:u,title:c,vertical:l,position:f,className:h,style:y,transform:n,btnIcon:_}},[u,c,l,f,h,y,n,_]);return(0,Z.useEffect)(function(){var t=new L.GeoLocate(aV(S,function(t){return void 0===t}));return g(t),d.addControl(t),function(){d.removeControl(t),g(void 0)}},[]),aW(m,S),aG(m,{add:o,remove:a,show:r,hide:i}),Z.createElement(Z.Fragment,null,x)};function a0(t){return(a0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function a2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a1(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==a0(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==a0(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===a0(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a1(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a3(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var a5=function(t){var e,n=t.layers,r=t.popperPlacement,i=t.popperTrigger,o=t.popperClassName,a=t.btnIcon,s=t.btnText,u=t.title,c=t.vertical,l=t.position,f=t.className,h=t.style,p=t.multiple,d=t.onAdd,v=t.onRemove,m=t.onShow,g=t.onHide,y=t.onPopperShow,b=t.onPopperHide,x=t.onSelectChange,_=eo(),S=ef(),w=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return a3(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a3(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),k=w[0],C=w[1],E=(0,Z.useMemo)(function(){return tW(h)},[h]),A=aY(a),M=A.portal,P=A.dom,O=(0,Z.useMemo)(function(){return null!=n&&n.length?n.map(function(t){if("string"==typeof t)return S.find(function(e){return e.id===t});if(!Object.prototype.hasOwnProperty.call(t,"isComposite")){var e=t.layer;if("string"==typeof e){var n=S.find(function(t){return t.id===e});return n?a2(a2({},t),{},{layer:n}):void 0}}return t}).filter(function(t){return!!t}):S},[n,S]),R=(0,Z.useMemo)(function(){return{layers:O,popperPlacement:r,popperTrigger:i,popperClassName:o,btnText:s,title:u,vertical:c,position:l,className:f,multiple:p,style:E,btnIcon:P}},[O,r,i,o,s,u,c,l,f,p,E,P]);return(0,Z.useEffect)(function(){var t=new L.LayerSwitch(aV(R,function(t){return void 0===t}));return C(t),_.addControl(t),function(){_.removeControl(t),C(void 0)}},[]),aW(k,R),aG(k,{add:d,remove:v,show:m,hide:g,popperShow:y,popperHide:b,selectChange:x}),Z.createElement(Z.Fragment,null,M)};function a4(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var a7=function(t){var e,n=t.popperPlacement,r=t.btnText,i=t.title,o=t.vertical,a=t.position,s=t.className,u=t.options,c=t.popperTrigger,l=t.popperClassName,f=t.btnIcon,h=t.style,p=t.onAdd,d=t.onRemove,v=t.onShow,m=t.onHide,g=t.onPopperShow,y=t.onPopperHide,b=t.onSelectChange,x=eo(),_=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return a4(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a4(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),S=_[0],w=_[1],k=(0,Z.useMemo)(function(){return tW(h)},[h]),C=aY(f),E=C.portal,A=C.dom,M=(0,Z.useMemo)(function(){return{popperPlacement:n,popperTrigger:c,popperClassName:l,btnText:r,title:i,vertical:o,position:a,className:s,options:u,style:k,btnIcon:A}},[u,n,c,l,r,i,o,a,s,k,A]);return(0,Z.useEffect)(function(){var t=new L.MapTheme(aV(M,function(t){return void 0===t}));return w(t),x.addControl(t),function(){x.removeControl(t),w(void 0)}},[]),aW(S,M),aG(S,{add:p,remove:d,show:v,hide:m,popperShow:g,popperHide:y,selectChange:b}),Z.createElement(Z.Fragment,null,E)};function a6(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var a8=function(t){var e,n=t.position,r=t.className,i=t.style,o=t.onLocationChange,a=t.transform,s=t.onAdd,u=t.onRemove,c=t.onShow,l=t.onHide,f=eo(),h=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return a6(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a6(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),p=h[0],d=h[1],v=(0,Z.useMemo)(function(){return tW(i)},[i]),m=(0,Z.useMemo)(function(){return{transform:a,position:n,className:r,style:v}},[a,n,r,v]);return(0,Z.useEffect)(function(){var t=new L.MouseLocation(aV(m,function(t){return void 0===t}));return d(t),f.addControl(t),function(){f.removeControl(t),d(void 0)}},[]),aW(p,m),aG(p,{add:s,remove:u,show:c,hide:l,locationChange:o}),null};function a9(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var st=function(t){var e,n=t.onShow,r=t.onHide,i=t.onAdd,o=t.onRemove,a=t.position,s=t.className,u=t.style,c=t.lockWidth,l=t.maxWidth,f=t.metric,h=t.imperial,p=t.updateWhenIdle,d=eo(),v=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return a9(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a9(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),m=v[0],g=v[1],y=(0,Z.useMemo)(function(){return tW(u)},[u]),b=(0,Z.useMemo)(function(){return{position:a,className:s,style:y,lockWidth:c,maxWidth:l,metric:f,imperial:h,updateWhenIdle:p}},[a,s,y,c,l,f,h,p]);return(0,Z.useEffect)(function(){var t=new L.Scale(aV(b,function(t){return void 0===t}));return g(t),d.addControl(t),function(){d.removeControl(t),g(void 0)}},[]),aW(m,b),aG(m,{add:i,remove:o,show:n,hide:r}),null};function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var sn=function(t){var e,n=t.onShow,r=t.onHide,i=t.onAdd,o=t.onRemove,a=t.position,s=t.name,u=t.className,c=t.style,l=t.zoomInText,f=t.zoomOutText,h=t.zoomInTitle,p=t.zoomOutTitle,d=t.showZoom,v=eo(),m=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return se(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),g=m[0],y=m[1],b=(0,Z.useMemo)(function(){return tW(c)},[c]),x=aY(l),_=x.portal,S=x.dom,w=aY(f),k=w.portal,C=w.dom,E=(0,Z.useMemo)(function(){return{position:a,name:s,className:u,zoomInTitle:h,zoomOutTitle:p,showZoom:d,style:b,zoomInText:S,zoomOutText:C}},[a,s,u,b,h,p,S,C,d]);return(0,Z.useEffect)(function(){var t=new L.Zoom(aV(E,function(t){return void 0===t}));return y(t),v.addControl(t),function(){v.removeControl(t),y(void 0)}},[]),aW(g,E),aG(g,{add:i,remove:o,show:n,hide:r}),Z.createElement(Z.Fragment,null,_,k)};function sr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var si=function(t){var e,n=t.img,r=t.href,i=t.position,o=t.className,a=t.style,s=t.onShow,u=t.onHide,c=t.onAdd,l=t.onRemove,f=eo(),h=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return sr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sr(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),p=h[0],d=h[1],v=(0,Z.useMemo)(function(){return tW(a)},[a]),m=(0,Z.useMemo)(function(){return{img:n,href:r,position:i,className:o,style:v}},[n,r,i,o,v]);return(0,Z.useEffect)(function(){var t=new L.Logo(aV(m,function(t){return void 0===t}));return d(t),f.addControl(t),function(){f.removeControl(t),d(void 0)}},[]),aW(p,m),aG(p,{add:c,remove:l,show:s,hide:u}),null},so=function(t){var e=t.title,n=t.className,r=t.style;return Z.createElement("h1",{className:D()("".concat("larkmap-template","_decoration"),n),style:r},e)};function sa(t){return(sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ss(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function su(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ss(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==sa(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==sa(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===sa(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ss(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var sc=(0,Z.memo)(function(t){var e=eo(),n=(0,Z.useRef)({props:t});n.current.props=t;var r=(0,Z.useMemo)(function(){var e=!1;Z.Children.forEach(t.children,function(t){t&&(e=!0)});var r=su(su({},t),{},{element:e?document.createElement("div"):null}),i=new L.Marker(r);return i.on("click",function(t){var e,r;null===(e=(r=n.current.props).onClick)||void 0===e||e.call(r,t)}),i},[]);return R(function(){r.setLnglat(t.lngLat)},[t.lngLat]),(0,Z.useEffect)(function(){return e.addMarker(r),function(){r.remove()}},[]),(0,av.createPortal)(t.children,r.getElement())});function sl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var sf=function(t){var e,n=t.style,r=t.closeButton,i=t.closeButtonOffsets,o=t.closeOnClick,a=t.closeOnEsc,s=t.maxWidth,u=t.anchor,c=t.offsets,l=t.stopPropagation,f=t.autoPan,h=t.autoClose,p=t.followCursor,d=t.className,v=t.lngLat,m=t.children,g=t.title,y=t.onOpen,b=t.onClose,x=t.onShow,_=t.onHide,S=eo(),w=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return sl(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sl(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),k=w[0],C=w[1],E=(0,Z.useMemo)(function(){return tW(n)},[n]),A=aY(m),M=A.portal,P=A.dom,O=aY(g),R=O.portal,I=O.dom,D=(0,Z.useMemo)(function(){return{style:E,closeButton:r,closeButtonOffsets:i,closeOnClick:o,closeOnEsc:a,maxWidth:s,anchor:u,offsets:c,stopPropagation:l,autoPan:f,autoClose:h,followCursor:p,className:d,lngLat:v,html:P,title:I}},[E,r,JSON.stringify(i),o,a,s,u,JSON.stringify(c),l,f,h,p,d,P,I,JSON.stringify(v)]);return(0,Z.useEffect)(function(){var t=new L.Popup(aV(D,function(t){return void 0===t}));return C(t),S.addPopup(t),function(){S.removePopup(t),C(void 0)}},[]),aW(k,D),aG(k,{open:y,close:b,show:x,hide:_}),Z.createElement(Z.Fragment,null,M,R)},sh=function(t,e){if(t instanceof Function){var n=document.createElement(e);return function(){var e=t.apply(void 0,arguments),r=av.createPortal(e,n);return av.render(r,n),n}}var r=document.createElement(e),i=av.createPortal(t,r);return av.render(i,r),r};function sp(t,e){if(t){if("string"==typeof t)return sd(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sd(t,e)}}function sd(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var sv=function(t){var e,n=t.style,r=t.closeButton,i=t.closeButtonOffsets,o=t.closeOnClick,a=t.closeOnEsc,s=t.maxWidth,u=t.anchor,c=t.offsets,l=t.stopPropagation,f=t.autoPan,h=t.autoClose,p=t.className,d=t.lngLat,v=t.items,m=t.trigger,g=t.onOpen,y=t.onClose,b=t.onShow,x=t.onHide,_=eo(),S=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)())||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||sp(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),w=S[0],k=S[1],C=(0,Z.useMemo)(function(){return tW(n)},[n]),E=ef(),A=(0,Z.useMemo)(function(){var t=[];return v.forEach(function(e){if("string"==typeof e.layer){var n,r,i=E.find(function(t){return t.id===e.layer});if(!i)return;r=i}else r=e.layer;var o=[];r.isComposite?o.push.apply(o,function(t){if(Array.isArray(t))return sd(t)}(n=r.getInteractionSubLayers())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||sp(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):o.push(r),o.forEach(function(n){var r,i={layer:n};e.title&&(i.title=sh(e.title,"div")),e.customContent&&(i.customContent=sh(e.customContent,"div")),null!==(r=e.fields)&&void 0!==r&&r.length&&(i.fields=e.fields.map(function(t){if("string"==typeof t)return t;var e={field:t.field,getValue:t.getValue};return t.formatField&&(e.formatField=sh(t.formatField,"span")),t.formatValue&&(e.formatValue=sh(t.formatValue,"span")),e})),t.push(i)})}),t},[E,v]),M=(0,Z.useMemo)(function(){return{style:C,closeButton:r,closeButtonOffsets:i,closeOnClick:o,closeOnEsc:a,maxWidth:s,anchor:u,offsets:c,stopPropagation:l,autoPan:f,autoClose:h,followCursor:"hover"===m,className:p,lngLat:d,items:A,trigger:m}},[C,r,JSON.stringify(i),o,a,s,u,JSON.stringify(c),l,f,h,p,m,JSON.stringify(d),A]);return(0,Z.useEffect)(function(){var t=new L.LayerPopup(aV(M,function(t){return void 0===t}));return k(t),_.addPopup(t),function(){_.removePopup(t),k(void 0)}},[]),aW(w,M),aG(w,{open:g,close:y,show:b,hide:x}),Z.createElement(Z.Fragment,null)},sm="larkmap-context-menu",sg=Object.prototype.hasOwnProperty,sy=function(t){if(null==t)return!0;if(nK(t)&&(tf(t)||"string"==typeof t||"function"==typeof t.splice||nL(t)||nF(t)||nE(t)))return!t.length;var e=ra(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(nG(t))return!nX(t).length;for(var n in t)if(sg.call(t,n))return!1;return!0},sb=(0,Z.memo)(function(t){var e=t.text,n=void 0===e?"":e,r=t.onClick;return sy(n)?null:Z.createElement("li",{className:D()("".concat(sm,"__menu-item"),null==t?void 0:t.className),style:null==t?void 0:t.style,onClick:r},n)});function sx(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var s_=function(t){var e,n=eo(),r=function(t){if(Array.isArray(t))return t}(e=(0,Z.useState)({visible:!1,position:void 0}))||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(t,e){if(t){if("string"==typeof t)return sx(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sx(t,e)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=r[0],o=r[1],a=(0,Z.useMemo)(function(){return Z.createElement("div",{className:D()("".concat(sm),null==t?void 0:t.className),style:null==t?void 0:t.style},null==t?void 0:t.children)},[t]),s=function(t){var e=t.lnglat;o({visible:!0,position:{lng:e.lng,lat:e.lat}})},u=function(){var t=setTimeout(function(){t&&(clearTimeout(t),o({visible:!1,position:void 0}))},0)};return(0,Z.useEffect)(function(){return n&&(n.on("contextmenu",s),n.on("click",u)),function(){n.off("contextmenu",s),n.off("click",u)}},[n]),i.visible?Z.createElement(sc,{lngLat:i.position,anchor:"top-left"},a):null};s_.Item=sb;var sS=n(54525),sw=n.n(sS),sk=function(t,e){var n,r=t1(t),i=null!==(n=null==e?void 0:e.wait)&&void 0!==n?n:1e3,o=(0,Z.useMemo)(function(){return sw()(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.current.apply(r,(0,eh.ev)([],(0,eh.CR)(t),!1))},i,e)},[]);return t2(function(){o.cancel()}),{run:o,cancel:o.cancel,flush:o.flush}},sC=n(21663),sE=n.n(sC),sA="larkmap-location-search",sM=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},sT=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o},sL=function(t,e){var n,r;return e=aT(e,t),n=t,null==(t=(r=e).length<2?n:aP(n,sT(r,0,-1)))||delete t[aZ(sM(e))]},sZ=Object.prototype,sP=Function.prototype.toString,sO=sZ.hasOwnProperty,sR=sP.call(Object),sI=function(t){if(!X(t)||"[object Object]"!=q(t))return!1;var e=rL(t);if(null===e)return!0;var n=sO.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&sP.call(n)==sR},sD=function(t){return sI(t)?void 0:t},sN=B?B.isConcatSpreadable:void 0,sz=function(t){return tf(t)||nE(t)||!!(sN&&t&&t[sN])},sj=function t(e,n,r,i,o){var a=-1,s=e.length;for(r||(r=sz),o||(o=[]);++a<s;){var u=e[a];n>0&&r(u)?n>1?t(u,n-1,r,i,o):nd(o,u):i||(o[o.length]=u)}return o},sB=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},sF=Math.max,sU=function(t,e,n){return e=sF(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=sF(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),sB(t,this,s)}},sV=Date.now,sH=(m=rv?function(t,e){return rv(t,"toString",{configurable:!0,enumerable:!1,value:function(){return e},writable:!0})}:aD,g=0,y=0,function(){var t=sV(),e=16-(t-y);if(y=t,e>0){if(++g>=800)return arguments[0]}else g=0;return m.apply(void 0,arguments)}),sG=sH(sU(b=function(t,e){var n={};if(null==t)return n;var r=!1;e=tl(e,function(e){return e=aT(e,t),r||(r=e.length>1),e}),rb(t,rP(t),n),r&&(n=rJ(n,7,sD));for(var i=e.length;i--;)sL(n,e[i]);return n},void 0,function(t){return(null==t?0:t.length)?sj(t,1):[]}),b+""),sW=n(14749),sY=n(63787),sq=n(50833),sX=n(5239),sK=n(80406),s$=n(6787),sQ=n(6976),sJ=n(44329),s0=n(53850),s1=n(24800),s2=n(76158),s3=n(4295),s5=n(74084),s4=function(t){var e=t.className,n=t.customizeIcon,r=t.customizeIconProps,i=t.children,o=t.onMouseDown,a=t.onClick,s="function"==typeof n?n(r):n;return Z.createElement("span",{className:e,onMouseDown:function(t){t.preventDefault(),null==o||o(t)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:a,"aria-hidden":!0},void 0!==s?s:Z.createElement("span",{className:D()(e.split(/\s+/).map(function(t){return"".concat(t,"-icon")}))},i))},s7=function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=Z.useMemo(function(){return"object"===(0,sQ.Z)(r)?r.clearIcon:i||void 0},[r,i]);return{allowClear:Z.useMemo(function(){return!o&&!!r&&(!!n.length||!!a)&&!("combobox"===s&&""===a)},[r,o,n.length,a,s]),clearIcon:Z.createElement(s4,{className:"".concat(t,"-clear"),onMouseDown:e,customizeIcon:u},"\xd7")}},s6=Z.createContext(null);function s8(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250,e=Z.useRef(null),n=Z.useRef(null);return Z.useEffect(function(){return function(){window.clearTimeout(n.current)}},[]),[function(){return e.current},function(r){(r||null===e.current)&&(e.current=r),window.clearTimeout(n.current),n.current=window.setTimeout(function(){e.current=null},t)}]}var s9="".concat("accept acceptCharset accessKey action allowFullScreen allowTransparency\n    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge\n    charSet checked classID className colSpan cols content contentEditable contextMenu\n    controls coords crossOrigin data dateTime default defer dir disabled download draggable\n    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder\n    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity\n    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media\n    mediaGroup method min minLength multiple muted name noValidate nonce open\n    optimum pattern placeholder poster preload radioGroup readOnly rel required\n    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected\n    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style\n    summary tabIndex target title type useMap value width wmode wrap"," ").concat("onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown\n    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick\n    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown\n    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel\n    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough\n    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata\n    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError").split(/[\s\n]+/);function ut(t,e){return 0===t.indexOf(e)}function ue(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=!1===n?{aria:!0,data:!0,attr:!0}:!0===n?{aria:!0}:(0,sX.Z)({},n);var r={};return Object.keys(t).forEach(function(n){(e.aria&&("role"===n||ut(n,"aria-"))||e.data&&ut(n,"data-")||e.attr&&s9.includes(n))&&(r[n]=t[n])}),r}var un=n(54739),ur=Z.forwardRef(function(t,e){var n,r=t.prefixCls,i=t.id,o=t.inputElement,a=t.disabled,s=t.tabIndex,u=t.autoFocus,c=t.autoComplete,l=t.editable,f=t.activeDescendantId,h=t.value,p=t.maxLength,d=t.onKeyDown,v=t.onMouseDown,m=t.onChange,g=t.onPaste,y=t.onCompositionStart,b=t.onCompositionEnd,x=t.open,_=t.attrs,S=o||Z.createElement("input",null),w=S,k=w.ref,C=w.props,E=C.onKeyDown,A=C.onChange,M=C.onMouseDown,L=C.onCompositionStart,P=C.onCompositionEnd,O=C.style;return(0,s0.Kp)(!("maxLength"in S.props),"Passing 'maxLength' to input element directly may not work because input in BaseSelect is controlled."),S=Z.cloneElement(S,(0,sX.Z)((0,sX.Z)((0,sX.Z)({type:"search"},C),{},{id:i,ref:(0,s5.sQ)(e,k),disabled:a,tabIndex:s,autoComplete:c||"off",autoFocus:u,className:D()("".concat(r,"-selection-search-input"),null===(n=S)||void 0===n||null===(n=n.props)||void 0===n?void 0:n.className),role:"combobox","aria-expanded":x||!1,"aria-haspopup":"listbox","aria-owns":"".concat(i,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(i,"_list"),"aria-activedescendant":x?f:void 0},_),{},{value:l?h:"",maxLength:p,readOnly:!l,unselectable:l?null:"on",style:(0,sX.Z)((0,sX.Z)({},O),{},{opacity:l?null:0}),onKeyDown:function(t){d(t),E&&E(t)},onMouseDown:function(t){v(t),M&&M(t)},onChange:function(t){m(t),A&&A(t)},onCompositionStart:function(t){y(t),L&&L(t)},onCompositionEnd:function(t){b(t),P&&P(t)},onPaste:g}))});function ui(t){return Array.isArray(t)?t:void 0!==t?[t]:[]}var uo="undefined"!=typeof window&&window.document&&window.document.documentElement;function ua(t){return["string","number"].includes((0,sQ.Z)(t))}function us(t){var e=void 0;return t&&(ua(t.title)?e=t.title.toString():ua(t.label)&&(e=t.label.toString())),e}function uu(t){var e;return null!==(e=t.key)&&void 0!==e?e:t.value}var uc=function(t){t.preventDefault(),t.stopPropagation()},ul=function(t){var e,n,r=t.id,i=t.prefixCls,o=t.values,a=t.open,s=t.searchValue,u=t.autoClearSearchValue,c=t.inputRef,l=t.placeholder,f=t.disabled,h=t.mode,p=t.showSearch,d=t.autoFocus,v=t.autoComplete,m=t.activeDescendantId,g=t.tabIndex,y=t.removeIcon,b=t.maxTagCount,x=t.maxTagTextLength,_=t.maxTagPlaceholder,S=void 0===_?function(t){return"+ ".concat(t.length," ...")}:_,w=t.tagRender,k=t.onToggleOpen,C=t.onRemove,E=t.onInputChange,A=t.onInputPaste,M=t.onInputKeyDown,L=t.onInputMouseDown,P=t.onInputCompositionStart,O=t.onInputCompositionEnd,R=Z.useRef(null),I=(0,Z.useState)(0),N=(0,sK.Z)(I,2),z=N[0],j=N[1],B=(0,Z.useState)(!1),F=(0,sK.Z)(B,2),U=F[0],V=F[1],H="".concat(i,"-selection"),G=a||"multiple"===h&&!1===u||"tags"===h?s:"",W="tags"===h||"multiple"===h&&!1===u||p&&(a||U);e=function(){j(R.current.scrollWidth)},n=[G],uo?Z.useLayoutEffect(e,n):Z.useEffect(e,n);var Y=function(t,e,n,r,i){return Z.createElement("span",{title:us(t),className:D()("".concat(H,"-item"),(0,sq.Z)({},"".concat(H,"-item-disabled"),n))},Z.createElement("span",{className:"".concat(H,"-item-content")},e),r&&Z.createElement(s4,{className:"".concat(H,"-item-remove"),onMouseDown:uc,onClick:i,customizeIcon:y},"\xd7"))},q=Z.createElement("div",{className:"".concat(H,"-search"),style:{width:z},onFocus:function(){V(!0)},onBlur:function(){V(!1)}},Z.createElement(ur,{ref:c,open:a,prefixCls:i,id:r,inputElement:null,disabled:f,autoFocus:d,autoComplete:v,editable:W,activeDescendantId:m,value:G,onKeyDown:M,onMouseDown:L,onChange:E,onPaste:A,onCompositionStart:P,onCompositionEnd:O,tabIndex:g,attrs:ue(t,!0)}),Z.createElement("span",{ref:R,className:"".concat(H,"-search-mirror"),"aria-hidden":!0},G,"\xa0")),X=Z.createElement(un.Z,{prefixCls:"".concat(H,"-overflow"),data:o,renderItem:function(t){var e,n=t.disabled,r=t.label,i=t.value,o=!f&&!n,s=r;if("number"==typeof x&&("string"==typeof r||"number"==typeof r)){var u=String(s);u.length>x&&(s="".concat(u.slice(0,x),"..."))}var c=function(e){e&&e.stopPropagation(),C(t)};return"function"==typeof w?(e=s,Z.createElement("span",{onMouseDown:function(t){uc(t),k(!a)}},w({label:e,value:i,disabled:n,closable:o,onClose:c}))):Y(t,s,n,o,c)},renderRest:function(t){var e="function"==typeof S?S(t):S;return Y({title:e},e,!1)},suffix:q,itemKey:uu,maxCount:b});return Z.createElement(Z.Fragment,null,X,!o.length&&!G&&Z.createElement("span",{className:"".concat(H,"-placeholder")},l))},uf=function(t){var e=t.inputElement,n=t.prefixCls,r=t.id,i=t.inputRef,o=t.disabled,a=t.autoFocus,s=t.autoComplete,u=t.activeDescendantId,c=t.mode,l=t.open,f=t.values,h=t.placeholder,p=t.tabIndex,d=t.showSearch,v=t.searchValue,m=t.activeValue,g=t.maxLength,y=t.onInputKeyDown,b=t.onInputMouseDown,x=t.onInputChange,_=t.onInputPaste,S=t.onInputCompositionStart,w=t.onInputCompositionEnd,k=t.title,C=Z.useState(!1),E=(0,sK.Z)(C,2),A=E[0],M=E[1],L="combobox"===c,P=L||d,O=f[0],R=v||"";L&&m&&!A&&(R=m),Z.useEffect(function(){L&&M(!1)},[L,m]);var I=("combobox"===c||!!l||!!d)&&!!R,D=void 0===k?us(O):k,N=Z.useMemo(function(){return O?null:Z.createElement("span",{className:"".concat(n,"-selection-placeholder"),style:I?{visibility:"hidden"}:void 0},h)},[O,I,h,n]);return Z.createElement(Z.Fragment,null,Z.createElement("span",{className:"".concat(n,"-selection-search")},Z.createElement(ur,{ref:i,prefixCls:n,id:r,open:l,inputElement:e,disabled:o,autoFocus:a,autoComplete:s,editable:P,activeDescendantId:u,value:R,onKeyDown:y,onMouseDown:b,onChange:function(t){M(!0),x(t)},onPaste:_,onCompositionStart:S,onCompositionEnd:w,tabIndex:p,attrs:ue(t,!0),maxLength:L?g:void 0})),!L&&O?Z.createElement("span",{className:"".concat(n,"-selection-item"),title:D,style:I?{visibility:"hidden"}:void 0},O.label):null,N)},uh=Z.forwardRef(function(t,e){var n=(0,Z.useRef)(null),r=(0,Z.useRef)(!1),i=t.prefixCls,o=t.open,a=t.mode,s=t.showSearch,u=t.tokenWithEnter,c=t.autoClearSearchValue,l=t.onSearch,f=t.onSearchSubmit,h=t.onToggleOpen,p=t.onInputKeyDown,d=t.domRef;Z.useImperativeHandle(e,function(){return{focus:function(t){n.current.focus(t)},blur:function(){n.current.blur()}}});var v=s8(0),m=(0,sK.Z)(v,2),g=m[0],y=m[1],b=(0,Z.useRef)(null),x=function(t){!1!==l(t,!0,r.current)&&h(!0)},_={inputRef:n,onInputKeyDown:function(t){var e=t.which;(e===s3.Z.UP||e===s3.Z.DOWN)&&t.preventDefault(),p&&p(t),e!==s3.Z.ENTER||"tags"!==a||r.current||o||null==f||f(t.target.value),[s3.Z.ESC,s3.Z.SHIFT,s3.Z.BACKSPACE,s3.Z.TAB,s3.Z.WIN_KEY,s3.Z.ALT,s3.Z.META,s3.Z.WIN_KEY_RIGHT,s3.Z.CTRL,s3.Z.SEMICOLON,s3.Z.EQUALS,s3.Z.CAPS_LOCK,s3.Z.CONTEXT_MENU,s3.Z.F1,s3.Z.F2,s3.Z.F3,s3.Z.F4,s3.Z.F5,s3.Z.F6,s3.Z.F7,s3.Z.F8,s3.Z.F9,s3.Z.F10,s3.Z.F11,s3.Z.F12].includes(e)||h(!0)},onInputMouseDown:function(){y(!0)},onInputChange:function(t){var e=t.target.value;if(u&&b.current&&/[\r\n]/.test(b.current)){var n=b.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");e=e.replace(n,b.current)}b.current=null,x(e)},onInputPaste:function(t){var e=t.clipboardData,n=null==e?void 0:e.getData("text");b.current=n||""},onInputCompositionStart:function(){r.current=!0},onInputCompositionEnd:function(t){r.current=!1,"combobox"!==a&&x(t.target.value)}},S="multiple"===a||"tags"===a?Z.createElement(ul,(0,sW.Z)({},t,_)):Z.createElement(uf,(0,sW.Z)({},t,_));return Z.createElement("div",{ref:d,className:"".concat(i,"-selector"),onClick:function(t){t.target!==n.current&&(void 0!==document.body.style.msTouchAction?setTimeout(function(){n.current.focus()}):n.current.focus())},onMouseDown:function(t){var e=g();t.target===n.current||e||"combobox"===a||t.preventDefault(),("combobox"===a||s&&e)&&o||(o&&!1!==c&&l("",!0,!1),h())}},S)}),up=n(98212),ud=["prefixCls","disabled","visible","children","popupElement","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","builtinPlacements","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],uv=function(t){var e=!0===t?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:e,adjustY:1},htmlRegion:"scroll"},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:e,adjustY:1},htmlRegion:"scroll"},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:e,adjustY:1},htmlRegion:"scroll"},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:e,adjustY:1},htmlRegion:"scroll"}}},um=Z.forwardRef(function(t,e){var n=t.prefixCls,r=(t.disabled,t.visible),i=t.children,o=t.popupElement,a=t.animation,s=t.transitionName,u=t.dropdownStyle,c=t.dropdownClassName,l=t.direction,f=t.placement,h=t.builtinPlacements,p=t.dropdownMatchSelectWidth,d=t.dropdownRender,v=t.dropdownAlign,m=t.getPopupContainer,g=t.empty,y=t.getTriggerDOMNode,b=t.onPopupVisibleChange,x=t.onPopupMouseEnter,_=(0,s$.Z)(t,ud),S="".concat(n,"-dropdown"),w=o;d&&(w=d(o));var k=Z.useMemo(function(){return h||uv(p)},[h,p]),C=a?"".concat(S,"-").concat(a):s,E="number"==typeof p,A=Z.useMemo(function(){return E?null:!1===p?"minWidth":"width"},[p,E]),M=u;E&&(M=(0,sX.Z)((0,sX.Z)({},M),{},{width:p}));var L=Z.useRef(null);return Z.useImperativeHandle(e,function(){return{getPopupElement:function(){return L.current}}}),Z.createElement(up.Z,(0,sW.Z)({},_,{showAction:b?["click"]:[],hideAction:b?["click"]:[],popupPlacement:f||("rtl"===(void 0===l?"ltr":l)?"bottomRight":"bottomLeft"),builtinPlacements:k,prefixCls:S,popupTransitionName:C,popup:Z.createElement("div",{ref:L,onMouseEnter:x},w),stretch:A,popupAlign:v,popupVisible:r,getPopupContainer:m,popupClassName:D()(c,(0,sq.Z)({},"".concat(S,"-empty"),g)),popupStyle:M,getTriggerDOMNode:y,onPopupVisibleChange:b}),i)}),ug=n(19065),uy=n(58194),ub=n(76057),ux=n(93319);function u_(t,e){var n,r=t.key;return("value"in t&&(n=t.value),null!=r)?r:void 0!==n?n:"rc-index-key-".concat(e)}function uS(t){return void 0!==t&&!Number.isNaN(t)}function uw(t,e){var n=t||{},r=n.label,i=n.value,o=n.options,a=n.groupLabel,s=r||(e?"children":"label");return{label:s,value:i||"value",options:o||"options",groupLabel:a||s}}function uk(t){var e=(0,sX.Z)({},t);return"props"in e||Object.defineProperty(e,"props",{get:function(){return(0,s0.ZP)(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),e}}),e}var uC=function(t,e,n){if(!e||!e.length)return null;var r=!1,i=function t(e,n){var i=(0,ug.Z)(n)||(0,uy.Z)(n)||(0,ub.Z)(n)||(0,ux.Z)(),o=i[0],a=i.slice(1);if(!o)return[e];var s=e.split(o);return r=r||s.length>1,s.reduce(function(e,n){return[].concat((0,sY.Z)(e),(0,sY.Z)(t(n,a)))},[]).filter(Boolean)}(t,e);return r?void 0!==n?i.slice(0,n):i:null},uE=Z.createContext(null),uA=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],uM=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"],uT=function(t){return"tags"===t||"multiple"===t},uL=Z.forwardRef(function(t,e){var n,r,i,o,a,s,u,c=t.id,l=t.prefixCls,f=t.className,h=t.showSearch,p=t.tagRender,d=t.direction,v=t.omitDomProps,m=t.displayValues,g=t.onDisplayValuesChange,y=t.emptyOptions,b=t.notFoundContent,x=void 0===b?"Not Found":b,_=t.onClear,S=t.mode,w=t.disabled,k=t.loading,C=t.getInputElement,E=t.getRawInputElement,A=t.open,M=t.defaultOpen,L=t.onDropdownVisibleChange,P=t.activeValue,O=t.onActiveValueChange,R=t.activeDescendantId,I=t.searchValue,N=t.autoClearSearchValue,z=t.onSearch,j=t.onSearchSplit,B=t.tokenSeparators,F=t.allowClear,U=t.suffixIcon,V=t.clearIcon,H=t.OptionList,G=t.animation,W=t.transitionName,Y=t.dropdownStyle,q=t.dropdownClassName,X=t.dropdownMatchSelectWidth,K=t.dropdownRender,$=t.dropdownAlign,Q=t.placement,J=t.builtinPlacements,tt=t.getPopupContainer,te=t.showAction,tn=void 0===te?[]:te,tr=t.onFocus,ti=t.onBlur,to=t.onKeyUp,ta=t.onKeyDown,ts=t.onMouseDown,tu=(0,s$.Z)(t,uA),tc=uT(S),tl=(void 0!==h?h:tc)||"combobox"===S,tf=(0,sX.Z)({},tu);uM.forEach(function(t){delete tf[t]}),null==v||v.forEach(function(t){delete tf[t]});var th=Z.useState(!1),tp=(0,sK.Z)(th,2),td=tp[0],tv=tp[1];Z.useEffect(function(){tv((0,s2.Z)())},[]);var tm=Z.useRef(null),tg=Z.useRef(null),ty=Z.useRef(null),tb=Z.useRef(null),tx=Z.useRef(null),t_=Z.useRef(!1),tS=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=Z.useState(!1),n=(0,sK.Z)(e,2),r=n[0],i=n[1],o=Z.useRef(null),a=function(){window.clearTimeout(o.current)};return Z.useEffect(function(){return a},[]),[r,function(e,n){a(),o.current=window.setTimeout(function(){i(e),n&&n()},t)},a]}(),tw=(0,sK.Z)(tS,3),tk=tw[0],tC=tw[1],tE=tw[2];Z.useImperativeHandle(e,function(){var t,e;return{focus:null===(t=tb.current)||void 0===t?void 0:t.focus,blur:null===(e=tb.current)||void 0===e?void 0:e.blur,scrollTo:function(t){var e;return null===(e=tx.current)||void 0===e?void 0:e.scrollTo(t)}}});var tA=Z.useMemo(function(){if("combobox"!==S)return I;var t,e=null===(t=m[0])||void 0===t?void 0:t.value;return"string"==typeof e||"number"==typeof e?String(e):""},[I,S,m]),tM="combobox"===S&&"function"==typeof C&&C()||null,tT="function"==typeof E&&E(),tL=(0,s5.x1)(tg,null==tT||null===(o=tT.props)||void 0===o?void 0:o.ref),tZ=Z.useState(!1),tP=(0,sK.Z)(tZ,2),tO=tP[0],tR=tP[1];(0,s1.Z)(function(){tR(!0)},[]);var tI=(0,sJ.Z)(!1,{defaultValue:M,value:A}),tD=(0,sK.Z)(tI,2),tN=tD[0],tz=tD[1],tj=!!tO&&tN,tB=!x&&y;(w||tB&&tj&&"combobox"===S)&&(tj=!1);var tF=!tB&&tj,tU=Z.useCallback(function(t){var e=void 0!==t?t:!tj;w||(tz(e),tj!==e&&(null==L||L(e)))},[w,tj,tz,L]),tV=Z.useMemo(function(){return(B||[]).some(function(t){return["\n","\r\n"].includes(t)})},[B]),tH=Z.useContext(uE)||{},tG=tH.maxCount,tW=tH.rawValues,tY=function(t,e,n){if(!(tc&&uS(tG))||!((null==tW?void 0:tW.size)>=tG)){var r=!0,i=t;null==O||O(null);var o=uC(t,B,uS(tG)?tG-tW.size:void 0),a=n?null:o;return"combobox"!==S&&a&&(i="",null==j||j(a),tU(!1),r=!1),z&&tA!==i&&z(i,{source:e?"typing":"effect"}),r}};Z.useEffect(function(){tj||tc||"combobox"===S||tY("",!1,!1)},[tj]),Z.useEffect(function(){tN&&w&&tz(!1),w&&!t_.current&&tC(!1)},[w]);var tq=s8(),tX=(0,sK.Z)(tq,2),tK=tX[0],t$=tX[1],tQ=Z.useRef(!1),tJ=[];Z.useEffect(function(){return function(){tJ.forEach(function(t){return clearTimeout(t)}),tJ.splice(0,tJ.length)}},[]);var t0=Z.useState({}),t1=(0,sK.Z)(t0,2)[1];tT&&(a=function(t){tU(t)}),n=function(){var t;return[tm.current,null===(t=ty.current)||void 0===t?void 0:t.getPopupElement()]},r=!!tT,(i=Z.useRef(null)).current={open:tF,triggerOpen:tU,customizedTrigger:r},Z.useEffect(function(){function t(t){if(null===(e=i.current)||void 0===e||!e.customizedTrigger){var e,r=t.target;r.shadowRoot&&t.composed&&(r=t.composedPath()[0]||r),i.current.open&&n().filter(function(t){return t}).every(function(t){return!t.contains(r)&&t!==r})&&i.current.triggerOpen(!1)}}return window.addEventListener("mousedown",t),function(){return window.removeEventListener("mousedown",t)}},[]);var t2=Z.useMemo(function(){return(0,sX.Z)((0,sX.Z)({},t),{},{notFoundContent:x,open:tj,triggerOpen:tF,id:c,showSearch:tl,multiple:tc,toggleOpen:tU})},[t,x,tF,tj,c,tl,tc,tU]),t3=!!U||k;t3&&(s=Z.createElement(s4,{className:D()("".concat(l,"-arrow"),(0,sq.Z)({},"".concat(l,"-arrow-loading"),k)),customizeIcon:U,customizeIconProps:{loading:k,searchValue:tA,open:tj,focused:tk,showSearch:tl}}));var t5=s7(l,function(){var t;null==_||_(),null===(t=tb.current)||void 0===t||t.focus(),g([],{type:"clear",values:m}),tY("",!1,!1)},m,F,V,w,tA,S),t4=t5.allowClear,t7=t5.clearIcon,t6=Z.createElement(H,{ref:tx}),t8=D()(l,f,(0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)({},"".concat(l,"-focused"),tk),"".concat(l,"-multiple"),tc),"".concat(l,"-single"),!tc),"".concat(l,"-allow-clear"),F),"".concat(l,"-show-arrow"),t3),"".concat(l,"-disabled"),w),"".concat(l,"-loading"),k),"".concat(l,"-open"),tj),"".concat(l,"-customize-input"),tM),"".concat(l,"-show-search"),tl)),t9=Z.createElement(um,{ref:ty,disabled:w,prefixCls:l,visible:tF,popupElement:t6,animation:G,transitionName:W,dropdownStyle:Y,dropdownClassName:q,direction:d,dropdownMatchSelectWidth:X,dropdownRender:K,dropdownAlign:$,placement:Q,builtinPlacements:J,getPopupContainer:tt,empty:y,getTriggerDOMNode:function(){return tg.current},onPopupVisibleChange:a,onPopupMouseEnter:function(){t1({})}},tT?Z.cloneElement(tT,{ref:tL}):Z.createElement(uh,(0,sW.Z)({},t,{domRef:tg,prefixCls:l,inputElement:tM,ref:tb,id:c,showSearch:tl,autoClearSearchValue:N,mode:S,activeDescendantId:R,tagRender:p,values:m,open:tj,onToggleOpen:tU,activeValue:P,searchValue:tA,onSearch:tY,onSearchSubmit:function(t){t&&t.trim()&&z(t,{source:"submit"})},onRemove:function(t){g(m.filter(function(e){return e!==t}),{type:"remove",values:[t]})},tokenWithEnter:tV})));return u=tT?t9:Z.createElement("div",(0,sW.Z)({className:t8},tf,{ref:tm,onMouseDown:function(t){var e,n=t.target,r=null===(e=ty.current)||void 0===e?void 0:e.getPopupElement();if(r&&r.contains(n)){var i=setTimeout(function(){var t,e=tJ.indexOf(i);-1!==e&&tJ.splice(e,1),tE(),td||r.contains(document.activeElement)||null===(t=tb.current)||void 0===t||t.focus()});tJ.push(i)}for(var o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];null==ts||ts.apply(void 0,[t].concat(a))},onKeyDown:function(t){var e,n=tK(),r=t.which;if(r!==s3.Z.ENTER||("combobox"!==S&&t.preventDefault(),tj||tU(!0)),t$(!!tA),r===s3.Z.BACKSPACE&&!n&&tc&&!tA&&m.length){for(var i=(0,sY.Z)(m),o=null,a=i.length-1;a>=0;a-=1){var s=i[a];if(!s.disabled){i.splice(a,1),o=s;break}}o&&g(i,{type:"remove",values:[o]})}for(var u=arguments.length,c=Array(u>1?u-1:0),l=1;l<u;l++)c[l-1]=arguments[l];tj&&(null===(e=tx.current)||void 0===e||e.onKeyDown.apply(e,[t].concat(c))),null==ta||ta.apply(void 0,[t].concat(c))},onKeyUp:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];tj&&(null===(e=tx.current)||void 0===e||e.onKeyUp.apply(e,[t].concat(r))),null==to||to.apply(void 0,[t].concat(r))},onFocus:function(){tC(!0),!w&&(tr&&!tQ.current&&tr.apply(void 0,arguments),tn.includes("focus")&&tU(!0)),tQ.current=!0},onBlur:function(){t_.current=!0,tC(!1,function(){tQ.current=!1,t_.current=!1,tU(!1)}),!w&&(tA&&("tags"===S?z(tA,{source:"submit"}):"multiple"===S&&z("",{source:"blur"})),ti&&ti.apply(void 0,arguments))}}),tk&&!tj&&Z.createElement("span",{"aria-live":"polite",style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},"".concat(m.map(function(t){var e=t.label,n=t.value;return["number","string"].includes((0,sQ.Z)(e))?e:n}).join(", "))),t9,s,t4&&t7),Z.createElement(s6.Provider,{value:t2},u)}),uZ=function(){return null};uZ.isSelectOptGroup=!0;var uP=function(){return null};uP.isSelectOption=!0;var uO=n(61475),uR=n(35704),uI=n(1610),uD=Z.forwardRef(function(t,e){var n=t.height,r=t.offsetY,i=t.offsetX,o=t.children,a=t.prefixCls,s=t.onInnerResize,u=t.innerProps,c=t.rtl,l=t.extra,f={},h={display:"flex",flexDirection:"column"};return void 0!==r&&(f={height:n,position:"relative",overflow:"hidden"},h=(0,sX.Z)((0,sX.Z)({},h),{},(0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)({transform:"translateY(".concat(r,"px)")},c?"marginRight":"marginLeft",-i),"position","absolute"),"left",0),"right",0),"top",0))),Z.createElement("div",{style:f},Z.createElement(uI.Z,{onResize:function(t){t.offsetHeight&&s&&s()}},Z.createElement("div",(0,sW.Z)({style:h,className:D()((0,sq.Z)({},"".concat(a,"-holder-inner"),a)),ref:e},u),o,l)))});uD.displayName="Filler";var uN=n(19223);function uz(t,e){return("touches"in t?t.touches[0]:t)[e?"pageX":"pageY"]}var uj=Z.forwardRef(function(t,e){var n=t.prefixCls,r=t.rtl,i=t.scrollOffset,o=t.scrollRange,a=t.onStartMove,s=t.onStopMove,u=t.onScroll,c=t.horizontal,l=t.spinSize,f=t.containerSize,h=t.style,p=t.thumbStyle,d=Z.useState(!1),v=(0,sK.Z)(d,2),m=v[0],g=v[1],y=Z.useState(null),b=(0,sK.Z)(y,2),x=b[0],_=b[1],S=Z.useState(null),w=(0,sK.Z)(S,2),k=w[0],C=w[1],E=!r,A=Z.useRef(),M=Z.useRef(),L=Z.useState(!1),P=(0,sK.Z)(L,2),O=P[0],R=P[1],I=Z.useRef(),N=function(){clearTimeout(I.current),R(!0),I.current=setTimeout(function(){R(!1)},3e3)},z=o-f||0,j=f-l||0,B=Z.useMemo(function(){return 0===i||0===z?0:i/z*j},[i,z,j]),F=Z.useRef({top:B,dragging:m,pageY:x,startTop:k});F.current={top:B,dragging:m,pageY:x,startTop:k};var U=function(t){g(!0),_(uz(t,c)),C(F.current.top),a(),t.stopPropagation(),t.preventDefault()};Z.useEffect(function(){var t=function(t){t.preventDefault()},e=A.current,n=M.current;return e.addEventListener("touchstart",t),n.addEventListener("touchstart",U),function(){e.removeEventListener("touchstart",t),n.removeEventListener("touchstart",U)}},[]);var V=Z.useRef();V.current=z;var H=Z.useRef();H.current=j,Z.useEffect(function(){if(m){var t,e=function(e){var n=F.current,r=n.dragging,i=n.pageY,o=n.startTop;if(uN.Z.cancel(t),r){var a=uz(e,c)-i,s=o;!E&&c?s-=a:s+=a;var l=V.current,f=H.current,h=Math.ceil((f?s/f:0)*l);h=Math.min(h=Math.max(h,0),l),t=(0,uN.Z)(function(){u(h,c)})}},n=function(){g(!1),s()};return window.addEventListener("mousemove",e),window.addEventListener("touchmove",e),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),function(){window.removeEventListener("mousemove",e),window.removeEventListener("touchmove",e),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),uN.Z.cancel(t)}}},[m]),Z.useEffect(function(){N()},[i]),Z.useImperativeHandle(e,function(){return{delayHidden:N}});var G="".concat(n,"-scrollbar"),W={position:"absolute",visibility:O?null:"hidden"},Y={position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"};return c?(W.height=8,W.left=0,W.right=0,W.bottom=0,Y.height="100%",Y.width=l,E?Y.left=B:Y.right=B):(W.width=8,W.top=0,W.bottom=0,E?W.right=0:W.left=0,Y.width="100%",Y.height=l,Y.top=B),Z.createElement("div",{ref:A,className:D()(G,(0,sq.Z)((0,sq.Z)((0,sq.Z)({},"".concat(G,"-horizontal"),c),"".concat(G,"-vertical"),!c),"".concat(G,"-visible"),O)),style:(0,sX.Z)((0,sX.Z)({},W),h),onMouseDown:function(t){t.stopPropagation(),t.preventDefault()},onMouseMove:N},Z.createElement("div",{ref:M,className:D()("".concat(G,"-thumb"),(0,sq.Z)({},"".concat(G,"-thumb-moving"),m)),style:(0,sX.Z)((0,sX.Z)({},Y),p),onMouseDown:U}))});function uB(t){var e=t.children,n=t.setRef,r=Z.useCallback(function(t){n(t)},[]);return Z.cloneElement(e,{ref:r})}var uF=n(97472),uU=n(47365),uV=n(65127),uH=function(){function t(){(0,uU.Z)(this,t),(0,sq.Z)(this,"maps",void 0),(0,sq.Z)(this,"id",0),this.maps=Object.create(null)}return(0,uV.Z)(t,[{key:"set",value:function(t,e){this.maps[t]=e,this.id+=1}},{key:"get",value:function(t){return this.maps[t]}}]),t}(),uG=n(55254),uW=("undefined"==typeof navigator?"undefined":(0,sQ.Z)(navigator))==="object"&&/Firefox/i.test(navigator.userAgent),uY=function(t,e){var n=(0,Z.useRef)(!1),r=(0,Z.useRef)(null),i=(0,Z.useRef)({top:t,bottom:e});return i.current.top=t,i.current.bottom=e,function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=t<0&&i.current.top||t>0&&i.current.bottom;return e&&o?(clearTimeout(r.current),n.current=!1):(!o||n.current)&&(clearTimeout(r.current),n.current=!0,r.current=setTimeout(function(){n.current=!1},50)),!n.current&&o}},uq=14/15;function uX(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t/e*t;return isNaN(n)&&(n=0),Math.floor(n=Math.max(n,20))}var uK=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles"],u$=[],uQ={overflowY:"auto",overflowAnchor:"none"},uJ=Z.forwardRef(function(t,e){var n,r,i,o,a,s,u,c,l,f,h,p,d,v,m,g,y,b,x,_,S,w,k,C,E,A,M,L,P,O,R,I,N,z,j,B=t.prefixCls,F=void 0===B?"rc-virtual-list":B,U=t.className,V=t.height,H=t.itemHeight,G=t.fullHeight,W=t.style,Y=t.data,q=t.children,X=t.itemKey,K=t.virtual,$=t.direction,Q=t.scrollWidth,J=t.component,tt=t.onScroll,te=t.onVirtualScroll,tn=t.onVisibleChange,tr=t.innerProps,ti=t.extraRender,to=t.styles,ta=(0,s$.Z)(t,uK),ts=!!(!1!==K&&V&&H),tu=ts&&Y&&(H*Y.length>V||!!Q),tc="rtl"===$,tl=D()(F,(0,sq.Z)({},"".concat(F,"-rtl"),tc),U),tf=Y||u$,th=(0,Z.useRef)(),tp=(0,Z.useRef)(),td=(0,Z.useState)(0),tv=(0,sK.Z)(td,2),tm=tv[0],tg=tv[1],ty=(0,Z.useState)(0),tb=(0,sK.Z)(ty,2),tx=tb[0],t_=tb[1],tS=(0,Z.useState)(!1),tw=(0,sK.Z)(tS,2),tk=tw[0],tC=tw[1],tE=function(){tC(!0)},tA=function(){tC(!1)},tM=Z.useCallback(function(t){return"function"==typeof X?X(t):null==t?void 0:t[X]},[X]);function tT(t){tg(function(e){var n,r=(n="function"==typeof t?t(e):t,Number.isNaN(t0.current)||(n=Math.min(n,t0.current)),n=Math.max(n,0));return th.current.scrollTop=r,r})}var tL=(0,Z.useRef)({start:0,end:tf.length}),tZ=(0,Z.useRef)(),tP=(r=Z.useState(tf),o=(i=(0,sK.Z)(r,2))[0],a=i[1],s=Z.useState(null),c=(u=(0,sK.Z)(s,2))[0],l=u[1],Z.useEffect(function(){var t=function(t,e,n){var r,i,o=t.length,a=e.length;if(0===o&&0===a)return null;o<a?(r=t,i=e):(r=e,i=t);var s={__EMPTY_ITEM__:!0};function u(t){return void 0!==t?n(t):s}for(var c=null,l=1!==Math.abs(o-a),f=0;f<i.length;f+=1){var h=u(r[f]);if(h!==u(i[f])){c=f,l=l||h!==u(i[f+1]);break}}return null===c?null:{index:c,multiple:l}}(o||[],tf||[],tM);(null==t?void 0:t.index)!==void 0&&(null==n||n(t.index),l(tf[t.index])),a(tf)},[tf]),[c]),tO=(0,sK.Z)(tP,1)[0];tZ.current=tO;var tR=function(t,e,n){var r=Z.useState(0),i=(0,sK.Z)(r,2),o=i[0],a=i[1],s=(0,Z.useRef)(new Map),u=(0,Z.useRef)(new uH),c=(0,Z.useRef)();function l(){uN.Z.cancel(c.current)}function f(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l();var e=function(){s.current.forEach(function(t,e){if(t&&t.offsetParent){var n=(0,uF.Z)(t),r=n.offsetHeight;u.current.get(e)!==r&&u.current.set(e,n.offsetHeight)}}),a(function(t){return t+1})};t?e():c.current=(0,uN.Z)(e)}return(0,Z.useEffect)(function(){return l},[]),[function(r,i){var o=t(r),a=s.current.get(o);i?(s.current.set(o,i),f()):s.current.delete(o),!a!=!i&&(i?null==e||e(r):null==n||n(r))},f,u.current,o]}(tM,null,null),tI=(0,sK.Z)(tR,4),tD=tI[0],tN=tI[1],tz=tI[2],tj=tI[3],tB=Z.useMemo(function(){if(!ts)return{scrollHeight:void 0,start:0,end:tf.length-1,offset:void 0};if(!tu)return{scrollHeight:(null===(t=tp.current)||void 0===t?void 0:t.offsetHeight)||0,start:0,end:tf.length-1,offset:void 0};for(var t,e,n,r,i=0,o=tf.length,a=0;a<o;a+=1){var s=tM(tf[a]),u=tz.get(s),c=i+(void 0===u?H:u);c>=tm&&void 0===e&&(e=a,n=i),c>tm+V&&void 0===r&&(r=a),i=c}return void 0===e&&(e=0,n=0,r=Math.ceil(V/H)),void 0===r&&(r=tf.length-1),{scrollHeight:i,start:e,end:r=Math.min(r+1,tf.length-1),offset:n}},[tu,ts,tm,tf,tj,V]),tF=tB.scrollHeight,tU=tB.start,tV=tB.end,tH=tB.offset;tL.current.start=tU,tL.current.end=tV;var tG=Z.useState({width:0,height:V}),tW=(0,sK.Z)(tG,2),tY=tW[0],tq=tW[1],tX=(0,Z.useRef)(),tK=(0,Z.useRef)(),t$=Z.useMemo(function(){return uX(tY.width,Q)},[tY.width,Q]),tQ=Z.useMemo(function(){return uX(tY.height,tF)},[tY.height,tF]),tJ=tF-V,t0=(0,Z.useRef)(tJ);t0.current=tJ;var t1=tm<=0,t2=tm>=tJ,t3=uY(t1,t2),t5=function(){return{x:tc?-tx:tx,y:tm}},t4=(0,Z.useRef)(t5()),t7=(0,uG.zX)(function(){if(te){var t=t5();(t4.current.x!==t.x||t4.current.y!==t.y)&&(te(t),t4.current=t)}});function t6(t,e){e?((0,av.flushSync)(function(){t_(t)}),t7()):tT(t)}var t8=function(t){var e=t,n=Q-tY.width;return Math.min(e=Math.max(e,0),n)},t9=(0,uG.zX)(function(t,e){e?((0,av.flushSync)(function(){t_(function(e){return t8(e+(tc?-t:t))})}),t7()):tT(function(e){return e+t})}),et=(f=!!Q,h=(0,Z.useRef)(0),p=(0,Z.useRef)(null),d=(0,Z.useRef)(null),v=(0,Z.useRef)(!1),m=uY(t1,t2),g=(0,Z.useRef)(null),y=(0,Z.useRef)(null),[function(t){if(ts){uN.Z.cancel(y.current),y.current=(0,uN.Z)(function(){g.current=null},2);var e,n=t.deltaX,r=t.deltaY,i=t.shiftKey,o=n,a=r;("sx"===g.current||!g.current&&i&&r&&!n)&&(o=r,a=0,g.current="sx");var s=Math.abs(o),u=Math.abs(a);(null===g.current&&(g.current=f&&s>u?"x":"y"),"y"===g.current)?(e=a,uN.Z.cancel(p.current),h.current+=e,d.current=e,m(e)||(uW||t.preventDefault(),p.current=(0,uN.Z)(function(){var t=v.current?10:1;t9(h.current*t),h.current=0}))):(t9(o,!0),uW||t.preventDefault())}},function(t){ts&&(v.current=t.detail===d.current)}]),ee=(0,sK.Z)(et,2),en=ee[0],er=ee[1];b=function(t,e){return!t3(t,e)&&(en({preventDefault:function(){},deltaY:t}),!0)},_=(0,Z.useRef)(!1),S=(0,Z.useRef)(0),w=(0,Z.useRef)(null),k=(0,Z.useRef)(null),C=function(t){if(_.current){var e=Math.ceil(t.touches[0].pageY),n=S.current-e;S.current=e,b(n)&&t.preventDefault(),clearInterval(k.current),k.current=setInterval(function(){(!b(n*=uq,!0)||.1>=Math.abs(n))&&clearInterval(k.current)},16)}},E=function(){_.current=!1,x()},A=function(t){x(),1!==t.touches.length||_.current||(_.current=!0,S.current=Math.ceil(t.touches[0].pageY),w.current=t.target,w.current.addEventListener("touchmove",C),w.current.addEventListener("touchend",E))},x=function(){w.current&&(w.current.removeEventListener("touchmove",C),w.current.removeEventListener("touchend",E))},(0,s1.Z)(function(){return ts&&th.current.addEventListener("touchstart",A),function(){var t;null===(t=th.current)||void 0===t||t.removeEventListener("touchstart",A),x(),clearInterval(k.current)}},[ts]),(0,s1.Z)(function(){function t(t){ts&&t.preventDefault()}var e=th.current;return e.addEventListener("wheel",en),e.addEventListener("DOMMouseScroll",er),e.addEventListener("MozMousePixelScroll",t),function(){e.removeEventListener("wheel",en),e.removeEventListener("DOMMouseScroll",er),e.removeEventListener("MozMousePixelScroll",t)}},[ts]),(0,s1.Z)(function(){Q&&t_(function(t){return t8(t)})},[tY.width,Q]);var ei=function(){var t,e;null===(t=tX.current)||void 0===t||t.delayHidden(),null===(e=tK.current)||void 0===e||e.delayHidden()},eo=(M=Z.useRef(),L=Z.useState(null),O=(P=(0,sK.Z)(L,2))[0],R=P[1],(0,s1.Z)(function(){if(O&&O.times<10){if(!th.current){R(function(t){return(0,sX.Z)({},t)});return}tN(!0);var t=O.targetAlign,e=O.originAlign,n=O.index,r=O.offset,i=th.current.clientHeight,o=!1,a=t,s=null;if(i){for(var u=t||e,c=0,l=0,f=0,h=Math.min(tf.length-1,n),p=0;p<=h;p+=1){var d=tM(tf[p]);l=c;var v=tz.get(d);c=f=l+(void 0===v?H:v)}for(var m="top"===u?r:i-r,g=h;g>=0;g-=1){var y=tM(tf[g]),b=tz.get(y);if(void 0===b){o=!0;break}if((m-=b)<=0)break}switch(u){case"top":s=l-r;break;case"bottom":s=f-i+r;break;default:var x=th.current.scrollTop;l<x?a="top":f>x+i&&(a="bottom")}null!==s&&tT(s),s!==O.lastTop&&(o=!0)}o&&R((0,sX.Z)((0,sX.Z)({},O),{},{times:O.times+1,targetAlign:a,lastTop:s}))}},[O,th.current]),function(t){if(null==t){ei();return}if(uN.Z.cancel(M.current),"number"==typeof t)tT(t);else if(t&&"object"===(0,sQ.Z)(t)){var e,n=t.align;e="index"in t?t.index:tf.findIndex(function(e){return tM(e)===t.key});var r=t.offset;R({times:0,index:e,offset:void 0===r?0:r,originAlign:n})}});Z.useImperativeHandle(e,function(){return{getScrollInfo:t5,scrollTo:function(t){t&&"object"===(0,sQ.Z)(t)&&("left"in t||"top"in t)?(void 0!==t.left&&t_(t8(t.left)),eo(t.top)):eo(t)}}}),(0,s1.Z)(function(){tn&&tn(tf.slice(tU,tV+1),tf)},[tU,tV,tf]);var ea=(I=Z.useMemo(function(){return[new Map,[]]},[tf,tz.id,H]),z=(N=(0,sK.Z)(I,2))[0],j=N[1],function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=z.get(t),r=z.get(e);if(void 0===n||void 0===r)for(var i=tf.length,o=j.length;o<i;o+=1){var a,s=tM(tf[o]);z.set(s,o);var u=null!==(a=tz.get(s))&&void 0!==a?a:H;if(j[o]=(j[o-1]||0)+u,s===t&&(n=o),s===e&&(r=o),void 0!==n&&void 0!==r)break}return{top:j[n-1]||0,bottom:j[r]}}),es=null==ti?void 0:ti({start:tU,end:tV,virtual:tu,offsetX:tx,offsetY:tH,rtl:tc,getSize:ea}),eu=tf.slice(tU,tV+1).map(function(t,e){var n=q(t,tU+e,{style:{width:Q}}),r=tM(t);return Z.createElement(uB,{key:r,setRef:function(e){return tD(t,e)}},n)}),ec=null;V&&(ec=(0,sX.Z)((0,sq.Z)({},void 0===G||G?"height":"maxHeight",V),uQ),ts&&(ec.overflowY="hidden",Q&&(ec.overflowX="hidden"),tk&&(ec.pointerEvents="none")));var el={};return tc&&(el.dir="rtl"),Z.createElement("div",(0,sW.Z)({style:(0,sX.Z)((0,sX.Z)({},W),{},{position:"relative"}),className:tl},el,ta),Z.createElement(uI.Z,{onResize:function(t){tq({width:t.width||t.offsetWidth,height:t.height||t.offsetHeight})}},Z.createElement(void 0===J?"div":J,{className:"".concat(F,"-holder"),style:ec,ref:th,onScroll:function(t){var e=t.currentTarget.scrollTop;e!==tm&&tT(e),null==tt||tt(t),t7()},onMouseEnter:ei},Z.createElement(uD,{prefixCls:F,height:tF,offsetX:tx,offsetY:tH,scrollWidth:Q,onInnerResize:tN,ref:tp,innerProps:tr,rtl:tc,extra:es},eu))),tu&&tF>V&&Z.createElement(uj,{ref:tX,prefixCls:F,scrollOffset:tm,scrollRange:tF,rtl:tc,onScroll:t6,onStartMove:tE,onStopMove:tA,spinSize:tQ,containerSize:tY.height,style:null==to?void 0:to.verticalScrollBar,thumbStyle:null==to?void 0:to.verticalScrollBarThumb}),tu&&Q>tY.width&&Z.createElement(uj,{ref:tK,prefixCls:F,scrollOffset:tx,scrollRange:Q,rtl:tc,onScroll:t6,onStartMove:tE,onStopMove:tA,spinSize:t$,containerSize:tY.width,horizontal:!0,style:null==to?void 0:to.horizontalScrollBar,thumbStyle:null==to?void 0:to.horizontalScrollBarThumb}))});uJ.displayName="List";var u0=["disabled","title","children","style","className"];function u1(t){return"string"==typeof t||"number"==typeof t}var u2=Z.forwardRef(function(t,e){var n=Z.useContext(s6),r=n.prefixCls,i=n.id,o=n.open,a=n.multiple,s=n.mode,u=n.searchValue,c=n.toggleOpen,l=n.notFoundContent,f=n.onPopupScroll,h=Z.useContext(uE),p=h.maxCount,d=h.flattenOptions,v=h.onActiveValue,m=h.defaultActiveFirstOption,g=h.onSelect,y=h.menuItemSelectedIcon,b=h.rawValues,x=h.fieldNames,_=h.virtual,S=h.direction,w=h.listHeight,k=h.listItemHeight,C=h.optionRender,E="".concat(r,"-item"),A=(0,uO.Z)(function(){return d},[o,d],function(t,e){return e[0]&&t[1]!==e[1]}),M=Z.useRef(null),L=Z.useMemo(function(){return a&&uS(p)&&(null==b?void 0:b.size)>=p},[a,p,null==b?void 0:b.size]),P=function(t){t.preventDefault()},O=function(t){var e;null===(e=M.current)||void 0===e||e.scrollTo("number"==typeof t?{index:t}:t)},R=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=A.length,r=0;r<n;r+=1){var i=(t+r*e+n)%n,o=A[i]||{},a=o.group,s=o.data;if(!a&&!(null!=s&&s.disabled)&&!L)return i}return -1},I=Z.useState(function(){return R(0)}),N=(0,sK.Z)(I,2),z=N[0],j=N[1],B=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];j(t);var n={source:e?"keyboard":"mouse"},r=A[t];if(!r){v(null,-1,n);return}v(r.value,t,n)};(0,Z.useEffect)(function(){B(!1!==m?R(0):-1)},[A.length,u]);var F=Z.useCallback(function(t){return b.has(t)&&"combobox"!==s},[s,(0,sY.Z)(b).toString(),b.size]);(0,Z.useEffect)(function(){var t,e=setTimeout(function(){if(!a&&o&&1===b.size){var t=Array.from(b)[0],e=A.findIndex(function(e){return e.data.value===t});-1!==e&&(B(e),O(e))}});return o&&(null===(t=M.current)||void 0===t||t.scrollTo(void 0)),function(){return clearTimeout(e)}},[o,u]);var U=function(t){void 0!==t&&g(t,{selected:!b.has(t)}),a||c(!1)};if(Z.useImperativeHandle(e,function(){return{onKeyDown:function(t){var e=t.which,n=t.ctrlKey;switch(e){case s3.Z.N:case s3.Z.P:case s3.Z.UP:case s3.Z.DOWN:var r=0;if(e===s3.Z.UP?r=-1:e===s3.Z.DOWN?r=1:/(mac\sos|macintosh)/i.test(navigator.appVersion)&&n&&(e===s3.Z.N?r=1:e===s3.Z.P&&(r=-1)),0!==r){var i=R(z+r,r);O(i),B(i,!0)}break;case s3.Z.ENTER:var a,s=A[z];!s||null!=s&&null!==(a=s.data)&&void 0!==a&&a.disabled||L?U(void 0):U(s.value),o&&t.preventDefault();break;case s3.Z.ESC:c(!1),o&&t.stopPropagation()}},onKeyUp:function(){},scrollTo:function(t){O(t)}}}),0===A.length)return Z.createElement("div",{role:"listbox",id:"".concat(i,"_list"),className:"".concat(E,"-empty"),onMouseDown:P},l);var V=Object.keys(x).map(function(t){return x[t]}),H=function(t){return t.label};function G(t,e){return{role:t.group?"presentation":"option",id:"".concat(i,"_list_").concat(e)}}var W=function(t){var e=A[t];if(!e)return null;var n=e.data||{},r=n.value,i=e.group,o=ue(n,!0),a=H(e);return e?Z.createElement("div",(0,sW.Z)({"aria-label":"string"!=typeof a||i?null:a},o,{key:t},G(e,t),{"aria-selected":F(r)}),r):null},Y={role:"listbox",id:"".concat(i,"_list")};return Z.createElement(Z.Fragment,null,_&&Z.createElement("div",(0,sW.Z)({},Y,{style:{height:0,width:0,overflow:"hidden"}}),W(z-1),W(z),W(z+1)),Z.createElement(uJ,{itemKey:"key",ref:M,data:A,height:w,itemHeight:k,fullHeight:!1,onMouseDown:P,onScroll:f,virtual:_,direction:S,innerProps:_?null:Y},function(t,e){var n=t.group,r=t.groupOption,i=t.data,o=t.label,a=t.value,s=i.key;if(n){var u,c=null!==(u=i.title)&&void 0!==u?u:u1(o)?o.toString():void 0;return Z.createElement("div",{className:D()(E,"".concat(E,"-group"),i.className),title:c},void 0!==o?o:s)}var l=i.disabled,f=i.title,h=(i.children,i.style),p=i.className,d=(0,s$.Z)(i,u0),v=(0,uR.Z)(d,V),m=F(a),g=l||!m&&L,b="".concat(E,"-option"),x=D()(E,b,p,(0,sq.Z)((0,sq.Z)((0,sq.Z)((0,sq.Z)({},"".concat(b,"-grouped"),r),"".concat(b,"-active"),z===e&&!g),"".concat(b,"-disabled"),g),"".concat(b,"-selected"),m)),S=H(t),w=!y||"function"==typeof y||m,k="number"==typeof S?S:S||a,A=u1(k)?k.toString():void 0;return void 0!==f&&(A=f),Z.createElement("div",(0,sW.Z)({},ue(v),_?{}:G(t,e),{"aria-selected":m,className:x,title:A,onMouseMove:function(){z===e||g||B(e)},onClick:function(){g||U(a)},style:h}),Z.createElement("div",{className:"".concat(b,"-content")},"function"==typeof C?C(t,{index:e}):k),Z.isValidElement(y)||m,w&&Z.createElement(s4,{className:"".concat(E,"-option-state"),customizeIcon:y,customizeIconProps:{value:a,disabled:g,isSelected:m}},m?"✓":null))}))}),u3=function(t,e){var n=Z.useRef({values:new Map,options:new Map});return[Z.useMemo(function(){var r=n.current,i=r.values,o=r.options,a=t.map(function(t){if(void 0===t.label){var e;return(0,sX.Z)((0,sX.Z)({},t),{},{label:null===(e=i.get(t.value))||void 0===e?void 0:e.label})}return t}),s=new Map,u=new Map;return a.forEach(function(t){s.set(t.value,t),u.set(t.value,e.get(t.value)||o.get(t.value))}),n.current.values=s,n.current.options=u,a},[t,e]),Z.useCallback(function(t){return e.get(t)||n.current.options.get(t)},[e])]};function u5(t,e){return ui(t).join("").toUpperCase().includes(e)}var u4=n(22127),u7=0,u6=(0,u4.Z)(),u8=n(33054),u9=["children","value"],ct=["children"];function ce(t){var e=Z.useRef();return e.current=t,Z.useCallback(function(){return e.current.apply(e,arguments)},[])}var cn=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","labelRender","value","defaultValue","labelInValue","onChange","maxCount"],cr=["inputValue"],ci=Z.forwardRef(function(t,e){var n,r,i,o,a,s=t.id,u=t.mode,c=t.prefixCls,l=t.backfill,f=t.fieldNames,h=t.inputValue,p=t.searchValue,d=t.onSearch,v=t.autoClearSearchValue,m=void 0===v||v,g=t.onSelect,y=t.onDeselect,b=t.dropdownMatchSelectWidth,x=void 0===b||b,_=t.filterOption,S=t.filterSort,w=t.optionFilterProp,k=t.optionLabelProp,C=t.options,E=t.optionRender,A=t.children,M=t.defaultActiveFirstOption,L=t.menuItemSelectedIcon,P=t.virtual,O=t.direction,R=t.listHeight,I=void 0===R?200:R,D=t.listItemHeight,N=void 0===D?20:D,z=t.labelRender,j=t.value,B=t.defaultValue,F=t.labelInValue,U=t.onChange,V=t.maxCount,H=(0,s$.Z)(t,cn),G=(n=Z.useState(),i=(r=(0,sK.Z)(n,2))[0],o=r[1],Z.useEffect(function(){var t;o("rc_select_".concat((u6?(t=u7,u7+=1):t="TEST_OR_SSR",t)))},[]),s||i),W=uT(u),Y=!!(!C&&A),q=Z.useMemo(function(){return(void 0!==_||"combobox"!==u)&&_},[_,u]),X=Z.useMemo(function(){return uw(f,Y)},[JSON.stringify(f),Y]),K=(0,sJ.Z)("",{value:void 0!==p?p:h,postState:function(t){return t||""}}),$=(0,sK.Z)(K,2),Q=$[0],J=$[1],tt=Z.useMemo(function(){var t=C;C||(t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,u8.Z)(e).map(function(e,r){if(!Z.isValidElement(e)||!e.type)return null;var i,o,a,s,u,c=e.type.isSelectOptGroup,l=e.key,f=e.props,h=f.children,p=(0,s$.Z)(f,ct);return n||!c?(i=e.key,a=(o=e.props).children,s=o.value,u=(0,s$.Z)(o,u9),(0,sX.Z)({key:i,value:void 0!==s?s:i,children:a},u)):(0,sX.Z)((0,sX.Z)({key:"__RC_SELECT_GRP__".concat(null===l?r:l,"__"),label:l},p),{},{options:t(h)})}).filter(function(t){return t})}(A));var e=new Map,n=new Map,r=function(t,e,n){n&&"string"==typeof n&&t.set(e[n],e)};return function t(i){for(var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=0;a<i.length;a+=1){var s=i[a];!s[X.options]||o?(e.set(s[X.value],s),r(n,s,X.label),r(n,s,w),r(n,s,k)):t(s[X.options],!0)}}(t),{options:t,valueOptions:e,labelOptions:n}},[C,A,X,w,k]),te=tt.valueOptions,tn=tt.labelOptions,tr=tt.options,ti=Z.useCallback(function(t){return ui(t).map(function(t){t&&"object"===(0,sQ.Z)(t)?(r=t.key,n=t.label,e=null!==(a=t.value)&&void 0!==a?a:r):e=t;var e,n,r,i,o,a,s,u=te.get(e);return u&&(void 0===n&&(n=null==u?void 0:u[k||X.label]),void 0===r&&(r=null!==(s=null==u?void 0:u.key)&&void 0!==s?s:e),i=null==u?void 0:u.disabled,o=null==u?void 0:u.title),{label:n,value:e,key:r,disabled:i,title:o}})},[X,k,te]),to=(0,sJ.Z)(B,{value:j}),ta=(0,sK.Z)(to,2),ts=ta[0],tu=ta[1],tc=u3(Z.useMemo(function(){var t,e,n=ti(W&&null===ts?[]:ts);return"combobox"!==u||(e=null===(t=n[0])||void 0===t?void 0:t.value)||0===e?n:[]},[ts,ti,u,W]),te),tl=(0,sK.Z)(tc,2),tf=tl[0],th=tl[1],tp=Z.useMemo(function(){if(!u&&1===tf.length){var t=tf[0];if(null===t.value&&(null===t.label||void 0===t.label))return[]}return tf.map(function(t){var e;return(0,sX.Z)((0,sX.Z)({},t),{},{label:null!==(e="function"==typeof z?z(t):t.label)&&void 0!==e?e:t.value})})},[u,tf,z]),td=Z.useMemo(function(){return new Set(tf.map(function(t){return t.value}))},[tf]);Z.useEffect(function(){if("combobox"===u){var t,e=null===(t=tf[0])||void 0===t?void 0:t.value;J(null!=e?String(e):"")}},[tf]);var tv=ce(function(t,e){var n=null!=e?e:t;return(0,sq.Z)((0,sq.Z)({},X.value,t),X.label,n)}),tm=(a=Z.useMemo(function(){if("tags"!==u)return tr;var t=(0,sY.Z)(tr);return(0,sY.Z)(tf).sort(function(t,e){return t.value<e.value?-1:1}).forEach(function(e){var n=e.value;te.has(n)||t.push(tv(n,e.label))}),t},[tv,tr,te,tf,u]),Z.useMemo(function(){if(!Q||!1===q)return a;var t=X.options,e=X.label,n=X.value,r=[],i="function"==typeof q,o=Q.toUpperCase(),s=i?q:function(r,i){return w?u5(i[w],o):i[t]?u5(i["children"!==e?e:"label"],o):u5(i[n],o)},u=i?function(t){return uk(t)}:function(t){return t};return a.forEach(function(e){if(e[t]){if(s(Q,u(e)))r.push(e);else{var n=e[t].filter(function(t){return s(Q,u(t))});n.length&&r.push((0,sX.Z)((0,sX.Z)({},e),{},(0,sq.Z)({},t,n)))}return}s(Q,u(e))&&r.push(e)}),r},[a,q,w,Q,X])),tg=Z.useMemo(function(){return"tags"!==u||!Q||tm.some(function(t){return t[w||"value"]===Q})||tm.some(function(t){return t[X.value]===Q})?tm:[tv(Q)].concat((0,sY.Z)(tm))},[tv,w,u,tm,Q,X]),ty=Z.useMemo(function(){return S?(0,sY.Z)(tg).sort(function(t,e){return S(t,e)}):tg},[tg,S]),tb=Z.useMemo(function(){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.fieldNames,r=e.childrenAsData,i=[],o=uw(n,!1),a=o.label,s=o.value,u=o.options,c=o.groupLabel;return!function t(e,n){Array.isArray(e)&&e.forEach(function(e){if(!n&&u in e){var o=e[c];void 0===o&&r&&(o=e.label),i.push({key:u_(e,i.length),group:!0,data:e,label:o}),t(e[u],!0)}else{var l=e[s];i.push({key:u_(e,i.length),groupOption:n,data:e,label:e[a],value:l})}})}(t,!1),i}(ty,{fieldNames:X,childrenAsData:Y})},[ty,X,Y]),tx=function(t){var e=ti(t);if(tu(e),U&&(e.length!==tf.length||e.some(function(t,e){var n;return(null===(n=tf[e])||void 0===n?void 0:n.value)!==(null==t?void 0:t.value)}))){var n=F?e:e.map(function(t){return t.value}),r=e.map(function(t){return uk(th(t.value))});U(W?n:n[0],W?r:r[0])}},t_=Z.useState(null),tS=(0,sK.Z)(t_,2),tw=tS[0],tk=tS[1],tC=Z.useState(0),tE=(0,sK.Z)(tC,2),tA=tE[0],tM=tE[1],tT=void 0!==M?M:"combobox"!==u,tL=Z.useCallback(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.source;tM(e),l&&"combobox"===u&&null!==t&&"keyboard"===(void 0===r?"keyboard":r)&&tk(String(t))},[l,u]),tZ=function(t,e,n){var r=function(){var e,n=th(t);return[F?{label:null==n?void 0:n[X.label],value:t,key:null!==(e=null==n?void 0:n.key)&&void 0!==e?e:t}:t,uk(n)]};if(e&&g){var i=r(),o=(0,sK.Z)(i,2);g(o[0],o[1])}else if(!e&&y&&"clear"!==n){var a=r(),s=(0,sK.Z)(a,2);y(s[0],s[1])}},tP=ce(function(t,e){var n=!W||e.selected;tx(n?W?[].concat((0,sY.Z)(tf),[t]):[t]:tf.filter(function(e){return e.value!==t})),tZ(t,n),"combobox"===u?tk(""):(!uT||m)&&(J(""),tk(""))}),tO=Z.useMemo(function(){var t=!1!==P&&!1!==x;return(0,sX.Z)((0,sX.Z)({},tt),{},{flattenOptions:tb,onActiveValue:tL,defaultActiveFirstOption:tT,onSelect:tP,menuItemSelectedIcon:L,rawValues:td,fieldNames:X,virtual:t,direction:O,listHeight:I,listItemHeight:N,childrenAsData:Y,maxCount:V,optionRender:E})},[V,tt,tb,tL,tT,tP,L,td,X,P,x,O,I,N,Y,E]);return Z.createElement(uE.Provider,{value:tO},Z.createElement(uL,(0,sW.Z)({},H,{id:G,prefixCls:void 0===c?"rc-select":c,ref:e,omitDomProps:cr,mode:u,displayValues:tp,onDisplayValuesChange:function(t,e){tx(t);var n=e.type,r=e.values;("remove"===n||"clear"===n)&&r.forEach(function(t){tZ(t.value,!1,n)})},direction:O,searchValue:Q,onSearch:function(t,e){if(J(t),tk(null),"submit"===e.source){var n=(t||"").trim();n&&(tx(Array.from(new Set([].concat((0,sY.Z)(td),[n])))),tZ(n,!0),J(""));return}"blur"!==e.source&&("combobox"===u&&tx(t),null==d||d(t))},autoClearSearchValue:m,onSearchSplit:function(t){var e=t;"tags"!==u&&(e=t.map(function(t){var e=tn.get(t);return null==e?void 0:e.value}).filter(function(t){return void 0!==t}));var n=Array.from(new Set([].concat((0,sY.Z)(td),(0,sY.Z)(e))));tx(n),n.forEach(function(t){tZ(t,!0)})},dropdownMatchSelectWidth:x,OptionList:u2,emptyOptions:!tb.length,activeValue:tw,activeDescendantId:"".concat(G,"_list_").concat(tA)})))});function co(t){return(co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}ci.Option=uP,ci.OptGroup=uZ;var ca=["prefixCls","bordered","className","getPopupContainer","dropdownClassName","popupClassName","listHeight","placement","listItemHeight","disabled","notFoundContent"];function cs(){return(cs=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var cu="SECRET_COMBOBOX_MODE_DO_NOT_USE",cc="larkmap-select",cl=Z.forwardRef(function(t,e){t.prefixCls;var n,r,i,o,a=t.bordered,s=t.className,u=t.getPopupContainer,c=(t.dropdownClassName,t.popupClassName),l=t.listHeight,f=t.placement,h=t.listItemHeight,p=t.disabled,d=t.notFoundContent,v=function(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}(t,ca),m=Z.useMemo(function(){var t=v.mode;return"combobox"===t?void 0:t===cu?"combobox":t},[v]),g=sG(v,"suffixIcon","itemIcon"),y=D()((r={},i="".concat(cc,"-borderless"),o=!(void 0===a||a),(n=function(t,e){if("object"!==co(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==co(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),(i="symbol"===co(n)?n:String(n))in r)?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r),s);return Z.createElement(ci,cs({ref:e},g,{listHeight:void 0===l?256:l,listItemHeight:void 0===h?24:h,mode:m,prefixCls:cc,placement:f,notFoundContent:null!=d?d:"当前无数据",className:y,getPopupContainer:u,dropdownClassName:c,disabled:p}))});function cf(t){return(cf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}cl.SECRET_COMBOBOX_MODE_DO_NOT_USE=cu,cl.Option=uP,cl.OptGroup=uZ;var ch=["searchParams","showDistrict","showAddress","onSearchFinish","onChange"],cp=["keywords","privateKey"];function cd(){return(cd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function cv(){cv=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(e,n,r,o){var a,s,u=Object.create((n&&n.prototype instanceof m?n:m).prototype);return i(u,"_invoke",{value:(a=new A(o||[]),s=h,function(n,i){if(s===p)throw Error("Generator is already running");if(s===d){if("throw"===n)throw i;return{value:t,done:!0}}for(a.method=n,a.arg=i;;){var o=a.delegate;if(o){var u=function e(n,r){var i=r.method,o=n.iterator[i];if(o===t)return r.delegate=null,"throw"===i&&n.iterator.return&&(r.method="return",r.arg=t,e(n,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+i+"' method")),v;var a=f(o,n.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var s=a.arg;return s?s.done?(r[n.resultName]=s.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):s:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,v)}(o,a);if(u){if(u===v)continue;return u}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(s===h)throw s=d,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=p;var c=f(e,r,a);if("normal"===c.type){if(s=a.done?d:"suspendedYield",c.arg===v)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s=d,a.method="throw",a.arg=c.arg)}})}),u}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="executing",d="completed",v={};function m(){}function g(){}function y(){}var b={};c(b,a,function(){return this});var x=Object.getPrototypeOf,_=x&&x(x(M([])));_&&_!==n&&r.call(_,a)&&(b=_);var S=y.prototype=m.prototype=Object.create(b);function w(t){["next","throw","return"].forEach(function(e){c(t,e,function(t){return this._invoke(e,t)})})}function k(t,e){var n;i(this,"_invoke",{value:function(i,o){function a(){return new e(function(n,a){!function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==cf(l)&&r.call(l,"__await")?e.resolve(l.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(l).then(function(t){c.value=t,a(c)},function(t){return n("throw",t,a,s)})}s(u.arg)}(i,o,n,a)})}return n=n?n.then(a,a):a()}})}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw TypeError(cf(e)+" is not iterable")}return g.prototype=y,i(S,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:g,configurable:!0}),g.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},w(k.prototype),c(k.prototype,s,function(){return this}),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new k(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},w(S),c(S,u,"Generator"),c(S,a,function(){return this}),c(S,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function cm(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function cg(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?cm(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==cf(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==cf(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===cf(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cm(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function cy(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){n(t);return}s.done?e(u):Promise.resolve(u).then(r,i)}function cb(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||cx(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cx(t,e){if(t){if("string"==typeof t)return c_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c_(t,e)}}function c_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function cS(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var cw=cl.Option,ck=function(t){var e,n,r=t.searchParams,i=t.showDistrict,o=t.showAddress,a=t.onSearchFinish,s=t.onChange,u=cS(t,ch),c=cb((0,Z.useState)([]),2),l=c[0],f=c[1];(0,Z.useEffect)(function(){null==a||a(l)},[a,l]);var h=sk((e=cv().mark(function t(e){var n,i,o,a,s,u;return cv().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return f([]),t.abrupt("return");case 3:var c;return i=r.keywords,o=r.privateKey,a=cg(cg({},cS(r,cp)),{},{keywords:[].concat(function(t){if(Array.isArray(t))return c_(t)}(c=(null!=i?i:"").split("|"))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(c)||cx(c)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]).filter(function(t){return!!t}).join("|")}),o&&(a.sig=sE()(tX(a,!1)+o)),s="".concat("https://restapi.amap.com/v3/assistant/inputtips","?").concat(tX(a,!0)),t.next=9,fetch(s);case 9:return t.next=11,t.sent.json();case 11:f((null!==(n=null==(u=t.sent)?void 0:u.tips)&&void 0!==n?n:[]).filter(function(t){return t.location&&t.location.length}).map(function(t){var e=cb(t.location.split(","),2),n=e[0],r=e[1];return t.longitude=+n,t.latitude=+r,t}));case 13:case"end":return t.stop()}},t)}),n=function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(t){cy(o,r,i,a,s,"next",t)}function s(t){cy(o,r,i,a,s,"throw",t)}a(void 0)})},function(t){return n.apply(this,arguments)}),{wait:1e3}).run,p=(0,Z.useCallback)(function(t){var e=t&&l.find(function(e){return e.name===t});null==s||s(t||void 0,e||void 0)},[s,l]);return Z.createElement(cl,cd({className:"".concat(sA),onSearch:h,onChange:p,clearIcon:function(){return null}},u),l.map(function(t){var e="".concat(i?t.district:"").concat(o?t.address:"");return Z.createElement(cw,{key:t.id,value:t.name},Z.createElement("div",{title:t.name,className:"".concat(sA,"__option-name")},t.name),e&&Z.createElement("div",{title:e,className:"".concat(sA,"__option-tip")},e))}))};ck.defaultProps={placeholder:"请输入要搜索地名",showSearch:!0,allowClear:!0,filterOption:!1,defaultActiveFirstOption:!1,showAddress:!0,showDistrict:!0};var cC=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return -1},cE=function(t){return t!=t},cA=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return -1},cM=function(t,e){return!!(null==t?0:t.length)&&(e==e?cA(t,e,0):cC(t,cE,0))>-1},cT=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1},cL=Math.min,cZ=function(t,e,n){for(var r=n?cT:cM,i=t[0].length,o=t.length,a=o,s=Array(o),u=1/0,c=[];a--;){var l=t[a];a&&e&&(l=tl(l,nI(e))),u=cL(l.length,u),s[a]=!n&&(e||i>=120&&l.length>=120)?new ni(a&&l):void 0}l=t[0];var f=-1,h=s[0];e:for(;++f<i&&c.length<u;){var p=l[f],d=e?e(p):p;if(p=n||0!==p?p:0,!(h?na(h,d):r(c,d,n))){for(a=o;--a;){var v=s[a];if(!(v?na(v,d):r(t[a],d,n)))continue e}h&&h.push(d),c.push(p)}}return c},cP=function(t){return X(t)&&nK(t)?t:[]},cO=sH(sU(x=function(t){var e=tl(t,cP);return e.length&&e[0]===t[0]?cZ(e):[]},void 0,aD),x+"");function cR(t){return(cR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cI(){cI=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(e,n,r,o){var a,s,u=Object.create((n&&n.prototype instanceof m?n:m).prototype);return i(u,"_invoke",{value:(a=new A(o||[]),s=h,function(n,i){if(s===p)throw Error("Generator is already running");if(s===d){if("throw"===n)throw i;return{value:t,done:!0}}for(a.method=n,a.arg=i;;){var o=a.delegate;if(o){var u=function e(n,r){var i=r.method,o=n.iterator[i];if(o===t)return r.delegate=null,"throw"===i&&n.iterator.return&&(r.method="return",r.arg=t,e(n,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+i+"' method")),v;var a=f(o,n.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var s=a.arg;return s?s.done?(r[n.resultName]=s.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):s:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,v)}(o,a);if(u){if(u===v)continue;return u}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(s===h)throw s=d,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=p;var c=f(e,r,a);if("normal"===c.type){if(s=a.done?d:"suspendedYield",c.arg===v)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s=d,a.method="throw",a.arg=c.arg)}})}),u}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="executing",d="completed",v={};function m(){}function g(){}function y(){}var b={};c(b,a,function(){return this});var x=Object.getPrototypeOf,_=x&&x(x(M([])));_&&_!==n&&r.call(_,a)&&(b=_);var S=y.prototype=m.prototype=Object.create(b);function w(t){["next","throw","return"].forEach(function(e){c(t,e,function(t){return this._invoke(e,t)})})}function k(t,e){var n;i(this,"_invoke",{value:function(i,o){function a(){return new e(function(n,a){!function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==cR(l)&&r.call(l,"__await")?e.resolve(l.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(l).then(function(t){c.value=t,a(c)},function(t){return n("throw",t,a,s)})}s(u.arg)}(i,o,n,a)})}return n=n?n.then(a,a):a()}})}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw TypeError(cR(e)+" is not iterable")}return g.prototype=y,i(S,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:g,configurable:!0}),g.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},w(k.prototype),c(k.prototype,s,function(){return this}),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new k(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},w(S),c(S,u,"Generator"),c(S,a,function(){return this}),c(S,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function cD(t){return function(t){if(Array.isArray(t))return cU(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||cF(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cN(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function cz(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?cN(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==cR(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==cR(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===cR(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cN(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function cj(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){n(t);return}s.done?e(u):Promise.resolve(u).then(r,i)}function cB(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||cF(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cF(t,e){if(t){if("string"==typeof t)return cU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cU(t,e)}}function cU(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var cV=function(t){var e=t.className,n=t.style,r=t.searchParams,i=t.transformBounds,o=t.onChange,a=eo(),s=cB((0,Z.useState)("-"),2),u=s[0],c=s[1];return(0,Z.useEffect)(function(){var t,e,n=(t=cI().mark(function t(){var e,n,s,u,l,f,h,p,d;return cI().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:return e=function(t,e){return new Promise(function(n,i){var o;fetch((o=cz(cz({},r),{},{location:"".concat(t,",").concat(e)}),"".concat("https://restapi.amap.com/v3/geocode/regeo","?").concat(tX(o,!0)))).then(function(t){return t.json()}).then(function(t){if("1"===t.status){var e=t.regeocode.addressComponent;n([e.country,e.province,e.city,e.district,e.township].filter(function(t){return"string"==typeof t&&t}))}else i(t)})})},s=(n=cB(a.getBounds(),2))[0],u=n[1],i&&(s=(l=cB(i([s,u]),2))[0],u=l[1]),t.next=7,Promise.all([e.apply(void 0,cD(s)),e.apply(void 0,cD(u))]);case 7:h=(f=cB(t.sent,2))[0],p=f[1],c(d=h.length&&p.length?cO(h,p).join(" "):"-"),null==o||o(d,[s,u]);case 14:case"end":return t.stop()}},t)}),e=function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){cj(o,r,i,a,s,"next",t)}function s(t){cj(o,r,i,a,s,"throw",t)}a(void 0)})},function(){return e.apply(this,arguments)}),s=on(n,500,{maxWait:500});return n(),null==a||a.on("mapchange",s),function(){null==a||a.off("mapchange",s)}},[o,a,r,i]),Z.createElement("div",{className:D()([e,"larkmap-administrative-location"]),style:n},u)},cH="larkmap-legend-icon",cG=function(t){var e=t.labels,n=t.icons,r=t.className,i=t.style;return Z.createElement("div",{className:D()("".concat(cH),r),style:i},e.map(function(t,e){return Z.createElement("div",{key:t,className:"".concat(cH,"__content")},Z.createElement("img",{src:n[e],className:"".concat(cH,"__content__icon")}),Z.createElement("div",null,t))}))},cW=function(t){return K(t)&&t!=+t},cY=0,cq=function(t){var e=++cY;return tg(t)+e};function cX(t,e){if(t){if("string"==typeof t)return cK(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cK(t,e)}}function cK(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var c$="larkmap-legend-proportion",cQ=function(t){var e=t.labels,n=t.fillColor,r=void 0===n?"#f9f9f9":n,i=t.className,o=t.style,a=function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||cX(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),s=a[0],u=a[1],c=[86,62,38,24];return Z.createElement("div",{className:D()("".concat(c$),i),style:o},Z.createElement(function(){return Z.createElement("div",{className:"".concat(c$,"__circlebox"),style:{width:c[0]}},c.map(function(t){return Z.createElement("div",{key:t,style:{width:t,height:t,background:r},className:"".concat(c$,"__circlebox__item")})}))},null),Z.createElement(function(){var t,e,n,r,i,o;return Z.createElement("div",{style:{height:c[0]}},(t=s,e=u,K(t)&&K(t)||(t=e=0),cW(t)&&(t=0),cW(e)&&(e=0),n=t,i=((r=e)-n)/4,[{prefix:"MIN:",val:t}].concat(function(t){if(Array.isArray(t))return cK(t)}(o=[Math.floor(n+i),Math.floor(r-i)])||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||cX(o)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[{prefix:"MAX:",val:e}])).reverse().map(function(t){return Z.createElement("div",{key:cq(),className:"".concat(c$,"__labelitem")},null==t?void 0:t.prefix,"number"==typeof t?t:t.val)}))},null))};cQ.defaultProps={fillColor:"#f9f9f9"};var cJ=n(12163),c0=n.n(cJ),c1=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),a=o.length;a--;){var s=o[++r];if(!1===e(i[s],s,i))break}return t},c2=function(t,e){if(null==t)return t;if(!nK(t))return t&&c1(t,e,n$);for(var n=t.length,r=_?n:-1,i=Object(t);(_?r--:++r<n)&&!1!==e(i[r],r,i););return t},c3=1/0,c5=function(t){var e,n=(e=t)?(e=i9(e))===c3||e===-c3?(e<0?-1:1)*17976931348623157e292:e==e?e:0:0===e?e:0,r=n%1;return n==n?r?n-r:n:0},c4=j.isFinite,c7=Math.min,c6=(S=Math.round,function(t,e){if(t=i9(t),(e=null==e?0:c7(c5(e),292))&&c4(t)){var n=(tg(t)+"e").split("e");return+((n=(tg(S(n[0]+"e"+(+n[1]+e)))+"e").split("e"))[0]+"e"+(+n[1]-e))}return S(t)}),c8=function(t,e){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,o=[t],a=c0()(t).object(),s=c0()(e).object();if(i<2)return i<1?[]:o;var u={r:(a.r-s.r)/(i-1),g:(a.g-s.g)/(i-1),b:(a.b-s.b)/(i-1)};return n=Array(i-2),r=function(t,e){return o.push(c0()({r:c6(a.r-u.r*(e+1),0),g:c6(a.g-u.g*(e+1),0),b:c6(a.b-u.b*(e+1),0)}).hex())},(tf(n)?rd:c2)(n,"function"==typeof r?r:aD),o.push(e),o};function c9(t){return(c9="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var lt="larkmap-legend-category";function le(t){var e=t.labels,n=t.colors,r=t.geometryType,i=void 0===r?"circle":r,o=t.isStrokeColor,a=t.style,s=t.className;function u(t){return Z.createElement("div",{className:D()(lt,s),style:a},e.map(function(e,n){var r,a,s,u;return Z.createElement("div",{className:"".concat(lt,"__content"),key:e},Z.createElement("div",{className:D()("".concat(lt,"__content__shape"),(r={},(u=function(t,e){if("object"!==c9(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==c9(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a="".concat(lt,"__content__").concat(i),"string"),(a="symbol"===c9(u)?u:String(u))in r)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i,r)),style:(s=t[n],o?{border:"2px solid ".concat(s)}:{background:s})}),Z.createElement("div",{className:"".concat(lt,"labels")},e))}))}return Z.createElement(function(){return Array.isArray(n)?u(n):u(c8(n.startColor,n.endColor,e.length))},null)}le.defaultProps={geometryType:"circle",isStrokeColor:!1};var ln=n(96990),lr=function(t){var e=(0,Z.useRef)(0),n=(0,eh.CR)((0,Z.useState)(t),2),r=n[0],i=n[1],o=(0,Z.useCallback)(function(t){cancelAnimationFrame(e.current),e.current=requestAnimationFrame(function(){i(t)})},[]);return t2(function(){cancelAnimationFrame(e.current)}),[r,o]},li=!!("undefined"!=typeof window&&window.document&&window.document.createElement);function lo(t,e){return li?t?"function"==typeof t?t():"current"in t?t.current:t:e:void 0}function la(t,e){if(t===e)return!0;for(var n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}var ls=function(t){return function(e,n,r){var i=(0,Z.useRef)(!1),o=(0,Z.useRef)([]),a=(0,Z.useRef)([]),s=(0,Z.useRef)();t(function(){var t,u=(Array.isArray(r)?r:[r]).map(function(t){return lo(t)});if(!i.current){i.current=!0,o.current=u,a.current=n,s.current=e();return}u.length===o.current.length&&la(u,o.current)&&la(n,a.current)||(null===(t=s.current)||void 0===t||t.call(s),o.current=u,a.current=n,s.current=e())}),t2(function(){var t;null===(t=s.current)||void 0===t||t.call(s),i.current=!1})}},lu=ls(Z.useEffect),lc=ls(Z.useLayoutEffect),ll=li?lc:lu,lf=function(t){var e=(0,eh.CR)(lr(function(){var e=lo(t);return e?{width:e.clientWidth,height:e.clientHeight}:void 0}),2),n=e[0],r=e[1];return ll(function(){var e=lo(t);if(e){var n=new ln.Z(function(t){t.forEach(function(t){var e=t.target;r({width:e.clientWidth,height:e.clientHeight})})});return n.observe(e),function(){n.disconnect()}}},[],t),n},lh="larkmap-legend-ramp";function lp(t){var e=t.labels,n=t.labelUnit,r=void 0===n?"":n,i=t.colors,o=e[0]+r,a=e[e.length-1]+r;return Z.createElement(Z.Fragment,null,Z.createElement("div",{className:"".concat(lh,"__continuous"),style:{background:"linear-gradient(to right,".concat(i,")")}}),Z.createElement("div",{className:"".concat(lh,"__continuous-labelbar")},Z.createElement("span",null,o),Z.createElement("span",null,a)))}function ld(t){var e=t.labels,n=t.labelUnit,r=void 0===n?"":n,i=t.colors,o=(0,Z.useRef)(null),a=lf(o),s=(null==a?void 0:a.width)/(i.length+1);if(e.length+1===i.length){var u="< "+e[0],c="≥ "+e[e.length-1];e.unshift(u),e.push(c)}return Z.createElement("div",{className:"".concat(lh,"__dis-continuous"),ref:o},Number.isNaN(s)?null:Z.createElement(Z.Fragment,null,Z.createElement("div",{className:"".concat(lh,"__dis-continuous__colors"),style:{paddingLeft:s/2}},null==i?void 0:i.map(function(t,n){return Z.createElement("div",{key:t,title:"".concat(e[n]).concat(r," - ").concat(e[n+1]).concat(r),className:"".concat(lh,"__dis-continuous__color"),style:{background:t,width:s}})})),Z.createElement("div",{className:"".concat(lh,"__dis-continuous__labels")},null==e?void 0:e.map(function(t){var e=t+r;return Z.createElement("span",{key:t,className:"".concat(lh,"__dis-continuous__label")},e)}))))}function lv(t){var e=t.isContinuous,n=t.labels,r=t.colors,i=t.labelUnit,o=t.className,a=t.style;return Z.createElement("div",{className:D()("".concat(lh),o),style:a},e?Z.createElement(lp,{labels:n,labelUnit:i,colors:r}):Z.createElement(ld,{labels:n,labelUnit:i,colors:r}))}lv.defaultProps={isContinuous:!1,labelUnit:""};var lm=n(70619),lg={point:lm.DrawPoint,line:lm.DrawLine,polygon:lm.DrawPolygon,rect:lm.DrawRect,circle:lm.DrawCircle};function ly(t){return(ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function lx(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lb(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==ly(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==ly(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ly(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lb(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function l_(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return lS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lS(t,e)}}(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lS(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var lw=function(t){var e=eo(),n=l_((0,Z.useState)(function(){var e,n;return null!==(e=r0(null==t||null===(n=t.options)||void 0===n?void 0:n.initialData))&&void 0!==e?e:[]}),2),r=n[0],i=n[1],o=(0,Z.useMemo)(function(){return e?new lg[t.type](e,lx(lx({},t.options),{},{initialData:r0(r)})):(console.error("useDraw 只能使用在 LarkMap 容器中"),null)},[e,JSON.stringify(sG(t.options,"initialData")),t.type]),a=l_((0,Z.useState)(o.isEnable()),2),s=a[0],u=a[1];(0,Z.useEffect)(function(){var t=function(){return u(!0)},e=function(){return u(!1)},n=function(t){i(t)};return null==o||o.setData(r),null==o||o.on(lm.DrawEvent.Enable,t),null==o||o.on(lm.DrawEvent.Disable,e),null==o||o.on(lm.DrawEvent.Change,n),function(){i(o.getData()),null==o||o.off(lm.DrawEvent.Enable,t),null==o||o.off(lm.DrawEvent.Disable,e),null==o||o.off(lm.DrawEvent.Change,n),null==o||o.destroy()}},[o]);var c=(0,Z.useCallback)(function(t){null==o||o.setData(t),i(t)},[o]),l=(0,Z.useMemo)(function(){return{enable:null==o?void 0:o.enable.bind(o),disable:null==o?void 0:o.disable.bind(o),getDrawData:null==o?void 0:o.getData.bind(o)}},[o]);return lx({drawType:t.type,draw:o,drawData:r,setDrawData:c,isEnable:s},l)},lk=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},lC=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n},lE=function(t){var e=ra(t);return"[object Map]"==e?nc(t):"[object Set]"==e?lC(t):tl(n$(t),function(e){return[e,t[e]]})};function lA(t){return(lA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lM(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return lT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lT(t,e)}}(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function lL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function lZ(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lL(Object(n),!0).forEach(function(e){var r,i;r=e,i=n[e],(r=function(t){var e=function(t,e){if("object"!==lA(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==lA(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===lA(e)?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lL(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var lP=function(t,e){var n=t.point,r=t.line,i=t.polygon,o=t.rect,a=t.circle,s=!!n,u=!!r,c=!!i,l=!!o,f=!!a,h=(0,Z.useCallback)(function(t){return lZ(lZ({},e),t instanceof Object?t:{})},[e]),p=lw({type:"point",options:h(n)}),d=lw({type:"line",options:h(r)}),v=lw({type:"polygon",options:h(i)}),m=lw({type:"rect",options:h(o)}),g=lw({type:"circle",options:h(a)}),y=(0,Z.useMemo)(function(){return lk(lE({point:s?p:void 0,line:u?d:void 0,polygon:c?v:void 0,rect:l?m:void 0,circle:f?g:void 0}).filter(function(t){return!!lM(t,2)[1]}))},[p,d,v,m,g,s,u,c,l,f]),b=(0,Z.useMemo)(function(){return lk(lE(y).map(function(t){var e=lM(t,2);return[e[0],e[1].draw]}))},[y]),x=(0,Z.useMemo)(function(){return lk(lE(y).map(function(t){var e=lM(t,2);return[e[0],e[1].drawData]}))},[y]),_=(0,Z.useCallback)(function(t){Object.entries(t).forEach(function(t){var e,n=lM(t,2),r=n[0],i=n[1];null===(e=y[r])||void 0===e||e.setDrawData(i)})},[y]),S=(0,Z.useMemo)(function(){return Object.values(y).find(function(t){return t.isEnable})},[y]);return{drawMap:b,drawGroupData:x,setDrawGroupData:_,activeDraw:(0,Z.useMemo)(function(){var t;return null!==(t=null==S?void 0:S.draw)&&void 0!==t?t:null},[S]),activeDrawInfo:S,setActiveDraw:(0,Z.useCallback)(function(t){Object.values(y).forEach(function(e){if(e){var n,r,i="string"==typeof t?null!==(n=null===(r=y[t])||void 0===r?void 0:r.draw)&&void 0!==n?n:null:t;if(!i){e.disable();return}var o=e.isEnable;i===e.draw?o||e.enable():o&&e.disable()}})},[y])}},lO="1.4.13",lR=function(t,e){var n,r=null!=(n=t.getMapService().version)&&n.includes("MAPBOX")?"Mapbox":"Gaode",i=e.zoom,o=e.center,a=e.pitch,s=e.rotation;if("Gaode"===r){var u=null==t?void 0:t.map;o&&u.setCenter(o,!0),K(i)&&(null==u||u.setZoom(i+1,!0)),K(s)&&(null==u||u.setRotation(360-s,!0)),K(a)&&(null==u||u.setPitch(a,!0))}else K(i)&&(null==t||t.setZoom(i)),o&&(null==t||t.setCenter(o)),K(s)&&t.setRotation(s),K(a)&&(null==t||t.setPitch(a))};function lI(t,e){var n=null!=e?e:{},r=n.zoomGap,i=void 0===r?0:r,o=n.mainIndex,a=void 0===o?0:o,s=[],u=[],c=function(e){var n=t[e];return n.on("mapmove",u[e]),n.on("dragging",u[e]),n.on("rotate",u[e]),n.on("zoomchange",u[e]),function(){n.off("mapmove",u[e]),n.off("dragging",u[e]),n.off("zoomchange",u[e]),n.off("rotate",u[e])}},l=function(){null==s||s.forEach(function(t){return t()}),s.length=0},f=function(e){var n=t[e],r=n.getCenter(),o=n.getZoom(),s=n.getRotation(),u=n.getPitch(),c=e===a;t.forEach(function(t,n){n!==e&&lR(t,{zoom:c?o+i:n===a?o-i:o,center:[r.lng,r.lat],rotation:s,pitch:u})})},h=function(t){l(),f(t),p()};function p(){u=t.map(function(t,e){return h.bind(null,e)}),t.forEach(function(t,e){s.push(c(e))})}return t.forEach(function(t,e){f(e)}),p(),l}var lD=function(t){var e=t.scenes,n=t.options;return Z.useEffect(function(){return lI(e,n)},[e,n]),Z.createElement(Z.Fragment,null)}},58058:function(t,e){"use strict";e.Z=function(t,e,n){return t<e?e:t>n?n:t}},47546:function(t,e){"use strict";e.Z=function(t){return null==t}},65044:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r={}.toString,i=function(t){return"[object Number]"===r.call(t)}},3338:function(t){function e(t,e){if(0!==t.length){n(t[0],e);for(var r=1;r<t.length;r++)n(t[r],!e)}}function n(t,e){for(var n=0,r=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!e&&t.reverse()}t.exports=function t(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)t(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)t(n.geometries[i],r);else if("Feature"===o)t(n.geometry,r);else if("Polygon"===o)e(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)e(n.coordinates[i],r);return n}},48447:function(t){"use strict";function e(t,e){this.x=t,this.y=e}t.exports=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}},46721:function(t){"use strict";function e(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function n(t,e,n,i,o,a){for(var s=0;s<e;s++)r(t,s,e,n,i,o,a);for(var u=0;u<n;u++)r(t,u*e,1,e,i,o,a)}function r(t,e,n,r,i,o,a){var s,u,c,l;for(s=0,o[0]=0,a[0]=-1e20,a[1]=1e20;s<r;s++)i[s]=t[e+s*n];for(s=1,u=0,c=0;s<r;s++){do l=o[u],c=(i[s]-i[l]+s*s-l*l)/(s-l)/2;while(c<=a[u]&&--u>-1);o[++u]=s,a[u]=c,a[u+1]=1e20}for(s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;l=o[u],t[e+s*n]=i[l]+(s-l)*(s-l)}}t.exports=e,t.exports.default=e,e.prototype._draw=function(t,e){var r,i,o,a,s,u,c,l,f,h=this.ctx.measureText(t),p=h.width,d=2*this.buffer;e&&this.useMetrics?(s=Math.floor(h.actualBoundingBoxAscent),l=this.buffer+Math.ceil(h.actualBoundingBoxAscent),u=this.buffer,c=this.buffer,i=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)),a=Math.min(this.size-u,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)),r=i+d,o=a+d,this.ctx.textBaseline="alphabetic"):(r=i=this.size,o=a=this.size,s=19*this.fontSize/24,u=c=0,l=this.middle,this.ctx.textBaseline="middle"),i&&a&&(this.ctx.clearRect(c,u,i,a),this.ctx.fillText(t,this.buffer,l),f=this.ctx.getImageData(c,u,i,a));var v=new Uint8ClampedArray(r*o);return function(t,e,n,r,i,o,a){o.fill(1e20,0,e*n),a.fill(0,0,e*n);for(var s=(e-r)/2,u=0;u<i;u++)for(var c=0;c<r;c++){var l=(u+s)*e+c+s,f=t.data[4*(u*r+c)+3]/255;if(1===f)o[l]=0,a[l]=1e20;else if(0===f)o[l]=1e20,a[l]=0;else{var h=Math.max(0,.5-f),p=Math.max(0,f-.5);o[l]=h*h,a[l]=p*p}}}(f,r,o,i,a,this.gridOuter,this.gridInner),n(this.gridOuter,r,o,this.f,this.v,this.z),n(this.gridInner,r,o,this.f,this.v,this.z),function(t,e,n,r,i,o,a){for(var s=0;s<e*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(u/o+a))}}(v,r,o,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:v,metrics:{width:i,height:a,sdfWidth:r,sdfHeight:o,top:s,left:0,advance:p}}},e.prototype.draw=function(t){return this._draw(t,!1).data},e.prototype.drawWithMetrics=function(t){return this._draw(t,!0)}},87421:function(t){function e(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}t.exports=e,e.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},e.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},e.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},e.prototype.solveCurveX=function(t,e){for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(Math.abs(o=this.sampleCurveX(i)-t)<e)return i;var n,r,i,o,a,s=this.sampleCurveDerivativeX(i);if(1e-6>Math.abs(s))break;i-=o/s}if(n=0,r=1,(i=t)<n)return n;if(i>r)return r;for(;n<r&&!(Math.abs((o=this.sampleCurveX(i))-t)<e);)t>o?n=i:r=i,i=(r-n)*.5+n;return i},e.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},29935:function(t,e,n){t.exports.VectorTile=n(68165),n(80195),n(73239)},68165:function(t,e,n){"use strict";var r=n(73239);function i(t,e,n){if(3===t){var i=new r(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}t.exports=function(t,e){this.layers=t.readFields(i,{},e)}},80195:function(t,e,n){"use strict";var r=n(48447);function i(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(o,this,e)}function o(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}t.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var c=t.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(a,s));else if(7===i)e&&e.push(e[0].clone());else throw Error("unknown command "+i)}return e&&u.push(e),u},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;t.pos<e;){if(r<=0){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)i+=t.readSVarint(),o+=t.readSVarint(),i<a&&(a=i),i>s&&(s=i),o<u&&(u=o),o>c&&(c=o);else if(7!==n)throw Error("unknown command "+n)}return[a,u,s,c]},i.prototype.toGeoJSON=function(t,e,n){var r,o,a=this.extent*Math.pow(2,n),s=this.extent*t,u=this.extent*e,c=this.loadGeometry(),l=i.types[this.type];function f(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-(n.y+u)*360/a;t[e]=[(n.x+s)*360/a-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<c.length;r++)h[r]=c[r][0];f(c=h);break;case 2:for(r=0;r<c.length;r++)f(c[r]);break;case 3:for(r=0,c=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=function(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(c);r<c.length;r++)for(o=0;o<c[r].length;o++)f(c[r][o])}1===c.length?c=c[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:c},properties:this.properties};return"id"in this&&(p.id=this.id),p}},73239:function(t,e,n){"use strict";var r=n(80195);function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(o,this,e),this.length=this._features.length}function o(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}t.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,e,this.extent,this._keys,this._values)}},12312:function(t,e,n){"use strict";var r=n(63383);function i(){var t={},e=0,n=0,r=0;return{add:function(i,o){o||(o=i,i=0),i>n?n=i:i<r&&(r=i),t[i]||(t[i]=[]),t[i].push(o),e++},process:function(){for(var e=r;e<=n;e++)for(var i=t[e],o=0;o<i.length;o++)(0,i[o])()},size:function(){return e}}}t.exports=function(t){var e,n=(t=t||{}).reporter,o=r.getOption(t,"async",!0),a=r.getOption(t,"auto",!0);a&&!o&&(n&&n.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),o=!0);var s=i(),u=!1;function c(){for(u=!0;s.size();){var t=s;s=i(),t.process()}u=!1}function l(t){return setTimeout(t,0)}return{add:function(t,n){!u&&a&&o&&0===s.size()&&(e=l(c)),s.add(t,n)},force:function(t){!u&&(void 0===t&&(t=o),e&&(clearTimeout(e),e=null),t?e=l(c):c())}}}},63383:function(t){"use strict";(t.exports={}).getOption=function(t,e,n){var r=t[e];return null==r&&void 0!==n?n:r}},50232:function(t){var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}};t.exports=e},80679:function(t,e,n){let r=n(2284),i={};for(let t of Object.keys(r))i[r[t]]=t;let o={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(let e of(t.exports=o,Object.keys(o))){if(!("channels"in o[e]))throw Error("missing channels property: "+e);if(!("labels"in o[e]))throw Error("missing channel labels property: "+e);if(o[e].labels.length!==o[e].channels)throw Error("channel and label counts mismatch: "+e);let{channels:t,labels:n}=o[e];delete o[e].channels,delete o[e].labels,Object.defineProperty(o[e],"channels",{value:t}),Object.defineProperty(o[e],"labels",{value:n})}o.rgb.hsl=function(t){let e;let n=t[0]/255,r=t[1]/255,i=t[2]/255,o=Math.min(n,r,i),a=Math.max(n,r,i),s=a-o;a===o?e=0:n===a?e=(r-i)/s:r===a?e=2+(i-n)/s:i===a&&(e=4+(n-r)/s),(e=Math.min(60*e,360))<0&&(e+=360);let u=(o+a)/2;return[e,100*(a===o?0:u<=.5?s/(a+o):s/(2-a-o)),100*u]},o.rgb.hsv=function(t){let e,n,r,i,o;let a=t[0]/255,s=t[1]/255,u=t[2]/255,c=Math.max(a,s,u),l=c-Math.min(a,s,u),f=function(t){return(c-t)/6/l+.5};return 0===l?(i=0,o=0):(o=l/c,e=f(a),n=f(s),r=f(u),a===c?i=r-n:s===c?i=1/3+e-r:u===c&&(i=2/3+n-e),i<0?i+=1:i>1&&(i-=1)),[360*i,100*o,100*c]},o.rgb.hwb=function(t){let e=t[0],n=t[1],r=t[2];return[o.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(n,r))*100,100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},o.rgb.cmyk=function(t){let e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.min(1-e,1-n,1-r);return[100*((1-e-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*((1-r-i)/(1-i)||0),100*i]},o.rgb.keyword=function(t){let e;let n=i[t];if(n)return n;let o=1/0;for(let n of Object.keys(r)){let i=r[n],a=(t[0]-i[0])**2+(t[1]-i[1])**2+(t[2]-i[2])**2;a<o&&(o=a,e=n)}return e},o.keyword.rgb=function(t){return r[t]},o.rgb.xyz=function(t){let e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?((e+.055)/1.055)**2.4:e/12.92)+.3576*(n=n>.04045?((n+.055)/1.055)**2.4:n/12.92)+.1805*(r=r>.04045?((r+.055)/1.055)**2.4:r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},o.rgb.lab=function(t){let e=o.rgb.xyz(t),n=e[0],r=e[1],i=e[2];return n/=95.047,r/=100,i/=108.883,[116*(r=r>.008856?r**(1/3):7.787*r+16/116)-16,500*((n=n>.008856?n**(1/3):7.787*n+16/116)-r),200*(r-(i=i>.008856?i**(1/3):7.787*i+16/116))]},o.hsl.rgb=function(t){let e,n,r;let i=t[0]/360,o=t[1]/100,a=t[2]/100;if(0===o)return[r=255*a,r,r];e=a<.5?a*(1+o):a+o-a*o;let s=2*a-e,u=[0,0,0];for(let t=0;t<3;t++)(n=i+-(1/3*(t-1)))<0&&n++,n>1&&n--,r=6*n<1?s+(e-s)*6*n:2*n<1?e:3*n<2?s+(e-s)*(2/3-n)*6:s,u[t]=255*r;return u},o.hsl.hsv=function(t){let e=t[0],n=t[1]/100,r=t[2]/100,i=n,o=Math.max(r,.01);r*=2,n*=r<=1?r:2-r,i*=o<=1?o:2-o;let a=(r+n)/2;return[e,100*(0===r?2*i/(o+i):2*n/(r+n)),100*a]},o.hsv.rgb=function(t){let e=t[0]/60,n=t[1]/100,r=t[2]/100,i=Math.floor(e)%6,o=e-Math.floor(e),a=255*r*(1-n),s=255*r*(1-n*o),u=255*r*(1-n*(1-o));switch(r*=255,i){case 0:return[r,u,a];case 1:return[s,r,a];case 2:return[a,r,u];case 3:return[a,s,r];case 4:return[u,a,r];case 5:return[r,a,s]}},o.hsv.hsl=function(t){let e,n;let r=t[0],i=t[1]/100,o=t[2]/100,a=Math.max(o,.01);n=(2-i)*o;let s=(2-i)*a;return[r,100*(i*a/(s<=1?s:2-s)||0),100*(n/=2)]},o.hwb.rgb=function(t){let e,n,r,i;let o=t[0]/360,a=t[1]/100,s=t[2]/100,u=a+s;u>1&&(a/=u,s/=u);let c=Math.floor(6*o),l=1-s;e=6*o-c,(1&c)!=0&&(e=1-e);let f=a+e*(l-a);switch(c){default:case 6:case 0:n=l,r=f,i=a;break;case 1:n=f,r=l,i=a;break;case 2:n=a,r=l,i=f;break;case 3:n=a,r=f,i=l;break;case 4:n=f,r=a,i=l;break;case 5:n=l,r=a,i=f}return[255*n,255*r,255*i]},o.cmyk.rgb=function(t){let e=t[0]/100,n=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},o.xyz.rgb=function(t){let e,n,r;let i=t[0]/100,o=t[1]/100,a=t[2]/100;return e=(e=3.2406*i+-1.5372*o+-.4986*a)>.0031308?1.055*e**(1/2.4)-.055:12.92*e,n=(n=-.9689*i+1.8758*o+.0415*a)>.0031308?1.055*n**(1/2.4)-.055:12.92*n,r=(r=.0557*i+-.204*o+1.057*a)>.0031308?1.055*r**(1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},o.xyz.lab=function(t){let e=t[0],n=t[1],r=t[2];return e/=95.047,n/=100,r/=108.883,[116*(n=n>.008856?n**(1/3):7.787*n+16/116)-16,500*((e=e>.008856?e**(1/3):7.787*e+16/116)-n),200*(n-(r=r>.008856?r**(1/3):7.787*r+16/116))]},o.lab.xyz=function(t){let e,n,r;let i=t[0],o=t[1],a=t[2];e=o/500+(n=(i+16)/116),r=n-a/200;let s=n**3,u=e**3,c=r**3;return n=(s>.008856?s:(n-16/116)/7.787)*100,[e=(u>.008856?u:(e-16/116)/7.787)*95.047,n,r=(c>.008856?c:(r-16/116)/7.787)*108.883]},o.lab.lch=function(t){let e;let n=t[0],r=t[1],i=t[2];return(e=360*Math.atan2(i,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+i*i),e]},o.lch.lab=function(t){let e=t[0],n=t[1],r=t[2]/360*2*Math.PI;return[e,n*Math.cos(r),n*Math.sin(r)]},o.rgb.ansi16=function(t,e=null){let[n,r,i]=t,a=null===e?o.rgb.hsv(t)[2]:e;if(0===(a=Math.round(a/50)))return 30;let s=30+(Math.round(i/255)<<2|Math.round(r/255)<<1|Math.round(n/255));return 2===a&&(s+=60),s},o.hsv.ansi16=function(t){return o.rgb.ansi16(o.hsv.rgb(t),t[2])},o.rgb.ansi256=function(t){let e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},o.ansi16.rgb=function(t){let e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];let n=(~~(t>50)+1)*.5;return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},o.ansi256.rgb=function(t){let e;if(t>=232){let e=(t-232)*10+8;return[e,e,e]}return[Math.floor((t-=16)/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},o.rgb.hex=function(t){let e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},o.hex.rgb=function(t){let e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];let n=e[0];3===e[0].length&&(n=n.split("").map(t=>t+t).join(""));let r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},o.rgb.hcg=function(t){let e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.max(Math.max(e,n),r),o=Math.min(Math.min(e,n),r),a=i-o;return[(a<=0?0:i===e?(n-r)/a%6:i===n?2+(r-e)/a:4+(e-n)/a)/6%1*360,100*a,100*(a<1?o/(1-a):0)]},o.hsl.hcg=function(t){let e=t[1]/100,n=t[2]/100,r=n<.5?2*e*n:2*e*(1-n),i=0;return r<1&&(i=(n-.5*r)/(1-r)),[t[0],100*r,100*i]},o.hsv.hcg=function(t){let e=t[1]/100,n=t[2]/100,r=e*n,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},o.hcg.rgb=function(t){let e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];let i=[0,0,0],o=e%1*6,a=o%1,s=1-a,u=0;switch(Math.floor(o)){case 0:i[0]=1,i[1]=a,i[2]=0;break;case 1:i[0]=s,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=a;break;case 3:i[0]=0,i[1]=s,i[2]=1;break;case 4:i[0]=a,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=s}return u=(1-n)*r,[(n*i[0]+u)*255,(n*i[1]+u)*255,(n*i[2]+u)*255]},o.hcg.hsv=function(t){let e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},o.hcg.hsl=function(t){let e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},o.hcg.hwb=function(t){let e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],(n-e)*100,(1-n)*100]},o.hwb.hcg=function(t){let e=t[1]/100,n=1-t[2]/100,r=n-e,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},o.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},o.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},o.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},o.gray.hsl=function(t){return[0,0,t[0]]},o.gray.hsv=o.gray.hsl,o.gray.hwb=function(t){return[0,100,t[0]]},o.gray.cmyk=function(t){return[0,0,0,t[0]]},o.gray.lab=function(t){return[t[0],0,0]},o.gray.hex=function(t){let e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},o.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},47377:function(t,e,n){let r=n(80679),i=n(11054),o={};Object.keys(r).forEach(t=>{o[t]={},Object.defineProperty(o[t],"channels",{value:r[t].channels}),Object.defineProperty(o[t],"labels",{value:r[t].labels});let e=i(t);Object.keys(e).forEach(n=>{let r=e[n];o[t][n]=function(t){let e=function(...e){let n=e[0];if(null==n)return n;n.length>1&&(e=n);let r=t(e);if("object"==typeof r)for(let t=r.length,e=0;e<t;e++)r[e]=Math.round(r[e]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}(r),o[t][n].raw=function(t){let e=function(...e){let n=e[0];return null==n?n:(n.length>1&&(e=n),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)})}),t.exports=o},11054:function(t,e,n){let r=n(80679);t.exports=function(t){let e=function(t){let e=function(){let t={},e=Object.keys(r);for(let n=e.length,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;){let t=n.pop(),i=Object.keys(r[t]);for(let r=i.length,o=0;o<r;o++){let r=i[o],a=e[r];-1===a.distance&&(a.distance=e[t].distance+1,a.parent=t,n.unshift(r))}}return e}(t),n={},i=Object.keys(e);for(let t=i.length,o=0;o<t;o++){let t=i[o];null!==e[t].parent&&(n[t]=function(t,e){let n=[e[t].parent,t],i=r[e[t].parent][t],o=e[t].parent;for(;e[o].parent;)n.unshift(e[o].parent),i=function(t,e){return function(n){return e(t(n))}}(r[e[o].parent][o],i),o=e[o].parent;return i.conversion=n,i}(t,e))}return n}},2284:function(t){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},95737:function(t,e,n){var r=n(2284),i=n(62789),o=Object.hasOwnProperty,a=Object.create(null);for(var s in r)o.call(r,s)&&(a[r[s]]=s);var u=t.exports={to:{},get:{}};function c(t,e,n){return Math.min(Math.max(e,t),n)}function l(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}u.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=u.get.hsl(t),n="hsl";break;case"hwb":e=u.get.hwb(t),n="hwb";break;default:e=u.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},u.get.rgb=function(t){if(!t)return null;var e,n,i,a=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=0,i=e[2],e=e[1];n<3;n++){var s=2*n;a[n]=parseInt(e.slice(s,s+2),16)}i&&(a[3]=parseInt(i,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(n=0,i=(e=e[1])[3];n<3;n++)a[n]=parseInt(e[n]+e[n],16);i&&(a[3]=parseInt(i+i,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)a[n]=parseInt(e[n+1],0);e[4]&&(e[5]?a[3]=.01*parseFloat(e[4]):a[3]=parseFloat(e[4]))}else if(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)a[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?a[3]=.01*parseFloat(e[4]):a[3]=parseFloat(e[4]))}else if(!(e=t.match(/^(\w+)$/)))return null;else return"transparent"===e[1]?[0,0,0,0]:o.call(r,e[1])?((a=r[e[1]])[3]=1,a):null;for(n=0;n<3;n++)a[n]=c(a[n],0,255);return a[3]=c(a[3],0,1),a},u.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,c(parseFloat(e[2]),0,100),c(parseFloat(e[3]),0,100),c(isNaN(n)?1:n,0,1)]}return null},u.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,c(parseFloat(e[2]),0,100),c(parseFloat(e[3]),0,100),c(isNaN(n)?1:n,0,1)]}return null},u.to.hex=function(){var t=i(arguments);return"#"+l(t[0])+l(t[1])+l(t[2])+(t[3]<1?l(Math.round(255*t[3])):"")},u.to.rgb=function(){var t=i(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},u.to.rgb.percent=function(){var t=i(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},u.to.hsl=function(){var t=i(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},u.to.hwb=function(){var t=i(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},u.to.keyword=function(t){return a[t.slice(0,3)]}},12163:function(t,e,n){let r=n(95737),i=n(47377),o=["keyword","gray","hex"],a={};for(let t of Object.keys(i))a[[...i[t].labels].sort().join("")]=t;let s={};function u(t,e){let n,c;if(!(this instanceof u))return new u(t,e);if(e&&e in o&&(e=null),e&&!(e in i))throw Error("Unknown model: "+e);if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof u)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if("string"==typeof t){let e=r.get(t);if(null===e)throw Error("Unable to parse color from string: "+t);this.model=e.model,c=i[this.model].channels,this.color=e.value.slice(0,c),this.valpha="number"==typeof e.value[c]?e.value[c]:1}else if(t.length>0){this.model=e||"rgb",c=i[this.model].channels;let n=Array.prototype.slice.call(t,0,c);this.color=f(n,c),this.valpha="number"==typeof t[c]?t[c]:1}else if("number"==typeof t)this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;let e=Object.keys(t);"alpha"in t&&(e.splice(e.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);let r=e.sort().join("");if(!(r in a))throw Error("Unable to parse color from object: "+JSON.stringify(t));this.model=a[r];let{labels:o}=i[this.model],s=[];for(n=0;n<o.length;n++)s.push(t[o[n]]);this.color=f(s)}if(s[this.model])for(n=0,c=i[this.model].channels;n<c;n++){let t=s[this.model][n];t&&(this.color[n]=t(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}for(let t of(u.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let e=this.model in r.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:[...e.color,this.valpha];return r.to[e.model](n)},percentString(t){let e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:[...e.color,this.valpha];return r.to.rgb.percent(n)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){let t={},{channels:e}=i[this.model],{labels:n}=i[this.model];for(let r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray(){let t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject(){let t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round(t){var e;return t=Math.max(t||0,0),new u([...this.color.map((e=t,function(t){return Number(t.toFixed(e))})),this.valpha],this.model)},alpha(t){return void 0!==t?new u([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:c("rgb",0,l(255)),green:c("rgb",1,l(255)),blue:c("rgb",2,l(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,t=>(t%360+360)%360),saturationl:c("hsl",1,l(100)),lightness:c("hsl",2,l(100)),saturationv:c("hsv",1,l(100)),value:c("hsv",2,l(100)),chroma:c("hcg",1,l(100)),gray:c("hcg",2,l(100)),white:c("hwb",1,l(100)),wblack:c("hwb",2,l(100)),cyan:c("cmyk",0,l(100)),magenta:c("cmyk",1,l(100)),yellow:c("cmyk",2,l(100)),black:c("cmyk",3,l(100)),x:c("xyz",0,l(95.047)),y:c("xyz",1,l(100)),z:c("xyz",2,l(108.833)),l:c("lab",0,l(100)),a:c("lab",1),b:c("lab",2),keyword(t){return void 0!==t?new u(t):i[this.model].keyword(this.color)},hex(t){return void 0!==t?new u(t):r.to.hex(this.rgb().round().color)},hexa(t){if(void 0!==t)return new u(t);let e=this.rgb().round().color,n=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),r.to.hex(e)+n},rgbNumber(){let t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity(){let t=this.rgb().color,e=[];for(let[n,r]of t.entries()){let t=r/255;e[n]=t<=.04045?t/12.92:((t+.055)/1.055)**2.4}return .2126*e[0]+.7152*e[1]+.0722*e[2]},contrast(t){let e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level(t){let e=this.contrast(t);return e>=7?"AAA":e>=4.5?"AA":""},isDark(){let t=this.rgb().color;return(2126*t[0]+7152*t[1]+722*t[2])/1e4<128},isLight(){return!this.isDark()},negate(){let t=this.rgb();for(let e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten(t){let e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken(t){let e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate(t){let e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate(t){let e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten(t){let e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken(t){let e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale(){let t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return u.rgb(e,e,e)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){let e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix(t,e){if(!t||!t.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);let n=t.rgb(),r=this.rgb(),i=void 0===e?.5:e,o=2*i-1,a=n.alpha()-r.alpha(),s=((o*a==-1?o:(o+a)/(1+o*a))+1)/2,c=1-s;return u.rgb(s*n.red()+c*r.red(),s*n.green()+c*r.green(),s*n.blue()+c*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(i))){if(o.includes(t))continue;let{channels:e}=i[t];u.prototype[t]=function(...e){var n;return this.model===t?new u(this):e.length>0?new u(e,t):new u([...Array.isArray(n=i[this.model][t].raw(this.color))?n:[n],this.valpha],t)},u[t]=function(...n){let r=n[0];return"number"==typeof r&&(r=f(n,e)),new u(r,t)}}function c(t,e,n){for(let r of t=Array.isArray(t)?t:[t])(s[r]||(s[r]=[]))[e]=n;return t=t[0],function(r){let i;return void 0!==r?(n&&(r=n(r)),(i=this[t]()).color[e]=r):(i=this[t]().color[e],n&&(i=n(i))),i}}function l(t){return function(e){return Math.max(0,Math.min(t,e))}}function f(t,e){for(let n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}t.exports=u},46515:function(t){var e,n;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&n.rotl(t,8)|4278255360&n.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=n.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],n=0,r=0;n<t.length;n++,r+=8)e[r>>>5]|=t[n]<<24-r%32;return e},wordsToBytes:function(t){for(var e=[],n=0;n<32*t.length;n+=8)e.push(t[n>>>5]>>>24-n%32&255);return e},bytesToHex:function(t){for(var e=[],n=0;n<t.length;n++)e.push((t[n]>>>4).toString(16)),e.push((15&t[n]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e},bytesToBase64:function(t){for(var n=[],r=0;r<t.length;r+=3)for(var i=t[r]<<16|t[r+1]<<8|t[r+2],o=0;o<4;o++)8*r+6*o<=8*t.length?n.push(e.charAt(i>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],r=0,i=0;r<t.length;i=++r%4)0!=i&&n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(t.charAt(r))>>>6-2*i);return n}},t.exports=n},35060:function(t){"use strict";function e(t,e,l){l=l||2;var f,d,m,g,y,b,x,_=e&&e.length,S=_?e[0]*l:t.length,w=n(t,0,S,l,!0),k=[];if(!w||w.next===w.prev)return k;if(_&&(w=function(t,e,o,u){var c,l,f,d,v,m=[];for(c=0,l=e.length;c<l;c++)f=e[c]*u,d=c<l-1?e[c+1]*u:t.length,(v=n(t,f,d,u,!1))===v.next&&(v.steiner=!0),m.push(function(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}(v));for(m.sort(i),c=0;c<m.length;c++)o=function(t,e){var n=function(t,e){var n,r,i,o=e,u=t.x,c=t.y,l=-1/0;do{if(c<=o.y&&c>=o.next.y&&o.next.y!==o.y){var f=o.x+(c-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(f<=u&&f>l&&(l=f,i=o.x<o.next.x?o:o.next,f===u))return i}o=o.next}while(o!==e);if(!i)return null;var p,d=i,v=i.x,m=i.y,g=1/0;o=i;do u>=o.x&&o.x>=v&&u!==o.x&&a(c<m?u:l,c,v,m,c<m?l:u,c,o.x,o.y)&&(p=Math.abs(c-o.y)/(u-o.x),h(o,t)&&(p<g||p===g&&(o.x>i.x||o.x===i.x&&(n=i,r=o,0>s(n.prev,n,r.prev)&&0>s(r.next,n,n.next))))&&(i=o,g=p)),o=o.next;while(o!==d);return i}(t,e);if(!n)return e;var i=p(n,t);return r(i,i.next),r(n,n.next)}(m[c],o);return o}(t,e,w,l)),t.length>80*l){f=m=t[0],d=g=t[1];for(var C=l;C<S;C+=l)y=t[C],b=t[C+1],y<f&&(f=y),b<d&&(d=b),y>m&&(m=y),b>g&&(g=b);x=0!==(x=Math.max(m-f,g-d))?32767/x:0}return function t(e,n,i,l,f,d,m){if(e){!m&&d&&function(t,e,n,r){var i=t;do 0===i.z&&(i.z=o(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,l,f,d);for(var g,y,b=e;e.prev!==e.next;){if(g=e.prev,y=e.next,d?function(t,e,n,r){var i=t.prev,u=t.next;if(s(i,t,u)>=0)return!1;for(var c=i.x,l=t.x,f=u.x,h=i.y,p=t.y,d=u.y,v=c<l?c<f?c:f:l<f?l:f,m=h<p?h<d?h:d:p<d?p:d,g=c>l?c>f?c:f:l>f?l:f,y=h>p?h>d?h:d:p>d?p:d,b=o(v,m,e,n,r),x=o(g,y,e,n,r),_=t.prevZ,S=t.nextZ;_&&_.z>=b&&S&&S.z<=x;){if(_.x>=v&&_.x<=g&&_.y>=m&&_.y<=y&&_!==i&&_!==u&&a(c,h,l,p,f,d,_.x,_.y)&&s(_.prev,_,_.next)>=0||(_=_.prevZ,S.x>=v&&S.x<=g&&S.y>=m&&S.y<=y&&S!==i&&S!==u&&a(c,h,l,p,f,d,S.x,S.y)&&s(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;_&&_.z>=b;){if(_.x>=v&&_.x<=g&&_.y>=m&&_.y<=y&&_!==i&&_!==u&&a(c,h,l,p,f,d,_.x,_.y)&&s(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;S&&S.z<=x;){if(S.x>=v&&S.x<=g&&S.y>=m&&S.y<=y&&S!==i&&S!==u&&a(c,h,l,p,f,d,S.x,S.y)&&s(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}(e,l,f,d):function(t){var e=t.prev,n=t.next;if(s(e,t,n)>=0)return!1;for(var r=e.x,i=t.x,o=n.x,u=e.y,c=t.y,l=n.y,f=r<i?r<o?r:o:i<o?i:o,h=u<c?u<l?u:l:c<l?c:l,p=r>i?r>o?r:o:i>o?i:o,d=u>c?u>l?u:l:c>l?c:l,v=n.next;v!==e;){if(v.x>=f&&v.x<=p&&v.y>=h&&v.y<=d&&a(r,u,i,c,o,l,v.x,v.y)&&s(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}(e)){n.push(g.i/i|0),n.push(e.i/i|0),n.push(y.i/i|0),v(e),e=y.next,b=y.next;continue}if((e=y)===b){m?1===m?t(e=function(t,e,n){var i=t;do{var o=i.prev,a=i.next.next;!u(o,a)&&c(o,i,i.next,a)&&h(o,a)&&h(a,o)&&(e.push(o.i/n|0),e.push(i.i/n|0),e.push(a.i/n|0),v(i),v(i.next),i=t=a),i=i.next}while(i!==t);return r(i)}(r(e),n,i),n,i,l,f,d,2):2===m&&function(e,n,i,o,a,l){var f=e;do{for(var d,v,m=f.next.next;m!==f.prev;){if(f.i!==m.i&&(d=f,v=m,d.next.i!==v.i&&d.prev.i!==v.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&c(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(d,v)&&(h(d,v)&&h(v,d)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}(d,v)&&(s(d.prev,d,v.prev)||s(d,v.prev,v))||u(d,v)&&s(d.prev,d,d.next)>0&&s(v.prev,v,v.next)>0))){var g=p(f,m);f=r(f,f.next),g=r(g,g.next),t(f,n,i,o,a,l,0),t(g,n,i,o,a,l,0);return}m=m.next}f=f.next}while(f!==e)}(e,n,i,l,f,d):t(r(e),n,i,l,f,d,1);break}}}}(w,k,l,f,d,x,0),k}function n(t,e,n,r,i){var o,a;if(i===g(t,e,n,r)>0)for(o=e;o<n;o+=r)a=d(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=d(o,t[o],t[o+1],a);return a&&u(a,a.next)&&(v(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var n,r=t;do if(n=!1,!r.steiner&&(u(r,r.next)||0===s(r.prev,r,r.next))){if(v(r),(r=e=r.prev)===r.next)break;n=!0}else r=r.next;while(n||r!==e);return e}function i(t,e){return t.x-e.x}function o(t,e,n,r,i){return(t=((t=((t=((t=((t=(t-n)*i|0)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)|(e=((e=((e=((e=((e=(e-r)*i|0)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)<<1}function a(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function s(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function u(t,e){return t.x===e.x&&t.y===e.y}function c(t,e,n,r){var i=f(s(t,e,n)),o=f(s(t,e,r)),a=f(s(n,r,t)),u=f(s(n,r,e));return!!(i!==o&&a!==u||0===i&&l(t,n,e)||0===o&&l(t,r,e)||0===a&&l(n,t,r)||0===u&&l(n,e,r))}function l(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function f(t){return t>0?1:t<0?-1:0}function h(t,e){return 0>s(t.prev,t,t.next)?s(t,e,t.next)>=0&&s(t,t.prev,e)>=0:0>s(t,e,t.prev)||0>s(t,t.next,e)}function p(t,e){var n=new m(t.i,t.x,t.y),r=new m(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){var i=new m(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function v(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function m(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function g(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(g(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(g(t,c,l,n))}var f=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;f+=Math.abs((t[h]-t[d])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[d+1]-t[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},90708:function(t){"use strict";var e=t.exports={};e.isIE=function(t){var e;return(-1!==(e=navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==e.indexOf("trident")||-1!==e.indexOf(" edge/"))&&(!t||t===function(){var t,e=3,n=document.createElement("div"),r=n.getElementsByTagName("i");do n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->";while(r[0]);return e>4?e:t}())},e.isLegacyOpera=function(){return!!window.opera}},73925:function(t){"use strict";(t.exports={}).forEach=function(t,e){for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}}},48866:function(t,e,n){"use strict";var r=n(90708);t.exports=function(t){var e=(t=t||{}).reporter,n=t.batchProcessor,i=t.stateHandler.getState;if(!e)throw Error("Missing required dependency: reporter.");return{makeDetectable:function(o,a,s){s||(s=a,a=o,o=null),(o=o||{}).debug,r.isIE(8)?s(a):function(a,s){var u,c=(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"].join(u=t.important?" !important; ":"; ")+u).trim(),l=!1,f=window.getComputedStyle(a),h=a.offsetWidth,p=a.offsetHeight;function d(){function t(){if("static"===f.position){a.style.setProperty("position","relative",o.important?"important":"");var t=function(t,e,n,r){var i=n[r];"auto"!==i&&"0"!==i.replace(/[^-\d\.]/g,"")&&(t.warn("An element that is positioned static has style."+r+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+r+" will be set to 0. Element: ",e),e.style.setProperty(r,"0",o.important?"important":""))};t(e,a,f,"top"),t(e,a,f,"right"),t(e,a,f,"bottom"),t(e,a,f,"left")}}""!==f.position&&(t(f),l=!0);var n=document.createElement("object");n.style.cssText=c,n.tabIndex=-1,n.type="text/html",n.setAttribute("aria-hidden","true"),n.onload=function(){l||t(),function t(e,n){if(!e.contentDocument){var r=i(e);r.checkForObjectDocumentTimeoutId&&window.clearTimeout(r.checkForObjectDocumentTimeoutId),r.checkForObjectDocumentTimeoutId=setTimeout(function(){r.checkForObjectDocumentTimeoutId=0,t(e,n)},100);return}n(e.contentDocument)}(this,function(t){s(a)})},r.isIE()||(n.data="about:blank"),i(a)&&(a.appendChild(n),i(a).object=n,r.isIE()&&(n.data="about:blank"))}i(a).startSize={width:h,height:p},n?n.add(d):d()}(a,s)},addListener:function(t,e){function n(){e(t)}if(r.isIE(8))i(t).object={proxy:n},t.attachEvent("onresize",n);else{var o=i(t).object;if(!o)throw Error("Element is not detectable by this strategy.");o.contentDocument.defaultView.addEventListener("resize",n)}},uninstall:function(t){if(i(t)){var e=i(t).object;e&&(r.isIE(8)?t.detachEvent("onresize",e.proxy):t.removeChild(e),i(t).checkForObjectDocumentTimeoutId&&window.clearTimeout(i(t).checkForObjectDocumentTimeoutId),delete i(t).object)}}}}},67896:function(t,e,n){"use strict";var r=n(73925).forEach;t.exports=function(t){var e,n,i,o,a=(t=t||{}).reporter,s=t.batchProcessor,u=t.stateHandler.getState;t.stateHandler.hasState;var c=t.idHandler;if(!s)throw Error("Missing required dependency: batchProcessor");if(!a)throw Error("Missing required dependency: reporter.");var l=((e=document.createElement("div")).style.cssText=p(["position: absolute","width: 1000px","height: 1000px","visibility: hidden","margin: 0","padding: 0"]),(n=document.createElement("div")).style.cssText=p(["position: absolute","width: 500px","height: 500px","overflow: scroll","visibility: none","top: -1500px","left: -1500px","visibility: hidden","margin: 0","padding: 0"]),n.appendChild(e),document.body.insertBefore(n,document.body.firstChild),i=500-n.clientWidth,o=500-n.clientHeight,document.body.removeChild(n),{width:i,height:o}),f="erd_scroll_detection_container";function h(t){!function(t,e,n){if(!t.getElementById(e)){var r,i,o,a=n+"_animation",s="/* Created by the element-resize-detector library. */\n";s+="."+n+" > div::-webkit-scrollbar { "+p(["display: none"])+" }\n\n"+("."+n+"_animation_active { ")+p(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+a,"animation-name: "+a])+" }\n@-webkit-keyframes "+a+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }\n@keyframes "+a+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",r=s,i=i||function(e){t.head.appendChild(e)},(o=t.createElement("style")).innerHTML=r,o.id=e,i(o)}}(t,"erd_scroll_detection_scrollbar_style",f)}function p(e){var n=t.important?" !important; ":"; ";return(e.join(n)+n).trim()}function d(t,e,n){if(t.addEventListener)t.addEventListener(e,n);else{if(!t.attachEvent)return a.error("[scroll] Don't know how to add event listeners.");t.attachEvent("on"+e,n)}}function v(t,e,n){if(t.removeEventListener)t.removeEventListener(e,n);else{if(!t.detachEvent)return a.error("[scroll] Don't know how to remove event listeners.");t.detachEvent("on"+e,n)}}function m(t){return u(t).container.childNodes[0].childNodes[0].childNodes[0]}function g(t){return u(t).container.childNodes[0].childNodes[0].childNodes[1]}return h(window.document),{makeDetectable:function(t,e,n){var i,o,h;function v(){if(t.debug){var n=Array.prototype.slice.call(arguments);if(n.unshift(c.get(e),"Scroll: "),a.log.apply)a.log.apply(null,n);else for(var r=0;r<n.length;r++)a.log(n[r])}}function y(t){var e=u(t).container.childNodes[0],n=window.getComputedStyle(e);return!n.width||-1===n.width.indexOf("px")}function b(){var t=window.getComputedStyle(e),n={};return n.position=t.position,n.width=e.offsetWidth,n.height=e.offsetHeight,n.top=t.top,n.right=t.right,n.bottom=t.bottom,n.left=t.left,n.widthCSS=t.width,n.heightCSS=t.height,n}function x(){if(v("storeStyle invoked."),!u(e)){v("Aborting because element has been uninstalled");return}var t=b();u(e).style=t}function _(t,e,n){u(t).lastWidth=e,u(t).lastHeight=n}function S(){return 2*l.width+1}function w(){return 2*l.height+1}function k(t,e,n){var r=m(t),i=g(t),o=e+10+S(),a=n+10+w(),s=2*e+S(),u=2*n+w();r.scrollLeft=o,r.scrollTop=a,i.scrollLeft=s,i.scrollTop=u}function C(){var t=u(e).container;if(!t){(t=document.createElement("div")).className=f,t.style.cssText=p(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),u(e).container=t,n=t,n.className+=" "+f+"_animation_active",e.appendChild(t);var n,r=function(){u(e).onRendered&&u(e).onRendered()};d(t,"animationstart",r),u(e).onAnimationStart=r}return t}function E(){if(v("Injecting elements"),!u(e)){v("Aborting because element has been uninstalled");return}!function(){var n=u(e).style;if("static"===n.position){e.style.setProperty("position","relative",t.important?"important":"");var r=function(t,e,n,r){var i=n[r];"auto"!==i&&"0"!==i.replace(/[^-\d\.]/g,"")&&(t.warn("An element that is positioned static has style."+r+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+r+" will be set to 0. Element: ",e),e.style[r]=0)};r(a,e,n,"top"),r(a,e,n,"right"),r(a,e,n,"bottom"),r(a,e,n,"left")}}();var n,r,i,o,s=u(e).container;s||(s=C());var c=l.width,h=l.height,m=p(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),g=p(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat((n=-(1+c),r=-(1+h),i=-h,["left: "+(n=n?n+"px":"0"),"top: "+(r=r?r+"px":"0"),"right: "+(o=(o=-c)?o+"px":"0"),"bottom: "+(i=i?i+"px":"0")]))),y=p(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),b=p(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),x=p(["position: absolute","left: 0","top: 0"]),_=p(["position: absolute","width: 200%","height: 200%"]),S=document.createElement("div"),w=document.createElement("div"),k=document.createElement("div"),E=document.createElement("div"),A=document.createElement("div"),M=document.createElement("div");function L(){var t=u(e);t&&t.onExpand?t.onExpand():v("Aborting expand scroll handler: element has been uninstalled")}function Z(){var t=u(e);t&&t.onShrink?t.onShrink():v("Aborting shrink scroll handler: element has been uninstalled")}S.dir="ltr",S.style.cssText=m,S.className=f,w.className=f,w.style.cssText=g,k.style.cssText=y,E.style.cssText=x,A.style.cssText=b,M.style.cssText=_,k.appendChild(E),A.appendChild(M),w.appendChild(k),w.appendChild(A),S.appendChild(w),s.appendChild(S),d(k,"scroll",L),d(A,"scroll",Z),u(e).onExpandScroll=L,u(e).onShrinkScroll=Z}function A(){function n(e,n,r){var i=m(e).childNodes[0],o=n+10+S(),a=r+10+w();i.style.setProperty("width",o+"px",t.important?"important":""),i.style.setProperty("height",a+"px",t.important?"important":"")}function i(r){var i=e.offsetWidth,l=e.offsetHeight,f=i!==u(e).lastWidth||l!==u(e).lastHeight;v("Storing current size",i,l),_(e,i,l),s.add(0,function(){if(f){if(!u(e)){v("Aborting because element has been uninstalled");return}if(!o()){v("Aborting because element container has not been initialized");return}if(t.debug){var r=e.offsetWidth,s=e.offsetHeight;(r!==i||s!==l)&&a.warn(c.get(e),"Scroll: Size changed before updating detector elements.")}n(e,i,l)}}),s.add(1,function(){if(!u(e)){v("Aborting because element has been uninstalled");return}if(!o()){v("Aborting because element container has not been initialized");return}k(e,i,l)}),f&&r&&s.add(2,function(){if(!u(e)){v("Aborting because element has been uninstalled");return}if(!o()){v("Aborting because element container has not been initialized");return}r()})}function o(){return!!u(e).container}function l(){v("notifyListenersIfNeeded invoked");var t=u(e);return void 0===u(e).lastNotifiedWidth&&t.lastWidth===t.startSize.width&&t.lastHeight===t.startSize.height?v("Not notifying: Size is the same as the start size, and there has been no notification yet."):t.lastWidth===t.lastNotifiedWidth&&t.lastHeight===t.lastNotifiedHeight?v("Not notifying: Size already notified"):void(v("Current size not notified, notifying..."),t.lastNotifiedWidth=t.lastWidth,t.lastNotifiedHeight=t.lastHeight,r(u(e).listeners,function(t){t(e)}))}function f(){if(v("Scroll detected."),y(e)){v("Scroll event fired while unrendered. Ignoring...");return}i(l)}if(v("registerListenersAndPositionElements invoked."),!u(e)){v("Aborting because element has been uninstalled");return}u(e).onRendered=function(){if(v("startanimation triggered."),y(e)){v("Ignoring since element is still unrendered...");return}v("Element rendered.");var t=m(e),n=g(e);(0===t.scrollLeft||0===t.scrollTop||0===n.scrollLeft||0===n.scrollTop)&&(v("Scrollbars out of sync. Updating detector elements..."),i(l))},u(e).onExpand=f,u(e).onShrink=f;var h=u(e).style;n(e,h.width,h.height)}function M(){if(v("finalizeDomMutation invoked."),!u(e)){v("Aborting because element has been uninstalled");return}var t=u(e).style;_(e,t.width,t.height),k(e,t.width,t.height)}function L(){n(e)}function Z(){var t;v("Installing..."),u(e).listeners=[],t=b(),u(e).startSize={width:t.width,height:t.height},v("Element start size",u(e).startSize),s.add(0,x),s.add(1,E),s.add(2,A),s.add(3,M),s.add(4,L)}n||(n=e,e=t,t=null),t=t||{},(v("Making detectable..."),(h=(o=i=e).getRootNode&&o.getRootNode().contains(o),(o===o.ownerDocument.body||o.ownerDocument.body.contains(o)||h)&&null!==window.getComputedStyle(i))?1:0)?Z():(v("Element is detached"),C(),v("Waiting until element is attached..."),u(e).onRendered=function(){v("Element is now attached"),Z()})},addListener:function(t,e){if(!u(t).listeners.push)throw Error("Cannot add listener to an element that is not detectable.");u(t).listeners.push(e)},uninstall:function(t){var e=u(t);e&&(e.onExpandScroll&&v(m(t),"scroll",e.onExpandScroll),e.onShrinkScroll&&v(g(t),"scroll",e.onShrinkScroll),e.onAnimationStart&&v(e.container,"animationstart",e.onAnimationStart),e.container&&t.removeChild(e.container))},initDocument:h}}},23369:function(t,e,n){"use strict";var r=n(73925).forEach,i=n(89351),o=n(65326),a=n(95669),s=n(14171),u=n(88067),c=n(90708),l=n(12312),f=n(70022),h=n(48866),p=n(67896);function d(t){return Array.isArray(t)||void 0!==t.length}function v(t){if(Array.isArray(t))return t;var e=[];return r(t,function(t){e.push(t)}),e}function m(t){return t&&1===t.nodeType}function g(t,e,n){var r=t[e];return null==r&&void 0!==n?n:r}t.exports=function(t){if((t=t||{}).idHandler)e={get:function(e){return t.idHandler.get(e,!0)},set:t.idHandler.set};else{var e,n;e=s({idGenerator:a(),stateHandler:f})}var y=t.reporter;y||(y=u(!1===y));var b=g(t,"batchProcessor",l({reporter:y})),x={};x.callOnAdd=!!g(t,"callOnAdd",!0),x.debug=!!g(t,"debug",!1);var _=o(e),S=i({stateHandler:f}),w=g(t,"strategy","object"),k=g(t,"important",!1),C={reporter:y,batchProcessor:b,stateHandler:f,idHandler:e,important:k};if("scroll"===w&&(c.isLegacyOpera()?(y.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),w="object"):c.isIE(9)&&(y.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),w="object")),"scroll"===w)n=p(C);else if("object"===w)n=h(C);else throw Error("Invalid strategy name: "+w);var E={};return{listenTo:function(t,i,o){function a(t){r(_.get(t),function(e){e(t)})}function s(t,e,n){_.add(e,n),t&&n(e)}if(o||(o=i,i=t,t={}),!i)throw Error("At least one element required.");if(!o)throw Error("Listener required.");if(m(i))i=[i];else{if(!d(i))return y.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");i=v(i)}var u=0,c=g(t,"callOnAdd",x.callOnAdd),l=g(t,"onReady",function(){}),h=g(t,"debug",x.debug);r(i,function(t){f.getState(t)||(f.initState(t),e.set(t));var p=e.get(t);if(h&&y.log("Attaching listener to element",p,t),!S.isDetectable(t)){if(h&&y.log(p,"Not detectable."),S.isBusy(t)){h&&y.log(p,"System busy making it detectable"),s(c,t,o),E[p]=E[p]||[],E[p].push(function(){++u===i.length&&l()});return}return h&&y.log(p,"Making detectable..."),S.markBusy(t,!0),n.makeDetectable({debug:h,important:k},t,function(t){if(h&&y.log(p,"onElementDetectable"),f.getState(t)){S.markAsDetectable(t),S.markBusy(t,!1),n.addListener(t,a),s(c,t,o);var e=f.getState(t);if(e&&e.startSize){var d=t.offsetWidth,v=t.offsetHeight;(e.startSize.width!==d||e.startSize.height!==v)&&a(t)}E[p]&&r(E[p],function(t){t()})}else h&&y.log(p,"Element uninstalled before being detectable.");delete E[p],++u===i.length&&l()})}h&&y.log(p,"Already detecable, adding listener."),s(c,t,o),u++}),u===i.length&&l()},removeListener:_.removeListener,removeAllListeners:_.removeAllListeners,uninstall:function(t){if(!t)return y.error("At least one element is required.");if(m(t))t=[t];else{if(!d(t))return y.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");t=v(t)}r(t,function(t){_.removeAllListeners(t),n.uninstall(t),f.cleanState(t)})},initDocument:function(t){n.initDocument&&n.initDocument(t)}}}},89351:function(t){"use strict";t.exports=function(t){var e=t.stateHandler.getState;return{isDetectable:function(t){var n=e(t);return n&&!!n.isDetectable},markAsDetectable:function(t){e(t).isDetectable=!0},isBusy:function(t){return!!e(t).busy},markBusy:function(t,n){e(t).busy=!!n}}}},95669:function(t){"use strict";t.exports=function(){var t=1;return{generate:function(){return t++}}}},14171:function(t){"use strict";t.exports=function(t){var e=t.idGenerator,n=t.stateHandler.getState;return{get:function(t){var e=n(t);return e&&void 0!==e.id?e.id:null},set:function(t){var r=n(t);if(!r)throw Error("setId required the element to have a resize detection state.");var i=e.generate();return r.id=i,i}}}},65326:function(t){"use strict";t.exports=function(t){var e={};function n(n){var r=t.get(n);return void 0===r?[]:e[r]||[]}return{get:n,add:function(n,r){var i=t.get(n);e[i]||(e[i]=[]),e[i].push(r)},removeListener:function(t,e){for(var r=n(t),i=0,o=r.length;i<o;++i)if(r[i]===e){r.splice(i,1);break}},removeAllListeners:function(t){var e=n(t);e&&(e.length=0)}}}},88067:function(t){"use strict";t.exports=function(t){function e(){}var n={log:e,warn:e,error:e};if(!t&&window.console){var r=function(t,e){t[e]=function(){var t=console[e];if(t.apply)t.apply(console,arguments);else for(var n=0;n<arguments.length;n++)t(arguments[n])}};r(n,"log"),r(n,"warn"),r(n,"error")}return n}},70022:function(t){"use strict";var e="_erd";t.exports={initState:function(t){return t[e]={},t[e]},getState:function(t){return t[e]},cleanState:function(t){delete t[e]}}},32614:function(t){"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,o),!0;case 6:return l.fn.call(l.context,e,r,i,o,a),!0}for(c=1,u=Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,r);break;case 4:l[c].fn.call(l[c].context,e,r,i);break;default:if(!u)for(h=1,u=Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s},45796:function(t,e,n){var r;/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(i,o,a,s){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],l=o.createElement("div"),f=Math.round,h=Math.abs,p=Date.now;function d(t,e,n){return setTimeout(_(t,n),e)}function v(t,e,n){return!!Array.isArray(t)&&(m(t,n[e],n),!0)}function m(t,e,n){var r;if(t){if(t.forEach)t.forEach(e,n);else if(s!==t.length)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}}function g(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(null==t)throw TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var y=g(function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&s===t[r[i]])&&(t[r[i]]=e[r[i]]),i++;return t},"extend","Use `assign`."),b=g(function(t,e){return y(t,e,!0)},"merge","Use `assign`.");function x(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&u(r,n)}function _(t,e){return function(){return t.apply(e,arguments)}}function S(t,e){return"function"==typeof t?t.apply(e&&e[0]||s,e):t}function w(t,e,n){m(A(e),function(e){t.addEventListener(e,n,!1)})}function k(t,e,n){m(A(e),function(e){t.removeEventListener(e,n,!1)})}function C(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function E(t,e){return t.indexOf(e)>-1}function A(t){return t.trim().split(/\s+/g)}function M(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return -1}function L(t){return Array.prototype.slice.call(t,0)}function Z(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];0>M(i,a)&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort(function(t,n){return t[e]>n[e]}):r.sort()),r}function P(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:e)in t)return r;o++}}var O=1;function R(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var I="ontouchstart"in i,D=s!==P(i,"PointerEvent"),N=I&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z="touch",j="mouse",B=["x","y"],F=["clientX","clientY"];function U(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){S(t.options.enable,[t])&&n.handler(e)},this.init()}function V(t,e,n){var r,i,o,a,u,c,l,f,d,v,m,g,y,b,x,_=n.pointers.length,S=n.changedPointers.length,w=1&e&&_-S==0,k=12&e&&_-S==0;n.isFirst=!!w,n.isFinal=!!k,w&&(t.session={}),n.eventType=e,r=t.session,o=(i=n.pointers).length,r.firstInput||(r.firstInput=H(n)),o>1&&!r.firstMultiple?r.firstMultiple=H(n):1===o&&(r.firstMultiple=!1),a=r.firstInput,c=(u=r.firstMultiple)?u.center:a.center,l=n.center=G(i),n.timeStamp=p(),n.deltaTime=n.timeStamp-a.timeStamp,n.angle=X(c,l),n.distance=q(c,l),f=n.center,d=r.offsetDelta||{},v=r.prevDelta||{},m=r.prevInput||{},(1===n.eventType||4===m.eventType)&&(v=r.prevDelta={x:m.deltaX||0,y:m.deltaY||0},d=r.offsetDelta={x:f.x,y:f.y}),n.deltaX=v.x+(f.x-d.x),n.deltaY=v.y+(f.y-d.y),n.offsetDirection=Y(n.deltaX,n.deltaY),g=W(n.deltaTime,n.deltaX,n.deltaY),n.overallVelocityX=g.x,n.overallVelocityY=g.y,n.overallVelocity=h(g.x)>h(g.y)?g.x:g.y,n.scale=u?(y=u.pointers,q(i[0],i[1],F)/q(y[0],y[1],F)):1,n.rotation=u?(b=u.pointers,X(i[1],i[0],F)+X(b[1],b[0],F)):0,n.maxPointers=r.prevInput?n.pointers.length>r.prevInput.maxPointers?n.pointers.length:r.prevInput.maxPointers:n.pointers.length,function(t,e){var n,r,i,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(u>25||s===a.velocity)){var c=e.deltaX-a.deltaX,l=e.deltaY-a.deltaY,f=W(u,c,l);r=f.x,i=f.y,n=h(f.x)>h(f.y)?f.x:f.y,o=Y(c,l),t.lastInterval=e}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}(r,n),x=t.element,C(n.srcEvent.target,x)&&(x=n.srcEvent.target),n.target=x,t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function H(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:f(t.pointers[n].clientX),clientY:f(t.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:e,center:G(e),deltaX:t.deltaX,deltaY:t.deltaY}}function G(t){var e=t.length;if(1===e)return{x:f(t[0].clientX),y:f(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:f(n/e),y:f(r/e)}}function W(t,e,n){return{x:e/t||0,y:n/t||0}}function Y(t,e){return t===e?1:h(t)>=h(e)?t<0?2:4:e<0?8:16}function q(t,e,n){n||(n=B);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function X(t,e,n){n||(n=B);var r=e[n[0]]-t[n[0]];return 180*Math.atan2(e[n[1]]-t[n[1]],r)/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(R(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4};function $(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,U.apply(this,arguments)}x($,U,{handler:function(t){var e=K[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:j,srcEvent:t}))}});var Q={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},J={2:z,3:"pen",4:j,5:"kinect"},tt="pointerdown",te="pointermove pointerup pointercancel";function tn(){this.evEl=tt,this.evWin=te,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(tt="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel"),x(tn,U,{handler:function(t){var e=this.store,n=!1,r=Q[t.type.toLowerCase().replace("ms","")],i=J[t.pointerType]||t.pointerType,o=i==z,a=M(e,t.pointerId,"pointerId");1&r&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):12&r&&(n=!0),!(a<0)&&(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:i,srcEvent:t}),n&&e.splice(a,1))}});var tr={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ti(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,U.apply(this,arguments)}function to(t,e){var n=L(t.touches),r=L(t.changedTouches);return 12&e&&(n=Z(n.concat(r),"identifier",!0)),[n,r]}x(ti,U,{handler:function(t){var e=tr[t.type];if(1===e&&(this.started=!0),this.started){var n=to.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:t})}}});var ta={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ts(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},U.apply(this,arguments)}function tu(t,e){var n=L(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=L(t.changedTouches),s=[],u=this.target;if(o=n.filter(function(t){return C(t.target,u)}),1===e)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&e&&delete r[a[i].identifier],i++;if(s.length)return[Z(o.concat(s),"identifier",!0),s]}function tc(){U.apply(this,arguments);var t=_(this.handler,this);this.touch=new ts(this.manager,t),this.mouse=new $(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function tl(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,tf.call(this,e)):12&t&&tf.call(this,e)}function tf(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout(function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)},2500)}}function th(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}x(ts,U,{handler:function(t){var e=ta[t.type],n=tu.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:t})}}),x(tc,U,{handler:function(t,e,n){var r=n.pointerType==z,i=n.pointerType==j;if(!i||!n.sourceCapabilities||!n.sourceCapabilities.firesTouchEvents){if(r)tl.call(this,e,n);else if(i&&th.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var tp=P(l.style,"touchAction"),td=s!==tp,tv="compute",tm="auto",tg="manipulation",ty="none",tb="pan-x",tx="pan-y",t_=function(){if(!td)return!1;var t={},e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!e||i.CSS.supports("touch-action",n)}),t}();function tS(t,e){this.manager=t,this.set(e)}function tw(t){var e;this.options=u({},this.defaults,t||{}),this.id=O++,this.manager=null,this.options.enable=s===(e=this.options.enable)||e,this.state=1,this.simultaneous={},this.requireFail=[]}function tk(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function tC(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function tE(t,e){var n=e.manager;return n?n.get(t):t}function tA(){tw.apply(this,arguments)}function tM(){tA.apply(this,arguments),this.pX=null,this.pY=null}function tT(){tA.apply(this,arguments)}function tL(){tw.apply(this,arguments),this._timer=null,this._input=null}function tZ(){tA.apply(this,arguments)}function tP(){tA.apply(this,arguments)}function tO(){tw.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function tR(t,e){var n,r;return(e=e||{}).recognizers=(n=e.recognizers,r=tR.defaults.preset,s===n?r:n),new tI(t,e)}function tI(t,e){var n;this.options=u({},tR.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this.options.inputClass)?n:D?tn:N?ts:I?tc:$)(this,V),this.touchAction=new tS(this,this.options.touchAction),tD(this,!0),m(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function tD(t,e){var n,r=t.element;r.style&&(m(t.options.cssProps,function(i,o){n=P(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={}))}tS.prototype={set:function(t){t==tv&&(t=this.compute()),td&&this.manager.element.style&&t_[t]&&(this.manager.element.style[tp]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return m(this.manager.recognizers,function(e){S(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(E(t,ty))return ty;var e=E(t,tb),n=E(t,tx);return e&&n?ty:e||n?e?tb:tx:E(t,tg)?tg:tm}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}var r=this.actions,i=E(r,ty)&&!t_[ty],o=E(r,tx)&&!t_[tx],a=E(r,tb)&&!t_[tb];if(i){var s=1===t.pointers.length,u=t.distance<2,c=t.deltaTime<250;if(s&&u&&c)return}if((!a||!o)&&(i||o&&6&n||a&&24&n))return this.preventSrc(e)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}},tw.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(v(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=tE(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return v(t,"dropRecognizeWith",this)||(t=tE(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(v(t,"requireFailure",this))return this;var e=this.requireFail;return -1===M(e,t=tE(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(v(t,"dropRequireFailure",this))return this;t=tE(t,this);var e=M(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+tk(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+tk(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!S(this.options.enable,[this,e])){this.reset(),this.state=32;return}56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},x(tA,tw,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:32}}),x(tM,tA,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(tx),24&t&&e.push(tb),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(6&e.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return tA.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=tC(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),x(tT,tA,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ty]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),x(tL,tw,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[tm]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,r&&n&&(!(12&t.eventType)||i)){if(1&t.eventType)this.reset(),this._timer=d(function(){this.state=8,this.tryEmit()},e.time,this);else if(4&t.eventType)return 8}else this.reset();return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),x(tZ,tA,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ty]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),x(tP,tA,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return tM.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&h(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=tC(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),x(tO,tw,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[tg]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||q(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=d(function(){this.state=8,this.tryEmit()},e.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),tR.VERSION="2.0.7",tR.defaults={domEvents:!1,touchAction:tv,enable:!0,inputTarget:null,inputClass:null,preset:[[tZ,{enable:!1}],[tT,{enable:!1},["rotate"]],[tP,{direction:6}],[tM,{direction:6},["swipe"]],[tO],[tO,{event:"doubletap",taps:2},["tap"]],[tL]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},tI.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e,n=this.session;if(!n.stopped){this.touchAction.preventDefaults(t);var r=this.recognizers,i=n.curRecognizer;(!i||i&&8&i.state)&&(i=n.curRecognizer=null);for(var o=0;o<r.length;)e=r[o],2!==n.stopped&&(!i||e==i||e.canRecognizeWith(i))?e.recognize(t):e.reset(),!i&&14&e.state&&(i=n.curRecognizer=e),o++}},get:function(t){if(t instanceof tw)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(v(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(v(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=M(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(s!==t&&s!==e){var n=this.handlers;return m(A(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(s!==t){var n=this.handlers;return m(A(t),function(t){e?n[t]&&n[t].splice(M(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&((n=o.createEvent("Event")).initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n));var n,r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](e),i++}},destroy:function(){this.element&&tD(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(tR,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:tI,Input:U,TouchAction:tS,TouchInput:ts,MouseInput:$,PointerEventInput:tn,TouchMouseInput:tc,SingleTouchInput:ti,Recognizer:tw,AttrRecognizer:tA,Tap:tO,Pan:tM,Swipe:tP,Pinch:tT,Rotate:tZ,Press:tL,on:w,off:k,each:m,merge:b,extend:y,assign:u,inherit:x,bindFn:_,prefixed:P}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=tR,s!==(r=(function(){return tR}).call(e,n,e,t))&&(t.exports=r)}(window,document,0)},61531:function(t,e){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+t[e+f],f+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?5960464477539062e-23:0,p=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+f>=1?e+=h/u:e+=h*Math.pow(2,1-f),e*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(e*u-1)*Math.pow(2,i),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+p]=255&a,p+=d,a/=256,c-=8);t[n+p-d]|=128*v}},15576:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(t,e,r,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return(i&&!Reflect.hasMetadata(n,this,e)&&Reflect.defineMetadata(n,r(),this,e),Reflect.hasMetadata(n,this,e))?Reflect.getMetadata(n,this,e):r()},set:function(t){Reflect.defineMetadata(n,t,this,e)}})}e.makePropertyInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,function(){return t.get(n)},e)}}},e.makePropertyInjectNamedDecorator=function(t,e){return function(n,i){return function(o,a){r(o,a,function(){return t.getNamed(n,i)},e)}}},e.makePropertyInjectTaggedDecorator=function(t,e){return function(n,i,o){return function(a,s){r(a,s,function(){return t.getTagged(n,i,o)},e)}}},e.makePropertyMultiInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,function(){return t.getAll(n)},e)}}}},55729:function(t,e,n){"use strict";var r=n(15576);e.Z=function(t,e){return void 0===e&&(e=!0),{lazyInject:r.makePropertyInjectDecorator(t,e),lazyInjectNamed:r.makePropertyInjectNamedDecorator(t,e),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(t,e),lazyMultiInject:r.makePropertyMultiInjectDecorator(t,e)}}},23527:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var r=n(1760),i=n(15154);function o(t,e,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var c=a[u];if(Array.isArray(c))for(var l=0,f=c;l<f.length;l++){var h=f[l];if(h.key===i.key)throw Error(r.DUPLICATED_METADATA+" "+h.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(t,a,e)}function a(t,e){Reflect.decorate(t,e)}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?a([function(e,r){t(e,r,n)}],e):"string"==typeof n?Reflect.decorate([t],e,n):a([t],e)}},50929:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var r=n(1760),i=n(15154),o=n(85200),a=n(23527),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=s,e.inject=function(t){return function(e,n,s){if(void 0===t)throw Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}},28323:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var r=n(1760),i=n(15154);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},39019:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var r=n(15154),i=n(85200),o=n(23527);e.multiInject=function(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},81990:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var r=n(15154),i=n(85200),o=n(23527);e.named=function(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},16669:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var r=n(15154),i=n(85200),o=n(23527);e.optional=function(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}},41946:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var r=n(1760),i=n(15154),o=n(85200);e.postConstruct=function(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}},31423:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var r=n(85200),i=n(23527);e.tagged=function(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},27022:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var r=n(15154),i=n(85200),o=n(23527);e.targetName=function(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}},13334:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var r=n(15154),i=n(85200),o=n(23527);e.unmanaged=function(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}},26470:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var r=n(93691),i=n(68847),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===r.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},95630:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0,e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},1760:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]},e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},93691:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0,e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},15154:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]},80582:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var a=n(26470),s=n(1760),u=n(93691),c=n(15154),l=n(8081),f=n(44223),h=n(40511),p=n(66881),d=n(68847),v=n(19070),m=n(64623),g=n(55403),y=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!=typeof e)throw Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=u.BindingScopeEnum.Transient;else if(e.defaultScope!==u.BindingScopeEnum.Singleton&&e.defaultScope!==u.BindingScopeEnum.Transient&&e.defaultScope!==u.BindingScopeEnum.Request)throw Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=d.id(),this._bindingDictionary=new g.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new l.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new t,s=o([e,n],r).map(function(t){return f.getBindingDictionary(t)}),u=f.getBindingDictionary(a);return s.forEach(function(t){!function(t,e){t.traverse(function(t,n){n.forEach(function(t){e.add(t.serviceIdentifier,t.clone())})})}(t,u)}),a},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0;r<t.length;r++){var i=t[r],o=n(i.id);i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,function(){var e,n,r,o,a;return i(this,function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:if(!(n<r.length))return[3,4];return o=r[n],a=e(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){var n,r=(n=e.id,function(t){return t.moduleId===n});t._bindingDictionary.removeByCondition(r)})},t.prototype.bind=function(t){var e=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(t,e);return this._bindingDictionary.add(t,n),new p.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw Error(s.CANNOT_UNBIND+" "+v.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new g.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,c.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=f.createMockRequest(this,t,e,n);r=i.some(function(t){return t.constraint(o)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(m.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(t,e){return e(t)},n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,u.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,c.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,u.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,c.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach(function(t){e.applyMiddleware(t)}),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e};return function(n){return{bindFunction:function(r){var i=t.bind.bind(t)(r);return e(i,n),i},isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:function(r){var i=t.rebind.bind(t)(r);return e(i,n),i},unbindFunction:function(e){t.unbind.bind(t)(e)}}}},t.prototype._get=function(t,e,n,r,i,o){var a=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=f.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),h.resolve(n)}},t}();e.Container=y},143:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var r=n(68847);e.ContainerModule=function(t){this.id=r.id(),this.registry=t},e.AsyncContainerModule=function(t){this.id=r.id(),this.registry=t}},64623:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var n=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=n},55403:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var r=n(1760),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t||null==e)throw Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach(function(n,r){var i=n.filter(function(e){return!t(e)});i.length>0?e._map.set(r,i):e._map.delete(r)})},t.prototype.hasKey=function(t){if(null==t)throw Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach(function(t,n){t.forEach(function(t){return e.add(n,t.clone())})}),e},t.prototype.traverse=function(t){this._map.forEach(function(e,n){t(n,e)})},t}();e.Lookup=i},15581:function(t,e,n){"use strict";e.GW=e.zY=e.f3=e.b2=e.W2=void 0,n(15154);var r=n(80582);Object.defineProperty(e,"W2",{enumerable:!0,get:function(){return r.Container}}),n(93691),n(143);var i=n(28323);Object.defineProperty(e,"b2",{enumerable:!0,get:function(){return i.injectable}}),n(31423),n(81990);var o=n(50929);Object.defineProperty(e,"f3",{enumerable:!0,get:function(){return o.inject}}),n(16669),n(13334),n(39019),n(27022);var a=n(41946);Object.defineProperty(e,"zY",{enumerable:!0,get:function(){return a.postConstruct}}),n(8081),n(68847);var s=n(23527);Object.defineProperty(e,"GW",{enumerable:!0,get:function(){return s.decorate}}),n(79199),n(19070),n(58768)},60858:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var r=n(68847),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},85200:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=n(15154),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},8081:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var r=n(15154),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},75557:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0,e.Plan=function(t,e){this.parentContext=t,this.rootRequest=e}},44223:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var r=n(95630),i=n(1760),o=n(93691),a=n(15154),s=n(9547),u=n(19070),c=n(60858),l=n(85200),f=n(75557),h=n(32323),p=n(58045),d=n(37247);function v(t){return t._bindingDictionary}function m(t,e,n,o,a){var s=g(n.container,a.serviceIdentifier),c=[];return s.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),s=g(n.container,a.serviceIdentifier)),c=e?s:s.filter(function(t){var e=new p.Request(t.serviceIdentifier,n,o,t,a);return t.constraint(e)}),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw Error(s+=u.listMetadataForTarget(a,n)+u.listRegisteredBindingsForServiceIdentifier(o,a,g));case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return;var a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a;throw Error(s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g))}}(a.serviceIdentifier,c,a,n.container),c}function g(t,e){var n=[],r=v(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=g(t.parent,e)),n}e.getBindingDictionary=v,e.plan=function(t,e,n,r,v,g,y,b){void 0===b&&(b=!1);var x=new c.Context(e),_=function(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new d.Target(e,"",n,u);if(void 0!==i){var f=new l.Metadata(i,o);c.metadata.push(f)}return c}(n,r,v,0,g,y);try{return function t(e,n,r,a,s,u){if(null===s){c=m(e,n,a,null,u),l=new p.Request(r,a,null,c,u);var c,l,d=new f.Plan(a,l);a.addPlan(d)}else c=m(e,n,a,s,u),l=s.addChildRequest(u.serviceIdentifier,c,u);c.forEach(function(n){var r=null;if(u.isArray())r=l.addChildRequest(n.serviceIdentifier,n,u);else{if(n.cache)return;r=l}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var s=h.getDependencies(e,n.implementationType);if(!a.container.options.skipBaseClassChecks){var c=h.getBaseClassDependencyCount(e,n.implementationType);if(s.length<c)throw Error(i.ARGUMENTS_LENGTH_MISMATCH(h.getFunctionName(n.implementationType)))}s.forEach(function(n){t(e,!1,n.serviceIdentifier,a,r,n)})}})}(t,b,v,x,null,_),x}catch(t){throw s.isStackOverflowExeption(t)&&x.plan&&u.circularDependencyToException(x.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",e,new l.Metadata(n,r)),a=new c.Context(t);return new p.Request(e,a,null,[],i)}},12121:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var n=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e="",n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return -1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=n},32323:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var i=n(50929),o=n(1760),a=n(93691),s=n(15154),u=n(19070);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var c=n(37247);function l(t,e,n,s){var u=t.getConstructorMetadata(n),l=u.compilerGeneratedMetadata;if(void 0===l)throw Error(o.MISSING_INJECTABLE_ANNOTATION+" "+e+".");var h=u.userGeneratedMetadata,p=Object.keys(h),d=0===n.length&&p.length>0,v=p.length>n.length,m=function(t,e,n,r,s){for(var u=[],l=0;l<s;l++){var h=function(t,e,n,r,s){var u=s[t.toString()]||[],l=f(u),h=!0!==l.unmanaged,p=r[t];if((p=l.inject||l.multiInject||p)instanceof i.LazyServiceIdentifer&&(p=p.unwrap()),h){var d=p===Object,v=p===Function,m=void 0===p;if(!e&&(d||v||m))throw Error(o.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".");var g=new c.Target(a.TargetTypeEnum.ConstructorArgument,l.targetName,p);return g.metadata=u,g}return null}(l,t,e,n,r);null!==h&&u.push(h)}return u}(s,e,l,h,d||v?p.length:n.length),g=function t(e,n){for(var i=e.getPropertiesMetadata(n),o=[],s=Object.keys(i),u=0;u<s.length;u++){var l=s[u],h=i[l],p=f(i[l]),d=p.targetName||l,v=p.inject||p.multiInject,m=new c.Target(a.TargetTypeEnum.ClassProperty,d,v);m.metadata=h,o.push(m)}var g=Object.getPrototypeOf(n.prototype).constructor;if(g!==Object){var y=t(e,g);o=r(r([],o),y)}return o}(t,n);return r(r([],m),g)}function f(t){var e={};return t.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return l(t,u.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r===Object)return 0;var i=l(e,u.getFunctionName(r),r,!0),o=i.map(function(t){return t.metadata.filter(function(t){return t.key===s.UNMANAGED_TAG})}),a=[].concat.apply([],o).length,c=i.length-a;return c>0?c:t(e,r)}},58045:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var r=n(68847),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},37247:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var r=n(15154),i=n(68847),o=n(85200),a=n(12121),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=[];var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++)if(n[e].key===t)return!0;return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some(function(t){return r.NON_CUSTOM_TAG_KEYS.every(function(e){return t.key!==e})})},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===r.NAMED_TAG})[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return r.NON_CUSTOM_TAG_KEYS.every(function(e){return t.key!==e})}):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},94130:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var i=n(1760),o=n(93691),a=n(15154);e.resolveInstance=function(t,e,n){var s=null;if(e.length>0){var u,c,l,f=e.filter(function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ConstructorArgument}).map(n);u=s=new(t.bind.apply(t,r([void 0],f))),l=(c=e.filter(function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ClassProperty})).map(n),c.forEach(function(t,e){var n="";n=t.target.name.value();var r=l[e];u[n]=r}),s=u}else s=new t;return!function(t,e){if(Reflect.hasMetadata(a.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw Error(i.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,s),s}},40511:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var r=n(1760),i=n(93691),o=n(9547),a=n(19070),s=n(94130),u=function(t,e,n){try{return n()}catch(n){if(o.isStackOverflowExeption(n))throw Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString()));throw n}},c=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,l=e.target&&e.target.isArray(),f=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(l&&f)return o.map(function(e){return c(t)(e)});var h=null;if(!e.target.isOptional()||0!==n.length){var p=n[0],d=p.scope===i.BindingScopeEnum.Singleton,v=p.scope===i.BindingScopeEnum.Request;if(d&&p.activated)return p.cache;if(v&&null!==t&&t.has(p.id))return t.get(p.id);if(p.type===i.BindingTypeEnum.ConstantValue)h=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Function)h=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Constructor)h=p.implementationType;else if(p.type===i.BindingTypeEnum.DynamicValue&&null!==p.dynamicValue)h=u("toDynamicValue",p.serviceIdentifier,function(){return p.dynamicValue(e.parentContext)});else if(p.type===i.BindingTypeEnum.Factory&&null!==p.factory)h=u("toFactory",p.serviceIdentifier,function(){return p.factory(e.parentContext)});else if(p.type===i.BindingTypeEnum.Provider&&null!==p.provider)h=u("toProvider",p.serviceIdentifier,function(){return p.provider(e.parentContext)});else if(p.type===i.BindingTypeEnum.Instance&&null!==p.implementationType)h=s.resolveInstance(p.implementationType,o,c(t));else{var m=a.getServiceIdentifierAsString(e.serviceIdentifier);throw Error(r.INVALID_BINDING_TYPE+" "+m)}return"function"==typeof p.onActivation&&(h=p.onActivation(e.parentContext,h)),d&&(p.cache=h,p.activated=!0),v&&null!==t&&!t.has(p.id)&&t.set(p.id,h),h}}};e.resolve=function(t){return c(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},93435:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var r=n(93691),i=n(99945),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},2873:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var r=n(93435),i=n(97977),o=n(92718),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},97977:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var r=n(92718),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},66881:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var r=n(1760),i=n(93691),o=n(2873),a=n(99945),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue(function(e){return e.container.get(t)})},t}();e.BindingToSyntax=s},99945:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var r=n(97977),i=n(92718),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},92718:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var r=n(97977),i=n(79199),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},79199:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var r=n(15154),i=n(85200),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var a=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=a;var s=a(r.NAMED_TAG);e.namedConstraint=s,e.typeConstraint=function(t){return function(e){var n=null;return null!==e&&((n=e.bindings[0],"string"==typeof t)?n.serviceIdentifier===t:t===e.bindings[0].implementationType)}}},58768:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0,e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach(function(n){return t.bind(n).toService(e)})}}}},9547:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var r=n(1760);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},68847:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var n=0;e.id=function(){return n++}},19070:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var r=n(1760);function i(t){if("function"==typeof t){var e=t;return e.name}if("symbol"==typeof t)return t.toString();var e=t;return e}function o(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach(function(t){var e="Object";null!==t.implementationType&&(e=o(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)})),r},e.circularDependencyToException=function t(e){e.childRequests.forEach(function(e){if(function t(e,n){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===n||t(e.parentRequest,n))}(e,e.serviceIdentifier)){var n=(function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return(n.push(r),null!==e.parentRequest)?t(e.parentRequest,n):n})(e).reverse().join(" --> ");throw Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)})},e.listMetadataForTarget=function(t,e){if(!(e.isTagged()||e.isNamed()))return" "+t;var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach(function(t){n+=t.toString()+"\n"})," "+t+"\n "+t+" - "+n},e.getFunctionName=o},30825:function(t){t.exports=function(t){return!!t&&"string"!=typeof t&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},81272:function(t){function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */t.exports=function(t){return null!=t&&(e(t)||"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))||!!t._isBuffer)}},93488:function(t,e,n){var r=n(93245)(n(67741),"DataView");t.exports=r},68193:function(t,e,n){var r=n(65660),i=n(31735),o=n(83960),a=n(52436),s=n(38175);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},5835:function(t,e,n){var r=n(13234),i=n(77207),o=n(74641),a=n(70668),s=n(42572);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},58246:function(t,e,n){var r=n(93245)(n(67741),"Map");t.exports=r},93785:function(t,e,n){var r=n(26528),i=n(90972),o=n(55981),a=n(76656),s=n(45541);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},70490:function(t,e,n){var r=n(93245)(n(67741),"Promise");t.exports=r},50608:function(t,e,n){var r=n(93245)(n(67741),"Set");t.exports=r},22440:function(t,e,n){var r=n(93785),i=n(3367),o=n(36428);function a(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,t.exports=a},4380:function(t,e,n){var r=n(5835),i=n(4800),o=n(73987),a=n(59728),s=n(4146),u=n(81333);function c(t){var e=this.__data__=new r(t);this.size=e.size}c.prototype.clear=i,c.prototype.delete=o,c.prototype.get=a,c.prototype.has=s,c.prototype.set=u,t.exports=c},14212:function(t,e,n){var r=n(67741).Symbol;t.exports=r},69142:function(t,e,n){var r=n(67741).Uint8Array;t.exports=r},93101:function(t,e,n){var r=n(93245)(n(67741),"WeakMap");t.exports=r},24821:function(t){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},89982:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},31467:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}},2664:function(t,e,n){var r=n(77095);t.exports=function(t,e){return!!(null==t?0:t.length)&&r(t,e,0)>-1}},64797:function(t){t.exports=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}},26546:function(t,e,n){var r=n(97944),i=n(99782),o=n(95059),a=n(64843),s=n(30176),u=n(30484),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=o(t),l=!n&&i(t),f=!n&&!l&&a(t),h=!n&&!l&&!f&&u(t),p=n||l||f||h,d=p?r(t.length,String):[],v=d.length;for(var m in t)(e||c.call(t,m))&&!(p&&("length"==m||f&&("offset"==m||"parent"==m)||h&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||s(m,v)))&&d.push(m);return d}},83690:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}},65789:function(t){t.exports=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}},62670:function(t){t.exports=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}},30927:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}},89882:function(t){t.exports=function(t){return t.split("")}},77037:function(t){var e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;t.exports=function(t){return t.match(e)||[]}},79281:function(t,e,n){var r=n(30804),i=n(61595);t.exports=function(t,e,n){(void 0===n||i(t[e],n))&&(void 0!==n||e in t)||r(t,e,n)}},49478:function(t,e,n){var r=n(30804),i=n(61595),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];o.call(t,e)&&i(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},89329:function(t,e,n){var r=n(61595);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return -1}},52100:function(t,e,n){var r=n(99942),i=n(39406);t.exports=function(t,e){return t&&r(e,i(e),t)}},18662:function(t,e,n){var r=n(99942),i=n(70480);t.exports=function(t,e){return t&&r(e,i(e),t)}},30804:function(t,e,n){var r=n(40930);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},72650:function(t){t.exports=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}},42993:function(t,e,n){var r=n(4380),i=n(89982),o=n(49478),a=n(52100),s=n(18662),u=n(10241),c=n(71136),l=n(37937),f=n(34737),h=n(40013),p=n(27790),d=n(96770),v=n(78646),m=n(4658),g=n(75549),y=n(95059),b=n(64843),x=n(54082),_=n(70816),S=n(86591),w=n(39406),k=n(70480),C="[object Arguments]",E="[object Function]",A="[object Object]",M={};M[C]=M["[object Array]"]=M["[object ArrayBuffer]"]=M["[object DataView]"]=M["[object Boolean]"]=M["[object Date]"]=M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Map]"]=M["[object Number]"]=M[A]=M["[object RegExp]"]=M["[object Set]"]=M["[object String]"]=M["[object Symbol]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M["[object Error]"]=M[E]=M["[object WeakMap]"]=!1,t.exports=function t(e,n,L,Z,P,O){var R,I=1&n,D=2&n,N=4&n;if(L&&(R=P?L(e,Z,P,O):L(e)),void 0!==R)return R;if(!_(e))return e;var z=y(e);if(z){if(R=v(e),!I)return c(e,R)}else{var j=d(e),B=j==E||"[object GeneratorFunction]"==j;if(b(e))return u(e,I);if(j==A||j==C||B&&!P){if(R=D||B?{}:g(e),!I)return D?f(e,s(R,e)):l(e,a(R,e))}else{if(!M[j])return P?e:{};R=m(e,j,I)}}O||(O=new r);var F=O.get(e);if(F)return F;O.set(e,R),S(e)?e.forEach(function(r){R.add(t(r,n,L,r,e,O))}):x(e)&&e.forEach(function(r,i){R.set(i,t(r,n,L,i,e,O))});var U=N?D?p:h:D?k:w,V=z?void 0:U(e);return i(V||e,function(r,i){V&&(r=e[i=r]),o(R,i,t(r,n,L,i,e,O))}),R}},61682:function(t,e,n){var r=n(70816),i=Object.create,o=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=o},47495:function(t){t.exports=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return -1}},94410:function(t,e,n){var r=n(320)();t.exports=r},38824:function(t,e,n){var r=n(53066),i=n(217);t.exports=function(t,e){e=r(e,t);for(var n=0,o=e.length;null!=t&&n<o;)t=t[i(e[n++])];return n&&n==o?t:void 0}},86206:function(t,e,n){var r=n(65789),i=n(95059);t.exports=function(t,e,n){var o=e(t);return i(t)?o:r(o,n(t))}},7976:function(t,e,n){var r=n(14212),i=n(29829),o=n(8611),a=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?i(t):o(t)}},77095:function(t,e,n){var r=n(47495),i=n(77562),o=n(48150);t.exports=function(t,e,n){return e==e?o(t,e,n):r(t,i,n)}},93375:function(t){t.exports=function(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return -1}},63686:function(t,e,n){var r=n(7976),i=n(19340);t.exports=function(t){return i(t)&&"[object Arguments]"==r(t)}},29759:function(t,e,n){var r=n(28685),i=n(19340);t.exports=function t(e,n,o,a,s){return e===n||(null!=e&&null!=n&&(i(e)||i(n))?r(e,n,o,a,t,s):e!=e&&n!=n)}},28685:function(t,e,n){var r=n(4380),i=n(63859),o=n(41020),a=n(10701),s=n(96770),u=n(95059),c=n(64843),l=n(30484),f="[object Arguments]",h="[object Array]",p="[object Object]",d=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,v,m,g){var y=u(t),b=u(e),x=y?h:s(t),_=b?h:s(e);x=x==f?p:x,_=_==f?p:_;var S=x==p,w=_==p,k=x==_;if(k&&c(t)){if(!c(e))return!1;y=!0,S=!1}if(k&&!S)return g||(g=new r),y||l(t)?i(t,e,n,v,m,g):o(t,e,x,n,v,m,g);if(!(1&n)){var C=S&&d.call(t,"__wrapped__"),E=w&&d.call(e,"__wrapped__");if(C||E){var A=C?t.value():t,M=E?e.value():e;return g||(g=new r),m(A,M,n,v,g)}}return!!k&&(g||(g=new r),a(t,e,n,v,m,g))}},21254:function(t,e,n){var r=n(96770),i=n(19340);t.exports=function(t){return i(t)&&"[object Map]"==r(t)}},77562:function(t){t.exports=function(t){return t!=t}},35759:function(t,e,n){var r=n(80509),i=n(70740),o=n(70816),a=n(35315),s=/^\[object .+?Constructor\]$/,u=Object.prototype,c=Function.prototype.toString,l=u.hasOwnProperty,f=RegExp("^"+c.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||i(t))&&(r(t)?f:s).test(a(t))}},3662:function(t,e,n){var r=n(96770),i=n(19340);t.exports=function(t){return i(t)&&"[object Set]"==r(t)}},80043:function(t,e,n){var r=n(7976),i=n(54512),o=n(19340),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return o(t)&&i(t.length)&&!!a[r(t)]}},92916:function(t,e,n){var r=n(32231),i=n(51678),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=[];for(var n in Object(t))o.call(t,n)&&"constructor"!=n&&e.push(n);return e}},46107:function(t,e,n){var r=n(70816),i=n(32231),o=n(77361),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=i(t),n=[];for(var s in t)"constructor"==s&&(e||!a.call(t,s))||n.push(s);return n}},2068:function(t,e,n){var r=n(4380),i=n(79281),o=n(94410),a=n(69580),s=n(70816),u=n(70480),c=n(96054);t.exports=function t(e,n,l,f,h){e!==n&&o(n,function(o,u){if(h||(h=new r),s(o))a(e,n,u,l,t,f,h);else{var p=f?f(c(e,u),o,u+"",e,n,h):void 0;void 0===p&&(p=o),i(e,u,p)}},u)}},69580:function(t,e,n){var r=n(79281),i=n(10241),o=n(24192),a=n(71136),s=n(75549),u=n(99782),c=n(95059),l=n(69942),f=n(64843),h=n(80509),p=n(70816),d=n(23393),v=n(30484),m=n(96054),g=n(2488);t.exports=function(t,e,n,y,b,x,_){var S=m(t,n),w=m(e,n),k=_.get(w);if(k){r(t,n,k);return}var C=x?x(S,w,n+"",t,e,_):void 0,E=void 0===C;if(E){var A=c(w),M=!A&&f(w),L=!A&&!M&&v(w);C=w,A||M||L?c(S)?C=S:l(S)?C=a(S):M?(E=!1,C=i(w,!0)):L?(E=!1,C=o(w,!0)):C=[]:d(w)||u(w)?(C=S,u(S)?C=g(S):(!p(S)||h(S))&&(C=s(w))):E=!1}E&&(_.set(w,C),b(C,w,y,x,_),_.delete(w)),r(t,n,C)}},57690:function(t){t.exports=function(t){return function(e){return null==t?void 0:t[e]}}},91170:function(t,e,n){var r=n(83690),i=n(77095),o=n(93375),a=n(43863),s=n(71136),u=Array.prototype.splice;t.exports=function(t,e,n,c){var l=c?o:i,f=-1,h=e.length,p=t;for(t===e&&(e=s(e)),n&&(p=r(t,a(n)));++f<h;)for(var d=0,v=e[f],m=n?n(v):v;(d=l(p,m,d,c))>-1;)p!==t&&u.call(p,d,1),u.call(t,d,1);return t}},70712:function(t,e,n){var r=n(39100),i=n(7157),o=n(18501);t.exports=function(t,e){return o(i(t,e,r),t+"")}},79029:function(t,e,n){var r=n(71364),i=n(40930),o=n(39100),a=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;t.exports=a},81834:function(t){t.exports=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}},97944:function(t){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},2218:function(t,e,n){var r=n(14212),i=n(83690),o=n(95059),a=n(62704),s=1/0,u=r?r.prototype:void 0,c=u?u.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return i(e,t)+"";if(a(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-s?"-0":n}},33223:function(t,e,n){var r=n(49406),i=/^\s+/;t.exports=function(t){return t?t.slice(0,r(t)+1).replace(i,""):t}},43863:function(t){t.exports=function(t){return function(e){return t(e)}}},15375:function(t,e,n){var r=n(22440),i=n(2664),o=n(64797),a=n(97399),s=n(94225),u=n(1640);t.exports=function(t,e,n){var c=-1,l=i,f=t.length,h=!0,p=[],d=p;if(n)h=!1,l=o;else if(f>=200){var v=e?null:s(t);if(v)return u(v);h=!1,l=a,d=new r}else d=e?[]:p;e:for(;++c<f;){var m=t[c],g=e?e(m):m;if(m=n||0!==m?m:0,h&&g==g){for(var y=d.length;y--;)if(d[y]===g)continue e;e&&d.push(g),p.push(m)}else l(d,g,n)||(d!==p&&d.push(g),p.push(m))}return p}},97399:function(t){t.exports=function(t,e){return t.has(e)}},53066:function(t,e,n){var r=n(95059),i=n(55632),o=n(35508),a=n(25635);t.exports=function(t,e){return r(t)?t:i(t,e)?[t]:o(a(t))}},32332:function(t,e,n){var r=n(81834);t.exports=function(t,e,n){var i=t.length;return n=void 0===n?i:n,!e&&n>=i?t:r(t,e,n)}},24292:function(t,e,n){var r=n(69142);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},10241:function(t,e,n){t=n.nmd(t);var r=n(67741),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=s?s(n):new t.constructor(n);return t.copy(r),r}},70867:function(t,e,n){var r=n(24292);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},90093:function(t){var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},14240:function(t,e,n){var r=n(14212),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;t.exports=function(t){return o?Object(o.call(t)):{}}},24192:function(t,e,n){var r=n(24292);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},71136:function(t){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},99942:function(t,e,n){var r=n(49478),i=n(30804);t.exports=function(t,e,n,o){var a=!n;n||(n={});for(var s=-1,u=e.length;++s<u;){var c=e[s],l=o?o(n[c],t[c],c,n,t):void 0;void 0===l&&(l=t[c]),a?i(n,c,l):r(n,c,l)}return n}},37937:function(t,e,n){var r=n(99942),i=n(17807);t.exports=function(t,e){return r(t,i(t),e)}},34737:function(t,e,n){var r=n(99942),i=n(12533);t.exports=function(t,e){return r(t,i(t),e)}},35852:function(t,e,n){var r=n(67741)["__core-js_shared__"];t.exports=r},55878:function(t,e,n){var r=n(70712),i=n(45021);t.exports=function(t){return r(function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=t.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,a)}return e})}},320:function(t){t.exports=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}},6551:function(t,e,n){var r=n(32332),i=n(98495),o=n(14956),a=n(25635);t.exports=function(t){return function(e){var n=i(e=a(e))?o(e):void 0,s=n?n[0]:e.charAt(0),u=n?r(n,1).join(""):e.slice(1);return s[t]()+u}}},24259:function(t,e,n){var r=n(62670),i=n(37148),o=n(22896),a=RegExp("['’]","g");t.exports=function(t){return function(e){return r(o(i(e).replace(a,"")),t,"")}}},94225:function(t,e,n){var r=n(50608),i=n(67222),o=n(1640),a=r&&1/o(new r([,-0]))[1]==1/0?function(t){return new r(t)}:i;t.exports=a},57744:function(t,e,n){var r=n(57690)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});t.exports=r},40930:function(t,e,n){var r=n(93245),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},63859:function(t,e,n){var r=n(22440),i=n(30927),o=n(97399);t.exports=function(t,e,n,a,s,u){var c=1&n,l=t.length,f=e.length;if(l!=f&&!(c&&f>l))return!1;var h=u.get(t),p=u.get(e);if(h&&p)return h==e&&p==t;var d=-1,v=!0,m=2&n?new r:void 0;for(u.set(t,e),u.set(e,t);++d<l;){var g=t[d],y=e[d];if(a)var b=c?a(y,g,d,e,t,u):a(g,y,d,t,e,u);if(void 0!==b){if(b)continue;v=!1;break}if(m){if(!i(e,function(t,e){if(!o(m,e)&&(g===t||s(g,t,n,a,u)))return m.push(e)})){v=!1;break}}else if(!(g===y||s(g,y,n,a,u))){v=!1;break}}return u.delete(t),u.delete(e),v}},41020:function(t,e,n){var r=n(14212),i=n(69142),o=n(61595),a=n(63859),s=n(38737),u=n(1640),c=r?r.prototype:void 0,l=c?c.valueOf:void 0;t.exports=function(t,e,n,r,c,f,h){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!f(new i(t),new i(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var p=s;case"[object Set]":var d=1&r;if(p||(p=u),t.size!=e.size&&!d)break;var v=h.get(t);if(v)return v==e;r|=2,h.set(t,e);var m=a(p(t),p(e),r,c,f,h);return h.delete(t),m;case"[object Symbol]":if(l)return l.call(t)==l.call(e)}return!1}},10701:function(t,e,n){var r=n(40013),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,o,a,s){var u=1&n,c=r(t),l=c.length;if(l!=r(e).length&&!u)return!1;for(var f=l;f--;){var h=c[f];if(!(u?h in e:i.call(e,h)))return!1}var p=s.get(t),d=s.get(e);if(p&&d)return p==e&&d==t;var v=!0;s.set(t,e),s.set(e,t);for(var m=u;++f<l;){var g=t[h=c[f]],y=e[h];if(o)var b=u?o(y,g,h,e,t,s):o(g,y,h,t,e,s);if(!(void 0===b?g===y||a(g,y,n,o,s):b)){v=!1;break}m||(m="constructor"==h)}if(v&&!m){var x=t.constructor,_=e.constructor;x!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof _&&_ instanceof _)&&(v=!1)}return s.delete(t),s.delete(e),v}},58584:function(t,e,n){var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=r},40013:function(t,e,n){var r=n(86206),i=n(17807),o=n(39406);t.exports=function(t){return r(t,o,i)}},27790:function(t,e,n){var r=n(86206),i=n(12533),o=n(70480);t.exports=function(t){return r(t,o,i)}},72080:function(t,e,n){var r=n(34850);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},93245:function(t,e,n){var r=n(35759),i=n(13970);t.exports=function(t,e){var n=i(t,e);return r(n)?n:void 0}},28766:function(t,e,n){var r=n(93332)(Object.getPrototypeOf,Object);t.exports=r},29829:function(t,e,n){var r=n(14212),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}},17807:function(t,e,n){var r=n(31467),i=n(30786),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:r(a(t=Object(t)),function(e){return o.call(t,e)})}:i;t.exports=s},12533:function(t,e,n){var r=n(65789),i=n(28766),o=n(17807),a=n(30786),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,o(t)),t=i(t);return e}:a;t.exports=s},96770:function(t,e,n){var r=n(93488),i=n(58246),o=n(70490),a=n(50608),s=n(93101),u=n(7976),c=n(35315),l="[object Map]",f="[object Promise]",h="[object Set]",p="[object WeakMap]",d="[object DataView]",v=c(r),m=c(i),g=c(o),y=c(a),b=c(s),x=u;(r&&x(new r(new ArrayBuffer(1)))!=d||i&&x(new i)!=l||o&&x(o.resolve())!=f||a&&x(new a)!=h||s&&x(new s)!=p)&&(x=function(t){var e=u(t),n="[object Object]"==e?t.constructor:void 0,r=n?c(n):"";if(r)switch(r){case v:return d;case m:return l;case g:return f;case y:return h;case b:return p}return e}),t.exports=x},13970:function(t){t.exports=function(t,e){return null==t?void 0:t[e]}},98495:function(t){var e=RegExp("[\\u200d\ud800-\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return e.test(t)}},90409:function(t){var e=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;t.exports=function(t){return e.test(t)}},65660:function(t,e,n){var r=n(83463);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},31735:function(t){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},83960:function(t,e,n){var r=n(83463),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(e,t)?e[t]:void 0}},52436:function(t,e,n){var r=n(83463),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:i.call(e,t)}},38175:function(t,e,n){var r=n(83463);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},78646:function(t){var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},4658:function(t,e,n){var r=n(24292),i=n(70867),o=n(90093),a=n(14240),s=n(24192);t.exports=function(t,e,n){var u=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return i(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return o(t);case"[object Symbol]":return a(t)}}},75549:function(t,e,n){var r=n(61682),i=n(28766),o=n(32231);t.exports=function(t){return"function"!=typeof t.constructor||o(t)?{}:r(i(t))}},30176:function(t){var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},45021:function(t,e,n){var r=n(61595),i=n(10187),o=n(30176),a=n(70816);t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return("number"==s?!!(i(n)&&o(e,n.length)):"string"==s&&e in n)&&r(n[e],t)}},55632:function(t,e,n){var r=n(95059),i=n(62704),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var n=typeof t;return!!("number"==n||"symbol"==n||"boolean"==n||null==t||i(t))||a.test(t)||!o.test(t)||null!=e&&t in Object(e)}},34850:function(t){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},70740:function(t,e,n){var r,i=n(35852),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!o&&o in t}},32231:function(t){var e=Object.prototype;t.exports=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||e)}},13234:function(t){t.exports=function(){this.__data__=[],this.size=0}},77207:function(t,e,n){var r=n(89329),i=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():i.call(e,n,1),--this.size,!0)}},74641:function(t,e,n){var r=n(89329);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},70668:function(t,e,n){var r=n(89329);t.exports=function(t){return r(this.__data__,t)>-1}},42572:function(t,e,n){var r=n(89329);t.exports=function(t,e){var n=this.__data__,i=r(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}},26528:function(t,e,n){var r=n(68193),i=n(5835),o=n(58246);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},90972:function(t,e,n){var r=n(72080);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},55981:function(t,e,n){var r=n(72080);t.exports=function(t){return r(this,t).get(t)}},76656:function(t,e,n){var r=n(72080);t.exports=function(t){return r(this,t).has(t)}},45541:function(t,e,n){var r=n(72080);t.exports=function(t,e){var n=r(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}},38737:function(t){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}},53092:function(t,e,n){var r=n(49512);t.exports=function(t){var e=r(t,function(t){return 500===n.size&&n.clear(),t}),n=e.cache;return e}},83463:function(t,e,n){var r=n(93245)(Object,"create");t.exports=r},51678:function(t,e,n){var r=n(93332)(Object.keys,Object);t.exports=r},77361:function(t){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},16474:function(t,e,n){t=n.nmd(t);var r=n(58584),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i&&r.process,s=function(){try{var t=o&&o.require&&o.require("util").types;if(t)return t;return a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=s},8611:function(t){var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},93332:function(t){t.exports=function(t,e){return function(n){return t(e(n))}}},7157:function(t,e,n){var r=n(24821),i=Math.max;t.exports=function(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){for(var o=arguments,a=-1,s=i(o.length-e,0),u=Array(s);++a<s;)u[a]=o[e+a];a=-1;for(var c=Array(e+1);++a<e;)c[a]=o[a];return c[e]=n(u),r(t,this,c)}}},67741:function(t,e,n){var r=n(58584),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},96054:function(t){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},3367:function(t){t.exports=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}},36428:function(t){t.exports=function(t){return this.__data__.has(t)}},1640:function(t){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}},18501:function(t,e,n){var r=n(79029),i=n(14326)(r);t.exports=i},14326:function(t){var e=Date.now;t.exports=function(t){var n=0,r=0;return function(){var i=e(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}},4800:function(t,e,n){var r=n(5835);t.exports=function(){this.__data__=new r,this.size=0}},73987:function(t){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},59728:function(t){t.exports=function(t){return this.__data__.get(t)}},4146:function(t){t.exports=function(t){return this.__data__.has(t)}},81333:function(t,e,n){var r=n(5835),i=n(58246),o=n(93785);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(t,e),this.size=n.size,this}},48150:function(t){t.exports=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return -1}},14956:function(t,e,n){var r=n(89882),i=n(98495),o=n(12014);t.exports=function(t){return i(t)?o(t):r(t)}},35508:function(t,e,n){var r=n(53092),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(i,function(t,n,r,i){e.push(r?i.replace(o,"$1"):n||t)}),e});t.exports=a},217:function(t,e,n){var r=n(62704),i=1/0;t.exports=function(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}},35315:function(t){var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},49406:function(t){var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},12014:function(t){var e="\ud800-\udfff",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\ud83c[\udffb-\udfff]",i="[^"+e+"]",o="(?:\ud83c[\udde6-\uddff]){2}",a="[\ud800-\udbff][\udc00-\udfff]",s="(?:"+n+"|"+r+")?",u="[\\ufe0e\\ufe0f]?",c="(?:\\u200d(?:"+[i,o,a].join("|")+")"+u+s+")*",l=RegExp(r+"(?="+r+")|(?:"+[i+n+"?",n,o,a,"["+e+"]"].join("|")+")"+(u+s+c),"g");t.exports=function(t){return t.match(l)||[]}},183:function(t){var e="\ud800-\udfff",n="\\u2700-\\u27bf",r="a-z\\xdf-\\xf6\\xf8-\\xff",i="A-Z\\xc0-\\xd6\\xd8-\\xde",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="['’]",s="["+o+"]",u="["+r+"]",c="[^"+e+o+"\\d+"+n+r+i+"]",l="(?:\ud83c[\udde6-\uddff]){2}",f="[\ud800-\udbff][\udc00-\udfff]",h="["+i+"]",p="(?:"+u+"|"+c+")",d="(?:"+a+"(?:d|ll|m|re|s|t|ve))?",v="(?:"+a+"(?:D|LL|M|RE|S|T|VE))?",m="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\ud83c[\udffb-\udfff])?",g="[\\ufe0e\\ufe0f]?",y="(?:\\u200d(?:"+["[^"+e+"]",l,f].join("|")+")"+g+m+")*",b="(?:"+["["+n+"]",l,f].join("|")+")"+(g+m+y),x=RegExp([h+"?"+u+"+"+d+"(?="+[s,h,"$"].join("|")+")","(?:"+h+"|"+c+")+"+v+"(?="+[s,h+p,"$"].join("|")+")",h+"?"+p+"+"+d,h+"+"+v,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",b].join("|"),"g");t.exports=function(t){return t.match(x)||[]}},51729:function(t,e,n){var r=n(311),i=n(24259)(function(t,e,n){return e=e.toLowerCase(),t+(n?r(e):e)});t.exports=i},311:function(t,e,n){var r=n(25635),i=n(9332);t.exports=function(t){return i(r(t).toLowerCase())}},89508:function(t,e,n){var r=n(72650),i=n(89753);t.exports=function(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==e&&(e=(e=i(e))==e?e:0),r(i(t),e,n)}},70156:function(t,e,n){var r=n(42993);t.exports=function(t){return r(t,5)}},71364:function(t){t.exports=function(t){return function(){return t}}},54525:function(t,e,n){var r=n(70816),i=n(80128),o=n(89753),a=Math.max,s=Math.min;t.exports=function(t,e,n){var u,c,l,f,h,p,d=0,v=!1,m=!1,g=!0;if("function"!=typeof t)throw TypeError("Expected a function");function y(e){var n=u,r=c;return u=c=void 0,d=e,f=t.apply(r,n)}function b(t){var n=t-p,r=t-d;return void 0===p||n>=e||n<0||m&&r>=l}function x(){var t,n,r,o=i();if(b(o))return _(o);h=setTimeout(x,(t=o-p,n=o-d,r=e-t,m?s(r,l-n):r))}function _(t){return(h=void 0,g&&u)?y(t):(u=c=void 0,f)}function S(){var t,n=i(),r=b(n);if(u=arguments,c=this,p=n,r){if(void 0===h)return d=t=p,h=setTimeout(x,e),v?y(t):f;if(m)return clearTimeout(h),h=setTimeout(x,e),y(p)}return void 0===h&&(h=setTimeout(x,e)),f}return e=o(e)||0,r(n)&&(v=!!n.leading,l=(m="maxWait"in n)?a(o(n.maxWait)||0,e):l,g="trailing"in n?!!n.trailing:g),S.cancel=function(){void 0!==h&&clearTimeout(h),d=0,u=p=c=h=void 0},S.flush=function(){return void 0===h?f:_(i())},S}},37148:function(t,e,n){var r=n(57744),i=n(25635),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");t.exports=function(t){return(t=i(t))&&t.replace(o,r).replace(a,"")}},61595:function(t){t.exports=function(t,e){return t===e||t!=t&&e!=e}},44750:function(t,e,n){var r=n(38824);t.exports=function(t,e,n){var i=null==t?void 0:r(t,e);return void 0===i?n:i}},39100:function(t){t.exports=function(t){return t}},99782:function(t,e,n){var r=n(63686),i=n(19340),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(t){return i(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=u},95059:function(t){var e=Array.isArray;t.exports=e},10187:function(t,e,n){var r=n(80509),i=n(54512);t.exports=function(t){return null!=t&&i(t.length)&&!r(t)}},69942:function(t,e,n){var r=n(10187),i=n(19340);t.exports=function(t){return i(t)&&r(t)}},90849:function(t,e,n){var r=n(7976),i=n(19340);t.exports=function(t){return!0===t||!1===t||i(t)&&"[object Boolean]"==r(t)}},64843:function(t,e,n){t=n.nmd(t);var r=n(67741),i=n(33879),o=e&&!e.nodeType&&e,a=o&&t&&!t.nodeType&&t,s=a&&a.exports===o?r.Buffer:void 0,u=s?s.isBuffer:void 0;t.exports=u||i},93574:function(t,e,n){var r=n(29759);t.exports=function(t,e){return r(t,e)}},80509:function(t,e,n){var r=n(7976),i=n(70816);t.exports=function(t){if(!i(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},54512:function(t){t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},54082:function(t,e,n){var r=n(21254),i=n(43863),o=n(16474),a=o&&o.isMap,s=a?i(a):r;t.exports=s},71292:function(t){t.exports=function(t){return null==t}},39018:function(t,e,n){var r=n(7976),i=n(19340);t.exports=function(t){return"number"==typeof t||i(t)&&"[object Number]"==r(t)}},70816:function(t){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},19340:function(t){t.exports=function(t){return null!=t&&"object"==typeof t}},23393:function(t,e,n){var r=n(7976),i=n(28766),o=n(19340),a=Object.prototype,s=Function.prototype.toString,u=a.hasOwnProperty,c=s.call(Object);t.exports=function(t){if(!o(t)||"[object Object]"!=r(t))return!1;var e=i(t);if(null===e)return!0;var n=u.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&s.call(n)==c}},86591:function(t,e,n){var r=n(3662),i=n(43863),o=n(16474),a=o&&o.isSet,s=a?i(a):r;t.exports=s},96907:function(t,e,n){var r=n(7976),i=n(95059),o=n(19340);t.exports=function(t){return"string"==typeof t||!i(t)&&o(t)&&"[object String]"==r(t)}},62704:function(t,e,n){var r=n(7976),i=n(19340);t.exports=function(t){return"symbol"==typeof t||i(t)&&"[object Symbol]"==r(t)}},30484:function(t,e,n){var r=n(80043),i=n(43863),o=n(16474),a=o&&o.isTypedArray,s=a?i(a):r;t.exports=s},14308:function(t){t.exports=function(t){return void 0===t}},39406:function(t,e,n){var r=n(26546),i=n(92916),o=n(10187);t.exports=function(t){return o(t)?r(t):i(t)}},70480:function(t,e,n){var r=n(26546),i=n(46107),o=n(10187);t.exports=function(t){return o(t)?r(t,!0):i(t)}},49512:function(t,e,n){var r=n(93785);function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r),n}i.Cache=r,t.exports=i},74613:function(t,e,n){var r=n(2068),i=n(55878)(function(t,e,n){r(t,e,n)});t.exports=i},57102:function(t,e,n){var r=n(2068),i=n(55878)(function(t,e,n,i){r(t,e,n,i)});t.exports=i},67222:function(t){t.exports=function(){}},80128:function(t,e,n){var r=n(67741);t.exports=function(){return r.Date.now()}},92619:function(t,e,n){var r=n(70712)(n(68407));t.exports=r},68407:function(t,e,n){var r=n(91170);t.exports=function(t,e){return t&&t.length&&e&&e.length?r(t,e):t}},30786:function(t){t.exports=function(){return[]}},33879:function(t){t.exports=function(){return!1}},68417:function(t,e,n){var r=n(54525),i=n(70816);t.exports=function(t,e,n){var o=!0,a=!0;if("function"!=typeof t)throw TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(t,e,{leading:o,maxWait:e,trailing:a})}},89753:function(t,e,n){var r=n(33223),i=n(70816),o=n(62704),a=0/0,s=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(o(t))return a;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var n=u.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):s.test(t)?a:+t}},2488:function(t,e,n){var r=n(99942),i=n(70480);t.exports=function(t){return r(t,i(t))}},25635:function(t,e,n){var r=n(2218);t.exports=function(t){return null==t?"":r(t)}},59679:function(t,e,n){var r=n(15375);t.exports=function(t){return t&&t.length?r(t):[]}},9332:function(t,e,n){var r=n(6551)("toUpperCase");t.exports=r},22896:function(t,e,n){var r=n(77037),i=n(90409),o=n(25635),a=n(183);t.exports=function(t,e,n){return(t=o(t),void 0===(e=n?void 0:e))?i(t)?a(t):r(t):t.match(e)||[]}},21663:function(t,e,n){var r,i,o,a,s;r=n(46515),i=n(50232).utf8,o=n(81272),a=n(50232).bin,(s=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?a.stringToBytes(t):i.stringToBytes(t):o(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||t.constructor===Uint8Array||(t=t.toString());for(var n=r.bytesToWords(t),u=8*t.length,c=1732584193,l=-271733879,f=-1732584194,h=271733878,p=0;p<n.length;p++)n[p]=(n[p]<<8|n[p]>>>24)&16711935|(n[p]<<24|n[p]>>>8)&4278255360;n[u>>>5]|=128<<u%32,n[(u+64>>>9<<4)+14]=u;for(var d=s._ff,v=s._gg,m=s._hh,g=s._ii,p=0;p<n.length;p+=16){var y=c,b=l,x=f,_=h;c=d(c,l,f,h,n[p+0],7,-680876936),h=d(h,c,l,f,n[p+1],12,-389564586),f=d(f,h,c,l,n[p+2],17,606105819),l=d(l,f,h,c,n[p+3],22,-1044525330),c=d(c,l,f,h,n[p+4],7,-176418897),h=d(h,c,l,f,n[p+5],12,1200080426),f=d(f,h,c,l,n[p+6],17,-1473231341),l=d(l,f,h,c,n[p+7],22,-45705983),c=d(c,l,f,h,n[p+8],7,1770035416),h=d(h,c,l,f,n[p+9],12,-1958414417),f=d(f,h,c,l,n[p+10],17,-42063),l=d(l,f,h,c,n[p+11],22,-1990404162),c=d(c,l,f,h,n[p+12],7,1804603682),h=d(h,c,l,f,n[p+13],12,-40341101),f=d(f,h,c,l,n[p+14],17,-1502002290),l=d(l,f,h,c,n[p+15],22,1236535329),c=v(c,l,f,h,n[p+1],5,-165796510),h=v(h,c,l,f,n[p+6],9,-1069501632),f=v(f,h,c,l,n[p+11],14,643717713),l=v(l,f,h,c,n[p+0],20,-373897302),c=v(c,l,f,h,n[p+5],5,-701558691),h=v(h,c,l,f,n[p+10],9,38016083),f=v(f,h,c,l,n[p+15],14,-660478335),l=v(l,f,h,c,n[p+4],20,-405537848),c=v(c,l,f,h,n[p+9],5,568446438),h=v(h,c,l,f,n[p+14],9,-1019803690),f=v(f,h,c,l,n[p+3],14,-187363961),l=v(l,f,h,c,n[p+8],20,1163531501),c=v(c,l,f,h,n[p+13],5,-1444681467),h=v(h,c,l,f,n[p+2],9,-51403784),f=v(f,h,c,l,n[p+7],14,1735328473),l=v(l,f,h,c,n[p+12],20,-1926607734),c=m(c,l,f,h,n[p+5],4,-378558),h=m(h,c,l,f,n[p+8],11,-2022574463),f=m(f,h,c,l,n[p+11],16,1839030562),l=m(l,f,h,c,n[p+14],23,-35309556),c=m(c,l,f,h,n[p+1],4,-1530992060),h=m(h,c,l,f,n[p+4],11,1272893353),f=m(f,h,c,l,n[p+7],16,-155497632),l=m(l,f,h,c,n[p+10],23,-1094730640),c=m(c,l,f,h,n[p+13],4,681279174),h=m(h,c,l,f,n[p+0],11,-358537222),f=m(f,h,c,l,n[p+3],16,-722521979),l=m(l,f,h,c,n[p+6],23,76029189),c=m(c,l,f,h,n[p+9],4,-640364487),h=m(h,c,l,f,n[p+12],11,-421815835),f=m(f,h,c,l,n[p+15],16,530742520),l=m(l,f,h,c,n[p+2],23,-995338651),c=g(c,l,f,h,n[p+0],6,-198630844),h=g(h,c,l,f,n[p+7],10,1126891415),f=g(f,h,c,l,n[p+14],15,-1416354905),l=g(l,f,h,c,n[p+5],21,-57434055),c=g(c,l,f,h,n[p+12],6,1700485571),h=g(h,c,l,f,n[p+3],10,-1894986606),f=g(f,h,c,l,n[p+10],15,-1051523),l=g(l,f,h,c,n[p+1],21,-2054922799),c=g(c,l,f,h,n[p+8],6,1873313359),h=g(h,c,l,f,n[p+15],10,-30611744),f=g(f,h,c,l,n[p+6],15,-1560198380),l=g(l,f,h,c,n[p+13],21,1309151649),c=g(c,l,f,h,n[p+4],6,-145523070),h=g(h,c,l,f,n[p+11],10,-1120210379),f=g(f,h,c,l,n[p+2],15,718787259),l=g(l,f,h,c,n[p+9],21,-343485551),c=c+y>>>0,l=l+b>>>0,f=f+x>>>0,h=h+_>>>0}return r.endian([c,l,f,h])})._ff=function(t,e,n,r,i,o,a){var s=t+(e&n|~e&r)+(i>>>0)+a;return(s<<o|s>>>32-o)+e},s._gg=function(t,e,n,r,i,o,a){var s=t+(e&r|n&~r)+(i>>>0)+a;return(s<<o|s>>>32-o)+e},s._hh=function(t,e,n,r,i,o,a){var s=t+(e^n^r)+(i>>>0)+a;return(s<<o|s>>>32-o)+e},s._ii=function(t,e,n,r,i,o,a){var s=t+(n^(e|~r))+(i>>>0)+a;return(s<<o|s>>>32-o)+e},s._blocksize=16,s._digestsize=16,t.exports=function(t,e){if(null==t)throw Error("Illegal argument "+t);var n=r.wordsToBytes(s(t,e));return e&&e.asBytes?n:e&&e.asString?a.bytesToString(n):r.bytesToHex(n)}},49079:function(t,e,n){"use strict";var r,i;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(13127)},13127:function(t){!function(){var e={229:function(t){var e,n,r,i=t.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:o}catch(t){e=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u=[],c=!1,l=-1;function f(){c&&r&&(c=!1,r.length?u=r.concat(u):l=-1,u.length&&h())}function h(){if(!c){var t=s(f);c=!0;for(var e=u.length;e;){for(r=u,u=[];++l<e;)r&&r[l].run();l=-1,e=u.length}r=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||c||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(t){var i=n[t];if(void 0!==i)return i.exports;var o=n[t]={exports:{}},a=!0;try{e[t](o,o.exports,r),a=!1}finally{a&&delete n[t]}return o.exports}r.ab="//";var i=r(229);t.exports=i}()},20079:function(t,e,n){"use strict";t.exports=i;var r=n(61531);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function a(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function u(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function c(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function l(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function h(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function g(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function y(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=g(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=g(this.buf,this.pos)+4294967296*g(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=g(this.buf,this.pos)+4294967296*b(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return(e=127&(n=r[this.pos++]),n<128)?e:(e|=(127&(n=r[this.pos++]))<<7,n<128)?e:(e|=(127&(n=r[this.pos++]))<<14,n<128)?e:(e|=(127&(n=r[this.pos++]))<<21,n<128)?e:function(t,e,n){var r,i,o,a,s=n.buf;if(o=(112&(a=s[n.pos++]))>>4,a<128||(o|=(127&(a=s[n.pos++]))<<3,a<128)||(o|=(127&(a=s[n.pos++]))<<10,a<128)||(o|=(127&(a=s[n.pos++]))<<17,a<128)||(o|=(127&(a=s[n.pos++]))<<24,a<128)||(o|=(1&(a=s[n.pos++]))<<31,a<128)){return r=t,i=o,e?4294967296*i+(r>>>0):(i>>>0)*4294967296+(r>>>0)}throw Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?-((t+1)/2):t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t,e=this.readVarint()+this.pos,n=this.pos;return(this.pos=e,e-n>=12&&o)?(t=this.buf,o.decode(t.subarray(n,e))):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],c=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>n)break;1===l?u<128&&(c=u):2===l?(192&(o=t[i+1]))==128&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=t[i+1],a=t[i+2],(192&o)==128&&(192&a)==128&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(o=t[i+1],a=t[i+2],s=t[i+3],(192&o)==128&&(192&a)==128&&(192&s)==128&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=l}return r}(this.buf,n,e)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var n=a(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else if(e===i.Fixed64)this.pos+=8;else throw Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),y(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),y(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),y(this.buf,-1&t,this.pos),y(this.buf,Math.floor(23283064365386963e-26*t),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),y(this.buf,-1&t,this.pos),y(this.buf,Math.floor(23283064365386963e-26*t),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t||0)>268435455||t<0){!function(t,e){var n,r,i,o,a,s;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(n=~(-t%4294967296),r=~(-t/4294967296),4294967295^n?n=n+1|0:(n=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");e.realloc(10),i=n,e.buf[e.pos++]=127&i|128,i>>>=7,e.buf[e.pos++]=127&i|128,i>>>=7,e.buf[e.pos++]=127&i|128,i>>>=7,e.buf[e.pos++]=127&i|128,i>>>=7,e.buf[e.pos]=127&i,o=r,a=e,s=(7&o)<<4,a.buf[a.pos++]|=s|((o>>>=3)?128:0),!o||(a.buf[a.pos++]=127&o|((o>>>=7)?128:0),!o)||(a.buf[a.pos++]=127&o|((o>>>=7)?128:0),!o)||(a.buf[a.pos++]=127&o|((o>>>=7)?128:0),o&&(a.buf[a.pos++]=127&o|((o>>>=7)?128:0),o&&(a.buf[a.pos++]=127&o)))}(t,this);return}this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-(2*t)-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(i){if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else{r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&s(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),r.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),r.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&s(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}}},46362:function(t,e,n){var r=n(49079);t.exports=function(){"use strict";var t=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function e(t,e){return t>e?1:t<e?-1:0}function n(e,n,r){for(var i=new t(null,null),o=i,a=i;;){var s=r(e,n.key);if(s<0){if(null===n.left)break;if(0>r(e,n.left.key)){var u=n.left;if(n.left=u.right,u.right=n,null===(n=u).left)break}a.left=n,a=n,n=n.left}else if(s>0){if(null===n.right)break;if(r(e,n.right.key)>0){var u=n.right;if(n.right=u.left,u.left=n,null===(n=u).right)break}o.right=n,o=n,n=n.right}else break}return o.right=n.left,a.left=n.right,n.left=i.right,n.right=i.left,n}function i(e,r,i,o){var a=new t(e,r);if(null===i)return a.left=a.right=null,a;i=n(e,i,o);var s=o(e,i.key);return s<0?(a.left=i.left,a.right=i,i.left=null):s>=0&&(a.right=i.right,a.left=i,i.right=null),a}function o(t,e,r){var i=null,o=null;if(e){e=n(t,e,r);var a=r(e.key,t);0===a?(i=e.left,o=e.right):a<0?(o=e.right,e.right=null,i=e):(i=e.left,e.left=null,o=e)}return{left:i,right:o}}var a=function(){function r(t){void 0===t&&(t=e),this._root=null,this._size=0,this._comparator=t}return r.prototype.insert=function(t,e){return this._size++,this._root=i(t,e,this._root,this._comparator)},r.prototype.add=function(e,r){var i=new t(e,r);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var o=this._comparator,a=n(e,this._root,o),s=o(e,a.key);return 0===s?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},r.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},r.prototype._remove=function(t,e,r){var i;return null===e?null:(e=n(t,e,r),0===r(t,e.key))?(null===e.left?i=e.right:(i=n(t,e.left,r)).right=e.right,this._size--,i):e},r.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=n(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},r.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},r.prototype.find=function(t){return this._root&&(this._root=n(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},r.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},r.prototype.forEach=function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},r.prototype.range=function(t,e,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,e)>0)break;if(o(a.key,t)>=0&&n.call(r,a))return this;a=a.right}return this},r.prototype.keys=function(){var t=[];return this.forEach(function(e){var n=e.key;return t.push(n)}),t},r.prototype.values=function(){var t=[];return this.forEach(function(e){var n=e.data;return t.push(n)}),t},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},r.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},r.prototype.at=function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},r.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},r.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return function(e){for(var n=e,r=[],i=!1,o=new t(null,null),a=o;!i;)n?(r.push(n),n=n.left):r.length>0?n=(n=a=a.next=r.pop()).right:i=!0;return a.next=null,o.next}(this._root)},r.prototype.load=function(e,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1);var i=e.length,o=this._comparator;if(r&&function t(e,n,r,i,o){if(!(r>=i)){for(var a=e[r+i>>1],s=r-1,u=i+1;;){do s++;while(0>o(e[s],a));do u--;while(o(e[u],a)>0);if(s>=u)break;var c=e[s];e[s]=e[u],e[u]=c,c=n[s],n[s]=n[u],n[u]=c}t(e,n,r,u,o),t(e,n,u+1,i,o)}}(e,n,0,i-1,o),null===this._root)this._root=function e(n,r,i,o){var a=o-i;if(a>0){var s=i+Math.floor(a/2),u=new t(n[s],r[s]);return u.left=e(n,r,i,s),u.right=e(n,r,s+1,o),u}return null}(e,n,0,i),this._size=i;else{var a=function(e,n,r){for(var i=new t(null,null),o=i,a=e,s=n;null!==a&&null!==s;)0>r(a.key,s.key)?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,n){for(var r=new t(null,null),i=r,o=0;o<e.length;o++)i=i.next=new t(e[o],n[o]);return i.next=null,r.next}(e,n),o);i=this._size+i,this._root=function t(e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=t(e,n,o),s=e.head;return s.left=a,e.head=e.head.next,s.right=t(e,o+1,r),s}return null}({head:a},0,i)}return this},r.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return function t(e,n,r,i,o){if(e){i(""+n+(r?"└── ":"├── ")+o(e)+"\n");var a=n+(r?"    ":"│   ");e.left&&t(e.left,a,!1,i,o),e.right&&t(e.right,a,!0,i,o)}}(this._root,"",!0,function(t){return e.push(t)},t),e.join("")},r.prototype.update=function(t,e,r){var a,s,u=this._comparator,c=o(t,this._root,u),l=c.left,f=c.right;0>u(t,e)?f=i(e,r,f,u):l=i(e,r,l,u),this._root=(a=l,null===(s=f)?a:(null===a||((s=n(a.key,s,u)).left=a),s))},r.prototype.split=function(t){return o(t,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var t,e,n;return(/**
     * splaytree v3.1.2
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     *//*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,function(r){switch(r.label){case 0:t=this._root,e=[],n=!1,r.label=1;case 1:if(n)return[3,6];if(!(null!==t))return[3,2];return e.push(t),t=t.left,[3,5];case 2:if(!(0!==e.length))return[3,4];return[4,t=e.pop()];case 3:return r.sent(),t=t.right,[3,5];case 4:n=!0,r.label=5;case 5:return[3,1];case 6:return[2]}}))},r}();let s=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,u=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;let n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},c=Number.EPSILON;void 0===c&&(c=2220446049250313e-31);let l=c*c,f=(t,e)=>{if(-c<t&&t<c&&-c<e&&e<c)return 0;let n=t-e;return n*n<l*t*e?0:t<e?-1:1};class h{constructor(){this.reset()}reset(){this.xRounder=new p,this.yRounder=new p}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class p{constructor(){this.tree=new a,this.round(0)}round(t){let e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===f(e.key,n.key))return this.tree.remove(t),n.key;let r=this.tree.next(e);return null!==r&&0===f(e.key,r.key)?(this.tree.remove(t),r.key):t}}let d=new h,v=(3+8881784197001252e-31)*11102230246251565e-32;function m(t,e,n,r,i){let o,a,s,u;let c=e[0],l=r[0],f=0,h=0;l>c==l>-c?(o=c,c=e[++f]):(o=l,l=r[++h]);let p=0;if(f<t&&h<n)for(l>c==l>-c?(a=c+o,s=o-(a-c),c=e[++f]):(a=l+o,s=o-(a-l),l=r[++h]),o=a,0!==s&&(i[p++]=s);f<t&&h<n;)l>c==l>-c?(u=(a=o+c)-o,s=o-(a-u)+(c-u),c=e[++f]):(u=(a=o+l)-o,s=o-(a-u)+(l-u),l=r[++h]),o=a,0!==s&&(i[p++]=s);for(;f<t;)u=(a=o+c)-o,s=o-(a-u)+(c-u),c=e[++f],o=a,0!==s&&(i[p++]=s);for(;h<n;)u=(a=o+l)-o,s=o-(a-u)+(l-u),l=r[++h],o=a,0!==s&&(i[p++]=s);return(0!==o||0===p)&&(i[p++]=o),p}function g(t){return new Float64Array(t)}let y=(3+17763568394002505e-31)*11102230246251565e-32,b=(2+13322676295501878e-31)*11102230246251565e-32,x=(9+7105427357601002e-30)*11102230246251565e-32*11102230246251565e-32,_=g(4),S=g(8),w=g(12),k=g(16),C=g(4),E=(t,e)=>t.x*e.y-t.y*e.x,A=(t,e)=>t.x*e.x+t.y*e.y,M=(t,e,n)=>{let r=function(t,e,n,r,i,o){let a=(e-o)*(n-i),s=(t-i)*(r-o),u=a-s,c=Math.abs(a+s);return Math.abs(u)>=y*c?u:-function(t,e,n,r,i,o,a){let s,u,c,l,f,h,p,d,g,y,E,A,M,L,Z,P,O,R;let I=t-i,D=n-i,N=e-o,z=r-o;L=I*z,p=(h=134217729*I)-(h-I),d=I-p,g=(h=134217729*z)-(h-z),Z=d*(y=z-g)-(L-p*g-d*g-p*y),P=N*D,p=(h=134217729*N)-(h-N),d=N-p,g=(h=134217729*D)-(h-D),E=Z-(O=d*(y=D-g)-(P-p*g-d*g-p*y)),f=Z-E,_[0]=Z-(E+f)+(f-O),f=(A=L+E)-L,E=(M=L-(A-f)+(E-f))-P,f=M-E,_[1]=M-(E+f)+(f-P),f=(R=A+E)-A,_[2]=A-(R-f)+(E-f),_[3]=R;let j=function(t,e){let n=e[0];for(let t=1;t<4;t++)n+=e[t];return n}(0,_),B=b*a;if(j>=B||-j>=B||(f=t-I,s=t-(I+f)+(f-i),f=n-D,c=n-(D+f)+(f-i),f=e-N,u=e-(N+f)+(f-o),f=r-z,l=r-(z+f)+(f-o),0===s&&0===u&&0===c&&0===l)||(B=x*a+v*Math.abs(j),(j+=I*l+z*s-(N*c+D*u))>=B||-j>=B))return j;L=s*z,p=(h=134217729*s)-(h-s),d=s-p,g=(h=134217729*z)-(h-z),Z=d*(y=z-g)-(L-p*g-d*g-p*y),P=u*D,p=(h=134217729*u)-(h-u),d=u-p,g=(h=134217729*D)-(h-D),E=Z-(O=d*(y=D-g)-(P-p*g-d*g-p*y)),f=Z-E,C[0]=Z-(E+f)+(f-O),f=(A=L+E)-L,E=(M=L-(A-f)+(E-f))-P,f=M-E,C[1]=M-(E+f)+(f-P),f=(R=A+E)-A,C[2]=A-(R-f)+(E-f),C[3]=R;let F=m(4,_,4,C,S);L=I*l,p=(h=134217729*I)-(h-I),d=I-p,g=(h=134217729*l)-(h-l),Z=d*(y=l-g)-(L-p*g-d*g-p*y),P=N*c,p=(h=134217729*N)-(h-N),d=N-p,g=(h=134217729*c)-(h-c),E=Z-(O=d*(y=c-g)-(P-p*g-d*g-p*y)),f=Z-E,C[0]=Z-(E+f)+(f-O),f=(A=L+E)-L,E=(M=L-(A-f)+(E-f))-P,f=M-E,C[1]=M-(E+f)+(f-P),f=(R=A+E)-A,C[2]=A-(R-f)+(E-f),C[3]=R;let U=m(F,S,4,C,w);L=s*l,p=(h=134217729*s)-(h-s),d=s-p,g=(h=134217729*l)-(h-l),Z=d*(y=l-g)-(L-p*g-d*g-p*y),P=u*c,p=(h=134217729*u)-(h-u),d=u-p,g=(h=134217729*c)-(h-c),E=Z-(O=d*(y=c-g)-(P-p*g-d*g-p*y)),f=Z-E,C[0]=Z-(E+f)+(f-O),f=(A=L+E)-L,E=(M=L-(A-f)+(E-f))-P,f=M-E,C[1]=M-(E+f)+(f-P),f=(R=A+E)-A,C[2]=A-(R-f)+(E-f),C[3]=R;let V=m(U,w,4,C,k);return k[V-1]}(t,e,n,r,i,o,c)}(t.x,t.y,e.x,e.y,n.x,n.y);return r>0?-1:r<0?1:0},L=t=>Math.sqrt(A(t,t)),Z=(t,e,n)=>{let r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return E(i,r)/L(i)/L(r)},P=(t,e,n)=>{let r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return A(i,r)/L(i)/L(r)},O=(t,e,n)=>0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n},R=(t,e,n)=>0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)},I=(t,e,n,r)=>{if(0===e.x)return R(n,r,t.x);if(0===r.x)return R(t,e,n.x);if(0===e.y)return O(n,r,t.y);if(0===r.y)return O(t,e,n.y);let i=E(e,r);if(0==i)return null;let o={x:n.x-t.x,y:n.y-t.y},a=E(o,e)/i,s=E(o,r)/i,u=t.x+s*e.x,c=n.x+a*r.x;return{x:(u+c)/2,y:(t.y+s*e.y+(n.y+a*r.y))/2}};class D{static compare(t,e){let n=D.comparePoints(t.point,e.point);return 0!==n?n:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft)?t.isLeft?1:-1:z.compare(t.segment,e.segment)}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw Error("Tried to link already linked events");let e=t.point.events;for(let t=0,n=e.length;t<n;t++){let n=e[t];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){let t=this.point.events.length;for(let e=0;e<t;e++){let n=this.point.events[e];if(void 0===n.segment.consumedBy)for(let r=e+1;r<t;r++){let t=this.point.events[r];void 0===t.consumedBy&&n.otherSE.point.events===t.otherSE.point.events&&n.segment.consume(t.segment)}}}getAvailableLinkedEvents(){let t=[];for(let e=0,n=this.point.events.length;e<n;e++){let n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){let e=new Map,n=n=>{let r=n.otherSE;e.set(n,{sine:Z(this.point,t.point,r.point),cosine:P(this.point,t.point,r.point)})};return(t,r)=>{e.has(t)||n(t),e.has(r)||n(r);let{sine:i,cosine:o}=e.get(t),{sine:a,cosine:s}=e.get(r);return i>=0&&a>=0?o<s?1:o>s?-1:0:i<0&&a<0?o<s?-1:o>s?1:0:a<i?-1:a>i?1:0}}}let N=0;class z{static compare(t,e){let n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return -1;let a=t.leftSE.point.y,s=e.leftSE.point.y,u=t.rightSE.point.y,c=e.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return -1;let n=t.comparePoint(e.leftSE.point);if(n<0)return 1;if(n>0)return -1;let r=e.comparePoint(t.rightSE.point);return 0!==r?r:-1}if(n>r){if(a<s&&a<c)return -1;if(a>s&&a>c)return 1;let n=e.comparePoint(t.leftSE.point);if(0!==n)return n;let r=t.comparePoint(e.rightSE.point);return r<0?1:r>0?-1:1}if(a<s)return -1;if(a>s)return 1;if(i<o){let n=e.comparePoint(t.rightSE.point);if(0!==n)return n}if(i>o){let n=t.comparePoint(e.rightSE.point);if(n<0)return 1;if(n>0)return -1}if(i!==o){let t=u-a,e=i-n,l=c-s,f=o-r;if(t>e&&l<f)return 1;if(t<e&&l>f)return -1}return i>o?1:i<o||u<c?-1:u>c?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,n,r){this.id=++N,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=n,this.windings=r}static fromRing(t,e,n){let r,i,o;let a=D.comparePoints(t,e);if(a<0)r=t,i=e,o=1;else if(a>0)r=e,i=t,o=-1;else throw Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);return new z(new D(r,!0),new D(i,!1),[n],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;let e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;let i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;let a=(t.x-e.x)/r.x,s=e.y+a*r.y;return t.y===s?0:t.y<s?-1:1}getIntersection(t){let e=this.bbox(),n=t.bbox(),r=u(e,n);if(null===r)return null;let i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,c=t.rightSE.point,l=s(e,a)&&0===this.comparePoint(a),f=s(n,i)&&0===t.comparePoint(i),h=s(e,c)&&0===this.comparePoint(c),p=s(n,o)&&0===t.comparePoint(o);if(f&&l)return p&&!h?o:!p&&h?c:null;if(f)return h&&i.x===c.x&&i.y===c.y?null:i;if(l)return p&&o.x===a.x&&o.y===a.y?null:a;if(p&&h)return null;if(p)return o;if(h)return c;let v=I(i,this.vector(),a,t.vector());return null!==v&&s(r,v)?d.round(v.x,v.y):null}split(t){let e=[],n=void 0!==t.events,r=new D(t,!0),i=new D(t,!1),o=this.rightSE;this.replaceRightSE(i),e.push(i),e.push(r);let a=new z(r,o,this.rings.slice(),this.windings.slice());return D.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),D.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),i.checkForConsuming()),e}swapEvents(){let t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,n=t;for(;e.consumedBy;)e=e.consumedBy;for(;n.consumedBy;)n=n.consumedBy;let r=z.compare(e,n);if(0!==r){if(r>0){let t=e;e=n,n=t}if(e.prev===n){let t=e;e=n,n=t}for(let t=0,r=n.rings.length;t<r;t++){let r=n.rings[t],i=n.windings[t],o=e.rings.indexOf(r);-1===o?(e.rings.push(r),e.windings.push(i)):e.windings[o]+=i}n.rings=null,n.windings=null,n.consumedBy=e,n.leftSE.consumedBy=e.leftSE,n.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){let t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;let t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};let e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let t=0,r=this.rings.length;t<r;t++){let r=this.rings[t],i=this.windings[t],o=e.indexOf(r);-1===o?(e.push(r),n.push(i)):n[o]+=i}let i=[],o=[];for(let t=0,r=e.length;t<r;t++){if(0===n[t])continue;let r=e[t],a=r.poly;if(-1===o.indexOf(a)){if(r.isExterior)i.push(a);else{-1===o.indexOf(a)&&o.push(a);let t=i.indexOf(r.poly);-1!==t&&i.splice(t,1)}}}for(let t=0,e=i.length;t<e;t++){let e=i[t].multiPoly;-1===r.indexOf(e)&&r.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;let t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(X.type){case"union":{let n=0===t.length,r=0===e.length;this._isInResult=n!==r;break}case"intersection":{let n,r;t.length<e.length?(n=t.length,r=e.length):(n=e.length,r=t.length),this._isInResult=r===X.numMultiPolys&&n<r;break}case"xor":{let n=Math.abs(t.length-e.length);this._isInResult=n%2==1;break}case"difference":this._isInResult=(1===t.length&&t[0].isSubject)!==(1===e.length&&e[0].isSubject);break;default:throw Error(`Unrecognized operation type found ${X.type}`)}return this._isInResult}}class j{constructor(t,e,n){if(!Array.isArray(t)||0===t.length||(this.poly=e,this.isExterior=n,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1]))throw Error("Input geometry is not a valid Polygon or MultiPolygon");let r=d.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let e=1,n=t.length;e<n;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw Error("Input geometry is not a valid Polygon or MultiPolygon");let n=d.round(t[e][0],t[e][1]);(n.x!==i.x||n.y!==i.y)&&(this.segments.push(z.fromRing(i,n,this)),n.x<this.bbox.ll.x&&(this.bbox.ll.x=n.x),n.y<this.bbox.ll.y&&(this.bbox.ll.y=n.y),n.x>this.bbox.ur.x&&(this.bbox.ur.x=n.x),n.y>this.bbox.ur.y&&(this.bbox.ur.y=n.y),i=n)}(r.x!==i.x||r.y!==i.y)&&this.segments.push(z.fromRing(i,r,this))}getSweepEvents(){let t=[];for(let e=0,n=this.segments.length;e<n;e++){let n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}class B{constructor(t,e){if(!Array.isArray(t))throw Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new j(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,n=t.length;e<n;e++){let n=new j(t[e],this,!1);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=e}getSweepEvents(){let t=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){let n=this.interiorRings[e].getSweepEvents();for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return t}}class F{constructor(t,e){if(!Array.isArray(t))throw Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,n=t.length;e<n;e++){let n=new B(t[e],this);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=e}getSweepEvents(){let t=[];for(let e=0,n=this.polys.length;e<n;e++){let n=this.polys[e].getSweepEvents();for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return t}}class U{static factory(t){let e=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];if(!r.isInResult()||r.ringOut)continue;let i=null,o=r.leftSE,a=r.rightSE,s=[o],u=o.point,c=[];for(;i=o,o=a,s.push(o),o.point!==u;)for(;;){let t=o.getAvailableLinkedEvents();if(0===t.length){let t=s[0].point,e=s[s.length-1].point;throw Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){a=t[0].otherSE;break}let n=null;for(let t=0,e=c.length;t<e;t++)if(c[t].point===o.point){n=t;break}if(null!==n){let t=c.splice(n)[0],r=s.splice(t.index);r.unshift(r[0].otherSE),e.push(new U(r.reverse()));continue}c.push({index:s.length,point:o.point});let r=o.getLeftmostComparator(i);a=t.sort(r)[0].otherSE;break}e.push(new U(s))}return e}constructor(t){this.events=t;for(let e=0,n=t.length;e<n;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point,e=[t];for(let n=1,r=this.events.length-1;n<r;n++){let r=this.events[n].point;0!==M(r,t,this.events[n+1].point)&&(e.push(r),t=r)}if(1===e.length)return null;0===M(e[0],t,e[1])&&e.shift(),e.push(e[0]);let n=this.isExteriorRing()?1:-1,r=this.isExteriorRing()?0:e.length-1,i=this.isExteriorRing()?e.length:-1,o=[];for(let t=r;t!=i;t+=n)o.push([e[t].x,e[t].y]);return o}isExteriorRing(){if(void 0===this._isExteriorRing){let t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,n=this.events.length;e<n;e++){let n=this.events[e];D.compare(t,n)>0&&(t=n)}let e=t.segment.prevInResult(),n=e?e.prevInResult():null;for(;;){if(!e)return null;if(!n)return e.ringOut;if(n.ringOut!==e.ringOut){if(n.ringOut.enclosingRing()!==e.ringOut)return e.ringOut;return e.ringOut.enclosingRing()}n=(e=n.prevInResult())?e.prevInResult():null}}}class V{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){let t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,n=this.interiorRings.length;e<n;e++){let n=this.interiorRings[e].getGeom();null!==n&&t.push(n)}return t}}class H{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){let t=[];for(let e=0,n=this.polys.length;e<n;e++){let n=this.polys[e].getGeom();null!==n&&t.push(n)}return t}_composePolys(t){let e=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];if(!r.poly){if(r.isExteriorRing())e.push(new V(r));else{let t=r.enclosingRing();t.poly||e.push(new V(t)),t.poly.addInterior(r)}}}return e}}class G{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.compare;this.queue=t,this.tree=new a(e),this.segments=[]}process(t){let e,n;let r=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),i;let o=t.isLeft?this.tree.add(r):this.tree.find(r);if(!o)throw Error(`Unable to find segment #${r.id} [${r.leftSE.point.x}, ${r.leftSE.point.y}] -> [${r.rightSE.point.x}, ${r.rightSE.point.y}] in SweepLine tree.`);let a=o,s=o;for(;void 0===e;)null===(a=this.tree.prev(a))?e=null:void 0===a.key.consumedBy&&(e=a.key);for(;void 0===n;)null===(s=this.tree.next(s))?n=null:void 0===s.key.consumedBy&&(n=s.key);if(t.isLeft){let o=null;if(e){let t=e.getIntersection(r);if(null!==t&&(r.isAnEndpoint(t)||(o=t),!e.isAnEndpoint(t))){let n=this._splitSafely(e,t);for(let t=0,e=n.length;t<e;t++)i.push(n[t])}}let a=null;if(n){let t=n.getIntersection(r);if(null!==t&&(r.isAnEndpoint(t)||(a=t),!n.isAnEndpoint(t))){let e=this._splitSafely(n,t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}}if(null!==o||null!==a){let t=null;t=null===o?a:null===a?o:0>=D.comparePoints(o,a)?o:a,this.queue.remove(r.rightSE),i.push(r.rightSE);let e=r.split(t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}i.length>0?(this.tree.remove(r),i.push(t)):(this.segments.push(r),r.prev=e)}else{if(e&&n){let t=e.getIntersection(n);if(null!==t){if(!e.isAnEndpoint(t)){let n=this._splitSafely(e,t);for(let t=0,e=n.length;t<e;t++)i.push(n[t])}if(!n.isAnEndpoint(t)){let e=this._splitSafely(n,t);for(let t=0,n=e.length;t<n;t++)i.push(e[t])}}}this.tree.remove(r)}return i}_splitSafely(t,e){this.tree.remove(t);let n=t.rightSE;this.queue.remove(n);let r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.add(t),r}}let W=void 0!==r&&r.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Y=void 0!==r&&r.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class q{run(t,e,n){X.type=t,d.reset();let r=[new F(e,!0)];for(let t=0,e=n.length;t<e;t++)r.push(new F(n[t],!1));if(X.numMultiPolys=r.length,"difference"===X.type){let t=r[0],e=1;for(;e<r.length;)null!==u(r[e].bbox,t.bbox)?e++:r.splice(e,1)}if("intersection"===X.type)for(let t=0,e=r.length;t<e;t++){let e=r[t];for(let n=t+1,i=r.length;n<i;n++)if(null===u(e.bbox,r[n].bbox))return[]}let i=new a(D.compare);for(let t=0,e=r.length;t<e;t++){let e=r[t].getSweepEvents();for(let t=0,n=e.length;t<n;t++)if(i.insert(e[t]),i.size>W)throw Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}let o=new G(i),s=i.size,c=i.pop();for(;c;){let t=c.key;if(i.size===s){let e=t.segment;throw Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(i.size>W)throw Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>Y)throw Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");let e=o.process(t);for(let t=0,n=e.length;t<n;t++){let n=e[t];void 0===n.consumedBy&&i.insert(n)}s=i.size,c=i.pop()}return d.reset(),new H(U.factory(o.segments)).getGeom()}}let X=new q;return{union:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return X.run("union",t,n)},intersection:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return X.run("intersection",t,n)},xor:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return X.run("xor",t,n)},difference:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return X.run("difference",t,n)}}}()},62789:function(t,e,n){"use strict";var r=n(30825),i=Array.prototype.concat,o=Array.prototype.slice,a=t.exports=function(t){for(var e=[],n=0,a=t.length;n<a;n++){var s=t[n];r(s)?e=i.call(e,o.call(s)):e.push(s)}return e};a.wrap=function(t){return function(){return t(a(arguments))}}},24299:function(t){t.exports=function(){"use strict";function t(t,n,r,i){e(t,r,i),e(n,2*r,2*i),e(n,2*r+1,2*i+1)}function e(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function n(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}var r,i=function(t){return t[0]},o=function(t){return t[1]},a=function(e,n,r,a,s){void 0===n&&(n=i),void 0===r&&(r=o),void 0===a&&(a=64),void 0===s&&(s=Float64Array),this.nodeSize=a,this.points=e;for(var u=e.length<65536?Uint16Array:Uint32Array,c=this.ids=new u(e.length),l=this.coords=new s(2*e.length),f=0;f<e.length;f++)c[f]=f,l[2*f]=n(e[f]),l[2*f+1]=r(e[f]);!function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;(function e(n,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,c=i-o+1,l=Math.log(u),f=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*f*(u-f)/u)*(c-u/2<0?-1:1),p=Math.max(o,Math.floor(i-c*f/u+h)),d=Math.min(a,Math.floor(i+(u-c)*f/u+h));e(n,r,i,p,d,s)}var v=r[2*i+s],m=o,g=a;for(t(n,r,o,i),r[2*a+s]>v&&t(n,r,o,a);m<g;){for(t(n,r,m,g),m++,g--;r[2*m+s]<v;)m++;for(;r[2*g+s]>v;)g--}r[2*o+s]===v?t(n,r,o,g):t(n,r,++g,a),g<=i&&(o=g+1),i<=g&&(a=g-1)}})(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}(c,l,a,0,c.length-1,0)};a.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,c=[0,t.length-1,0],l=[];c.length;){var f=c.pop(),h=c.pop(),p=c.pop();if(h-p<=a){for(var d=p;d<=h;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(t[d]);continue}var v=Math.floor((p+h)/2);s=e[2*v],u=e[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(t[v]);var m=(f+1)%2;(0===f?n<=s:r<=u)&&(c.push(p),c.push(v-1),c.push(m)),(0===f?i>=s:o>=u)&&(c.push(v+1),c.push(h),c.push(m))}return l}(this.ids,this.coords,t,e,n,r,this.nodeSize)},a.prototype.within=function(t,e,r){return function(t,e,r,i,o,a){for(var s=[0,t.length-1,0],u=[],c=o*o;s.length;){var l=s.pop(),f=s.pop(),h=s.pop();if(f-h<=a){for(var p=h;p<=f;p++)n(e[2*p],e[2*p+1],r,i)<=c&&u.push(t[p]);continue}var d=Math.floor((h+f)/2),v=e[2*d],m=e[2*d+1];n(v,m,r,i)<=c&&u.push(t[d]);var g=(l+1)%2;(0===l?r-o<=v:i-o<=m)&&(s.push(h),s.push(d-1),s.push(g)),(0===l?r+o>=v:i+o>=m)&&(s.push(d+1),s.push(f),s.push(g))}return u}(this.ids,this.coords,t,e,r,this.nodeSize)};var s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},u=Math.fround||(r=new Float32Array(1),function(t){return r[0]=+t,r[0]}),c=function(t){this.options=d(Object.create(s),t),this.trees=Array(this.options.maxZoom+1)};function l(t){return{type:"Feature",id:t.id,properties:f(t),geometry:{type:"Point",coordinates:[(t.x-.5)*360,360*Math.atan(Math.exp((180-360*t.y)*Math.PI/180))/Math.PI-90]}}}function f(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return d(d({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function h(t){return t/360+.5}function p(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function d(t,e){for(var n in e)t[n]=e[n];return t}function v(t){return t.x}function m(t){return t.y}return c.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var s="prepare "+t.length+" points";n&&console.time(s),this.points=t;for(var c=[],l=0;l<t.length;l++)t[l].geometry&&c.push(function(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:u(h(r)),y:u(p(i)),zoom:1/0,index:e,parentId:-1}}(t[l],l));this.trees[i+1]=new a(c,v,m,o,Float32Array),n&&console.timeEnd(s);for(var f=i;f>=r;f--){var d=+Date.now();c=this._cluster(c,f),this.trees[f]=new a(c,v,m,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",f,c.length,+Date.now()-d)}return n&&console.timeEnd("total time"),this},c.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],c=u.range(h(n),p(o),h(i),p(r)),f=[],d=0;d<c.length;d+=1){var v=c[d],m=u.points[v];f.push(m.numPoints?l(m):this.points[m.index])}return f},c.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw Error(r);var o=i.points[e];if(!o)throw Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=i.within(o.x,o.y,a),u=[],c=0;c<s.length;c+=1){var f=s[c],h=i.points[f];h.parentId===t&&u.push(h.numPoints?l(h):this.points[h.index])}if(0===u.length)throw Error(r);return u},c.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},c.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,c=(n+1+s)/i,l={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,c),r.points,e,n,i,l),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,c),r.points,i,n,i,l),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,c),r.points,-1,n,i,l),l.features.length?l:null},c.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},c.prototype._appendLeaves=function(t,e,n,r,i){for(var o=this.getChildren(e),a=0;a<o.length;a+=1){var s=o[a],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},c.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0;a<t.length;a+=1){var s=e[t[a]],u=s.numPoints,c=void 0,l=void 0,d=void 0;if(u)c=f(s),l=s.x,d=s.y;else{var v=this.points[s.index];c=v.properties,l=h(v.geometry.coordinates[0]),d=p(v.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(l*i-n)),Math.round(this.options.extent*(d*i-r))]],tags:c},g=void 0;u?g=s.id:this.options.generateId?g=s.index:this.points[s.index].id&&(g=this.points[s.index].id),void 0!==g&&(m.id=g),o.features.push(m)}},c.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},c.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,c=i/(o*Math.pow(2,e)),l=0;l<t.length;l++){var f=t[l];if(!(f.zoom<=e)){f.zoom=e;for(var h=this.trees[e+1],p=h.within(f.x,f.y,c),d=f.numPoints||1,v=d,m=0;m<p.length;m+=1){var g=p[m],y=h.points[g];y.zoom>e&&(v+=y.numPoints||1)}if(v>d&&v>=s){for(var b,x,_,S,w=f.x*d,k=f.y*d,C=a&&d>1?this._map(f,!0):null,E=(l<<5)+(e+1)+this.points.length,A=0;A<p.length;A+=1){var M=p[A],L=h.points[M];if(!(L.zoom<=e)){L.zoom=e;var Z=L.numPoints||1;w+=L.x*Z,k+=L.y*Z,L.parentId=E,a&&(C||(C=this._map(f,!0)),a(C,this._map(L)))}}f.parentId=E,n.push((b=w/v,x=k/v,_=v,S=C,{x:u(b),y:u(x),zoom:1/0,id:E,parentId:-1,numPoints:_,properties:S}))}else if(n.push(f),v>1)for(var P=0;P<p.length;P+=1){var O=p[P],R=h.points[O];R.zoom<=e||(R.zoom=e,n.push(R))}}}return n},c.prototype._getOriginId=function(t){return t-this.points.length>>5},c.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},c.prototype._map=function(t,e){if(t.numPoints)return e?d({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?d({},r):r},c}()},72192:function(t,e,n){var r=n(67564).default;function i(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t.exports=i=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var e,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(t,e,n){t[e]=n.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",f=u.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,n,r,i){var o,a,u=Object.create((n&&n.prototype instanceof b?n:b).prototype);return s(u,"_invoke",{value:(o=new Z(i||[]),a=v,function(n,i){if(a===m)throw Error("Generator is already running");if(a===g){if("throw"===n)throw i;return{value:e,done:!0}}for(o.method=n,o.arg=i;;){var s=o.delegate;if(s){var u=function t(n,r){var i=r.method,o=n.iterator[i];if(o===e)return r.delegate=null,"throw"===i&&n.iterator.return&&(r.method="return",r.arg=e,t(n,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=d(o,n.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var s=a.arg;return s?s.done?(r[n.resultName]=s.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):s:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,y)}(s,o);if(u){if(u===y)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(a===v)throw a=g,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a=m;var c=d(t,r,o);if("normal"===c.type){if(a=o.done?g:"suspendedYield",c.arg===y)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(a=g,o.method="throw",o.arg=c.arg)}})}),u}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=p;var v="suspendedStart",m="executing",g="completed",y={};function b(){}function x(){}function _(){}var S={};h(S,c,function(){return this});var w=Object.getPrototypeOf,k=w&&w(w(P([])));k&&k!==o&&a.call(k,c)&&(S=k);var C=_.prototype=b.prototype=Object.create(S);function E(t){["next","throw","return"].forEach(function(e){h(t,e,function(t){return this._invoke(e,t)})})}function A(t,e){var n;s(this,"_invoke",{value:function(i,o){function s(){return new e(function(n,s){!function n(i,o,s,u){var c=d(t[i],t,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==r(f)&&a.call(f,"__await")?e.resolve(f.__await).then(function(t){n("next",t,s,u)},function(t){n("throw",t,s,u)}):e.resolve(f).then(function(t){l.value=t,s(l)},function(t){return n("throw",t,s,u)})}u(c.arg)}(i,o,n,s)})}return n=n?n.then(s,s):s()}})}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Z(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function P(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(a.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw TypeError(r(t)+" is not iterable")}return x.prototype=_,s(C,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:x,configurable:!0}),x.displayName=h(_,f,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,h(t,f,"GeneratorFunction")),t.prototype=Object.create(C),t},n.awrap=function(t){return{__await:t}},E(A.prototype),h(A.prototype,l,function(){return this}),n.AsyncIterator=A,n.async=function(t,e,r,i,o){void 0===o&&(o=Promise);var a=new A(p(t,e,r,i),o);return n.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(C),h(C,f,"Generator"),h(C,c,function(){return this}),h(C,"toString",function(){return"[object Generator]"}),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=P,Z.prototype={constructor:Z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;L(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:P(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},n}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},67564:function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},28311:function(t,e,n){var r=n(72192)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},32986:function(t,e,n){var r,i;i=r||(r={}),function(t){var e="object"==typeof globalThis?globalThis:"object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(t){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(t){}}(),r=o(i);function o(t,e){return function(n,r){Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0!==e.Reflect&&(r=o(e.Reflect,r)),t(r,e),void 0===e.Reflect&&(e.Reflect=i)}(function(t,e){var n,r=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,o=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,u=({__proto__:[]})instanceof Array,c=!s&&!u,l={create:s?function(){return z(Object.create(null))}:u?function(){return z({__proto__:null})}:function(){return z({})},has:c?function(t,e){return r.call(t,e)}:function(t,e){return e in t},get:c?function(t,e){return r.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},f=Object.getPrototypeOf(Function),h="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[a]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,Z(e,this._cacheKey)&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[a]=function(){return this.entries()},e.prototype._find=function(t,e){if(!Z(this._cacheKey,t)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(Z(this._keys[n],t)){this._cacheIndex=n;break}}return this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function o(t,e){return[t,e]}}(),p="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.keys()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[a]=function(){return this.keys()},t}(),d="function"==typeof WeakMap?WeakMap:function(){var t=l.create(),e=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&l.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?l.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var e;do e="@@WeakMap@@"+function(){var t="function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(16)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(16)):o(new Uint8Array(16),16):o(Array(16),16);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var e="",n=0;n<16;++n){var r=t[n];(4===n||6===n||8===n)&&(e+="-"),r<16&&(e+="0"),e+=r.toString(16).toLowerCase()}return e}();while(l.has(t,e));return t[e]=!0,e}function i(t,n){if(!r.call(t,e)){if(!n)return;Object.defineProperty(t,e,{value:l.create()})}return t[e]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}}(),v=i?Symbol.for("@reflect-metadata:registry"):void 0,m=(!w(v)&&C(e.Reflect)&&Object.isExtensible(e.Reflect)&&(n=e.Reflect[v]),w(n)&&(n=function(){w(v)||void 0===e.Reflect||v in e.Reflect||"function"!=typeof e.Reflect.defineMetadata||(n=(t=e.Reflect).defineMetadata,r=t.hasOwnMetadata,i=t.getOwnMetadata,o=t.getOwnMetadataKeys,a=t.deleteMetadata,s=new d,u={isProviderFor:function(t,e){var n=s.get(t);return w(n)?!!o(t,e).length&&(w(n)&&(n=new p,s.set(t,n)),n.add(e),!0):n.has(e)},OrdinaryDefineOwnMetadata:n,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:a});var t,n,r,i,o,a,s,u,c,l,f,m=new d,g={registerProvider:function(t){if(!Object.isExtensible(g))throw Error("Cannot add provider to a frozen registry.");switch(!0){case u===t:break;case w(c):c=t;break;case c===t:break;case w(l):l=t;break;case l===t:break;default:void 0===f&&(f=new p),f.add(t)}},getProvider:y,setProvider:function(t,e,n){if(!function(t){if(w(t))throw TypeError();return c===t||l===t||!w(f)&&f.has(t)}(n))throw Error("Metadata provider not registered.");var r=y(t,e);if(r!==n){if(!w(r))return!1;var i=m.get(t);w(i)&&(i=new h,m.set(t,i)),i.set(e,n)}return!0}};return g;function y(t,e){var n,r=m.get(t);return w(r)||(n=r.get(e)),w(n)&&(n=function(t,e){if(!w(c)){if(c.isProviderFor(t,e))return c;if(!w(l)){if(l.isProviderFor(t,e))return c;if(!w(f))for(var n=O(f);;){var r=R(n);if(!r)return;var i=r.value;if(i.isProviderFor(t,e))return I(n),i}}}if(!w(u)&&u.isProviderFor(t,e))return u}(t,e),w(n)||(w(r)&&(r=new h,m.set(t,r)),r.set(e,n))),n}}()),!w(v)&&C(e.Reflect)&&Object.isExtensible(e.Reflect)&&Object.defineProperty(e.Reflect,v,{enumerable:!1,configurable:!1,writable:!1,value:n}),n),g=function(t){var e=new d,n={isProviderFor:function(t,n){var r=e.get(t);return!w(r)&&r.has(n)},OrdinaryDefineOwnMetadata:function(t,e,n,i){r(n,i,!0).set(t,e)},OrdinaryHasOwnMetadata:function(t,e,n){var i=r(e,n,!1);return!w(i)&&!!i.has(t)},OrdinaryGetOwnMetadata:function(t,e,n){var i=r(e,n,!1);if(!w(i))return i.get(t)},OrdinaryOwnMetadataKeys:function(t,e){var n=[],i=r(t,e,!1);if(w(i))return n;for(var o=O(i.keys()),a=0;;){var s=R(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(t){try{I(o)}finally{throw t}}a++}},OrdinaryDeleteMetadata:function(t,n,i){var o=r(n,i,!1);if(w(o)||!o.delete(t))return!1;if(0===o.size){var a=e.get(n);w(a)||(a.delete(i),0===a.size&&e.delete(a))}return!0}};return m.registerProvider(n),n;function r(r,i,o){var a=e.get(r),s=!1;if(w(a)){if(!o)return;a=new h,e.set(r,a),s=!0}var u=a.get(i);if(w(u)){if(!o)return;if(u=new h,a.set(i,u),!t.setProvider(r,i,n))throw a.delete(i),s&&e.delete(r),Error("Wrong provider for target.")}return u}}(m);function y(t,e,n){var r=N(e,n,!1);return!w(r)&&!!r.OrdinaryHasOwnMetadata(t,e,n)}function b(t,e,n){var r=N(e,n,!1);if(!w(r))return r.OrdinaryGetOwnMetadata(t,e,n)}function x(t,e,n,r){N(n,r,!0).OrdinaryDefineOwnMetadata(t,e,n,r)}function _(t,e){var n=N(t,e,!1);return n?n.OrdinaryOwnMetadataKeys(t,e):[]}function S(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function w(t){return void 0===t}function k(t){return null===t}function C(t){return"object"==typeof t?null!==t:"function"==typeof t}function E(t){var e=function(t,e){switch(S(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=P(t,o);if(void 0!==r){var i=r.call(t,n);if(C(i))throw TypeError();return i}return function(t,e){if("string"===e){var n=t.toString;if(M(n)){var r=n.call(t);if(!C(r))return r}var i=t.valueOf;if(M(i)){var r=i.call(t);if(!C(r))return r}}else{var i=t.valueOf;if(M(i)){var r=i.call(t);if(!C(r))return r}var o=t.toString;if(M(o)){var r=o.call(t);if(!C(r))return r}}throw TypeError()}(t,"default"===n?"number":n)}(t,3);return"symbol"==typeof e?e:""+e}function A(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function M(t){return"function"==typeof t}function L(t){return"function"==typeof t}function Z(t,e){return t===e||t!=t&&e!=e}function P(t,e){var n=t[e];if(null!=n){if(!M(n))throw TypeError();return n}}function O(t){var e=P(t,a);if(!M(e))throw TypeError();var n=e.call(t);if(!C(n))throw TypeError();return n}function R(t){var e=t.next();return!e.done&&e}function I(t){var e=t.return;e&&e.call(t)}function D(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===f||e!==f)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function N(t,e,n){var r=m.getProvider(t,e);if(!w(r))return r;if(n){if(m.setProvider(t,e,g))return g;throw Error("Illegal state.")}}function z(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,n,r){if(w(n)){if(!A(t)||!L(e))throw TypeError();return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!w(r)&&!k(r)){if(!L(r))throw TypeError();e=r}}return e}(t,e)}if(!A(t)||!C(e)||!C(r)&&!w(r)&&!k(r))throw TypeError();return k(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!w(o)&&!k(o)){if(!C(o))throw TypeError();r=o}}return r}(t,e,n=E(n),r)}),t("metadata",function(t,e){return function(n,r){if(!C(n)||!w(r)&&!function(t){switch(S(t)){case 3:case 4:return!0;default:return!1}}(r))throw TypeError();x(t,e,n,r)}}),t("defineMetadata",function(t,e,n,r){if(!C(n))throw TypeError();return w(r)||(r=E(r)),x(t,e,n,r)}),t("hasMetadata",function(t,e,n){if(!C(e))throw TypeError();return w(n)||(n=E(n)),function t(e,n,r){if(y(e,n,r))return!0;var i=D(n);return!k(i)&&t(e,i,r)}(t,e,n)}),t("hasOwnMetadata",function(t,e,n){if(!C(e))throw TypeError();return w(n)||(n=E(n)),y(t,e,n)}),t("getMetadata",function(t,e,n){if(!C(e))throw TypeError();return w(n)||(n=E(n)),function t(e,n,r){if(y(e,n,r))return b(e,n,r);var i=D(n);if(!k(i))return t(e,i,r)}(t,e,n)}),t("getOwnMetadata",function(t,e,n){if(!C(e))throw TypeError();return w(n)||(n=E(n)),b(t,e,n)}),t("getMetadataKeys",function(t,e){if(!C(t))throw TypeError();return w(e)||(e=E(e)),function t(e,n){var r=_(e,n),i=D(e);if(null===i)return r;var o=t(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new p,s=[],u=0;u<r.length;u++){var c=r[u],l=a.has(c);l||(a.add(c),s.push(c))}for(var f=0;f<o.length;f++){var c=o[f],l=a.has(c);l||(a.add(c),s.push(c))}return s}(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!C(t))throw TypeError();return w(e)||(e=E(e)),_(t,e)}),t("deleteMetadata",function(t,e,n){if(!C(e)||(w(n)||(n=E(n)),!C(e)))throw TypeError();w(n)||(n=E(n));var r=N(e,n,!1);return!w(r)&&r.OrdinaryDeleteMetadata(t,e,n)})})},45461:function(t,e,n){"use strict";var r=n(58800);e.Z=r},49174:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(38425);function i(t,e){void 0===e&&(e={});var n=Number(t[0]),i=Number(t[1]),o=Number(t[2]),a=Number(t[3]);if(6===t.length)throw Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[n,i],u=[n,a],c=[o,a],l=[o,i];return(0,r.yu)([[s,l,c,u,s]],e.properties,{bbox:t,id:e.id})}},7996:function(t,e,n){"use strict";var r=n(24274);function i(t){var e=[1/0,1/0,-1/0,-1/0];return(0,r.pZ)(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}i.default=i,e.Z=i},38425:function(t,e,n){"use strict";n.d(e,{DL:function(){return f},Ht:function(){return p},Kn:function(){return m},Tu:function(){return u},rQ:function(){return r},tw:function(){return l},uf:function(){return c},vi:function(){return h},vs:function(){return d},xm:function(){return a},yu:function(){return s},zL:function(){return o}});var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function o(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function a(t,e,n){if(void 0===n&&(n={}),!t)throw Error("coordinates is required");if(!Array.isArray(t))throw Error("coordinates must be an Array");if(t.length<2)throw Error("coordinates must be at least 2 numbers long");if(!v(t[0])||!v(t[1]))throw Error("coordinates must contain numbers");return o({type:"Point",coordinates:t},e,n)}function s(t,e,n){void 0===n&&(n={});for(var r=0;r<t.length;r++){var i=t[r];if(i.length<4)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:t},e,n)}function u(t,e,n){if(void 0===n&&(n={}),t.length<2)throw Error("coordinates must be an array of two or more positions");return o({type:"LineString",coordinates:t},e,n)}function c(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function l(t,e,n){return void 0===n&&(n={}),o({type:"MultiPolygon",coordinates:t},e,n)}function f(t,e){void 0===e&&(e="kilometers");var n=i[e];if(!n)throw Error(e+" units is invalid");return t*n}function h(t){return t%(2*Math.PI)*180/Math.PI}function p(t){return t%360*Math.PI/180}function d(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw Error("length must be a positive number");return f(function(t,e){void 0===e&&(e="kilometers");var n=i[e];if(!n)throw Error(e+" units is invalid");return t/n}(t,e),n)}function v(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function m(t){return!!t&&t.constructor===Object}},17037:function(t,e,n){"use strict";function r(t){if(!t)throw Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw Error("coord must be GeoJSON Point or an Array of numbers")}function i(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function o(t){return"Feature"===t.type?t.geometry:t}function a(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}n.d(e,{c9:function(){return r},oL:function(){return a},r7:function(){return i},wA:function(){return o}}),n(38425)},24274:function(t,e,n){"use strict";n.d(e,{By:function(){return i},nG:function(){return o},pZ:function(){return function t(e,n,r){if(null!==e)for(var i,o,a,s,u,c,l,f,h=0,p=0,d=e.type,v="FeatureCollection"===d,m="Feature"===d,g=v?e.features.length:1,y=0;y<g;y++){u=(f=!!(l=v?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var b=0;b<u;b++){var x=0,_=0;if(null!==(s=f?l.geometries[b]:l)){c=s.coordinates;var S=s.type;switch(h=r&&("Polygon"===S||"MultiPolygon"===S)?1:0,S){case null:break;case"Point":if(!1===n(c,p,y,x,_))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(i=0;i<c.length;i++){if(!1===n(c[i],p,y,x,_))return!1;p++,"MultiPoint"===S&&x++}"LineString"===S&&x++;break;case"Polygon":case"MultiLineString":for(i=0;i<c.length;i++){for(o=0;o<c[i].length-h;o++){if(!1===n(c[i][o],p,y,x,_))return!1;p++}"MultiLineString"===S&&x++,"Polygon"===S&&_++}"Polygon"===S&&x++;break;case"MultiPolygon":for(i=0;i<c.length;i++){for(o=0,_=0;o<c[i].length;o++){for(a=0;a<c[i][o].length-h;a++){if(!1===n(c[i][o][a],p,y,x,_))return!1;p++}_++}x++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===t(s.geometries[i],n,r))return!1;break;default:throw Error("Unknown Geometry Type")}}}}}}});var r=n(38425);function i(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function o(t,e){!function(t,e){var n,r,i,o,a,s,u,c,l,f,h=0,p="FeatureCollection"===t.type,d="Feature"===t.type,v=p?t.features.length:1;for(n=0;n<v;n++){for(i=0,s=p?t.features[n].geometry:d?t.geometry:t,c=p?t.features[n].properties:d?t.properties:{},l=p?t.features[n].bbox:d?t.bbox:void 0,f=p?t.features[n].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1;i<a;i++){if(null===(o=u?s.geometries[i]:s)){if(!1===e(null,h,c,l,f))return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,h,c,l,f))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],h,c,l,f))return!1;break;default:throw Error("Unknown Geometry Type")}}h++}}(t,function(t,n,i,o,a){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":if(!1===e((0,r.zL)(t,i,{bbox:o,id:a}),n,0))return!1;return}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var c=0;c<t.coordinates.length;c++){var l={type:s,coordinates:t.coordinates[c]};if(!1===e((0,r.zL)(l,i),n,c))return!1}})}},69703:function(t,e,n){"use strict";n.d(e,{CR:function(){return l},Jh:function(){return u},XA:function(){return c},ZT:function(){return i},_T:function(){return a},ev:function(){return h},mG:function(){return s},pi:function(){return o},pr:function(){return f}});var r=function(t,e){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)0>e.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function s(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(a,s)}u((r=r.apply(t,e||[])).next())})}function u(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function c(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function h(t,e,n){if(n||2==arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError}}]);